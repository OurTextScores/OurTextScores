"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[862],{4862:(e,t,r)=>{r.r(t),r.d(t,{default:()=>eR});var n,a=r(5155),o=r(2115),i=r(3321),s=r(1463),l=r(2619).Buffer;let u=function(){!function(){let e;var t,r=(t="u">typeof document&&document.currentScript?document.currentScript.src:void 0,"u">typeof __filename&&(t=t||__filename),function(e){var r,n,a,o,i,u,c,d,f,m,p,h,g,y,b,v,x,w,S,k,E,_,T,j,A,C,e=void 0!==(e=e||{})?e:{};e.ready=new Promise(function(e,t){r=e,n=t}),e.expectedDataFileDownloads||(e.expectedDataFileDownloads=0),e.expectedDataFileDownloads++,function(t){window.encodeURIComponent(window.location.pathname.toString().substring(0,window.location.pathname.toString().lastIndexOf("/"))+"/");var r,n,a="webmscore.lib.data";"function"!=typeof e.locateFilePackage||e.locateFile||(e.locateFile=e.locateFilePackage,U("warning: you defined Module.locateFilePackage, that has been renamed to Module.locateFile (using your locateFilePackage for now)"));var o=e.locateFile?e.locateFile(a,""):a,i=t.remote_package_size;t.package_uuid;var s=null,l=e.getPreloadedPackage?e.getPreloadedPackage(o,i):null;function u(){function r(e,t){if(!e)throw t+Error().stack}function n(n){r(n,"Loading data file failed."),r(n instanceof ArrayBuffer,"bad input to processPackageData");var a=new Uint8Array(n),o={data:null,cachedOffset:4096164,cachedIndexes:[-1,-1],cachedChunks:[null,null],offsets:[0,2041,4089,6137,8185,10233,12281,14329,16377,18425,20473,22521,24569,26617,28665,30713,32761,34809,36857,38905,40953,43001,45049,47097,49145,51193,53241,55289,57337,59385,61433,63481,65529,67577,69625,71673,73721,75769,77817,79865,81913,83961,86009,88057,90105,92153,94201,96249,98297,100345,102393,104441,106489,108537,110585,112633,114681,116729,118777,120825,122873,124921,126969,129017,131065,133113,135161,137209,139257,141305,143353,145401,147445,149493,151541,153589,155637,157685,159733,161781,163829,165877,167925,169973,172021,174069,176117,178165,180213,182261,184309,186357,188405,190453,192501,194549,196597,198645,200695,202743,204791,206839,208887,210935,212983,215031,217079,219127,221175,223223,225271,227319,229367,231415,233463,235511,237559,239607,241655,243703,245751,247799,249847,251895,253943,255997,258045,260093,262141,264189,266237,268285,270333,272381,274429,276477,278525,280573,282621,284669,286717,288765,290813,292861,294909,296957,299005,301053,303101,305149,307197,309245,311293,313347,315395,317451,319499,321547,323595,325643,327691,329739,331787,333835,335883,337931,339979,342027,344075,346123,348171,350219,352267,354315,356363,358411,360459,362514,364562,366610,368658,370706,372748,374796,376844,378892,380940,382982,385030,387078,389130,391178,393226,395274,397322,399370,401381,403437,405279,407327,409375,411376,413400,415415,417463,419386,421434,423469,425513,427484,429532,431580,433573,434919,435863,436459,437850,439898,441946,443994,446042,448090,450138,452186,454234,456282,458330,460378,462426,464474,466522,468570,470618,472666,474714,476762,478810,480858,482913,484961,487009,489057,491105,493153,495201,497249,499297,501345,503393,505441,507489,509537,511585,513633,515681,517729,519777,521825,523873,525921,527969,530017,532065,534113,536161,538209,540257,542305,544353,546401,548449,550497,552545,554593,556641,558689,560737,562785,564833,566881,568929,570977,573025,575073,577121,579169,581217,583265,585313,587361,589409,591457,593505,595553,597601,599649,601697,603745,605793,607841,609889,611937,613985,616033,618081,620129,622177,624225,626273,628321,630369,632417,634465,636513,638561,640609,642657,644705,646753,648801,650849,652897,654945,656993,659041,661089,663137,665185,667233,669281,671329,673377,675425,677473,679521,681569,683617,685665,687713,689761,691809,693857,695905,697953,700001,702049,704097,706145,708193,710241,712289,714337,716385,718433,720481,722529,724577,726625,728677,730733,732781,734829,736877,738925,740973,743021,745069,747117,749165,751213,753261,755309,757357,759405,761453,763501,765529,767343,769156,771016,772881,774623,776476,778270,780254,782302,784350,786398,788446,790489,792537,794585,796633,798681,800729,802777,804831,806879,808927,810975,813023,815071,817119,819167,821215,823263,825311,827359,829328,831311,833359,835407,837455,839503,841551,843599,845647,847695,849743,851791,853839,855887,857935,859983,862031,864079,866127,868175,870223,872271,874319,876367,878415,880463,882511,884559,886607,888655,890703,892751,894799,896847,898895,900943,902991,905039,907087,909135,911183,913231,915279,917327,919375,921423,923471,925519,927567,929615,931663,933711,935759,937807,939855,941903,943951,945999,948047,950095,952143,954191,956239,958287,960335,962383,964431,966479,968527,970575,972623,974671,976719,978767,980815,982863,984911,986959,989007,991055,993103,995151,997199,999247,1001295,1003343,1005391,1007439,1009487,1011535,1013583,1015631,1017679,1019727,1021775,1023823,1025871,1027919,1029967,1032015,1034063,1036111,1038159,1040207,1042255,1044303,1046351,1048399,1050447,1052495,1054548,1056596,1058644,1060692,1062740,1064788,1066836,1068884,1070932,1072980,1075028,1077076,1079124,1081172,1083220,1085268,1087316,1089364,1091412,1093460,1095508,1097556,1099613,1101661,1103709,1105753,1107801,1109849,1111897,1113945,1115993,1118041,1120089,1122137,1124185,1126233,1128287,1130335,1132383,1134431,1136479,1138527,1140575,1142623,1144671,1146719,1148767,1150815,1152863,1154911,1156959,1159002,1161050,1163098,1165146,1167194,1169242,1171290,1173338,1175386,1177434,1179482,1181530,1183578,1185626,1187674,1189722,1191770,1193818,1194978,1195298,1195687,1196185,1196683,1197129,1197589,1198104,1198406,1198755,1199110,1199517,1199902,1200278,1200611,1201768,1203816,1205864,1207914,1209537,1211352,1213400,1215448,1217496,1219544,1221592,1223640,1225688,1227736,1229784,1231832,1233880,1235928,1237976,1240024,1242072,1244120,1246168,1248216,1250264,1252312,1254360,1256408,1258456,1260504,1262552,1264600,1266648,1268696,1270744,1272792,1274840,1276888,1278936,1280984,1283032,1285080,1287128,1289176,1291224,1293272,1295320,1297368,1299416,1301464,1303512,1305560,1307608,1309656,1311704,1313752,1315800,1317848,1319896,1321944,1323992,1326040,1328088,1330136,1332184,1334232,1336280,1338328,1340376,1342424,1344472,1346520,1348568,1350616,1352664,1354712,1356760,1358808,1360856,1362904,1364952,1367e3,1369048,1371096,1373144,1375192,1377240,1379288,1381336,1383384,1385432,1387480,1389528,1391576,1393624,1395672,1397720,1399768,1401816,1403864,1405912,1407960,1410008,1412056,1414104,1416152,1418200,1420248,1422296,1424344,1426392,1428440,1430488,1432536,1434584,1436632,1438680,1440728,1442776,1444824,1446637,1447326,1447760,1448284,1448756,1449256,1449682,1450203,1450704,1451184,1451646,1452167,1452733,1453127,1453580,1454018,1454493,1454983,1455761,1456462,1457117,1457828,1458564,1459256,1460022,1460678,1461428,1462197,1462764,1463460,1463928,1464449,1464979,1465701,1466035,1466430,1466763,1467229,1467764,1468232,1468889,1469492,1469960,1470523,1471157,1471628,1472114,1472646,1473230,1473768,1474239,1474709,1475499,1477547,1479595,1481643,1483691,1485739,1487787,1489835,1491883,1493397,1493868,1494214,1494499,1494733,1494995,1495281,1495540,1495818,1496188,1496522,1496935,1497343,1497711,1498128,1498527,1498894,1499209,1499609,1499961,1500451,1502220,1504268,1506316,1508364,1510412,1512460,1514508,1516556,1517834,1518304,1518816,1519290,1519766,1520245,1520764,1521283,1521763,1522277,1522799,1523317,1523800,1524278,1524803,1525297,1525794,1526240,1526691,1527200,1527499,1527800,1528145,1528478,1528827,1529193,1529779,1530070,1530331,1530636,1530902,1531202,1531468,1531829,1532233,1532624,1532991,1533346,1533837,1534284,1534709,1535103,1535485,1535950,1536351,1536722,1537016,1537377,1537740,1538166,1538517,1538982,1539415,1539780,1540098,1540407,1540720,1541017,1541783,1543831,1545879,1547927,1549975,1552023,1554071,1556119,1558167,1560215,1562263,1564311,1566359,1568407,1570455,1572503,1574551,1576599,1578647,1580695,1582743,1584791,1586839,1588887,1590935,1592983,1594896,1595612,1596152,1596676,1597191,1597647,1597981,1598448,1598925,1599428,1599896,1600427,1600971,1601525,1601850,1603830,1605878,1607635,1609683,1611731,1613779,1615827,1617875,1619923,1621971,1624019,1626067,1628115,1630163,1632211,1634259,1636307,1638355,1640403,1642451,1644499,1646547,1648595,1650643,1652691,1654739,1656787,1658835,1660883,1662931,1664979,1667027,1669075,1671123,1673171,1675219,1677267,1679315,1681363,1683411,1685459,1687507,1689555,1691603,1693651,1695699,1697747,1699795,1701843,1703891,1705939,1707987,1710035,1712083,1714131,1716179,1718227,1720275,1722323,1724371,1726419,1728467,1730515,1732563,1734611,1736659,1738707,1740755,1742803,1744851,1746899,1748947,1750995,1753043,1755091,1757139,1759187,1761235,1763283,1765331,1767379,1769427,1771475,1773523,1775571,1777619,1779667,1781715,1783763,1785811,1787859,1789907,1791955,1794003,1796051,1798099,1800147,1802195,1804243,1806291,1808339,1810387,1812435,1814483,1816531,1818579,1820627,1822675,1824723,1826771,1828819,1830867,1831774,1832250,1832735,1833243,1833749,1834169,1834728,1835247,1835685,1836236,1836755,1837259,1837686,1838130,1838585,1839068,1839750,1840468,1841137,1841860,1842550,1843304,1844040,1844805,1845572,1846057,1846609,1847322,1847624,1847915,1848204,1848795,1849452,1850071,1850719,1851442,1852055,1852694,1853301,1853946,1854438,1854900,1855926,1857974,1860027,1861561,1863552,1865600,1867648,1869696,1871744,1873792,1875840,1877888,1879936,1881984,1884032,1886080,1888128,1890176,1892224,1894272,1896320,1898368,1900416,1902464,1904512,1906560,1908608,1910656,1912704,1914752,1916800,1918848,1920896,1922944,1924992,1927040,1929088,1931136,1933184,1935232,1937280,1939328,1941376,1943424,1945472,1947520,1949568,1951616,1953664,1955712,1957760,1959808,1961856,1963904,1965952,1968e3,1970048,1972096,1974144,1976192,1978240,1980288,1982336,1984384,1986432,1988480,1990528,1992576,1994624,1995682,1996143,1996520,1997078,1997713,1997962,1998214,1998521,1998989,1999397,1999942,2000456,2000996,2001529,2001917,2002477,2002994,2003636,2004140,2004636,2005090,2006954,2009010,2011058,2013106,2015154,2017202,2019250,2021298,2023346,2025394,2027442,2029490,2031538,2033586,2035634,2037682,2039730,2041778,2043826,2045874,2047922,2049970,2050846,2051400,2051982,2052712,2053348,2054067,2054829,2055570,2056262,2056839,2057450,2058083,2058635,2059263,2059980,2060514,2061160,2061816,2062422,2062965,2063520,2064177,2064713,2065289,2065941,2066568,2067296,2067957,2068632,2069334,2070012,2070673,2071392,2071819,2072568,2073123,2073672,2074280,2074801,2075465,2076079,2076731,2077481,2078135,2078797,2079430,2080105,2080827,2081445,2082094,2082690,2083332,2083946,2084616,2085254,2085761,2086347,2086878,2087490,2088081,2088693,2089179,2089721,2090405,2091058,2091723,2092446,2093208,2093834,2094487,2095129,2095765,2096494,2097159,2097866,2098516,2099076,2099695,2100432,2101186,2101788,2102312,2102891,2103376,2103802,2104374,2104923,2105568,2106125,2106776,2107340,2107832,2108392,2108897,2109450,2110027,2110579,2111077,2111696,2112267,2112876,2113332,2113920,2114576,2115220,2115820,2116405,2116959,2117555,2118212,2118786,2119244,2119906,2120561,2121253,2121976,2122678,2123475,2124118,2124655,2125175,2125721,2126310,2127008,2127753,2128418,2129194,2129970,2130727,2131419,2132137,2132858,2133568,2134338,2134905,2135483,2136240,2136951,2137731,2138207,2138795,2139353,2140034,2140682,2141362,2142056,2142572,2143144,2143617,2144202,2144950,2145739,2146430,2147166,2147933,2148596,2149202,2150084,2150985,2151849,2152704,2153550,2154385,2155056,2155769,2156501,2157255,2157996,2158919,2159872,2160736,2161595,2162430,2163193,2163818,2164568,2165268,2166181,2166947,2167624,2168253,2168949,2169639,2170373,2171029,2171835,2172787,2173542,2174251,2175110,2175870,2176676,2177402,2178171,2179014,2179808,2180593,2181497,2182341,2182974,2183440,2183968,2184507,2184977,2185604,2186073,2186543,2187182,2187648,2188129,2188756,2189224,2189771,2190297,2190767,2191398,2191865,2192337,2192988,2193453,2193929,2194618,2195232,2196106,2196679,2198181,2200229,2202286,2204334,2206382,2208430,2210478,2212526,2214574,2216622,2218670,2220718,2222766,2224814,2226862,2228910,2230958,2233006,2235054,2237102,2239150,2241198,2243246,2245294,2247342,2249390,2251438,2253486,2255534,2257582,2259630,2261678,2263726,2265774,2267822,2269870,2271918,2273966,2276014,2278062,2280110,2282158,2284206,2286254,2288302,2290350,2292398,2294446,2296494,2298542,2300590,2302638,2304686,2306734,2308782,2310830,2312878,2314926,2316974,2319022,2321070,2323118,2325166,2327214,2329262,2331310,2333358,2335406,2337454,2339502,2341550,2343598,2345646,2347694,2349742,2351790,2353838,2355886,2357934,2359982,2362030,2364078,2366126,2368174,2370222,2372270,2374318,2376366,2378414,2380462,2382510,2384558,2386606,2388654,2390702,2392750,2394798,2396846,2398894,2400942,2402990,2405038,2407086,2409134,2411182,2413230,2415278,2417326,2419374,2421422,2423470,2425518,2427566,2429614,2431662,2433710,2435758,2437806,2439854,2441902,2443950,2445998,2448046,2450094,2452142,2454190,2456238,2458286,2460334,2462382,2464430,2466472,2468527,2470575,2472631,2474679,2476727,2478775,2480823,2482871,2484919,2486967,2489015,2491063,2493111,2495159,2497207,2499255,2501303,2503359,2505407,2507455,2509503,2511551,2513599,2515647,2517695,2519743,2521791,2523839,2525887,2527935,2529983,2532031,2534079,2536127,2538175,2540223,2542271,2544319,2546367,2548415,2550463,2552511,2554559,2556607,2558655,2560703,2562751,2564799,2566847,2568895,2570943,2572991,2575039,2577087,2579135,2581183,2583231,2585279,2587327,2589375,2591423,2593471,2595519,2597567,2599615,2601663,2603711,2605759,2607807,2609855,2611903,2613951,2615999,2618047,2620095,2622143,2624191,2626239,2628287,2630335,2632383,2634431,2636479,2638527,2640575,2642623,2644671,2646719,2648767,2650815,2652863,2654911,2656959,2659007,2661055,2663103,2665151,2667199,2669247,2671295,2673343,2675391,2677439,2679487,2681535,2683583,2685631,2687679,2689727,2691775,2693823,2695871,2697919,2699967,2702015,2704063,2706111,2708159,2710207,2712255,2714303,2716351,2718399,2720447,2722495,2724543,2726591,2728639,2730687,2732735,2734783,2736831,2738879,2740927,2742975,2745023,2747071,2749119,2751167,2753215,2755263,2757311,2759359,2761407,2763455,2765503,2767551,2769599,2771647,2773695,2775743,2777791,2779839,2781887,2783935,2785983,2788031,2790079,2792127,2794175,2796223,2798271,2800319,2802367,2804415,2806463,2808511,2810559,2812607,2814655,2816703,2818751,2820799,2822847,2824895,2826943,2828991,2831039,2833087,2835135,2837183,2839231,2841279,2843327,2845375,2847423,2849471,2851519,2853567,2855615,2857663,2859711,2861759,2863807,2865855,2867903,2869951,2871999,2874047,2876095,2878143,2880191,2882239,2884287,2886335,2888383,2890431,2892479,2894527,2896575,2898623,2900671,2902719,2904767,2906815,2908863,2910911,2912959,2915007,2917055,2919103,2921151,2923199,2925247,2927295,2929343,2931391,2933439,2935487,2937535,2939583,2941631,2943679,2945727,2947775,2949823,2951871,2953919,2955967,2958015,2960063,2962111,2964159,2966207,2968255,2970303,2972351,2974399,2976447,2978495,2980543,2982591,2984639,2986687,2988735,2990783,2992831,2994879,2996927,2998975,3001023,3003071,3005119,3007167,3009215,3011263,3013311,3015359,3017407,3019455,3021503,3023551,3025599,3027647,3029695,3031743,3033791,3035839,3037887,3039935,3041983,3044031,3046079,3048127,3050175,3052223,3054271,3056319,3058367,3060415,3062463,3064511,3066559,3068607,3070655,3072703,3074751,3076799,3078847,3080895,3082943,3084991,3087039,3089087,3091135,3093183,3095231,3097279,3099327,3101375,3103423,3105471,3107519,3109567,3111615,3113663,3115711,3117759,3119807,3121855,3123903,3125951,3127999,3130047,3132095,3134143,3136191,3138239,3140287,3142335,3144383,3146431,3148479,3150527,3152575,3154623,3156671,3158719,3160767,3162815,3164863,3166911,3168959,3171007,3173055,3175103,3177151,3179199,3181247,3183295,3185343,3187391,3189439,3191487,3193535,3195583,3197631,3199679,3201727,3203775,3205823,3207871,3209919,3211967,3214015,3216063,3218111,3220159,3222207,3224255,3226303,3228351,3230399,3232447,3234495,3236543,3238591,3240639,3242687,3244735,3246783,3248831,3250879,3252927,3254975,3257023,3259071,3261119,3263167,3265215,3267263,3269311,3271359,3273407,3275455,3277503,3279551,3281599,3283647,3285695,3287743,3289791,3291839,3293887,3295930,3297978,3300026,3302074,3304122,3306170,3308218,3310266,3312314,3314362,3316410,3318458,3320506,3322554,3324602,3326650,3328698,3330746,3332794,3334842,3336890,3338938,3340986,3343034,3345082,3347130,3349178,3351226,3353274,3355322,3357370,3359418,3361466,3363514,3365562,3367610,3369658,3371706,3373754,3375802,3377850,3379898,3381946,3383994,3386042,3388090,3390138,3392186,3394234,3396282,3398330,3400378,3402426,3404474,3406522,3408570,3410618,3412666,3414714,3416762,3418810,3420858,3422906,3424954,3427002,3429050,3431098,3433146,3435194,3437242,3439290,3441338,3443386,3445434,3447482,3449530,3451578,3453626,3455674,3457722,3459770,3461818,3463866,3465914,3467962,3470010,3472058,3474106,3476152,3478200,3480248,3482296,3484344,3486392,3488440,3490488,3492536,3494584,3496632,3498680,3500728,3502776,3504824,3506872,3508920,3510968,3513016,3515064,3517112,3519160,3521208,3523256,3525304,3527352,3529400,3531448,3533496,3535544,3537592,3539640,3541688,3543736,3545784,3547832,3549880,3551928,3553976,3556024,3558072,3560120,3562168,3564216,3566264,3568312,3570360,3572408,3574456,3576504,3578552,3580600,3582648,3584696,3586744,3588792,3590840,3592878,3593587,3594338,3595234,3596130,3597e3,3597902,3598697,3599427,3600170,3601149,3602125,3602681,3603557,3604361,3605058,3605668,3606261,3606867,3607569,3608226,3608919,3609567,3610244,3610890,3611595,3612288,3612982,3613719,3614537,3615507,3616311,3617186,3618051,3618800,3619396,3620349,3621372,3622046,3622859,3623681,3624371,3624991,3625581,3626163,3626853,3627525,3628229,3628913,3629600,3630261,3630982,3631674,3632364,3633046,3633811,3634760,3635545,3636426,3637324,3638146,3638745,3639664,3640691,3641505,3642162,3643079,3643826,3644480,3645052,3645644,3646285,3646971,3647657,3648300,3648985,3649680,3650417,3651119,3651809,3652496,3653248,3654205,3655109,3656e3,3656909,3657769,3658547,3659194,3660146,3661145,3661940,3662641,3663574,3664332,3665067,3665744,3666372,3666982,3667675,3668416,3669132,3669897,3670591,3671305,3672056,3672741,3673484,3674207,3674928,3675638,3676403,3677324,3678365,3679455,3680319,3680676,3681102,3682353,3683062,3683586,3684104,3684633,3685199,3685878,3686522,3687281,3688050,3688669,3689377,3690026,3690680,3691326,3691915,3692466,3693114,3693851,3694467,3694996,3695634,3696234,3696813,3697392,3697933,3698463,3698991,3699585,3700106,3700689,3701345,3701934,3702618,3703340,3704015,3704685,3705437,3706114,3706691,3707306,3707893,3708485,3709127,3709689,3710287,3710865,3711430,3712011,3712637,3713187,3713752,3714299,3715006,3715675,3716286,3716967,3717593,3718246,3718981,3719743,3720480,3721239,3722055,3722654,3723242,3723941,3724620,3725357,3726022,3726700,3727445,3728187,3728763,3729436,3730112,3730859,3731510,3732229,3732772,3733476,3734153,3734926,3735636,3736399,3736933,3737446,3737967,3738494,3739024,3739582,3740164,3740719,3741236,3742028,3742684,3743282,3743917,3744548,3745304,3745946,3746617,3747216,3747898,3748511,3749231,3749882,3750580,3751335,3752040,3752778,3753414,3754005,3754560,3755210,3755808,3756564,3757201,3757850,3758540,3759251,3759896,3760512,3761135,3761729,3762382,3762941,3763610,3764264,3764872,3765352,3766046,3766605,3767195,3767918,3768530,3769234,3769828,3770592,3771178,3771870,3772370,3772950,3773586,3774310,3774979,3775569,3776251,3776956,3777672,3778465,3779109,3779627,3780253,3781007,3781808,3782485,3783090,3783709,3784332,3785100,3785853,3786659,3787261,3787853,3788407,3789005,3789694,3790499,3791182,3792064,3792828,3793618,3794422,3795188,3795908,3796634,3797404,3798206,3798982,3799748,3800522,3801276,3802106,3802826,3803559,3804292,3805047,3805796,3806591,3807321,3808125,3808913,3809658,3810414,3811171,3811906,3812724,3813427,3814180,3814980,3815766,3816505,3817259,3818041,3818463,3818852,3819234,3820082,3820886,3821598,3822279,3823070,3823811,3824667,3825377,3825883,3826668,3827102,3827498,3827872,3828681,3829042,3829594,3830293,3830633,3831515,3832230,3832991,3833660,3834213,3834781,3835335,3835874,3836581,3837134,3837808,3838510,3839156,3839777,3840495,3841181,3841830,3842483,3843111,3843770,3844465,3845213,3845875,3846570,3847245,3847892,3848545,3849140,3849780,3850421,3851162,3851866,3852499,3853149,3853799,3854477,3855113,3855909,3856671,3857331,3858141,3858821,3859591,3860403,3861160,3862014,3862746,3863526,3864228,3864963,3865697,3866492,3867316,3867997,3868770,3869595,3870381,3871129,3871928,3872601,3873260,3873983,3874618,3875365,3876129,3876921,3877541,3878192,3879001,3879849,3880677,3881531,3882289,3882952,3883625,3884347,3885067,3885759,3886412,3887045,3887703,3888326,3889001,3889667,3890415,3891178,3891944,3892635,3893394,3894118,3894880,3895643,3896338,3897002,3897682,3898370,3899080,3899877,3900539,3901133,3901835,3902451,3903276,3904020,3904754,3905454,3906146,3906436,3906785,3907064,3907367,3907632,3908004,3908319,3908566,3908890,3909186,3909514,3909816,3910133,3910428,3910761,3911056,3911385,3911637,3912022,3912376,3912627,3912942,3913239,3913555,3913845,3914179,3914482,3914873,3915151,3915506,3915799,3916179,3916477,3916711,3917007,3917291,3917623,3917900,3918232,3918509,3918901,3919170,3919528,3919797,3920169,3920443,3920725,3921048,3921351,3921664,3921965,3922305,3922588,3922942,3923215,3923605,3923895,3924242,3924574,3924878,3925194,3925499,3925807,3926105,3926438,3926709,3927055,3927323,3927695,3927984,3928342,3928646,3928940,3929252,3929547,3929866,3930149,3930495,3930769,3931119,3931387,3931771,3932062,3932384,3932705,3932985,3933308,3933593,3933920,3934209,3934577,3934851,3935196,3935460,3935836,3936183,3936497,3936844,3937129,3937502,3937798,3938173,3938484,3938879,3939164,3939513,3939785,3940158,3940450,3940784,3941066,3941356,3941676,3941973,3942306,3942598,3942922,3943199,3943543,3943799,3944178,3944463,3944760,3945057,3945356,3945652,3945955,3946275,3946539,3946884,3947167,3947550,3947810,3948191,3948489,3948760,3949057,3949358,3949661,3949961,3950277,3950560,3950898,3951170,3951512,3951786,3952164,3952520,3952828,3953126,3953425,3953704,3953985,3954302,3954588,3954916,3955196,3955541,3955805,3956194,3956480,3956763,3957049,3957347,3957654,3957943,3958278,3958544,3958913,3959186,3959548,3959843,3960127,3960425,3960720,3961037,3961338,3961648,3961945,3962297,3962569,3962921,3963183,3963556,3963825,3964127,3964420,3964718,3965049,3965326,3965669,3965939,3966287,3966551,3966890,3967188,3967445,3967734,3968018,3968338,3968630,3968961,3969251,3969574,3969845,3970162,3970432,3970783,3971081,3971380,3971696,3972003,3972328,3972629,3972978,3973263,3973607,3973868,3974234,3974509,3974849,3975130,3975436,3975746,3976048,3976365,3976649,3977002,3977276,3977619,3977883,3978257,3978548,3978859,3979137,3979443,3979756,3980057,3980382,3980673,3981016,3981294,3981653,3981917,3982295,3982618,3982860,3983175,3983466,3983798,3984084,3984428,3984716,3985077,3985350,3985704,3985961,3986348,3986633,3986917,3987223,3987519,3987843,3988122,3988459,3988723,3989072,3989337,3989713,3989990,3990350,3990618,3990894,3991197,3991488,3991800,3992096,3992434,3992714,3993059,3993332,3993702,3994005,3994354,3994698,3995014,3995340,3995629,3995920,3996213,3996548,3996826,3997175,3997447,3997831,3998127,3998474,3998770,3999069,3999385,3999690,4000024,4000325,4000665,4000947,4001295,4001560,4001933,4002224,4002562,4002845,4003139,4003455,4003742,4004079,4004362,4004708,4004982,4005333,4005601,4005992,4006275,4006591,4006892,4007167,4007457,4007763,4008081,4008373,4008717,4008978,4009324,4009571,4009950,4010248,4010497,4010812,4011109,4011429,4011731,4012081,4012376,4012730,4013007,4013359,4013608,4013982,4014283,4014550,4014855,4015129,4015447,4015736,4016067,4016347,4016690,4016962,4017312,4017580,4017970,4018247,4018530,4018835,4019132,4019439,4019742,4020071,4020372,4020721,4021002,4021377,4021669,4022017,4022322,4022624,4022933,4023240,4023565,4023866,4024265,4024548,4024896,4025152,4025482,4025785,4026133,4026411,4026696,4027009,4027306,4027610,4027872,4028221,4028495,4028856,4029121,4029504,4029802,4030106,4030401,4030700,4031005,4031310,4031670,4031963,4032353,4032628,4032938,4033184,4033557,4033866,4034105,4034425,4034715,4035028,4035319,4035625,4035896,4036206,4036484,4036806,4037101,4037449,4037790,4038094,4038442,4038748,4039060,4039354,4039731,4040009,4040357,4040626,4040991,4041286,4041632,4041917,4042221,4042532,4042838,4043216,4043508,4043869,4044152,4044501,4044774,4045150,4045434,4045756,4046071,4046345,4046666,4046957,4047278,4047558,4047911,4048186,4048571,4048826,4049205,4049548,4049862,4050160,4050454,4050780,4051059,4051378,4051646,4051994,4052264,4052620,4052884,4053258,4053558,4053834,4054134,4054427,4054742,4055039,4055350,4055642,4055989,4056267,4056612,4056876,4057247,4057553,4057800,4058159,4058451,4058764,4059047,4059367,4059642,4059987,4060283,4060669,4060974,4061398,4061699,4061954,4062236,4062517,4062830,4063120,4063441,4063723,4064059,4064323,4064688,4064972,4065323,4065604,4065901,4066201,4066484,4066801,4067064,4067422,4067683,4068022,4068279,4068652,4068981,4069234,4069544,4069835,4070141,4070423,4070752,4071042,4071370,4071636,4072014,4072298,4072629,4072909,4073182,4073477,4073771,4074096,4074354,4074701,4074962,4075314,4075559,4075934,4076229,4076500,4076795,4077097,4077418,4077717,4078055,4078348,4078688,4078962,4079322,4079586,4079962,4080277,4080532,4080831,4081113,4081428,4081719,4082042,4082312,4082654,4082920,4083280,4083535,4083897,4084174,4084451,4084759,4085051,4085388,4085681,4086029,4086311,4086670,4086944,4087319,4087584,4087943,4088232,4088531,4088845,4089149,4089475,4089776,4090123,4090408,4090744,4091016,4091387,4091677,4092015,4092295,4092571,4092882,4093174,4093527,4093789,4094138,4094413,4094763,4095030,4095405,4095710,4095994],sizes:[2041,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2044,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2050,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2054,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2054,2048,2056,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2055,2048,2048,2048,2048,2042,2048,2048,2048,2048,2042,2048,2048,2052,2048,2048,2048,2048,2048,2011,2056,1842,2048,2048,2001,2024,2015,2048,1923,2048,2035,2044,1971,2048,2048,1993,1346,944,596,1391,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2055,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2052,2056,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2028,1814,1813,1860,1865,1742,1853,1794,1984,2048,2048,2048,2048,2043,2048,2048,2048,2048,2048,2048,2054,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,1969,1983,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2053,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2057,2048,2048,2044,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2054,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2043,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,1160,320,389,498,498,446,460,515,302,349,355,407,385,376,333,1157,2048,2048,2050,1623,1815,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,1813,689,434,524,472,500,426,521,501,480,462,521,566,394,453,438,475,490,778,701,655,711,736,692,766,656,750,769,567,696,468,521,530,722,334,395,333,466,535,468,657,603,468,563,634,471,486,532,584,538,471,470,790,2048,2048,2048,2048,2048,2048,2048,2048,1514,471,346,285,234,262,286,259,278,370,334,413,408,368,417,399,367,315,400,352,490,1769,2048,2048,2048,2048,2048,2048,2048,1278,470,512,474,476,479,519,519,480,514,522,518,483,478,525,494,497,446,451,509,299,301,345,333,349,366,586,291,261,305,266,300,266,361,404,391,367,355,491,447,425,394,382,465,401,371,294,361,363,426,351,465,433,365,318,309,313,297,766,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,1913,716,540,524,515,456,334,467,477,503,468,531,544,554,325,1980,2048,1757,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,907,476,485,508,506,420,559,519,438,551,519,504,427,444,455,483,682,718,669,723,690,754,736,765,767,485,552,713,302,291,289,591,657,619,648,723,613,639,607,645,492,462,1026,2048,2053,1534,1991,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,1058,461,377,558,635,249,252,307,468,408,545,514,540,533,388,560,517,642,504,496,454,1864,2056,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,876,554,582,730,636,719,762,741,692,577,611,633,552,628,717,534,646,656,606,543,555,657,536,576,652,627,728,661,675,702,678,661,719,427,749,555,549,608,521,664,614,652,750,654,662,633,675,722,618,649,596,642,614,670,638,507,586,531,612,591,612,486,542,684,653,665,723,762,626,653,642,636,729,665,707,650,560,619,737,754,602,524,579,485,426,572,549,645,557,651,564,492,560,505,553,577,552,498,619,571,609,456,588,656,644,600,585,554,596,657,574,458,662,655,692,723,702,797,643,537,520,546,589,698,745,665,776,776,757,692,718,721,710,770,567,578,757,711,780,476,588,558,681,648,680,694,516,572,473,585,748,789,691,736,767,663,606,882,901,864,855,846,835,671,713,732,754,741,923,953,864,859,835,763,625,750,700,913,766,677,629,696,690,734,656,806,952,755,709,859,760,806,726,769,843,794,785,904,844,633,466,528,539,470,627,469,470,639,466,481,627,468,547,526,470,631,467,472,651,465,476,689,614,874,573,1502,2048,2057,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2042,2055,2048,2056,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2056,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2043,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2046,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2038,709,751,896,896,870,902,795,730,743,979,976,556,876,804,697,610,593,606,702,657,693,648,677,646,705,693,694,737,818,970,804,875,865,749,596,953,1023,674,813,822,690,620,590,582,690,672,704,684,687,661,721,692,690,682,765,949,785,881,898,822,599,919,1027,814,657,917,747,654,572,592,641,686,686,643,685,695,737,702,690,687,752,957,904,891,909,860,778,647,952,999,795,701,933,758,735,677,628,610,693,741,716,765,694,714,751,685,743,723,721,710,765,921,1041,1090,864,357,426,1251,709,524,518,529,566,679,644,759,769,619,708,649,654,646,589,551,648,737,616,529,638,600,579,579,541,530,528,594,521,583,656,589,684,722,675,670,752,677,577,615,587,592,642,562,598,578,565,581,626,550,565,547,707,669,611,681,626,653,735,762,737,759,816,599,588,699,679,737,665,678,745,742,576,673,676,747,651,719,543,704,677,773,710,763,534,513,521,527,530,558,582,555,517,792,656,598,635,631,756,642,671,599,682,613,720,651,698,755,705,738,636,591,555,650,598,756,637,649,690,711,645,616,623,594,653,559,669,654,608,480,694,559,590,723,612,704,594,764,586,692,500,580,636,724,669,590,682,705,716,793,644,518,626,754,801,677,605,619,623,768,753,806,602,592,554,598,689,805,683,882,764,790,804,766,720,726,770,802,776,766,774,754,830,720,733,733,755,749,795,730,804,788,745,756,757,735,818,703,753,800,786,739,754,782,422,389,382,848,804,712,681,791,741,856,710,506,785,434,396,374,809,361,552,699,340,882,715,761,669,553,568,554,539,707,553,674,702,646,621,718,686,649,653,628,659,695,748,662,695,675,647,653,595,640,641,741,704,633,650,650,678,636,796,762,660,810,680,770,812,757,854,732,780,702,735,734,795,824,681,773,825,786,748,799,673,659,723,635,747,764,792,620,651,809,848,828,854,758,663,673,722,720,692,653,633,658,623,675,666,748,763,766,691,759,724,762,763,695,664,680,688,710,797,662,594,702,616,825,744,734,700,692,290,349,279,303,265,372,315,247,324,296,328,302,317,295,333,295,329,252,385,354,251,315,297,316,290,334,303,391,278,355,293,380,298,234,296,284,332,277,332,277,392,269,358,269,372,274,282,323,303,313,301,340,283,354,273,390,290,347,332,304,316,305,308,298,333,271,346,268,372,289,358,304,294,312,295,319,283,346,274,350,268,384,291,322,321,280,323,285,327,289,368,274,345,264,376,347,314,347,285,373,296,375,311,395,285,349,272,373,292,334,282,290,320,297,333,292,324,277,344,256,379,285,297,297,299,296,303,320,264,345,283,383,260,381,298,271,297,301,303,300,316,283,338,272,342,274,378,356,308,298,299,279,281,317,286,328,280,345,264,389,286,283,286,298,307,289,335,266,369,273,362,295,284,298,295,317,301,310,297,352,272,352,262,373,269,302,293,298,331,277,343,270,348,264,339,298,257,289,284,320,292,331,290,323,271,317,270,351,298,299,316,307,325,301,349,285,344,261,366,275,340,281,306,310,302,317,284,353,274,343,264,374,291,311,278,306,313,301,325,291,343,278,359,264,378,323,242,315,291,332,286,344,288,361,273,354,257,387,285,284,306,296,324,279,337,264,349,265,376,277,360,268,276,303,291,312,296,338,280,345,273,370,303,349,344,316,326,289,291,293,335,278,349,272,384,296,347,296,299,316,305,334,301,340,282,348,265,373,291,338,283,294,316,287,337,283,346,274,351,268,391,283,316,301,275,290,306,318,292,344,261,346,247,379,298,249,315,297,320,302,350,295,354,277,352,249,374,301,267,305,274,318,289,331,280,343,272,350,268,390,277,283,305,297,307,303,329,301,349,281,375,292,348,305,302,309,307,325,301,399,283,348,256,330,303,348,278,285,313,297,304,262,349,274,361,265,383,298,304,295,299,305,305,360,293,390,275,310,246,373,309,239,320,290,313,291,306,271,310,278,322,295,348,341,304,348,306,312,294,377,278,348,269,365,295,346,285,304,311,306,378,292,361,283,349,273,376,284,322,315,274,321,291,321,280,353,275,385,255,379,343,314,298,294,326,279,319,268,348,270,356,264,374,300,276,300,293,315,297,311,292,347,278,345,264,371,306,247,359,292,313,283,320,275,345,296,386,305,424,301,255,282,281,313,290,321,282,336,264,365,284,351,281,297,300,283,317,263,358,261,339,257,373,329,253,310,291,306,282,329,290,328,266,378,284,331,280,273,295,294,325,258,347,261,352,245,375,295,271,295,302,321,299,338,293,340,274,360,264,376,315,255,299,282,315,291,323,270,342,266,360,255,362,277,277,308,292,337,293,348,282,359,274,375,265,359,289,299,314,304,326,301,347,285,336,272,371,290,338,280,276,311,292,353,262,349,275,350,267,375,305,284,170],successes:[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,1,1,0,0,0,0,0,1,1,1,0,0,1,1,1,0,1,0,1,1,1,0,0,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,0,0,0,0,1,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]};o.data=a,r("object"==typeof eR,"LZ4 not present - was your app build with  -s LZ4=1  ?"),eR.loadPackage({metadata:t,compressedData:o}),e.removeRunDependency("datafile_webmscore.lib.data")}e.FS_createPath("/","fonts",!0,!0),e.FS_createPath("/fonts","musejazz",!0,!0),e.FS_createPath("/fonts","campania",!0,!0),e.FS_createPath("/fonts","edwin",!0,!0),e.FS_createPath("/fonts","leland",!0,!0),e.FS_createPath("/fonts","bravura",!0,!0),e.FS_createPath("/fonts","gootville",!0,!0),e.FS_createPath("/fonts","mscore",!0,!0),e.FS_createPath("/fonts","petaluma",!0,!0),e.FS_createPath("/fonts","finalemaestro",!0,!0),e.FS_createPath("/fonts","finalebroadway",!0,!0),e.FS_createPath("/fonts","smufl",!0,!0),e.FS_createPath("/","engraving",!0,!0),e.FS_createPath("/engraving","styles",!0,!0),e.FS_createPath("/","styles",!0,!0),e.FS_createPath("/","mpe",!0,!0),e.addRunDependency("datafile_webmscore.lib.data"),e.preloadResults||(e.preloadResults={}),e.preloadResults["webmscore.lib.data"]={fromCache:!1},l?(n(l),l=null):s=n}l||(r=function(e){s?(s(e),s=null):l=e},(n=new XMLHttpRequest).open("GET",o,!0),n.responseType="arraybuffer",n.onprogress=function(t){var r=i;if(t.total&&(r=t.total),t.loaded){n.addedTotal?e.dataFileDownloads[o].loaded=t.loaded:(n.addedTotal=!0,e.dataFileDownloads||(e.dataFileDownloads={}),e.dataFileDownloads[o]={loaded:t.loaded,total:r});var a=0,s=0,l=0;for(var u in e.dataFileDownloads){var c=e.dataFileDownloads[u];a+=c.total,s+=c.loaded,l++}a=Math.ceil(a*e.expectedDataFileDownloads/l),e.setStatus&&e.setStatus("Downloading data... ("+s+"/"+a+")")}else!e.dataFileDownloads&&e.setStatus&&e.setStatus("Downloading data...")},n.onerror=function(e){throw Error("NetworkError for: "+o)},n.onload=function(e){if(200==n.status||304==n.status||206==n.status||0==n.status&&n.response)r(n.response);else throw Error(n.statusText+" : "+n.responseURL)},n.send(null)),e.calledRun?u():(e.preRun||(e.preRun=[]),e.preRun.push(u))}({files:[{filename:"/fonts/musejazz/MuseJazzText.woff2",start:0,end:107796,audio:0},{filename:"/fonts/campania/Campania.woff2",start:107796,end:145484,audio:0},{filename:"/fonts/edwin/Edwin-Roman.woff2",start:145484,end:200512,audio:0},{filename:"/fonts/edwin/Edwin-Bold.woff2",start:200512,end:255796,audio:0},{filename:"/fonts/edwin/Edwin-Italic.woff2",start:255796,end:313016,audio:0},{filename:"/fonts/edwin/Edwin-BdIta.woff2",start:313016,end:371224,audio:0},{filename:"/fonts/mscoreTab.woff2",start:371224,end:381524,audio:0},{filename:"/fonts/mscore-BC.woff2",start:381524,end:385976,audio:0},{filename:"/fonts/leland/LelandText.woff2",start:385976,end:400628,audio:0},{filename:"/fonts/bravura/BravuraText.woff2",start:400628,end:794740,audio:0},{filename:"/fonts/gootville/GootvilleText.woff2",start:794740,end:810876,audio:0},{filename:"/fonts/mscore/MScoreText.woff2",start:810876,end:831088,audio:0},{filename:"/fonts/petaluma/PetalumaText.woff2",start:831088,end:1060180,audio:0},{filename:"/fonts/petaluma/PetalumaScript.woff2",start:1060180,end:1110288,audio:0},{filename:"/fonts/finalemaestro/FinaleMaestroText.woff2",start:1110288,end:1134316,audio:0},{filename:"/fonts/finalebroadway/FinaleBroadwayText.woff2",start:1134316,end:1163264,audio:0},{filename:"/fonts/leland/Leland.woff2",start:1163264,end:1200628,audio:0},{filename:"/fonts/leland/metadata.json",start:1200628,end:1232041,audio:0},{filename:"/fonts/bravura/Bravura.woff2",start:1232041,end:1478033,audio:0},{filename:"/fonts/bravura/metadata.json",start:1478033,end:1584714,audio:0},{filename:"/fonts/mscore/mscore.woff2",start:1584714,end:1602574,audio:0},{filename:"/fonts/mscore/metadata.json",start:1602574,end:1644933,audio:0},{filename:"/fonts/gootville/Gootville.woff2",start:1644933,end:1661561,audio:0},{filename:"/fonts/gootville/metadata.json",start:1661561,end:1781225,audio:0},{filename:"/fonts/musejazz/MuseJazz.woff2",start:1781225,end:1834617,audio:0},{filename:"/fonts/musejazz/metadata.json",start:1834617,end:1863839,audio:0},{filename:"/fonts/petaluma/Petaluma.woff2",start:1863839,end:2093211,audio:0},{filename:"/fonts/petaluma/metadata.json",start:2093211,end:2180394,audio:0},{filename:"/fonts/finalemaestro/FinaleMaestro.woff2",start:2180394,end:2320666,audio:0},{filename:"/fonts/finalemaestro/metadata.json",start:2320666,end:2363713,audio:0},{filename:"/fonts/finalebroadway/FinaleBroadway.woff2",start:2363713,end:2408417,audio:0},{filename:"/fonts/finalebroadway/metadata.json",start:2408417,end:2415949,audio:0},{filename:"/fonts/smufl/glyphnames.json",start:2415949,end:2717632,audio:0},{filename:"/fonts/smufl/ranges.json",start:2717632,end:2816428,audio:0},{filename:"/fonts/fonts_tablature.xml",start:2816428,end:2865736,audio:0},{filename:"/fonts/fonts_figuredbass.xml",start:2865736,end:2870098,audio:0},{filename:"/fonts/FreeSans.woff2",start:2870098,end:3138270,audio:0},{filename:"/fonts/FreeSerif.woff2",start:3138270,end:3762718,audio:0},{filename:"/fonts/FreeSerifBold.woff2",start:3762718,end:3966970,audio:0},{filename:"/fonts/FreeSerifItalic.woff2",start:3966970,end:4147954,audio:0},{filename:"/fonts/FreeSerifBoldItalic.woff2",start:4147954,end:4265822,audio:0},{filename:"/engraving/styles/migration-306-style-Edwin.mss",start:4265822,end:4270716,audio:0},{filename:"/engraving/styles/migration-306-style-Leland.mss",start:4270716,end:4271899,audio:0},{filename:"/engraving/styles/legacy-style-defaults-v2.mss",start:4271899,end:4325664,audio:0},{filename:"/engraving/styles/legacy-style-defaults-v3.mss",start:4325664,end:4379409,audio:0},{filename:"/engraving/styles/legacy-style-defaults-v1.mss",start:4379409,end:4433160,audio:0},{filename:"/engraving/styles/legacy-style-defaults-v302.mss",start:4433160,end:4495013,audio:0},{filename:"/engraving/styles/gp-style.mss",start:4495013,end:4496529,audio:0},{filename:"/styles/chords_std.xml",start:4496529,end:4507623,audio:0},{filename:"/instruments.xml",start:4507623,end:5186510,audio:0},{filename:"/mpe/general_strings_articulations_profile.json",start:5186510,end:5490517,audio:0},{filename:"/mpe/general_percussion_articulations_profile.json",start:5490517,end:5770927,audio:0},{filename:"/mpe/general_keyboard_articulations_profile.json",start:5770927,end:5964608,audio:0},{filename:"/mpe/general_winds_articulations_profile.json",start:5964608,end:6207560,audio:0},{filename:"/mpe/general_voice_articulations_profile.json",start:6207560,end:6442574,audio:0}],remote_package_size:4100260,package_uuid:"e018a3fd-3e00-4e48-bbb3-ccea89f1cfd6"});var M={};for(a in e)e.hasOwnProperty(a)&&(M[a]=e[a]);var N="./this.program",P=function(e,t){throw t},I=!1,F=!1,D=!1,L=!1;I=!0,F="function"==typeof importScripts,D="object"==typeof s&&"object"==typeof s.versions&&"string"==typeof s.versions.node,L=!I&&!D&&!F;var R="";function B(t){return e.locateFile?e.locateFile(t,R):R+t}D?(R=F?require("path").dirname(R)+"/":__dirname+"/",o=function(e,t){return c||(c=require("fs")),d||(d=require("path")),e=d.normalize(e),c.readFileSync(e,t?null:"utf8")},u=function(e){var t=o(e,!0);return t.buffer||(t=new Uint8Array(t)),H(t.buffer),t},s.argv.length>1&&(N=s.argv[1].replace(/\\/g,"/")),s.argv.slice(2),P=function(e){s.exit(e)},e.inspect=function(){return"[Emscripten Module object]"}):L?("u">typeof read&&(o=function(e){return read(e)}),u=function(e){var t;return"function"==typeof readbuffer?new Uint8Array(readbuffer(e)):(H("object"==typeof(t=read(e,"binary"))),t)},"u">typeof scriptArgs&&scriptArgs,"function"==typeof quit&&(P=function(e){quit(e)}),"u">typeof print&&("u"<typeof console&&(console={}),console.log=print,console.warn=console.error="u">typeof printErr?printErr:print)):(I||F)&&(F?R=self.location.href:document.currentScript&&(R=document.currentScript.src),t&&(R=t),R=0!==R.indexOf("blob:")?R.substr(0,R.lastIndexOf("/")+1):"",o=function(e){var t=new XMLHttpRequest;return t.open("GET",e,!1),t.send(null),t.responseText},F&&(u=function(e){var t=new XMLHttpRequest;return t.open("GET",e,!1),t.responseType="arraybuffer",t.send(null),new Uint8Array(t.response)}),i=function(e,t,r){var n=new XMLHttpRequest;n.open("GET",e,!0),n.responseType="arraybuffer",n.onload=function(){200==n.status||0==n.status&&n.response?t(n.response):r()},n.onerror=r,n.send(null)});var O=e.print||console.log.bind(console),U=e.printErr||console.warn.bind(console);for(a in M)M.hasOwnProperty(a)&&(e[a]=M[a]);function z(e){z.shown||(z.shown={}),z.shown[e]||(z.shown[e]=1,U(e))}M=null,e.arguments&&e.arguments,e.thisProgram&&(N=e.thisProgram),e.quit&&(P=e.quit);var X=0,$=function(e){X=e};e.wasmBinary&&(f=e.wasmBinary),e.noExitRuntime&&(m=e.noExitRuntime),"object"!=typeof WebAssembly&&ev("no native wasm support detected");var W=!1;function H(e,t){e||ev("Assertion failed: "+t)}function G(t){var r=e["_"+t];return H(r,"Cannot call unknown function "+t+", make sure it is exported"),r}function q(e,t,r,n,a){var o,i={string:function(e){var t=0;if(null!=e&&0!==e){var r=(e.length<<2)+1;Q(e,t=rr(r),r)}return t},array:function(e){var t,r,n=rr(e.length);return t=e,r=n,y.set(t,r),n}},s=G(e),l=[],u=0;if(n)for(var c=0;c<n.length;c++){var d=i[r[c]];d?(0===u&&(u=re()),l[c]=d(n[c])):l[c]=n[c]}var f=s.apply(null,l);return o=f,f="string"===t?K(o):"boolean"===t?!!o:o,0!==u&&rt(u),f}var V="u">typeof TextDecoder?new TextDecoder("utf8"):void 0;function Y(e,t,r){for(var n=t+r,a=t;e[a]&&!(a>=n);)++a;if(a-t>16&&e.subarray&&V)return V.decode(e.subarray(t,a));for(var o="";t<a;){var i=e[t++];if(!(128&i)){o+=String.fromCharCode(i);continue}var s=63&e[t++];if((224&i)==192){o+=String.fromCharCode((31&i)<<6|s);continue}var l=63&e[t++];if((i=(240&i)==224?(15&i)<<12|s<<6|l:(7&i)<<18|s<<12|l<<6|63&e[t++])<65536)o+=String.fromCharCode(i);else{var u=i-65536;o+=String.fromCharCode(55296|u>>10,56320|1023&u)}}return o}function K(e,t){return e?Y(b,e,t):""}function Z(e,t,r,n){if(!(n>0))return 0;for(var a=r,o=r+n-1,i=0;i<e.length;++i){var s=e.charCodeAt(i);if(s>=55296&&s<=57343&&(s=65536+((1023&s)<<10)|1023&e.charCodeAt(++i)),s<=127){if(r>=o)break;t[r++]=s}else if(s<=2047){if(r+1>=o)break;t[r++]=192|s>>6,t[r++]=128|63&s}else if(s<=65535){if(r+2>=o)break;t[r++]=224|s>>12,t[r++]=128|s>>6&63,t[r++]=128|63&s}else{if(r+3>=o)break;t[r++]=240|s>>18,t[r++]=128|s>>12&63,t[r++]=128|s>>6&63,t[r++]=128|63&s}}return t[r]=0,r-a}function Q(e,t,r){return Z(e,b,t,r)}function J(e){for(var t=0,r=0;r<e.length;++r){var n=e.charCodeAt(r);n>=55296&&n<=57343&&(n=65536+((1023&n)<<10)|1023&e.charCodeAt(++r)),n<=127?++t:n<=2047?t+=2:n<=65535?t+=3:t+=4}return t}var ee="u">typeof TextDecoder?new TextDecoder("utf-16le"):void 0;function et(e,t){for(var r=e,n=r>>1,a=n+t/2;!(n>=a)&&x[n];)++n;if((r=n<<1)-e>32&&ee)return ee.decode(b.subarray(e,r));for(var o=0,i="";;){var s=v[e+2*o>>1];if(0==s||o==t/2)return i;++o,i+=String.fromCharCode(s)}}function er(e,t,r){if(void 0===r&&(r=0x7fffffff),r<2)return 0;for(var n=t,a=(r-=2)<2*e.length?r/2:e.length,o=0;o<a;++o){var i=e.charCodeAt(o);v[t>>1]=i,t+=2}return v[t>>1]=0,t-n}function en(e){return 2*e.length}function ea(e,t){for(var r=0,n="";!(r>=t/4);){var a=w[e+4*r>>2];if(0==a)break;if(++r,a>=65536){var o=a-65536;n+=String.fromCharCode(55296|o>>10,56320|1023&o)}else n+=String.fromCharCode(a)}return n}function eo(e,t,r){if(void 0===r&&(r=0x7fffffff),r<4)return 0;for(var n=t,a=n+r-4,o=0;o<e.length;++o){var i=e.charCodeAt(o);if(i>=55296&&i<=57343&&(i=65536+((1023&i)<<10)|1023&e.charCodeAt(++o)),w[t>>2]=i,(t+=4)+4>a)break}return w[t>>2]=0,t-n}function ei(e){for(var t=0,r=0;r<e.length;++r){var n=e.charCodeAt(r);n>=55296&&n<=57343&&++r,t+=4}return t}function es(e){var t=J(e)+1,r=t2(t);return r&&Z(e,y,r,t),r}function el(e,t,r){for(var n=0;n<e.length;++n)y[0|t++]=e.charCodeAt(n);r||(y[0|t]=0)}function eu(t){g=t,e.HEAP8=y=new Int8Array(t),e.HEAP16=v=new Int16Array(t),e.HEAP32=w=new Int32Array(t),e.HEAPU8=b=new Uint8Array(t),e.HEAPU16=x=new Uint16Array(t),e.HEAPU32=S=new Uint32Array(t),e.HEAPF32=k=new Float32Array(t),e.HEAPF64=E=new Float64Array(t)}var ec=e.INITIAL_MEMORY||0x1000000;(p=e.wasmMemory?e.wasmMemory:new WebAssembly.Memory({initial:ec/65536,maximum:32768}))&&(g=p.buffer),ec=g.byteLength,eu(g);var ed=[],ef=[],em=[],ep=[],eh=0,eg=null;function ey(t){eh++,e.monitorRunDependencies&&e.monitorRunDependencies(eh)}function eb(t){if(eh--,e.monitorRunDependencies&&e.monitorRunDependencies(eh),0==eh&&eg){var r=eg;eg=null,r()}}function ev(t){e.onAbort&&e.onAbort(t),U(t+=""),W=!0,t="abort("+t+"). Build with -s ASSERTIONS=1 for more info.";var r=new WebAssembly.RuntimeError(t);throw n(r),r}e.preloadedImages={},e.preloadedAudios={};var ex="webmscore.lib.mem.wasm";function ew(e,t){return String.prototype.startsWith?e.startsWith(t):0===e.indexOf(t)}function eS(e){return ew(e,"data:application/octet-stream;base64,")}function ek(e){return ew(e,"file://")}var eE="webmscore.lib.wasm";function e_(){try{if(f)return new Uint8Array(f);if(u)return u(eE);throw"both async and sync fetching of the wasm failed"}catch(e){ev(e)}}function eT(t){for(;t.length>0;){var r=t.shift();if("function"==typeof r){r(e);continue}var n=r.func;"number"==typeof n?void 0===r.arg?h.get(n)():h.get(n)(r.arg):n(void 0===r.arg?null:r.arg)}}function ej(t){if(ej.recursionGuard=(0|ej.recursionGuard)+1,ej.recursionGuard>1)return t;var r=e.___cxa_demangle||e.__cxa_demangle;H(r);var n=re();try{var a=t;a.startsWith("__Z")&&(a=a.substr(1));var o=J(a)+1,i=rr(o);Q(a,i,o);var s=rr(4),l=r(i,0,0,s);if(0===w[s>>2]&&l)return K(l)}catch(e){}finally{t4(l),rt(n),ej.recursionGuard<2&&--ej.recursionGuard}return t}function eA(){var e=Error();if(!e.stack){try{throw Error()}catch(t){e=t}if(!e.stack)return"(no stack trace available)"}return e.stack.toString()}eS(eE)||(eE=B(eE));var eC=[];function eM(e){this.excPtr=e,this.ptr=e-16,this.set_type=function(e){w[this.ptr+8>>2]=e},this.get_type=function(){return w[this.ptr+8>>2]},this.set_destructor=function(e){w[this.ptr+0>>2]=e},this.get_destructor=function(){return w[this.ptr+0>>2]},this.set_refcount=function(e){w[this.ptr+4>>2]=e},this.set_caught=function(e){e=+!!e,y[this.ptr+12|0]=e},this.get_caught=function(){return 0!=y[this.ptr+12|0]},this.set_rethrown=function(e){e=+!!e,y[this.ptr+13|0]=e},this.get_rethrown=function(){return 0!=y[this.ptr+13|0]},this.init=function(e,t){this.set_type(e),this.set_destructor(t),this.set_refcount(0),this.set_caught(!1),this.set_rethrown(!1)},this.add_ref=function(){var e=w[this.ptr+4>>2];w[this.ptr+4>>2]=e+1},this.release_ref=function(){var e=w[this.ptr+4>>2];return w[this.ptr+4>>2]=e-1,1===e}}function eN(){if(!eN.called){eN.called=!0,w[t9()>>2]=60*(new Date).getTimezoneOffset();var e=(new Date).getFullYear(),t=new Date(e,0,1),r=new Date(e,6,1);w[t7()>>2]=Number(t.getTimezoneOffset()!=r.getTimezoneOffset());var n=s(t),a=s(r),o=es(n),i=es(a);r.getTimezoneOffset()<t.getTimezoneOffset()?(w[t6()>>2]=o,w[t6()+4>>2]=i):(w[t6()>>2]=i,w[t6()+4>>2]=o)}function s(e){var t=e.toTimeString().match(/\(([A-Za-z ]+)\)$/);return t?t[1]:"GMT"}}var eP={splitPath:function(e){return/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/.exec(e).slice(1)},normalizeArray:function(e,t){for(var r=0,n=e.length-1;n>=0;n--){var a=e[n];"."===a?e.splice(n,1):".."===a?(e.splice(n,1),r++):r&&(e.splice(n,1),r--)}if(t)for(;r;r--)e.unshift("..");return e},normalize:function(e){var t="/"===e.charAt(0),r="/"===e.substr(-1);return(e=eP.normalizeArray(e.split("/").filter(function(e){return!!e}),!t).join("/"))||t||(e="."),e&&r&&(e+="/"),(t?"/":"")+e},dirname:function(e){var t=eP.splitPath(e),r=t[0],n=t[1];return r||n?(n&&(n=n.substr(0,n.length-1)),r+n):"."},basename:function(e){if("/"===e)return"/";var t=(e=(e=eP.normalize(e)).replace(/\/$/,"")).lastIndexOf("/");return -1===t?e:e.substr(t+1)},extname:function(e){return eP.splitPath(e)[3]},join:function(){var e=Array.prototype.slice.call(arguments,0);return eP.normalize(e.join("/"))},join2:function(e,t){return eP.normalize(e+"/"+t)}};function eI(e){return w[t8()>>2]=e,e}var eF={resolve:function(){for(var e="",t=!1,r=arguments.length-1;r>=-1&&!t;r--){var n=r>=0?arguments[r]:eB.cwd();if("string"!=typeof n)throw TypeError("Arguments to path.resolve must be strings");if(!n)return"";e=n+"/"+e,t="/"===n.charAt(0)}return e=eP.normalizeArray(e.split("/").filter(function(e){return!!e}),!t).join("/"),(t?"/":"")+e||"."},relative:function(e,t){function r(e){for(var t=0;t<e.length&&""===e[t];t++);for(var r=e.length-1;r>=0&&""===e[r];r--);return t>r?[]:e.slice(t,r-t+1)}e=eF.resolve(e).substr(1),t=eF.resolve(t).substr(1);for(var n=r(e.split("/")),a=r(t.split("/")),o=Math.min(n.length,a.length),i=o,s=0;s<o;s++)if(n[s]!==a[s]){i=s;break}for(var l=[],s=i;s<n.length;s++)l.push("..");return(l=l.concat(a.slice(i))).join("/")}},eD={ttys:[],init:function(){},shutdown:function(){},register:function(e,t){eD.ttys[e]={input:[],output:[],ops:t},eB.registerDevice(e,eD.stream_ops)},stream_ops:{open:function(e){var t=eD.ttys[e.node.rdev];if(!t)throw new eB.ErrnoError(43);e.tty=t,e.seekable=!1},close:function(e){e.tty.ops.flush(e.tty)},flush:function(e){e.tty.ops.flush(e.tty)},read:function(e,t,r,n,a){if(!e.tty||!e.tty.ops.get_char)throw new eB.ErrnoError(60);for(var o,i=0,s=0;s<n;s++){try{o=e.tty.ops.get_char(e.tty)}catch(e){throw new eB.ErrnoError(29)}if(void 0===o&&0===i)throw new eB.ErrnoError(6);if(null==o)break;i++,t[r+s]=o}return i&&(e.node.timestamp=Date.now()),i},write:function(e,t,r,n,a){if(!e.tty||!e.tty.ops.put_char)throw new eB.ErrnoError(60);try{for(var o=0;o<n;o++)e.tty.ops.put_char(e.tty,t[r+o])}catch(e){throw new eB.ErrnoError(29)}return n&&(e.node.timestamp=Date.now()),o}},default_tty_ops:{get_char:function(e){if(!e.input.length){var t=null;if(D){var r=l.alloc?l.alloc(256):new l(256),n=0;try{n=c.readSync(s.stdin.fd,r,0,256,null)}catch(e){if(-1!=e.toString().indexOf("EOF"))n=0;else throw e}t=n>0?r.slice(0,n).toString("utf-8"):null}else"function"==typeof window.prompt?null!==(t=window.prompt("Input: "))&&(t+="\n"):"function"==typeof readline&&null!==(t=readline())&&(t+="\n");if(!t)return null;e.input=tZ(t,!0)}return e.input.shift()},put_char:function(e,t){null===t||10===t?(O(Y(e.output,0)),e.output=[]):0!=t&&e.output.push(t)},flush:function(e){e.output&&e.output.length>0&&(O(Y(e.output,0)),e.output=[])}},default_tty1_ops:{put_char:function(e,t){null===t||10===t?(U(Y(e.output,0)),e.output=[]):0!=t&&e.output.push(t)},flush:function(e){e.output&&e.output.length>0&&(U(Y(e.output,0)),e.output=[])}}},eL={ops_table:null,mount:function(e){return eL.createNode(null,"/",16895,0)},createNode:function(e,t,r,n){if(eB.isBlkdev(r)||eB.isFIFO(r))throw new eB.ErrnoError(63);eL.ops_table||(eL.ops_table={dir:{node:{getattr:eL.node_ops.getattr,setattr:eL.node_ops.setattr,lookup:eL.node_ops.lookup,mknod:eL.node_ops.mknod,rename:eL.node_ops.rename,unlink:eL.node_ops.unlink,rmdir:eL.node_ops.rmdir,readdir:eL.node_ops.readdir,symlink:eL.node_ops.symlink},stream:{llseek:eL.stream_ops.llseek}},file:{node:{getattr:eL.node_ops.getattr,setattr:eL.node_ops.setattr},stream:{llseek:eL.stream_ops.llseek,read:eL.stream_ops.read,write:eL.stream_ops.write,allocate:eL.stream_ops.allocate,mmap:eL.stream_ops.mmap,msync:eL.stream_ops.msync}},link:{node:{getattr:eL.node_ops.getattr,setattr:eL.node_ops.setattr,readlink:eL.node_ops.readlink},stream:{}},chrdev:{node:{getattr:eL.node_ops.getattr,setattr:eL.node_ops.setattr},stream:eB.chrdev_stream_ops}});var a=eB.createNode(e,t,r,n);return eB.isDir(a.mode)?(a.node_ops=eL.ops_table.dir.node,a.stream_ops=eL.ops_table.dir.stream,a.contents={}):eB.isFile(a.mode)?(a.node_ops=eL.ops_table.file.node,a.stream_ops=eL.ops_table.file.stream,a.usedBytes=0,a.contents=null):eB.isLink(a.mode)?(a.node_ops=eL.ops_table.link.node,a.stream_ops=eL.ops_table.link.stream):eB.isChrdev(a.mode)&&(a.node_ops=eL.ops_table.chrdev.node,a.stream_ops=eL.ops_table.chrdev.stream),a.timestamp=Date.now(),e&&(e.contents[t]=a),a},getFileDataAsRegularArray:function(e){if(e.contents&&e.contents.subarray){for(var t=[],r=0;r<e.usedBytes;++r)t.push(e.contents[r]);return t}return e.contents},getFileDataAsTypedArray:function(e){return e.contents?e.contents.subarray?e.contents.subarray(0,e.usedBytes):new Uint8Array(e.contents):new Uint8Array(0)},expandFileStorage:function(e,t){var r=e.contents?e.contents.length:0;if(!(r>=t)){t=Math.max(t,r*(r<1048576?2:1.125)>>>0),0!=r&&(t=Math.max(t,256));var n=e.contents;e.contents=new Uint8Array(t),e.usedBytes>0&&e.contents.set(n.subarray(0,e.usedBytes),0)}},resizeFileStorage:function(e,t){if(e.usedBytes!=t){if(0==t){e.contents=null,e.usedBytes=0;return}if(!e.contents||e.contents.subarray){var r=e.contents;e.contents=new Uint8Array(t),r&&e.contents.set(r.subarray(0,Math.min(t,e.usedBytes))),e.usedBytes=t;return}if(e.contents||(e.contents=[]),e.contents.length>t)e.contents.length=t;else for(;e.contents.length<t;)e.contents.push(0);e.usedBytes=t}},node_ops:{getattr:function(e){var t={};return t.dev=eB.isChrdev(e.mode)?e.id:1,t.ino=e.id,t.mode=e.mode,t.nlink=1,t.uid=0,t.gid=0,t.rdev=e.rdev,eB.isDir(e.mode)?t.size=4096:eB.isFile(e.mode)?t.size=e.usedBytes:eB.isLink(e.mode)?t.size=e.link.length:t.size=0,t.atime=new Date(e.timestamp),t.mtime=new Date(e.timestamp),t.ctime=new Date(e.timestamp),t.blksize=4096,t.blocks=Math.ceil(t.size/t.blksize),t},setattr:function(e,t){void 0!==t.mode&&(e.mode=t.mode),void 0!==t.timestamp&&(e.timestamp=t.timestamp),void 0!==t.size&&eL.resizeFileStorage(e,t.size)},lookup:function(e,t){throw eB.genericErrors[44]},mknod:function(e,t,r,n){return eL.createNode(e,t,r,n)},rename:function(e,t,r){if(eB.isDir(e.mode)){var n;try{n=eB.lookupNode(t,r)}catch(e){}if(n)for(var a in n.contents)throw new eB.ErrnoError(55)}delete e.parent.contents[e.name],e.name=r,t.contents[r]=e,e.parent=t},unlink:function(e,t){delete e.contents[t]},rmdir:function(e,t){var r=eB.lookupNode(e,t);for(var n in r.contents)throw new eB.ErrnoError(55);delete e.contents[t]},readdir:function(e){var t=[".",".."];for(var r in e.contents)e.contents.hasOwnProperty(r)&&t.push(r);return t},symlink:function(e,t,r){var n=eL.createNode(e,t,41471,0);return n.link=r,n},readlink:function(e){if(!eB.isLink(e.mode))throw new eB.ErrnoError(28);return e.link}},stream_ops:{read:function(e,t,r,n,a){var o=e.node.contents;if(a>=e.node.usedBytes)return 0;var i=Math.min(e.node.usedBytes-a,n);if(i>8&&o.subarray)t.set(o.subarray(a,a+i),r);else for(var s=0;s<i;s++)t[r+s]=o[a+s];return i},write:function(e,t,r,n,a,o){if(t.buffer===y.buffer&&(o=!1),!n)return 0;var i=e.node;if(i.timestamp=Date.now(),t.subarray&&(!i.contents||i.contents.subarray)){if(o)return i.contents=t.subarray(r,r+n),i.usedBytes=n,n;else if(0===i.usedBytes&&0===a)return i.contents=t.slice(r,r+n),i.usedBytes=n,n;else if(a+n<=i.usedBytes)return i.contents.set(t.subarray(r,r+n),a),n}if(eL.expandFileStorage(i,a+n),i.contents.subarray&&t.subarray)i.contents.set(t.subarray(r,r+n),a);else for(var s=0;s<n;s++)i.contents[a+s]=t[r+s];return i.usedBytes=Math.max(i.usedBytes,a+n),n},llseek:function(e,t,r){var n=t;if(1===r?n+=e.position:2===r&&eB.isFile(e.node.mode)&&(n+=e.node.usedBytes),n<0)throw new eB.ErrnoError(28);return n},allocate:function(e,t,r){eL.expandFileStorage(e.node,t+r),e.node.usedBytes=Math.max(e.node.usedBytes,t+r)},mmap:function(e,t,r,n,a,o){if(H(0===t),!eB.isFile(e.node.mode))throw new eB.ErrnoError(43);var i,s,l=e.node.contents;if(2&o||l.buffer!==g){if((n>0||n+r<l.length)&&(l=l.subarray?l.subarray(n,n+r):Array.prototype.slice.call(l,n,n+r)),s=!0,!(i=function(e){for(var t=16384*Math.ceil(e/16384),r=t2(t);e<t;)y[r+e++]=0;return r}(r)))throw new eB.ErrnoError(48);y.set(l,i)}else s=!1,i=l.byteOffset;return{ptr:i,allocated:s}},msync:function(e,t,r,n,a){if(!eB.isFile(e.node.mode))throw new eB.ErrnoError(43);return 2&a||eL.stream_ops.write(e,t,0,n,r,!1),0}}},eR={DIR_MODE:16895,FILE_MODE:33279,CHUNK_SIZE:-1,codec:null,init:function(){if(!eR.codec){var e,t,r;(e={}).uncompress=function(e,t,r,n){r=r||0,n=n||e.length-r;for(var a=r,o=n,i=0;a<o;){var s=e[a++],l=s>>4;if(l>0){for(var u=l+240;255===u;)l+=u=e[a++];for(var c=a+l;a<c;)t[i++]=e[a++];if(a===o)break}var d=e[a++]|e[a++]<<8;if(0===d)break;if(d>i)return-(a-2);for(var f=15&s,u=f+240;255===u;)f+=u=e[a++];for(var m=i-d,c=i+f+4;i<c;)t[i++]=t[m++]}return i},H(!0),t=new Int16Array(65536),r=new Int16Array(t.length),e.compressBound=function(e){return e>0x7e000000?0:e+e/255+16|0},e.compress=function(n,a,o,i){return t.set(r),function(r,n,a,o,i){var s=o,l=i-o,u=0;if(r.length>=0x7e000000)throw Error("input too large");if(r.length>12){var c=e.compressBound(r.length);if(l<c)throw Error("output too small: "+l+" < "+c);for(var d=1,f=67,m=r.length-12;a+4<m;){var p=r[a+1]<<8|r[a],h=r[a+3]<<8|r[a+2],g=Math.imul(p|h<<16,0x9e3779b1)>>>16,y=t[g]-1;if(t[g]=a+1,y<0||a-y>>>16>0||(r[y+3]<<8|r[y+2])!=h||(r[y+1]<<8|r[y])!=p){a+=f++>>6;continue}f=67;var b=a-u,v=a-y;y+=4;for(var x=a+=4;a<m&&r[a]==r[y];)a++,y++;var w=(x=a-x)<15?x:15;if(b>=15){n[s++]=240+w;for(var S=b-15;S>254;S-=255)n[s++]=255;n[s++]=S}else n[s++]=(b<<4)+w;for(var k=0;k<b;k++)n[s++]=r[u+k];if(n[s++]=v,n[s++]=v>>8,x>=15){for(x-=15;x>=255;)x-=255,n[s++]=255;n[s++]=x}u=a}}if(0==u)return 0;if((b=r.length-u)>=15){n[s++]=240;for(var E=b-15;E>254;E-=255)n[s++]=255;n[s++]=E}else n[s++]=b<<4;for(a=u;a<r.length;)n[s++]=r[a++];return s}(n,a,0,o||0,i||a.length)},e.CHUNK_SIZE=2048,e.compressPackage=function(t,r){if(r)var n=new Uint8Array(e.CHUNK_SIZE);H(t instanceof ArrayBuffer),console.log("compressing package of size "+(t=new Uint8Array(t)).length);for(var a=[],o=[],i=0,s=0;i<t.length;){var l=t.subarray(i,i+e.CHUNK_SIZE);i+=e.CHUNK_SIZE;var u=e.compressBound(l.length),c=new Uint8Array(u),d=e.compress(l,c);if(d>0){if(H(d<=u),c=c.subarray(0,d),a.push(c),s+=d,o.push(1),r){var f=e.uncompress(c,n);H(f===l.length,[f,l.length]);for(var m=0;m<l.length;m++)H(l[m]===n[m])}}else H(0===d),a.push(l),s+=l.length,o.push(0)}t=null;var p={data:new Uint8Array(s+2*e.CHUNK_SIZE),cachedOffset:s,cachedIndexes:[-1,-1],cachedChunks:[null,null],offsets:[],sizes:[],successes:o};i=0;for(var m=0;m<a.length;m++)p.data.set(a[m],i),p.offsets[m]=i,p.sizes[m]=a[m].length,i+=a[m].length;return console.log("compressed package into "+[p.data.length]),H(i===s),p},H(e.CHUNK_SIZE<32768),eR.codec=e,eR.CHUNK_SIZE=eR.codec.CHUNK_SIZE}},loadPackage:function(e){eR.init();var t=e.compressedData;t||(t=eR.codec.compressPackage(e.data)),H(t.cachedIndexes.length===t.cachedChunks.length);for(var r=0;r<t.cachedIndexes.length;r++)t.cachedIndexes[r]=-1,t.cachedChunks[r]=t.data.subarray(t.cachedOffset+r*eR.CHUNK_SIZE,t.cachedOffset+(r+1)*eR.CHUNK_SIZE),H(t.cachedChunks[r].length===eR.CHUNK_SIZE);e.metadata.files.forEach(function(e){var r=eP.dirname(e.filename),n=eP.basename(e.filename);eB.createPath("",r,!0,!0);var a=eB.analyzePath(r).object;eR.createNode(a,n,eR.FILE_MODE,0,{compressedData:t,start:e.start,end:e.end})})},createNode:function(e,t,r,n,a,o){var i=eB.createNode(e,t,r);return i.mode=r,i.node_ops=eR.node_ops,i.stream_ops=eR.stream_ops,i.timestamp=(o||new Date).getTime(),H(eR.FILE_MODE!==eR.DIR_MODE),r===eR.FILE_MODE?(i.size=a.end-a.start,i.contents=a):(i.size=4096,i.contents={}),e&&(e.contents[t]=i),i},node_ops:{getattr:function(e){return{dev:1,ino:e.id,mode:e.mode,nlink:1,uid:0,gid:0,rdev:void 0,size:e.size,atime:new Date(e.timestamp),mtime:new Date(e.timestamp),ctime:new Date(e.timestamp),blksize:4096,blocks:Math.ceil(e.size/4096)}},setattr:function(e,t){void 0!==t.mode&&(e.mode=t.mode),void 0!==t.timestamp&&(e.timestamp=t.timestamp)},lookup:function(e,t){throw new eB.ErrnoError(44)},mknod:function(e,t,r,n){throw new eB.ErrnoError(63)},rename:function(e,t,r){throw new eB.ErrnoError(63)},unlink:function(e,t){throw new eB.ErrnoError(63)},rmdir:function(e,t){throw new eB.ErrnoError(63)},readdir:function(e){throw new eB.ErrnoError(63)},symlink:function(e,t,r){throw new eB.ErrnoError(63)},readlink:function(e){throw new eB.ErrnoError(63)}},stream_ops:{read:function(t,r,n,a,o){if((a=Math.min(a,t.node.size-o))<=0)return 0;for(var i=t.node.contents,s=i.compressedData,l=0;l<a;){var u,c=i.start+o+l,d=a-l,f=Math.floor(c/eR.CHUNK_SIZE),m=s.offsets[f],p=s.sizes[f];if(s.successes[f]){var h=s.cachedIndexes.indexOf(f);if(h>=0)u=s.cachedChunks[h];else{s.cachedIndexes.pop(),s.cachedIndexes.unshift(f),u=s.cachedChunks.pop(),s.cachedChunks.unshift(u),s.debug&&(console.log("decompressing chunk "+f),e.decompressedChunks=(e.decompressedChunks||0)+1);var g=s.data.subarray(m,m+p),y=eR.codec.uncompress(g,u);f<s.successes.length-1&&H(y===eR.CHUNK_SIZE)}}else u=s.data.subarray(m,m+eR.CHUNK_SIZE);var b=c%eR.CHUNK_SIZE,v=Math.min(b+d,eR.CHUNK_SIZE);r.set(u.subarray(b,v),n+l),l+=v-b}return l},write:function(e,t,r,n,a){throw new eB.ErrnoError(29)},llseek:function(e,t,r){var n=t;if(1===r?n+=e.position:2===r&&eB.isFile(e.node.mode)&&(n+=e.node.size),n<0)throw new eB.ErrnoError(28);return n}}},eB={root:null,mounts:[],devices:{},streams:[],nextInode:1,nameTable:null,currentPath:"/",initialized:!1,ignorePermissions:!0,trackingDelegate:{},tracking:{openFlags:{READ:1,WRITE:2}},ErrnoError:null,genericErrors:{},filesystems:null,syncFSRequests:0,handleFSError:function(t){if(!(t instanceof eB.ErrnoError)){var r;throw t+" : "+(r=eA(),e.extraStackTrace&&(r+="\n"+e.extraStackTrace()),r.replace(/\b_Z[\w\d_]+/g,function(e){var t=ej(e);return e===t?e:t+" ["+e+"]"}))}return eI(t.errno)},lookupPath:function(e,t){if(e=eF.resolve(eB.cwd(),e),t=t||{},!e)return{path:"",node:null};var r={follow_mount:!0,recurse_count:0};for(var n in r)void 0===t[n]&&(t[n]=r[n]);if(t.recurse_count>8)throw new eB.ErrnoError(32);for(var a=eP.normalizeArray(e.split("/").filter(function(e){return!!e}),!1),o=eB.root,i="/",s=0;s<a.length;s++){var l=s===a.length-1;if(l&&t.parent)break;if(o=eB.lookupNode(o,a[s]),i=eP.join2(i,a[s]),eB.isMountpoint(o)&&(!l||l&&t.follow_mount)&&(o=o.mounted.root),!l||t.follow)for(var u=0;eB.isLink(o.mode);){var c=eB.readlink(i);if(i=eF.resolve(eP.dirname(i),c),o=eB.lookupPath(i,{recurse_count:t.recurse_count}).node,u++>40)throw new eB.ErrnoError(32)}}return{path:i,node:o}},getPath:function(e){for(var t;;){if(eB.isRoot(e)){var r=e.mount.mountpoint;if(!t)return r;return"/"!==r[r.length-1]?r+"/"+t:r+t}t=t?e.name+"/"+t:e.name,e=e.parent}},hashName:function(e,t){for(var r=0,n=0;n<t.length;n++)r=(r<<5)-r+t.charCodeAt(n)|0;return(e+r>>>0)%eB.nameTable.length},hashAddNode:function(e){var t=eB.hashName(e.parent.id,e.name);e.name_next=eB.nameTable[t],eB.nameTable[t]=e},hashRemoveNode:function(e){var t=eB.hashName(e.parent.id,e.name);if(eB.nameTable[t]===e)eB.nameTable[t]=e.name_next;else for(var r=eB.nameTable[t];r;){if(r.name_next===e){r.name_next=e.name_next;break}r=r.name_next}},lookupNode:function(e,t){var r=eB.mayLookup(e);if(r)throw new eB.ErrnoError(r,e);for(var n=eB.hashName(e.id,t),a=eB.nameTable[n];a;a=a.name_next){var o=a.name;if(a.parent.id===e.id&&o===t)return a}return eB.lookup(e,t)},createNode:function(e,t,r,n){var a=new eB.FSNode(e,t,r,n);return eB.hashAddNode(a),a},destroyNode:function(e){eB.hashRemoveNode(e)},isRoot:function(e){return e===e.parent},isMountpoint:function(e){return!!e.mounted},isFile:function(e){return(61440&e)==32768},isDir:function(e){return(61440&e)==16384},isLink:function(e){return(61440&e)==40960},isChrdev:function(e){return(61440&e)==8192},isBlkdev:function(e){return(61440&e)==24576},isFIFO:function(e){return(61440&e)==4096},isSocket:function(e){return(49152&e)==49152},flagModes:{r:0,rs:1052672,"r+":2,w:577,wx:705,xw:705,"w+":578,"wx+":706,"xw+":706,a:1089,ax:1217,xa:1217,"a+":1090,"ax+":1218,"xa+":1218},modeStringToFlags:function(e){var t=eB.flagModes[e];if(void 0===t)throw Error("Unknown file open mode: "+e);return t},flagsToPermissionString:function(e){var t=["r","w","rw"][3&e];return 512&e&&(t+="w"),t},nodePermissions:function(e,t){return eB.ignorePermissions?0:2*(-1!==t.indexOf("r")&&!(292&e.mode)||-1!==t.indexOf("w")&&!(146&e.mode)||-1!==t.indexOf("x")&&!(73&e.mode))},mayLookup:function(e){var t=eB.nodePermissions(e,"x");return t||2*!e.node_ops.lookup},mayCreate:function(e,t){try{return eB.lookupNode(e,t),20}catch(e){}return eB.nodePermissions(e,"wx")},mayDelete:function(e,t,r){try{n=eB.lookupNode(e,t)}catch(e){return e.errno}var n,a=eB.nodePermissions(e,"wx");if(a)return a;if(r){if(!eB.isDir(n.mode))return 54;if(eB.isRoot(n)||eB.getPath(n)===eB.cwd())return 10}else if(eB.isDir(n.mode))return 31;return 0},mayOpen:function(e,t){return e?eB.isLink(e.mode)?32:eB.isDir(e.mode)&&("r"!==eB.flagsToPermissionString(t)||512&t)?31:eB.nodePermissions(e,eB.flagsToPermissionString(t)):44},MAX_OPEN_FDS:4096,nextfd:function(e,t){e=e||0,t=t||eB.MAX_OPEN_FDS;for(var r=e;r<=t;r++)if(!eB.streams[r])return r;throw new eB.ErrnoError(33)},getStream:function(e){return eB.streams[e]},createStream:function(e,t,r){eB.FSStream||(eB.FSStream=function(){},eB.FSStream.prototype={object:{get:function(){return this.node},set:function(e){this.node=e}},isRead:{get:function(){return(2097155&this.flags)!=1}},isWrite:{get:function(){return(2097155&this.flags)!=0}},isAppend:{get:function(){return 1024&this.flags}}});var n=new eB.FSStream;for(var a in e)n[a]=e[a];e=n;var o=eB.nextfd(t,r);return e.fd=o,eB.streams[o]=e,e},closeStream:function(e){eB.streams[e]=null},chrdev_stream_ops:{open:function(e){var t=eB.getDevice(e.node.rdev);e.stream_ops=t.stream_ops,e.stream_ops.open&&e.stream_ops.open(e)},llseek:function(){throw new eB.ErrnoError(70)}},major:function(e){return e>>8},minor:function(e){return 255&e},makedev:function(e,t){return e<<8|t},registerDevice:function(e,t){eB.devices[e]={stream_ops:t}},getDevice:function(e){return eB.devices[e]},getMounts:function(e){for(var t=[],r=[e];r.length;){var n=r.pop();t.push(n),r.push.apply(r,n.mounts)}return t},syncfs:function(e,t){"function"==typeof e&&(t=e,e=!1),eB.syncFSRequests++,eB.syncFSRequests>1&&U("warning: "+eB.syncFSRequests+" FS.syncfs operations in flight at once, probably just doing extra work");var r=eB.getMounts(eB.root.mount),n=0;function a(e){return eB.syncFSRequests--,t(e)}function o(e){if(e)return o.errored?void 0:(o.errored=!0,a(e));++n>=r.length&&a(null)}r.forEach(function(t){if(!t.type.syncfs)return o(null);t.type.syncfs(t,e,o)})},mount:function(e,t,r){var n,a="/"===r,o=!r;if(a&&eB.root)throw new eB.ErrnoError(10);if(!a&&!o){var i=eB.lookupPath(r,{follow_mount:!1});if(r=i.path,n=i.node,eB.isMountpoint(n))throw new eB.ErrnoError(10);if(!eB.isDir(n.mode))throw new eB.ErrnoError(54)}var s={type:e,opts:t,mountpoint:r,mounts:[]},l=e.mount(s);return l.mount=s,s.root=l,a?eB.root=l:n&&(n.mounted=s,n.mount&&n.mount.mounts.push(s)),l},unmount:function(e){var t=eB.lookupPath(e,{follow_mount:!1});if(!eB.isMountpoint(t.node))throw new eB.ErrnoError(28);var r=t.node,n=r.mounted,a=eB.getMounts(n);Object.keys(eB.nameTable).forEach(function(e){for(var t=eB.nameTable[e];t;){var r=t.name_next;-1!==a.indexOf(t.mount)&&eB.destroyNode(t),t=r}}),r.mounted=null;var o=r.mount.mounts.indexOf(n);r.mount.mounts.splice(o,1)},lookup:function(e,t){return e.node_ops.lookup(e,t)},mknod:function(e,t,r){var n=eB.lookupPath(e,{parent:!0}).node,a=eP.basename(e);if(!a||"."===a||".."===a)throw new eB.ErrnoError(28);var o=eB.mayCreate(n,a);if(o)throw new eB.ErrnoError(o);if(!n.node_ops.mknod)throw new eB.ErrnoError(63);return n.node_ops.mknod(n,a,t,r)},create:function(e,t){return t=(void 0!==t?t:438)&4095|32768,eB.mknod(e,t,0)},mkdir:function(e,t){return t=(void 0!==t?t:511)&1023|16384,eB.mknod(e,t,0)},mkdirTree:function(e,t){for(var r=e.split("/"),n="",a=0;a<r.length;++a)if(r[a]){n+="/"+r[a];try{eB.mkdir(n,t)}catch(e){if(20!=e.errno)throw e}}},mkdev:function(e,t,r){return void 0===r&&(r=t,t=438),t|=8192,eB.mknod(e,t,r)},symlink:function(e,t){if(!eF.resolve(e))throw new eB.ErrnoError(44);var r=eB.lookupPath(t,{parent:!0}).node;if(!r)throw new eB.ErrnoError(44);var n=eP.basename(t),a=eB.mayCreate(r,n);if(a)throw new eB.ErrnoError(a);if(!r.node_ops.symlink)throw new eB.ErrnoError(63);return r.node_ops.symlink(r,n,e)},rename:function(e,t){var r,n,a,o=eP.dirname(e),i=eP.dirname(t),s=eP.basename(e),l=eP.basename(t);if(r=eB.lookupPath(e,{parent:!0}).node,n=eB.lookupPath(t,{parent:!0}).node,!r||!n)throw new eB.ErrnoError(44);if(r.mount!==n.mount)throw new eB.ErrnoError(75);var u=eB.lookupNode(r,s),c=eF.relative(e,i);if("."!==c.charAt(0))throw new eB.ErrnoError(28);if("."!==(c=eF.relative(t,o)).charAt(0))throw new eB.ErrnoError(55);try{a=eB.lookupNode(n,l)}catch(e){}if(u!==a){var d=eB.isDir(u.mode),f=eB.mayDelete(r,s,d);if(f||(f=a?eB.mayDelete(n,l,d):eB.mayCreate(n,l)))throw new eB.ErrnoError(f);if(!r.node_ops.rename)throw new eB.ErrnoError(63);if(eB.isMountpoint(u)||a&&eB.isMountpoint(a))throw new eB.ErrnoError(10);if(n!==r&&(f=eB.nodePermissions(r,"w")))throw new eB.ErrnoError(f);try{eB.trackingDelegate.willMovePath&&eB.trackingDelegate.willMovePath(e,t)}catch(r){U("FS.trackingDelegate['willMovePath']('"+e+"', '"+t+"') threw an exception: "+r.message)}eB.hashRemoveNode(u);try{r.node_ops.rename(u,n,l)}catch(e){throw e}finally{eB.hashAddNode(u)}try{eB.trackingDelegate.onMovePath&&eB.trackingDelegate.onMovePath(e,t)}catch(r){U("FS.trackingDelegate['onMovePath']('"+e+"', '"+t+"') threw an exception: "+r.message)}}},rmdir:function(e){var t=eB.lookupPath(e,{parent:!0}).node,r=eP.basename(e),n=eB.lookupNode(t,r),a=eB.mayDelete(t,r,!0);if(a)throw new eB.ErrnoError(a);if(!t.node_ops.rmdir)throw new eB.ErrnoError(63);if(eB.isMountpoint(n))throw new eB.ErrnoError(10);try{eB.trackingDelegate.willDeletePath&&eB.trackingDelegate.willDeletePath(e)}catch(t){U("FS.trackingDelegate['willDeletePath']('"+e+"') threw an exception: "+t.message)}t.node_ops.rmdir(t,r),eB.destroyNode(n);try{eB.trackingDelegate.onDeletePath&&eB.trackingDelegate.onDeletePath(e)}catch(t){U("FS.trackingDelegate['onDeletePath']('"+e+"') threw an exception: "+t.message)}},readdir:function(e){var t=eB.lookupPath(e,{follow:!0}).node;if(!t.node_ops.readdir)throw new eB.ErrnoError(54);return t.node_ops.readdir(t)},unlink:function(e){var t=eB.lookupPath(e,{parent:!0}).node,r=eP.basename(e),n=eB.lookupNode(t,r),a=eB.mayDelete(t,r,!1);if(a)throw new eB.ErrnoError(a);if(!t.node_ops.unlink)throw new eB.ErrnoError(63);if(eB.isMountpoint(n))throw new eB.ErrnoError(10);try{eB.trackingDelegate.willDeletePath&&eB.trackingDelegate.willDeletePath(e)}catch(t){U("FS.trackingDelegate['willDeletePath']('"+e+"') threw an exception: "+t.message)}t.node_ops.unlink(t,r),eB.destroyNode(n);try{eB.trackingDelegate.onDeletePath&&eB.trackingDelegate.onDeletePath(e)}catch(t){U("FS.trackingDelegate['onDeletePath']('"+e+"') threw an exception: "+t.message)}},readlink:function(e){var t=eB.lookupPath(e).node;if(!t)throw new eB.ErrnoError(44);if(!t.node_ops.readlink)throw new eB.ErrnoError(28);return eF.resolve(eB.getPath(t.parent),t.node_ops.readlink(t))},stat:function(e,t){var r=eB.lookupPath(e,{follow:!t}).node;if(!r)throw new eB.ErrnoError(44);if(!r.node_ops.getattr)throw new eB.ErrnoError(63);return r.node_ops.getattr(r)},lstat:function(e){return eB.stat(e,!0)},chmod:function(e,t,r){var n;if(!(n="string"==typeof e?eB.lookupPath(e,{follow:!r}).node:e).node_ops.setattr)throw new eB.ErrnoError(63);n.node_ops.setattr(n,{mode:4095&t|-4096&n.mode,timestamp:Date.now()})},lchmod:function(e,t){eB.chmod(e,t,!0)},fchmod:function(e,t){var r=eB.getStream(e);if(!r)throw new eB.ErrnoError(8);eB.chmod(r.node,t)},chown:function(e,t,r,n){var a;if(!(a="string"==typeof e?eB.lookupPath(e,{follow:!n}).node:e).node_ops.setattr)throw new eB.ErrnoError(63);a.node_ops.setattr(a,{timestamp:Date.now()})},lchown:function(e,t,r){eB.chown(e,t,r,!0)},fchown:function(e,t,r){var n=eB.getStream(e);if(!n)throw new eB.ErrnoError(8);eB.chown(n.node,t,r)},truncate:function(e,t){if(t<0)throw new eB.ErrnoError(28);if("string"==typeof e){var r;r=eB.lookupPath(e,{follow:!0}).node}else r=e;if(!r.node_ops.setattr)throw new eB.ErrnoError(63);if(eB.isDir(r.mode))throw new eB.ErrnoError(31);if(!eB.isFile(r.mode))throw new eB.ErrnoError(28);var n=eB.nodePermissions(r,"w");if(n)throw new eB.ErrnoError(n);r.node_ops.setattr(r,{size:t,timestamp:Date.now()})},ftruncate:function(e,t){var r=eB.getStream(e);if(!r)throw new eB.ErrnoError(8);if((2097155&r.flags)==0)throw new eB.ErrnoError(28);eB.truncate(r.node,t)},utime:function(e,t,r){var n=eB.lookupPath(e,{follow:!0}).node;n.node_ops.setattr(n,{timestamp:Math.max(t,r)})},open:function(t,r,n,a,o){if(""===t)throw new eB.ErrnoError(44);if(r="string"==typeof r?eB.modeStringToFlags(r):r,n=void 0===n?438:n,n=64&r?4095&n|32768:0,"object"==typeof t)i=t;else{t=eP.normalize(t);try{var i;i=eB.lookupPath(t,{follow:!(131072&r)}).node}catch(e){}}var s=!1;if(64&r)if(i){if(128&r)throw new eB.ErrnoError(20)}else i=eB.mknod(t,n,0),s=!0;if(!i)throw new eB.ErrnoError(44);if(eB.isChrdev(i.mode)&&(r&=-513),65536&r&&!eB.isDir(i.mode))throw new eB.ErrnoError(54);if(!s){var l=eB.mayOpen(i,r);if(l)throw new eB.ErrnoError(l)}512&r&&eB.truncate(i,0),r&=-131713;var u=eB.createStream({node:i,path:eB.getPath(i),flags:r,seekable:!0,position:0,stream_ops:i.stream_ops,ungotten:[],error:!1},a,o);u.stream_ops.open&&u.stream_ops.open(u),e.logReadFiles&&!(1&r)&&(eB.readFiles||(eB.readFiles={}),t in eB.readFiles||(eB.readFiles[t]=1,U("FS.trackingDelegate error on read file: "+t)));try{if(eB.trackingDelegate.onOpenFile){var c=0;(2097155&r)!=1&&(c|=eB.tracking.openFlags.READ),(2097155&r)!=0&&(c|=eB.tracking.openFlags.WRITE),eB.trackingDelegate.onOpenFile(t,c)}}catch(e){U("FS.trackingDelegate['onOpenFile']('"+t+"', flags) threw an exception: "+e.message)}return u},close:function(e){if(eB.isClosed(e))throw new eB.ErrnoError(8);e.getdents&&(e.getdents=null);try{e.stream_ops.close&&e.stream_ops.close(e)}catch(e){throw e}finally{eB.closeStream(e.fd)}e.fd=null},isClosed:function(e){return null===e.fd},llseek:function(e,t,r){if(eB.isClosed(e))throw new eB.ErrnoError(8);if(!e.seekable||!e.stream_ops.llseek)throw new eB.ErrnoError(70);if(0!=r&&1!=r&&2!=r)throw new eB.ErrnoError(28);return e.position=e.stream_ops.llseek(e,t,r),e.ungotten=[],e.position},read:function(e,t,r,n,a){if(n<0||a<0)throw new eB.ErrnoError(28);if(eB.isClosed(e)||(2097155&e.flags)==1)throw new eB.ErrnoError(8);if(eB.isDir(e.node.mode))throw new eB.ErrnoError(31);if(!e.stream_ops.read)throw new eB.ErrnoError(28);var o=void 0!==a;if(o){if(!e.seekable)throw new eB.ErrnoError(70)}else a=e.position;var i=e.stream_ops.read(e,t,r,n,a);return o||(e.position+=i),i},write:function(e,t,r,n,a,o){if(n<0||a<0)throw new eB.ErrnoError(28);if(eB.isClosed(e)||(2097155&e.flags)==0)throw new eB.ErrnoError(8);if(eB.isDir(e.node.mode))throw new eB.ErrnoError(31);if(!e.stream_ops.write)throw new eB.ErrnoError(28);e.seekable&&1024&e.flags&&eB.llseek(e,0,2);var i=void 0!==a;if(i){if(!e.seekable)throw new eB.ErrnoError(70)}else a=e.position;var s=e.stream_ops.write(e,t,r,n,a,o);i||(e.position+=s);try{e.path&&eB.trackingDelegate.onWriteToFile&&eB.trackingDelegate.onWriteToFile(e.path)}catch(t){U("FS.trackingDelegate['onWriteToFile']('"+e.path+"') threw an exception: "+t.message)}return s},allocate:function(e,t,r){if(eB.isClosed(e))throw new eB.ErrnoError(8);if(t<0||r<=0)throw new eB.ErrnoError(28);if((2097155&e.flags)==0)throw new eB.ErrnoError(8);if(!eB.isFile(e.node.mode)&&!eB.isDir(e.node.mode))throw new eB.ErrnoError(43);if(!e.stream_ops.allocate)throw new eB.ErrnoError(138);e.stream_ops.allocate(e,t,r)},mmap:function(e,t,r,n,a,o){if((2&a)!=0&&(2&o)==0&&(2097155&e.flags)!=2||(2097155&e.flags)==1)throw new eB.ErrnoError(2);if(!e.stream_ops.mmap)throw new eB.ErrnoError(43);return e.stream_ops.mmap(e,t,r,n,a,o)},msync:function(e,t,r,n,a){return e&&e.stream_ops.msync?e.stream_ops.msync(e,t,r,n,a):0},munmap:function(e){return 0},ioctl:function(e,t,r){if(!e.stream_ops.ioctl)throw new eB.ErrnoError(59);return e.stream_ops.ioctl(e,t,r)},readFile:function(e,t){if((t=t||{}).flags=t.flags||"r",t.encoding=t.encoding||"binary","utf8"!==t.encoding&&"binary"!==t.encoding)throw Error('Invalid encoding type "'+t.encoding+'"');var r,n=eB.open(e,t.flags),a=eB.stat(e).size,o=new Uint8Array(a);return eB.read(n,o,0,a,0),"utf8"===t.encoding?r=Y(o,0):"binary"===t.encoding&&(r=o),eB.close(n),r},writeFile:function(e,t,r){(r=r||{}).flags=r.flags||"w";var n=eB.open(e,r.flags,r.mode);if("string"==typeof t){var a=new Uint8Array(J(t)+1),o=Z(t,a,0,a.length);eB.write(n,a,0,o,void 0,r.canOwn)}else if(ArrayBuffer.isView(t))eB.write(n,t,0,t.byteLength,void 0,r.canOwn);else throw Error("Unsupported data type");eB.close(n)},cwd:function(){return eB.currentPath},chdir:function(e){var t=eB.lookupPath(e,{follow:!0});if(null===t.node)throw new eB.ErrnoError(44);if(!eB.isDir(t.node.mode))throw new eB.ErrnoError(54);var r=eB.nodePermissions(t.node,"x");if(r)throw new eB.ErrnoError(r);eB.currentPath=t.path},createDefaultDirectories:function(){eB.mkdir("/tmp"),eB.mkdir("/home"),eB.mkdir("/home/web_user")},createDefaultDevices:function(){eB.mkdir("/dev"),eB.registerDevice(eB.makedev(1,3),{read:function(){return 0},write:function(e,t,r,n,a){return n}}),eB.mkdev("/dev/null",eB.makedev(1,3)),eD.register(eB.makedev(5,0),eD.default_tty_ops),eD.register(eB.makedev(6,0),eD.default_tty1_ops),eB.mkdev("/dev/tty",eB.makedev(5,0)),eB.mkdev("/dev/tty1",eB.makedev(6,0));var e=function(){if("object"==typeof crypto&&"function"==typeof crypto.getRandomValues){var e=new Uint8Array(1);return function(){return crypto.getRandomValues(e),e[0]}}if(D)try{var t=require("crypto");return function(){return t.randomBytes(1)[0]}}catch(e){}return function(){ev("randomDevice")}}();eB.createDevice("/dev","random",e),eB.createDevice("/dev","urandom",e),eB.mkdir("/dev/shm"),eB.mkdir("/dev/shm/tmp")},createSpecialDirectories:function(){eB.mkdir("/proc"),eB.mkdir("/proc/self"),eB.mkdir("/proc/self/fd"),eB.mount({mount:function(){var e=eB.createNode("/proc/self","fd",16895,73);return e.node_ops={lookup:function(e,t){var r=eB.getStream(+t);if(!r)throw new eB.ErrnoError(8);var n={parent:null,mount:{mountpoint:"fake"},node_ops:{readlink:function(){return r.path}}};return n.parent=n,n}},e}},{},"/proc/self/fd")},createStandardStreams:function(){e.stdin?eB.createDevice("/dev","stdin",e.stdin):eB.symlink("/dev/tty","/dev/stdin"),e.stdout?eB.createDevice("/dev","stdout",null,e.stdout):eB.symlink("/dev/tty","/dev/stdout"),e.stderr?eB.createDevice("/dev","stderr",null,e.stderr):eB.symlink("/dev/tty1","/dev/stderr"),eB.open("/dev/stdin","r"),eB.open("/dev/stdout","w"),eB.open("/dev/stderr","w")},ensureErrnoError:function(){eB.ErrnoError||(eB.ErrnoError=function(e,t){this.node=t,this.setErrno=function(e){this.errno=e},this.setErrno(e),this.message="FS error"},eB.ErrnoError.prototype=Error(),eB.ErrnoError.prototype.constructor=eB.ErrnoError,[44].forEach(function(e){eB.genericErrors[e]=new eB.ErrnoError(e),eB.genericErrors[e].stack="<generic error, no stack>"}))},staticInit:function(){eB.ensureErrnoError(),eB.nameTable=Array(4096),eB.mount(eL,{},"/"),eB.createDefaultDirectories(),eB.createDefaultDevices(),eB.createSpecialDirectories(),eB.filesystems={MEMFS:eL}},init:function(t,r,n){eB.init.initialized=!0,eB.ensureErrnoError(),e.stdin=t||e.stdin,e.stdout=r||e.stdout,e.stderr=n||e.stderr,eB.createStandardStreams()},quit:function(){eB.init.initialized=!1;var t=e._fflush;t&&t(0);for(var r=0;r<eB.streams.length;r++){var n=eB.streams[r];n&&eB.close(n)}},getMode:function(e,t){var r=0;return e&&(r|=365),t&&(r|=146),r},findObject:function(e,t){var r=eB.analyzePath(e,t);return r.exists?r.object:(eI(r.error),null)},analyzePath:function(e,t){try{var r=eB.lookupPath(e,{follow:!t});e=r.path}catch(e){}var n={isRoot:!1,exists:!1,error:0,name:null,path:null,object:null,parentExists:!1,parentPath:null,parentObject:null};try{var r=eB.lookupPath(e,{parent:!0});n.parentExists=!0,n.parentPath=r.path,n.parentObject=r.node,n.name=eP.basename(e),r=eB.lookupPath(e,{follow:!t}),n.exists=!0,n.path=r.path,n.object=r.node,n.name=r.node.name,n.isRoot="/"===r.path}catch(e){n.error=e.errno}return n},createPath:function(e,t,r,n){e="string"==typeof e?e:eB.getPath(e);for(var a=t.split("/").reverse();a.length;){var o=a.pop();if(o){var i=eP.join2(e,o);try{eB.mkdir(i)}catch(e){}e=i}}return i},createFile:function(e,t,r,n,a){var o=eP.join2("string"==typeof e?e:eB.getPath(e),t),i=eB.getMode(n,a);return eB.create(o,i)},createDataFile:function(e,t,r,n,a,o){var i=t?eP.join2("string"==typeof e?e:eB.getPath(e),t):e,s=eB.getMode(n,a),l=eB.create(i,s);if(r){if("string"==typeof r){for(var u=Array(r.length),c=0,d=r.length;c<d;++c)u[c]=r.charCodeAt(c);r=u}eB.chmod(l,146|s);var f=eB.open(l,"w");eB.write(f,r,0,r.length,0,o),eB.close(f),eB.chmod(l,s)}return l},createDevice:function(e,t,r,n){var a=eP.join2("string"==typeof e?e:eB.getPath(e),t),o=eB.getMode(!!r,!!n);eB.createDevice.major||(eB.createDevice.major=64);var i=eB.makedev(eB.createDevice.major++,0);return eB.registerDevice(i,{open:function(e){e.seekable=!1},close:function(e){n&&n.buffer&&n.buffer.length&&n(10)},read:function(e,t,n,a,o){for(var i,s=0,l=0;l<a;l++){try{i=r()}catch(e){throw new eB.ErrnoError(29)}if(void 0===i&&0===s)throw new eB.ErrnoError(6);if(null==i)break;s++,t[n+l]=i}return s&&(e.node.timestamp=Date.now()),s},write:function(e,t,r,a,o){for(var i=0;i<a;i++)try{n(t[r+i])}catch(e){throw new eB.ErrnoError(29)}return a&&(e.node.timestamp=Date.now()),i}}),eB.mkdev(a,o,i)},forceLoadFile:function(e){if(e.isDevice||e.isFolder||e.link||e.contents)return!0;var t=!0;if("u">typeof XMLHttpRequest)throw Error("Lazy loading should have been performed (contents set) in createLazyFile, but it was not. Lazy loading only works in web workers. Use --embed-file or --preload-file in emcc on the main thread.");if(o)try{e.contents=tZ(o(e.url),!0),e.usedBytes=e.contents.length}catch(e){t=!1}else throw Error("Cannot load without read() or XMLHttpRequest.");return t||eI(29),t},createLazyFile:function(e,t,r,n,a){function o(){this.lengthKnown=!1,this.chunks=[]}if(o.prototype.get=function(e){if(!(e>this.length-1)&&!(e<0)){var t=e%this.chunkSize,r=e/this.chunkSize|0;return this.getter(r)[t]}},o.prototype.setDataGetter=function(e){this.getter=e},o.prototype.cacheLength=function(){var e,t=new XMLHttpRequest;if(t.open("HEAD",r,!1),t.send(null),!(t.status>=200&&t.status<300||304===t.status))throw Error("Couldn't load "+r+". Status: "+t.status);var n=Number(t.getResponseHeader("Content-length")),a=(e=t.getResponseHeader("Accept-Ranges"))&&"bytes"===e,o=(e=t.getResponseHeader("Content-Encoding"))&&"gzip"===e,i=1048576;a||(i=n);var s=function(e,t){if(e>t)throw Error("invalid range ("+e+", "+t+") or no bytes requested!");if(t>n-1)throw Error("only "+n+" bytes available! programmer error!");var a=new XMLHttpRequest;if(a.open("GET",r,!1),n!==i&&a.setRequestHeader("Range","bytes="+e+"-"+t),"u">typeof Uint8Array&&(a.responseType="arraybuffer"),a.overrideMimeType&&a.overrideMimeType("text/plain; charset=x-user-defined"),a.send(null),!(a.status>=200&&a.status<300||304===a.status))throw Error("Couldn't load "+r+". Status: "+a.status);return void 0!==a.response?new Uint8Array(a.response||[]):tZ(a.responseText||"",!0)},l=this;l.setDataGetter(function(e){var t=e*i,r=(e+1)*i-1;if(r=Math.min(r,n-1),void 0===l.chunks[e]&&(l.chunks[e]=s(t,r)),void 0===l.chunks[e])throw Error("doXHR failed!");return l.chunks[e]}),(o||!n)&&(i=n=1,i=n=this.getter(0).length,O("LazyFiles on gzip forces download of the whole file when length is accessed")),this._length=n,this._chunkSize=i,this.lengthKnown=!0},"u">typeof XMLHttpRequest){if(!F)throw"Cannot do synchronous binary XHRs outside webworkers in modern browsers. Use --embed-file or --preload-file in emcc";var i=new o;Object.defineProperties(i,{length:{get:function(){return this.lengthKnown||this.cacheLength(),this._length}},chunkSize:{get:function(){return this.lengthKnown||this.cacheLength(),this._chunkSize}}});var s={isDevice:!1,contents:i}}else var s={isDevice:!1,url:r};var l=eB.createFile(e,t,s,n,a);s.contents?l.contents=s.contents:s.url&&(l.contents=null,l.url=s.url),Object.defineProperties(l,{usedBytes:{get:function(){return this.contents.length}}});var u={};return Object.keys(l.stream_ops).forEach(function(e){var t=l.stream_ops[e];u[e]=function(){if(!eB.forceLoadFile(l))throw new eB.ErrnoError(29);return t.apply(null,arguments)}}),u.read=function(e,t,r,n,a){if(!eB.forceLoadFile(l))throw new eB.ErrnoError(29);var o=e.node.contents;if(a>=o.length)return 0;var i=Math.min(o.length-a,n);if(o.slice)for(var s=0;s<i;s++)t[r+s]=o[a+s];else for(var s=0;s<i;s++)t[r+s]=o.get(a+s);return i},l.stream_ops=u,l},createPreloadedFile:function(t,r,n,a,o,i,s,l,u,c){tc.init();var d=r?eF.resolve(eP.join2(t,r)):t;function f(n){function f(e){c&&c(),l||eB.createDataFile(t,r,e,a,o,u),i&&i(),eb()}var m=!1;e.preloadPlugins.forEach(function(e){!m&&e.canHandle(d)&&(e.handle(n,d,f,function(){s&&s(),eb()}),m=!0)}),m||f(n)}ey(),"string"==typeof n?tc.asyncLoad(n,function(e){f(e)},s):f(n)},indexedDB:function(){return window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB},DB_NAME:function(){return"EM_FS_"+window.location.pathname},DB_VERSION:20,DB_STORE_NAME:"FILE_DATA",saveFilesToDB:function(e,t,r){t=t||function(){},r=r||function(){};var n=eB.indexedDB();try{var a=n.open(eB.DB_NAME(),eB.DB_VERSION)}catch(e){return r(e)}a.onupgradeneeded=function(){O("creating db"),a.result.createObjectStore(eB.DB_STORE_NAME)},a.onsuccess=function(){var n=a.result.transaction([eB.DB_STORE_NAME],"readwrite"),o=n.objectStore(eB.DB_STORE_NAME),i=0,s=0,l=e.length;function u(){0==s?t():r()}e.forEach(function(e){var t=o.put(eB.analyzePath(e).object.contents,e);t.onsuccess=function(){++i+s==l&&u()},t.onerror=function(){s++,i+s==l&&u()}}),n.onerror=r},a.onerror=r},loadFilesFromDB:function(e,t,r){t=t||function(){},r=r||function(){};var n=eB.indexedDB();try{var a=n.open(eB.DB_NAME(),eB.DB_VERSION)}catch(e){return r(e)}a.onupgradeneeded=r,a.onsuccess=function(){var n=a.result;try{var o=n.transaction([eB.DB_STORE_NAME],"readonly")}catch(e){r(e);return}var i=o.objectStore(eB.DB_STORE_NAME),s=0,l=0,u=e.length;function c(){0==l?t():r()}e.forEach(function(e){var t=i.get(e);t.onsuccess=function(){eB.analyzePath(e).exists&&eB.unlink(e),eB.createDataFile(eP.dirname(e),eP.basename(e),t.result,!0,!0,!0),++s+l==u&&c()},t.onerror=function(){l++,s+l==u&&c()}}),o.onerror=r},a.onerror=r}},eO={mappings:{},DEFAULT_POLLMASK:5,umask:511,calculateAt:function(e,t){if("/"!==t[0]){var r;if(-100===e)r=eB.cwd();else{var n=eB.getStream(e);if(!n)throw new eB.ErrnoError(8);r=n.path}t=eP.join2(r,t)}return t},doStat:function(e,t,r){try{var n=e(t)}catch(e){if(e&&e.node&&eP.normalize(t)!==eP.normalize(eB.getPath(e.node)))return -54;throw e}return w[r>>2]=n.dev,w[r+4>>2]=0,w[r+8>>2]=n.ino,w[r+12>>2]=n.mode,w[r+16>>2]=n.nlink,w[r+20>>2]=n.uid,w[r+24>>2]=n.gid,w[r+28>>2]=n.rdev,w[r+32>>2]=0,T=[n.size>>>0,+Math.abs(_=n.size)>=1?_>0?Math.min(+Math.floor(_/0x100000000),0xffffffff)>>>0:~~Math.ceil((_-(~~_>>>0))/0x100000000)>>>0:0],w[r+40>>2]=T[0],w[r+44>>2]=T[1],w[r+48>>2]=4096,w[r+52>>2]=n.blocks,w[r+56>>2]=n.atime.getTime()/1e3|0,w[r+60>>2]=0,w[r+64>>2]=n.mtime.getTime()/1e3|0,w[r+68>>2]=0,w[r+72>>2]=n.ctime.getTime()/1e3|0,w[r+76>>2]=0,T=[n.ino>>>0,+Math.abs(_=n.ino)>=1?_>0?Math.min(+Math.floor(_/0x100000000),0xffffffff)>>>0:~~Math.ceil((_-(~~_>>>0))/0x100000000)>>>0:0],w[r+80>>2]=T[0],w[r+84>>2]=T[1],0},doMsync:function(e,t,r,n,a){var o=b.slice(e,e+r);eB.msync(t,o,a,r,n)},doMkdir:function(e,t){return"/"===(e=eP.normalize(e))[e.length-1]&&(e=e.substr(0,e.length-1)),eB.mkdir(e,t,0),0},doMknod:function(e,t,r){switch(61440&t){case 32768:case 8192:case 24576:case 4096:case 49152:break;default:return -28}return eB.mknod(e,t,r),0},doReadlink:function(e,t,r){if(r<=0)return -28;var n=eB.readlink(e),a=Math.min(r,J(n)),o=y[t+a];return Q(n,t,r+1),y[t+a]=o,a},doAccess:function(e,t){if(-8&t)return -28;if(!(r=eB.lookupPath(e,{follow:!0}).node))return -44;var r,n="";return(4&t&&(n+="r"),2&t&&(n+="w"),1&t&&(n+="x"),n&&eB.nodePermissions(r,n))?-2:0},doDup:function(e,t,r){var n=eB.getStream(r);return n&&eB.close(n),eB.open(e,t,0,r,r).fd},doReadv:function(e,t,r,n){for(var a=0,o=0;o<r;o++){var i=w[t+8*o>>2],s=w[t+(8*o+4)>>2],l=eB.read(e,y,i,s,n);if(l<0)return -1;if(a+=l,l<s)break}return a},doWritev:function(e,t,r,n){for(var a=0,o=0;o<r;o++){var i=w[t+8*o>>2],s=w[t+(8*o+4)>>2],l=eB.write(e,y,i,s,n);if(l<0)return -1;a+=l}return a},varargs:void 0,get:function(){return eO.varargs+=4,w[eO.varargs-4>>2]},getStr:function(e){return K(e)},getStreamFromFD:function(e){var t=eB.getStream(e);if(!t)throw new eB.ErrnoError(8);return t},get64:function(e,t){return e}};function eU(e){switch(e){case 1:return 0;case 2:return 1;case 4:return 2;case 8:return 3;default:throw TypeError("Unknown type size: "+e)}}var ez=void 0;function eX(e){for(var t="",r=e;b[r];)t+=ez[b[r++]];return t}var e$={},eW={},eH={};function eG(e){if(void 0===e)return"_unknown";var t=(e=e.replace(/[^a-zA-Z0-9_]/g,"$")).charCodeAt(0);return t>=48&&t<=57?"_"+e:e}function eq(e,t){return Function("body","return function "+(e=eG(e))+'() {\n    "use strict";    return body.apply(this, arguments);\n};\n')(t)}function eV(e,t){var r=eq(t,function(e){this.name=t,this.message=e;var r=Error(e).stack;void 0!==r&&(this.stack=this.toString()+"\n"+r.replace(/^Error(:[^\n]*)?\n/,""))});return r.prototype=Object.create(e.prototype),r.prototype.constructor=r,r.prototype.toString=function(){return void 0===this.message?this.name:this.name+": "+this.message},r}var eY=void 0;function eK(e){throw new eY(e)}var eZ=void 0;function eQ(e){throw new eZ(e)}function eJ(e,t,r){if(r=r||{},!("argPackAdvance"in t))throw TypeError("registerType registeredInstance requires argPackAdvance");var n=t.name;if(e||eK('type "'+n+'" must have a positive integer typeid pointer'),eW.hasOwnProperty(e))if(r.ignoreDuplicateRegistrations)return;else eK("Cannot register type '"+n+"' twice");if(eW[e]=t,delete eH[e],e$.hasOwnProperty(e)){var a=e$[e];delete e$[e],a.forEach(function(e){e()})}}var e0=[],e1=[{},{value:void 0},{value:null},{value:!0},{value:!1}];function e2(e){e>4&&0==--e1[e].refcount&&(e1[e]=void 0,e0.push(e))}function e4(e){switch(e){case void 0:return 1;case null:return 2;case!0:return 3;case!1:return 4;default:var t=e0.length?e0.pop():e1.length;return e1[t]={refcount:1,value:e},t}}function e8(e){return this.fromWireType(S[e>>2])}function e3(e){if(null===e)return"null";var t=typeof e;return"object"===t||"array"===t||"function"===t?e.toString():""+e}function e5(e,t){if(!(e instanceof Function))throw TypeError("new_ called with constructor type "+typeof e+" which is not a function");var r=eq(e.name||"unknownFunctionName",function(){});r.prototype=e.prototype;var n=new r,a=e.apply(n,t);return a instanceof Object?a:n}function e6(e){for(;e.length;){var t=e.pop();e.pop()(t)}}var e7=void 0;function e9(e){var t=t3(e),r=eX(t);return t4(t),r}function te(e){return e||eK("Cannot use deleted val. handle = "+e),e1[e].value}function tt(e,t){var r=eW[e];return void 0===r&&eK(t+" has unknown type "+e9(e)),r}function tr(e,t){for(var r=Array(e),n=0;n<e;++n)r[n]=tt(w[(t>>2)+n],"parameter "+n);return r}var tn={};function ta(e){var t=tn[e];return void 0===t?eX(e):t}var to=[];function ti(){return"object"==typeof globalThis?globalThis:Function("return this")()}var ts={};function tl(t,r){if(tc.mainLoop.timingMode=t,tc.mainLoop.timingValue=r,!tc.mainLoop.func)return 1;if(0==t)tc.mainLoop.scheduler=function(){var e=0|Math.max(0,tc.mainLoop.tickStartTime+r-j());setTimeout(tc.mainLoop.runner,e)},tc.mainLoop.method="timeout";else if(1==t)tc.mainLoop.scheduler=function(){tc.requestAnimationFrame(tc.mainLoop.runner)},tc.mainLoop.method="rAF";else if(2==t){if("u"<typeof setImmediate){var n=[],a="setimmediate";addEventListener("message",function(e){(e.data===a||e.data.target===a)&&(e.stopPropagation(),n.shift()())},!0),setImmediate=function(t){n.push(t),F?(void 0===e.setImmediates&&(e.setImmediates=[]),e.setImmediates.push(t),postMessage({target:a})):postMessage(a,"*")}}tc.mainLoop.scheduler=function(){setImmediate(tc.mainLoop.runner)},tc.mainLoop.method="immediate"}return 0}function tu(e,t,r,n,a){m=!0,H(!tc.mainLoop.func,"emscripten_set_main_loop: there can only be one main loop function at once: call emscripten_cancel_main_loop to cancel the previous one before setting a new one with different parameters."),tc.mainLoop.func=e,tc.mainLoop.arg=n;var o=tc.mainLoop.currentlyRunningMainloop;if(tc.mainLoop.runner=function(){if(!W){if(tc.mainLoop.queue.length>0){var t=Date.now(),r=tc.mainLoop.queue.shift();if(r.func(r.arg),tc.mainLoop.remainingBlockers){var n=tc.mainLoop.remainingBlockers,a=n%1==0?n-1:Math.floor(n);r.counted?tc.mainLoop.remainingBlockers=a:(a+=.5,tc.mainLoop.remainingBlockers=(8*n+a)/9)}if(console.log('main loop blocker "'+r.name+'" took '+(Date.now()-t)+" ms"),tc.mainLoop.updateStatus(),o<tc.mainLoop.currentlyRunningMainloop)return;setTimeout(tc.mainLoop.runner,0);return}if(!(o<tc.mainLoop.currentlyRunningMainloop)){if(tc.mainLoop.currentFrameNumber=tc.mainLoop.currentFrameNumber+1|0,1==tc.mainLoop.timingMode&&tc.mainLoop.timingValue>1&&tc.mainLoop.currentFrameNumber%tc.mainLoop.timingValue!=0)return void tc.mainLoop.scheduler();0==tc.mainLoop.timingMode&&(tc.mainLoop.tickStartTime=j()),tc.mainLoop.runIter(e),o<tc.mainLoop.currentlyRunningMainloop||("object"==typeof SDL&&SDL.audio&&SDL.audio.queueNewAudioData&&SDL.audio.queueNewAudioData(),tc.mainLoop.scheduler())}}},a||(t&&t>0?tl(0,1e3/t):tl(1,1),tc.mainLoop.scheduler()),r)throw"unwind"}j=D?function(){var e=s.hrtime();return 1e3*e[0]+e[1]/1e6}:"u">typeof dateNow?dateNow:function(){return performance.now()};var tc={mainLoop:{scheduler:null,method:"",currentlyRunningMainloop:0,func:null,arg:0,timingMode:0,timingValue:0,currentFrameNumber:0,queue:[],pause:function(){tc.mainLoop.scheduler=null,tc.mainLoop.currentlyRunningMainloop++},resume:function(){tc.mainLoop.currentlyRunningMainloop++;var e=tc.mainLoop.timingMode,t=tc.mainLoop.timingValue,r=tc.mainLoop.func;tc.mainLoop.func=null,tu(r,0,!1,tc.mainLoop.arg,!0),tl(e,t),tc.mainLoop.scheduler()},updateStatus:function(){if(e.setStatus){var t=e.statusMessage||"Please wait...",r=tc.mainLoop.remainingBlockers,n=tc.mainLoop.expectedBlockers;r?r<n?e.setStatus(t+" ("+(n-r)+"/"+n+")"):e.setStatus(t):e.setStatus("")}},runIter:function(t){if(!W&&(!e.preMainLoop||!1!==e.preMainLoop())){try{t()}catch(e){if(e instanceof rf||"unwind"==e)return;throw e&&"object"==typeof e&&e.stack&&U("exception thrown: "+[e,e.stack]),e}e.postMainLoop&&e.postMainLoop()}}},isFullscreen:!1,pointerLock:!1,moduleContextCreatedCallbacks:[],workers:[],init:function(){if(e.preloadPlugins||(e.preloadPlugins=[]),!tc.initted){tc.initted=!0;try{new Blob,tc.hasBlobConstructor=!0}catch(e){tc.hasBlobConstructor=!1,console.log("warning: no blob constructor, cannot create blobs with mimetypes")}tc.BlobBuilder="u">typeof MozBlobBuilder?MozBlobBuilder:"u">typeof WebKitBlobBuilder?WebKitBlobBuilder:tc.hasBlobConstructor?null:console.log("warning: no BlobBuilder"),tc.URLObject=window.URL?window.URL:window.webkitURL,e.noImageDecoding||void 0!==tc.URLObject||(console.log("warning: Browser does not support creating object URLs. Built-in browser image decoding will not be available."),e.noImageDecoding=!0);var t={};t.canHandle=function(t){return!e.noImageDecoding&&/\.(jpg|jpeg|png|bmp)$/i.test(t)},t.handle=function(t,r,n,a){var o=null;if(tc.hasBlobConstructor)try{(o=new Blob([t],{type:tc.getMimetype(r)})).size!==t.length&&(o=new Blob([new Uint8Array(t).buffer],{type:tc.getMimetype(r)}))}catch(e){z("Blob constructor present but fails: "+e+"; falling back to blob builder")}if(!o){var i=new tc.BlobBuilder;i.append(new Uint8Array(t).buffer),o=i.getBlob()}var s=tc.URLObject.createObjectURL(o),l=new Image;l.onload=function(){H(l.complete,"Image "+r+" could not be decoded");var a=document.createElement("canvas");a.width=l.width,a.height=l.height,a.getContext("2d").drawImage(l,0,0),e.preloadedImages[r]=a,tc.URLObject.revokeObjectURL(s),n&&n(t)},l.onerror=function(e){console.log("Image "+s+" could not be decoded"),a&&a()},l.src=s},e.preloadPlugins.push(t);var r={};r.canHandle=function(t){return!e.noAudioDecoding&&t.substr(-4)in{".ogg":1,".wav":1,".mp3":1}},r.handle=function(t,r,n,a){var o=!1;function i(a){!o&&(o=!0,e.preloadedAudios[r]=a,n&&n(t))}function s(){!o&&(o=!0,e.preloadedAudios[r]=new Audio,a&&a())}if(!tc.hasBlobConstructor)return s();try{var l=new Blob([t],{type:tc.getMimetype(r)})}catch(e){return s()}var u=tc.URLObject.createObjectURL(l),c=new Audio;c.addEventListener("canplaythrough",function(){i(c)},!1),c.onerror=function(e){o||(console.log("warning: browser could not fully decode audio "+r+", trying slower base64 approach"),c.src="data:audio/x-"+r.substr(-3)+";base64,"+function(e){for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",r="",n=0,a=0,o=0;o<e.length;o++)for(n=n<<8|e[o],a+=8;a>=6;){var i=n>>a-6&63;a-=6,r+=t[i]}return 2==a?(r+=t[(3&n)<<4],r+="=="):4==a&&(r+=t[(15&n)<<2],r+="="),r}(t),i(c))},c.src=u,tc.safeSetTimeout(function(){i(c)},1e4)},e.preloadPlugins.push(r);var n=e.canvas;n&&(n.requestPointerLock=n.requestPointerLock||n.mozRequestPointerLock||n.webkitRequestPointerLock||n.msRequestPointerLock||function(){},n.exitPointerLock=document.exitPointerLock||document.mozExitPointerLock||document.webkitExitPointerLock||document.msExitPointerLock||function(){},n.exitPointerLock=n.exitPointerLock.bind(document),document.addEventListener("pointerlockchange",a,!1),document.addEventListener("mozpointerlockchange",a,!1),document.addEventListener("webkitpointerlockchange",a,!1),document.addEventListener("mspointerlockchange",a,!1),e.elementPointerLock&&n.addEventListener("click",function(t){!tc.pointerLock&&e.canvas.requestPointerLock&&(e.canvas.requestPointerLock(),t.preventDefault())},!1))}function a(){tc.pointerLock=document.pointerLockElement===e.canvas||document.mozPointerLockElement===e.canvas||document.webkitPointerLockElement===e.canvas||document.msPointerLockElement===e.canvas}},createContext:function(t,r,n,a){if(r&&e.ctx&&t==e.canvas)return e.ctx;if(r){var o,i,s={antialias:!1,alpha:!1,majorVersion:1};if(a)for(var l in a)s[l]=a[l];void 0!==th&&(i=th.createContext(t,s))&&(o=th.getContext(i).GLctx)}else o=t.getContext("2d");return o?(n&&(r||H(void 0===A,"cannot set in module if GLctx is used, but we are a non-GL context that would replace it"),e.ctx=o,r&&th.makeContextCurrent(i),e.useWebGL=r,tc.moduleContextCreatedCallbacks.forEach(function(e){e()}),tc.init()),o):null},destroyContext:function(e,t,r){},fullscreenHandlersInstalled:!1,lockPointer:void 0,resizeCanvas:void 0,requestFullscreen:function(t,r){tc.lockPointer=t,tc.resizeCanvas=r,void 0===tc.lockPointer&&(tc.lockPointer=!0),void 0===tc.resizeCanvas&&(tc.resizeCanvas=!1);var n=e.canvas;function a(){tc.isFullscreen=!1;var t=n.parentNode;(document.fullscreenElement||document.mozFullScreenElement||document.msFullscreenElement||document.webkitFullscreenElement||document.webkitCurrentFullScreenElement)===t?(n.exitFullscreen=tc.exitFullscreen,tc.lockPointer&&n.requestPointerLock(),tc.isFullscreen=!0,tc.resizeCanvas?tc.setFullscreenCanvasSize():tc.updateCanvasDimensions(n)):(t.parentNode.insertBefore(n,t),t.parentNode.removeChild(t),tc.resizeCanvas?tc.setWindowedCanvasSize():tc.updateCanvasDimensions(n)),e.onFullScreen&&e.onFullScreen(tc.isFullscreen),e.onFullscreen&&e.onFullscreen(tc.isFullscreen)}tc.fullscreenHandlersInstalled||(tc.fullscreenHandlersInstalled=!0,document.addEventListener("fullscreenchange",a,!1),document.addEventListener("mozfullscreenchange",a,!1),document.addEventListener("webkitfullscreenchange",a,!1),document.addEventListener("MSFullscreenChange",a,!1));var o=document.createElement("div");n.parentNode.insertBefore(o,n),o.appendChild(n),o.requestFullscreen=o.requestFullscreen||o.mozRequestFullScreen||o.msRequestFullscreen||(o.webkitRequestFullscreen?function(){o.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT)}:null)||(o.webkitRequestFullScreen?function(){o.webkitRequestFullScreen(Element.ALLOW_KEYBOARD_INPUT)}:null),o.requestFullscreen()},exitFullscreen:function(){return!!tc.isFullscreen&&((document.exitFullscreen||document.cancelFullScreen||document.mozCancelFullScreen||document.msExitFullscreen||document.webkitCancelFullScreen||function(){}).apply(document,[]),!0)},nextRAF:0,fakeRequestAnimationFrame:function(e){var t=Date.now();if(0===tc.nextRAF)tc.nextRAF=t+1e3/60;else for(;t+2>=tc.nextRAF;)tc.nextRAF+=1e3/60;setTimeout(e,Math.max(tc.nextRAF-t,0))},requestAnimationFrame:function(e){"function"==typeof requestAnimationFrame?requestAnimationFrame(e):(0,tc.fakeRequestAnimationFrame)(e)},safeCallback:function(e){return function(){if(!W)return e.apply(null,arguments)}},allowAsyncCallbacks:!0,queuedAsyncCallbacks:[],pauseAsyncCallbacks:function(){tc.allowAsyncCallbacks=!1},resumeAsyncCallbacks:function(){if(tc.allowAsyncCallbacks=!0,tc.queuedAsyncCallbacks.length>0){var e=tc.queuedAsyncCallbacks;tc.queuedAsyncCallbacks=[],e.forEach(function(e){e()})}},safeRequestAnimationFrame:function(e){return tc.requestAnimationFrame(function(){W||(tc.allowAsyncCallbacks?e():tc.queuedAsyncCallbacks.push(e))})},safeSetTimeout:function(e,t){return m=!0,setTimeout(function(){W||(tc.allowAsyncCallbacks?e():tc.queuedAsyncCallbacks.push(e))},t)},safeSetInterval:function(e,t){return m=!0,setInterval(function(){!W&&tc.allowAsyncCallbacks&&e()},t)},getMimetype:function(e){return({jpg:"image/jpeg",jpeg:"image/jpeg",png:"image/png",bmp:"image/bmp",ogg:"audio/ogg",wav:"audio/wav",mp3:"audio/mpeg"})[e.substr(e.lastIndexOf(".")+1)]},getUserMedia:function(e){window.getUserMedia||(window.getUserMedia=navigator.getUserMedia||navigator.mozGetUserMedia),window.getUserMedia(e)},getMovementX:function(e){return e.movementX||e.mozMovementX||e.webkitMovementX||0},getMovementY:function(e){return e.movementY||e.mozMovementY||e.webkitMovementY||0},getMouseWheelDelta:function(e){var t=0;switch(e.type){case"DOMMouseScroll":t=e.detail/3;break;case"mousewheel":t=e.wheelDelta/120;break;case"wheel":switch(t=e.deltaY,e.deltaMode){case 0:t/=100;break;case 1:t/=3;break;case 2:t*=80;break;default:throw"unrecognized mouse wheel delta mode: "+e.deltaMode}break;default:throw"unrecognized mouse wheel event: "+e.type}return t},mouseX:0,mouseY:0,mouseMovementX:0,mouseMovementY:0,touches:{},lastTouches:{},calculateMouseEvent:function(t){if(tc.pointerLock)"mousemove"!=t.type&&"mozMovementX"in t?tc.mouseMovementX=tc.mouseMovementY=0:(tc.mouseMovementX=tc.getMovementX(t),tc.mouseMovementY=tc.getMovementY(t)),"u">typeof SDL?(tc.mouseX=SDL.mouseX+tc.mouseMovementX,tc.mouseY=SDL.mouseY+tc.mouseMovementY):(tc.mouseX+=tc.mouseMovementX,tc.mouseY+=tc.mouseMovementY);else{var r=e.canvas.getBoundingClientRect(),n=e.canvas.width,a=e.canvas.height,o=void 0!==window.scrollX?window.scrollX:window.pageXOffset,i=void 0!==window.scrollY?window.scrollY:window.pageYOffset;if("touchstart"===t.type||"touchend"===t.type||"touchmove"===t.type){var s=t.touch;if(void 0===s)return;var l=s.pageX-(o+r.left),u=s.pageY-(i+r.top),c={x:l*=n/r.width,y:u*=a/r.height};if("touchstart"===t.type)tc.lastTouches[s.identifier]=c,tc.touches[s.identifier]=c;else if("touchend"===t.type||"touchmove"===t.type){var d=tc.touches[s.identifier];d||(d=c),tc.lastTouches[s.identifier]=d,tc.touches[s.identifier]=c}return}var f=t.pageX-(o+r.left),m=t.pageY-(i+r.top);f*=n/r.width,m*=a/r.height,tc.mouseMovementX=f-tc.mouseX,tc.mouseMovementY=m-tc.mouseY,tc.mouseX=f,tc.mouseY=m}},asyncLoad:function(e,t,r,n){var a=n?"":"al "+e;i(e,function(r){H(r,'Loading data file "'+e+'" failed (no arrayBuffer).'),t(new Uint8Array(r)),a&&eb()},function(t){if(r)r();else throw'Loading data file "'+e+'" failed.'}),a&&ey()},resizeListeners:[],updateResizeListeners:function(){var t=e.canvas;tc.resizeListeners.forEach(function(e){e(t.width,t.height)})},setCanvasSize:function(t,r,n){var a=e.canvas;tc.updateCanvasDimensions(a,t,r),n||tc.updateResizeListeners()},windowedWidth:0,windowedHeight:0,setFullscreenCanvasSize:function(){if("u">typeof SDL){var t=S[SDL.screen>>2];t|=8388608,w[SDL.screen>>2]=t}tc.updateCanvasDimensions(e.canvas),tc.updateResizeListeners()},setWindowedCanvasSize:function(){if("u">typeof SDL){var t=S[SDL.screen>>2];t&=-8388609,w[SDL.screen>>2]=t}tc.updateCanvasDimensions(e.canvas),tc.updateResizeListeners()},updateCanvasDimensions:function(t,r,n){r&&n?(t.widthNative=r,t.heightNative=n):(r=t.widthNative,n=t.heightNative);var a=r,o=n;if(e.forcedAspectRatio&&e.forcedAspectRatio>0&&(a/o<e.forcedAspectRatio?a=Math.round(o*e.forcedAspectRatio):o=Math.round(a/e.forcedAspectRatio)),(document.fullscreenElement||document.mozFullScreenElement||document.msFullscreenElement||document.webkitFullscreenElement||document.webkitCurrentFullScreenElement)===t.parentNode&&"u">typeof screen){var i=Math.min(screen.width/a,screen.height/o);a=Math.round(a*i),o=Math.round(o*i)}tc.resizeCanvas?(t.width!=a&&(t.width=a),t.height!=o&&(t.height=o),void 0!==t.style&&(t.style.removeProperty("width"),t.style.removeProperty("height"))):(t.width!=r&&(t.width=r),t.height!=n&&(t.height=n),void 0!==t.style&&(a!=r||o!=n?(t.style.setProperty("width",a+"px","important"),t.style.setProperty("height",o+"px","important")):(t.style.removeProperty("width"),t.style.removeProperty("height"))))},wgetRequests:{},nextWgetRequestHandle:0,getNextWgetRequestHandle:function(){var e=tc.nextWgetRequestHandle;return tc.nextWgetRequestHandle++,e}},td={inEventHandler:0,removeAllEventListeners:function(){for(var e=td.eventHandlers.length-1;e>=0;--e)td._removeHandler(e);td.eventHandlers=[],td.deferredCalls=[]},registerRemoveEventListeners:function(){td.removeEventListenersRegistered||(td.removeEventListenersRegistered=!0)},deferredCalls:[],deferCall:function(e,t,r){for(var n in td.deferredCalls){var a=td.deferredCalls[n];if(a.targetFunction==e&&function(e,t){if(e.length!=t.length)return!1;for(var r in e)if(e[r]!=t[r])return!1;return!0}(a.argsList,r))return}td.deferredCalls.push({targetFunction:e,precedence:t,argsList:r}),td.deferredCalls.sort(function(e,t){return e.precedence<t.precedence})},removeDeferredCalls:function(e){for(var t=0;t<td.deferredCalls.length;++t)td.deferredCalls[t].targetFunction==e&&(td.deferredCalls.splice(t,1),--t)},canPerformEventHandlerRequests:function(){return td.inEventHandler&&td.currentEventHandler.allowsDeferredCalls},runDeferredCalls:function(){if(td.canPerformEventHandlerRequests())for(var e=0;e<td.deferredCalls.length;++e){var t=td.deferredCalls[e];td.deferredCalls.splice(e,1),--e,t.targetFunction.apply(null,t.argsList)}},eventHandlers:[],removeAllHandlersOnTarget:function(e,t){for(var r=0;r<td.eventHandlers.length;++r)td.eventHandlers[r].target!=e||t&&t!=td.eventHandlers[r].eventTypeString||td._removeHandler(r--)},_removeHandler:function(e){var t=td.eventHandlers[e];t.target.removeEventListener(t.eventTypeString,t.eventListenerFunc,t.useCapture),td.eventHandlers.splice(e,1)},registerOrRemoveHandler:function(e){var t=function(t){++td.inEventHandler,td.currentEventHandler=e,td.runDeferredCalls(),e.handlerFunc(t),td.runDeferredCalls(),--td.inEventHandler};if(e.callbackfunc)e.eventListenerFunc=t,e.target.addEventListener(e.eventTypeString,t,e.useCapture),td.eventHandlers.push(e),td.registerRemoveEventListeners();else for(var r=0;r<td.eventHandlers.length;++r)td.eventHandlers[r].target==e.target&&td.eventHandlers[r].eventTypeString==e.eventTypeString&&td._removeHandler(r--)},getNodeNameForTarget:function(e){return e?e==window?"#window":e==screen?"#screen":e&&e.nodeName?e.nodeName:"":""},fullscreenEnabled:function(){return document.fullscreenEnabled||document.webkitFullscreenEnabled}},tf=[0,"u">typeof document?document:0,window];function tm(e){var t;return tf[e=(t=e)>2?K(t):t]||("u">typeof document?document.querySelector(e):void 0)}function tp(e){return 0>tf.indexOf(e)?e.getBoundingClientRect():{left:0,top:0}}var th={counter:1,buffers:[],programs:[],framebuffers:[],renderbuffers:[],textures:[],uniforms:[],shaders:[],vaos:[],contexts:[],offscreenCanvases:{},timerQueriesEXT:[],programInfos:{},stringCache:{},unpackAlignment:4,recordError:function(e){th.lastError||(th.lastError=e)},getNewId:function(e){for(var t=th.counter++,r=e.length;r<t;r++)e[r]=null;return t},getSource:function(e,t,r,n){for(var a="",o=0;o<t;++o){var i=n?w[n+4*o>>2]:-1;a+=K(w[r+4*o>>2],i<0?void 0:i)}return a},createContext:function(e,t){var r=e.getContext("webgl",t);return r?th.registerContext(r,t):0},registerContext:function(e,t){var r=th.getNewId(th.contexts),n={handle:r,attributes:t,version:t.majorVersion,GLctx:e};return e.canvas&&(e.canvas.GLctxObject=n),th.contexts[r]=n,(void 0===t.enableExtensionsByDefault||t.enableExtensionsByDefault)&&th.initExtensions(n),r},makeContextCurrent:function(t){return th.currentContext=th.contexts[t],e.ctx=A=th.currentContext&&th.currentContext.GLctx,!(t&&!A)},getContext:function(e){return th.contexts[e]},deleteContext:function(e){th.currentContext===th.contexts[e]&&(th.currentContext=null),"object"==typeof td&&td.removeAllHandlersOnTarget(th.contexts[e].GLctx.canvas),th.contexts[e]&&th.contexts[e].GLctx.canvas&&(th.contexts[e].GLctx.canvas.GLctxObject=void 0),th.contexts[e]=null},initExtensions:function(e){if(e||(e=th.currentContext),!e.initExtensionsDone){e.initExtensionsDone=!0;var t,r,n,a,o,i,s=e.GLctx;(r=(t=s).getExtension("ANGLE_instanced_arrays"))&&(t.vertexAttribDivisor=function(e,t){r.vertexAttribDivisorANGLE(e,t)},t.drawArraysInstanced=function(e,t,n,a){r.drawArraysInstancedANGLE(e,t,n,a)},t.drawElementsInstanced=function(e,t,n,a,o){r.drawElementsInstancedANGLE(e,t,n,a,o)}),(a=(n=s).getExtension("OES_vertex_array_object"))&&(n.createVertexArray=function(){return a.createVertexArrayOES()},n.deleteVertexArray=function(e){a.deleteVertexArrayOES(e)},n.bindVertexArray=function(e){a.bindVertexArrayOES(e)},n.isVertexArray=function(e){return a.isVertexArrayOES(e)}),(i=(o=s).getExtension("WEBGL_draw_buffers"))&&(o.drawBuffers=function(e,t){i.drawBuffersWEBGL(e,t)}),s.disjointTimerQueryExt=s.getExtension("EXT_disjoint_timer_query"),s.multiDrawWebgl=s.getExtension("WEBGL_multi_draw");var l=["OES_texture_float","OES_texture_half_float","OES_standard_derivatives","OES_vertex_array_object","WEBGL_compressed_texture_s3tc","WEBGL_depth_texture","OES_element_index_uint","EXT_texture_filter_anisotropic","EXT_frag_depth","WEBGL_draw_buffers","ANGLE_instanced_arrays","OES_texture_float_linear","OES_texture_half_float_linear","EXT_blend_minmax","EXT_shader_texture_lod","EXT_texture_norm16","WEBGL_compressed_texture_pvrtc","EXT_color_buffer_half_float","WEBGL_color_buffer_float","EXT_sRGB","WEBGL_compressed_texture_etc1","EXT_disjoint_timer_query","WEBGL_compressed_texture_etc","WEBGL_compressed_texture_astc","EXT_color_buffer_float","WEBGL_compressed_texture_s3tc_srgb","EXT_disjoint_timer_query_webgl2","WEBKIT_WEBGL_compressed_texture_pvrtc"];(s.getSupportedExtensions()||[]).forEach(function(e){-1!=l.indexOf(e)&&s.getExtension(e)})}},populateUniformTable:function(e){for(var t=th.programs[e],r=th.programInfos[e]={uniforms:{},maxUniformLength:0,maxAttributeLength:-1,maxUniformBlockNameLength:-1},n=r.uniforms,a=A.getProgramParameter(t,35718),o=0;o<a;++o){var i=A.getActiveUniform(t,o),s=i.name;r.maxUniformLength=Math.max(r.maxUniformLength,s.length+1),"]"==s.slice(-1)&&(s=s.slice(0,s.lastIndexOf("[")));var l=A.getUniformLocation(t,s);if(l){var u=th.getNewId(th.uniforms);n[s]=[i.size,u],th.uniforms[u]=l;for(var c=1;c<i.size;++c){var d=s+"["+c+"]";l=A.getUniformLocation(t,d),u=th.getNewId(th.uniforms),th.uniforms[u]=l}}}}},tg=[];function ty(e,t,r,n){for(var a=0;a<e;a++){var o=A[r](),i=o&&th.getNewId(n);o?(o.name=i,n[i]=o):th.recordError(1282),w[t+4*a>>2]=i}}function tb(e,t,r,n,a,o,i,s){t=th.programs[t];var l=A[e](t,r);if(l){var u=s&&Q(l.name,s,n);a&&(w[a>>2]=u),o&&(w[o>>2]=l.size),i&&(w[i>>2]=l.type)}}function tv(e,t){S[e>>2]=t,S[e+4>>2]=(t-S[e>>2])/0x100000000}function tx(e,t,r){if(!t)return void th.recordError(1281);var n=void 0;switch(e){case 36346:n=1;break;case 36344:0!=r&&1!=r&&th.recordError(1280);return;case 36345:n=0;break;case 34466:var a=A.getParameter(34467);n=a?a.length:0}if(void 0===n){var o=A.getParameter(e);switch(typeof o){case"number":n=o;break;case"boolean":n=+!!o;break;case"string":th.recordError(1280);return;case"object":if(null===o)switch(e){case 34964:case 35725:case 34965:case 36006:case 36007:case 32873:case 34229:case 34068:n=0;break;default:return void th.recordError(1280)}else if(o instanceof Float32Array||o instanceof Uint32Array||o instanceof Int32Array||o instanceof Array){for(var i=0;i<o.length;++i)switch(r){case 0:w[t+4*i>>2]=o[i];break;case 2:k[t+4*i>>2]=o[i];break;case 4:y[t+i|0]=+!!o[i]}return}else try{n=0|o.name}catch(t){th.recordError(1280),U("GL_INVALID_ENUM in glGet"+r+"v: Unknown object returned from WebGL getParameter("+e+")! (error: "+t+")");return}break;default:th.recordError(1280),U("GL_INVALID_ENUM in glGet"+r+"v: Native code calling glGet"+r+"v("+e+") and it returns "+o+" of type "+typeof o+"!");return}}switch(r){case 1:tv(t,n);break;case 0:w[t>>2]=n;break;case 2:k[t>>2]=n;break;case 4:y[0|t]=+!!n}}function tw(e){var t=J(e)+1,r=t2(t);return Q(e,r,t),r}function tS(e,t,r,n){if(!r)return void th.recordError(1281);var a=A.getUniform(th.programs[e],th.uniforms[t]);if("number"==typeof a||"boolean"==typeof a)switch(n){case 0:w[r>>2]=a;break;case 2:k[r>>2]=a}else for(var o=0;o<a.length;o++)switch(n){case 0:w[r+4*o>>2]=a[o];break;case 2:k[r+4*o>>2]=a[o]}}function tk(e,t,r,n){if(!r)return void th.recordError(1281);var a=A.getVertexAttrib(e,t);if(34975==t)w[r>>2]=a&&a.name;else if("number"==typeof a||"boolean"==typeof a)switch(n){case 0:w[r>>2]=a;break;case 2:k[r>>2]=a;break;case 5:w[r>>2]=Math.fround(a)}else for(var o=0;o<a.length;o++)switch(n){case 0:w[r+4*o>>2]=a[o];break;case 2:k[r+4*o>>2]=a[o];break;case 5:w[r+4*o>>2]=Math.fround(a[o])}}function tE(e,t,r,n,a,o){var i,s,l=1==(i=e-5120)?b:4==i?w:6==i?k:5==i||28922==i?S:x,u=31-Math.clz32(l.BYTES_PER_ELEMENT),c=n*((({5:3,6:4,8:2,29502:3,29504:4})[t-6402]||1)*(1<<u)*r+(s=th.unpackAlignment)-1&-s);return l.subarray(a>>u,a+c>>u)}var t_=[],tT=[],tj={indexedDB:function(){if("u">typeof indexedDB)return indexedDB;var e=null;return H(e=window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB,"IDBStore used, but indexedDB not supported"),e},DB_VERSION:22,DB_STORE_NAME:"FILE_DATA",dbs:{},blobs:[0],getDB:function(e,t){var r,n=tj.dbs[e];if(n)return t(null,n);try{r=tj.indexedDB().open(e,tj.DB_VERSION)}catch(e){return t(e)}r.onupgradeneeded=function(e){var t=e.target.result,r=e.target.transaction;t.objectStoreNames.contains(tj.DB_STORE_NAME)?r.objectStore(tj.DB_STORE_NAME):t.createObjectStore(tj.DB_STORE_NAME)},r.onsuccess=function(){n=r.result,tj.dbs[e]=n,t(null,n)},r.onerror=function(e){t(this.error),e.preventDefault()}},getStore:function(e,t,r){tj.getDB(e,function(e,n){if(e)return r(e);var a=n.transaction([tj.DB_STORE_NAME],t);a.onerror=function(e){r(this.error||"unknown error"),e.preventDefault()},r(null,a.objectStore(tj.DB_STORE_NAME))})},getFile:function(e,t,r){tj.getStore(e,"readonly",function(e,n){if(e)return r(e);var a=n.get(t);a.onsuccess=function(e){var n=e.target.result;return n?r(null,n):r("file "+t+" not found")},a.onerror=function(e){r(e)}})},setFile:function(e,t,r,n){tj.getStore(e,"readwrite",function(e,a){if(e)return n(e);var o=a.put(r,t);o.onsuccess=function(e){n()},o.onerror=function(e){n(e)}})},deleteFile:function(e,t,r){tj.getStore(e,"readwrite",function(e,n){if(e)return r(e);var a=n.delete(t);a.onsuccess=function(e){r()},a.onerror=function(e){r(e)}})},existsFile:function(e,t,r){tj.getStore(e,"readonly",function(e,n){if(e)return r(e);var a=n.count(t);a.onsuccess=function(e){r(null,e.target.result>0)},a.onerror=function(e){r(e)}})}};function tA(e,t){if(e<=0)return e;var r=t<=32?Math.abs(1<<t-1):Math.pow(2,t-1);return e>=r&&(t<=32||e>r)&&(e=-2*r+e),e}function tC(e,t){return e>=0?e:t<=32?2*Math.abs(1<<t-1)+e:Math.pow(2,t)+e}function tM(e){if(!e||!e.callee||!e.callee.name)return[null,"",""];e.callee.toString();var t=e.callee.name,r="(",n=!0;for(var a in e){var o=e[a];n||(r+=", "),n=!1,"number"==typeof o||"string"==typeof o?r+=o:r+="("+typeof o+")"}r+=")";var i=e.callee.caller;return e=i?i.arguments:[],n&&(r=""),[e,t,r]}function tN(e,t,r,n,a,o,i){td.keyEvent||(td.keyEvent=t2(164));var s={target:tm(e),allowsDeferredCalls:!0,eventTypeString:o,callbackfunc:n,handlerFunc:function(e){var r=td.keyEvent,o=r>>2;w[o+0]=e.location,w[o+1]=e.ctrlKey,w[o+2]=e.shiftKey,w[o+3]=e.altKey,w[o+4]=e.metaKey,w[o+5]=e.repeat,w[o+6]=e.charCode,w[o+7]=e.keyCode,w[o+8]=e.which,Q(e.key||"",r+36,32),Q(e.code||"",r+68,32),Q(e.char||"",r+100,32),Q(e.locale||"",r+132,32),h.get(n)(a,r,t)&&e.preventDefault()},useCapture:r};td.registerOrRemoveHandler(s)}function tP(e,t,r){var n=e>>2;w[n+0]=t.screenX,w[n+1]=t.screenY,w[n+2]=t.clientX,w[n+3]=t.clientY,w[n+4]=t.ctrlKey,w[n+5]=t.shiftKey,w[n+6]=t.altKey,w[n+7]=t.metaKey,v[2*n+16]=t.button,v[2*n+17]=t.buttons,w[n+9]=t.movementX,w[n+10]=t.movementY;var a=tp(r);w[n+11]=t.clientX-a.left,w[n+12]=t.clientY-a.top}function tI(e,t,r,n,a,o,i){td.mouseEvent||(td.mouseEvent=t2(64));var s={target:e=tm(e),allowsDeferredCalls:"mousemove"!=o&&"mouseenter"!=o&&"mouseleave"!=o,eventTypeString:o,callbackfunc:n,handlerFunc:function(r){var o=r||event;tP(td.mouseEvent,o,e),h.get(n)(a,td.mouseEvent,t)&&o.preventDefault()},useCapture:r};td.registerOrRemoveHandler(s)}function tF(e,t,r,n,a,o,i){td.touchEvent||(td.touchEvent=t2(1684));var s={target:e=tm(e),allowsDeferredCalls:"touchstart"==o||"touchend"==o,eventTypeString:o,callbackfunc:n,handlerFunc:function(r){for(var o={},i=r.touches,s=0;s<i.length;++s){var l=i[s];o[l.identifier]=l}i=r.changedTouches;for(var s=0;s<i.length;++s){var l=i[s];l.isChanged=1,o[l.identifier]=l}i=r.targetTouches;for(var s=0;s<i.length;++s)o[i[s].identifier].onTarget=1;var u=td.touchEvent,c=u>>2;w[c+1]=r.ctrlKey,w[c+2]=r.shiftKey,w[c+3]=r.altKey,w[c+4]=r.metaKey,c+=5;var d=tp(e),f=0;for(var s in o){var m=o[s];if(w[c+0]=m.identifier,w[c+1]=m.screenX,w[c+2]=m.screenY,w[c+3]=m.clientX,w[c+4]=m.clientY,w[c+5]=m.pageX,w[c+6]=m.pageY,w[c+7]=m.isChanged,w[c+8]=m.onTarget,w[c+9]=m.clientX-d.left,w[c+10]=m.clientY-d.top,c+=13,++f>31)break}w[u>>2]=f,h.get(n)(a,u,t)&&r.preventDefault()},useCapture:r};td.registerOrRemoveHandler(s)}var tD=["default","low-power","high-performance"];function tL(e){return th.makeContextCurrent(e)?0:-5}e._emscripten_webgl_get_current_context=function(){return th.currentContext?th.currentContext.handle:0},e._emscripten_webgl_make_context_current=tL;var tR={};function tB(){if(!tB.strings){var e={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:("object"==typeof navigator&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",_:N||"./this.program"};for(var t in tR)e[t]=tR[t];var r=[];for(var t in e)r.push(t+"="+e[t]);tB.strings=r}return tB.strings}function tO(e){return e%4==0&&(e%100!=0||e%400==0)}function tU(e,t){for(var r=0,n=0;n<=t;r+=e[n++]);return r}var tz=[31,29,31,30,31,30,31,31,30,31,30,31],tX=[31,28,31,30,31,30,31,31,30,31,30,31];function t$(e,t){for(var r=new Date(e.getTime());t>0;){var n=tO(r.getFullYear()),a=r.getMonth(),o=(n?tz:tX)[a];if(t>o-r.getDate())t-=o-r.getDate()+1,r.setDate(1),a<11?r.setMonth(a+1):(r.setMonth(0),r.setFullYear(r.getFullYear()+1));else{r.setDate(r.getDate()+t);break}}return r}function tW(e,t,r,n){var a=w[n+40>>2],o={tm_sec:w[n>>2],tm_min:w[n+4>>2],tm_hour:w[n+8>>2],tm_mday:w[n+12>>2],tm_mon:w[n+16>>2],tm_year:w[n+20>>2],tm_wday:w[n+24>>2],tm_yday:w[n+28>>2],tm_isdst:w[n+32>>2],tm_gmtoff:w[n+36>>2],tm_zone:a?K(a):""},i=K(r),s={"%c":"%a %b %d %H:%M:%S %Y","%D":"%m/%d/%y","%F":"%Y-%m-%d","%h":"%b","%r":"%I:%M:%S %p","%R":"%H:%M","%T":"%H:%M:%S","%x":"%m/%d/%y","%X":"%H:%M:%S","%Ec":"%c","%EC":"%C","%Ex":"%m/%d/%y","%EX":"%H:%M:%S","%Ey":"%y","%EY":"%Y","%Od":"%d","%Oe":"%e","%OH":"%H","%OI":"%I","%Om":"%m","%OM":"%M","%OS":"%S","%Ou":"%u","%OU":"%U","%OV":"%V","%Ow":"%w","%OW":"%W","%Oy":"%y"};for(var l in s)i=i.replace(RegExp(l,"g"),s[l]);var u=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],c=["January","February","March","April","May","June","July","August","September","October","November","December"];function d(e,t,r){for(var n="number"==typeof e?e.toString():e||"";n.length<t;)n=r[0]+n;return n}function f(e,t){return d(e,t,"0")}function m(e,t){var r;function n(e){return e<0?-1:+(e>0)}return 0===(r=n(e.getFullYear()-t.getFullYear()))&&0===(r=n(e.getMonth()-t.getMonth()))&&(r=n(e.getDate()-t.getDate())),r}function p(e){switch(e.getDay()){case 0:return new Date(e.getFullYear()-1,11,29);case 1:return e;case 2:return new Date(e.getFullYear(),0,3);case 3:return new Date(e.getFullYear(),0,2);case 4:return new Date(e.getFullYear(),0,1);case 5:return new Date(e.getFullYear()-1,11,31);case 6:return new Date(e.getFullYear()-1,11,30)}}function h(e){var t=t$(new Date(e.tm_year+1900,0,1),e.tm_yday),r=new Date(t.getFullYear(),0,4),n=new Date(t.getFullYear()+1,0,4),a=p(r),o=p(n);return 0>=m(a,t)?0>=m(o,t)?t.getFullYear()+1:t.getFullYear():t.getFullYear()-1}var g={"%a":function(e){return u[e.tm_wday].substring(0,3)},"%A":function(e){return u[e.tm_wday]},"%b":function(e){return c[e.tm_mon].substring(0,3)},"%B":function(e){return c[e.tm_mon]},"%C":function(e){return f((e.tm_year+1900)/100|0,2)},"%d":function(e){return f(e.tm_mday,2)},"%e":function(e){return d(e.tm_mday,2," ")},"%g":function(e){return h(e).toString().substring(2)},"%G":function(e){return h(e)},"%H":function(e){return f(e.tm_hour,2)},"%I":function(e){var t=e.tm_hour;return 0==t?t=12:t>12&&(t-=12),f(t,2)},"%j":function(e){return f(e.tm_mday+tU(tO(e.tm_year+1900)?tz:tX,e.tm_mon-1),3)},"%m":function(e){return f(e.tm_mon+1,2)},"%M":function(e){return f(e.tm_min,2)},"%n":function(){return"\n"},"%p":function(e){return e.tm_hour>=0&&e.tm_hour<12?"AM":"PM"},"%S":function(e){return f(e.tm_sec,2)},"%t":function(){return"	"},"%u":function(e){return e.tm_wday||7},"%U":function(e){var t=new Date(e.tm_year+1900,0,1),r=0===t.getDay()?t:t$(t,7-t.getDay()),n=new Date(e.tm_year+1900,e.tm_mon,e.tm_mday);if(0>m(r,n)){var a=tU(tO(n.getFullYear())?tz:tX,n.getMonth()-1)-31;return f(Math.ceil((31-r.getDate()+a+n.getDate())/7),2)}return 0===m(r,t)?"01":"00"},"%V":function(e){var t=new Date(e.tm_year+1900,0,4),r=new Date(e.tm_year+1901,0,4),n=p(t),a=p(r),o=t$(new Date(e.tm_year+1900,0,1),e.tm_yday);return 0>m(o,n)?"53":0>=m(a,o)?"01":f(Math.ceil((n.getFullYear()<e.tm_year+1900?e.tm_yday+32-n.getDate():e.tm_yday+1-n.getDate())/7),2)},"%w":function(e){return e.tm_wday},"%W":function(e){var t=new Date(e.tm_year,0,1),r=1===t.getDay()?t:t$(t,0===t.getDay()?1:7-t.getDay()+1),n=new Date(e.tm_year+1900,e.tm_mon,e.tm_mday);if(0>m(r,n)){var a=tU(tO(n.getFullYear())?tz:tX,n.getMonth()-1)-31;return f(Math.ceil((31-r.getDate()+a+n.getDate())/7),2)}return 0===m(r,t)?"01":"00"},"%y":function(e){return(e.tm_year+1900).toString().substring(2)},"%Y":function(e){return e.tm_year+1900},"%z":function(e){var t=e.tm_gmtoff;return(t>=0?"+":"-")+String("0000"+(t=(t=Math.abs(t)/60)/60*100+t%60)).slice(-4)},"%Z":function(e){return e.tm_zone},"%%":function(){return"%"}};for(var l in g)i.indexOf(l)>=0&&(i=i.replace(RegExp(l,"g"),g[l](o)));var b=tZ(i,!1);return b.length>t?0:(y.set(b,e),b.length-1)}var tH=function(e,t,r,n){e||(e=this),this.parent=e,this.mount=e.mount,this.mounted=null,this.id=eB.nextInode++,this.name=t,this.mode=r,this.node_ops={},this.stream_ops={},this.rdev=n};Object.defineProperties(tH.prototype,{read:{get:function(){return(365&this.mode)==365},set:function(e){e?this.mode|=365:this.mode&=-366}},write:{get:function(){return(146&this.mode)==146},set:function(e){e?this.mode|=146:this.mode&=-147}},isFolder:{get:function(){return eB.isDir(this.mode)}},isDevice:{get:function(){return eB.isChrdev(this.mode)}}}),eB.FSNode=tH,eB.staticInit(),e.FS_createPath=eB.createPath,e.FS_createDataFile=eB.createDataFile,e.FS_createPreloadedFile=eB.createPreloadedFile,e.FS_createLazyFile=eB.createLazyFile,e.FS_createDevice=eB.createDevice,e.FS_unlink=eB.unlink;for(var tG=Array(256),tq=0;tq<256;++tq)tG[tq]=String.fromCharCode(tq);ez=tG,eY=e.BindingError=eV(Error,"BindingError"),eZ=e.InternalError=eV(Error,"InternalError"),e.count_emval_handles=function(){for(var e=0,t=5;t<e1.length;++t)void 0!==e1[t]&&++e;return e},e.get_first_emval=function(){for(var e=5;e<e1.length;++e)if(void 0!==e1[e])return e1[e];return null},e7=e.UnboundTypeError=eV(Error,"UnboundTypeError"),e.requestFullscreen=function(e,t){tc.requestFullscreen(e,t)},e.requestAnimationFrame=function(e){tc.requestAnimationFrame(e)},e.setCanvasSize=function(e,t,r){tc.setCanvasSize(e,t,r)},e.pauseMainLoop=function(){tc.mainLoop.pause()},e.resumeMainLoop=function(){tc.mainLoop.resume()},e.getUserMedia=function(){tc.getUserMedia()},e.createContext=function(e,t,r,n){return tc.createContext(e,t,r,n)};for(var tV=0;tV<32;++tV)tg.push(Array(tV));for(var tY=new Float32Array(288),tV=0;tV<288;++tV)t_[tV]=tY.subarray(0,tV+1);for(var tK=new Int32Array(288),tV=0;tV<288;++tV)tT[tV]=tK.subarray(0,tV+1);function tZ(e,t,r){var n=Array(r>0?r:J(e)+1),a=Z(e,n,0,n.length);return t&&(n.length=a),n}ef.push({func:function(){tJ()}});var tQ={d:function(e,t,r,n){ev("Assertion failed: "+K(e)+", at: "+[t?K(t):"unknown filename",r,n?K(n):"unknown function"])},l:function(e){return t2(e+16)+16},Ue:function(){var e=eC.pop(),t=e.get_exception_info(),r=e.get_base_ptr();throw t.get_rethrown()?e.free():(eC.push(e),t.set_rethrown(!0)),r},V:function(e,t){},k:function(e,t,r){throw new eM(e).init(t,r),"uncaught_exception"in ra?ra.uncaught_exceptions++:ra.uncaught_exceptions=1,e},Te:function(e,t){var r,n,a,o,i,s,l;return eN(),r=new Date(1e3*w[e>>2]),w[t>>2]=r.getSeconds(),w[t+4>>2]=r.getMinutes(),w[t+8>>2]=r.getHours(),w[t+12>>2]=r.getDate(),w[t+16>>2]=r.getMonth(),w[t+20>>2]=r.getFullYear()-1900,w[t+24>>2]=r.getDay(),n=new Date(r.getFullYear(),0,1),a=(r.getTime()-n.getTime())/864e5|0,w[t+28>>2]=a,w[t+36>>2]=-(60*r.getTimezoneOffset()),s=0|((o=new Date(r.getFullYear(),6,1).getTimezoneOffset())!=(i=n.getTimezoneOffset())&&r.getTimezoneOffset()==Math.min(i,o)),w[t+32>>2]=s,l=w[t6()+4*!!s>>2],w[t+40>>2]=l,t},Fe:function(e,t){try{return e=eO.getStr(e),eO.doAccess(e,t)}catch(e){return void 0!==eB&&e instanceof eB.ErrnoError||ev(e),-e.errno}},wa:function(e,t){try{return e=eO.getStr(e),eB.chmod(e,t),0}catch(e){return void 0!==eB&&e instanceof eB.ErrnoError||ev(e),-e.errno}},we:function(e,t){try{return eB.fchmod(e,t),0}catch(e){return void 0!==eB&&e instanceof eB.ErrnoError||ev(e),-e.errno}},D:function(e,t,r){eO.varargs=r;try{var n=eO.getStreamFromFD(e);switch(t){case 0:var a=eO.get();if(a<0)return -28;return eB.open(n.path,n.flags,0,a).fd;case 1:case 2:case 13:case 14:return 0;case 3:return n.flags;case 4:var a=eO.get();return n.flags|=a,0;case 12:var a=eO.get();return v[a+0>>1]=2,0;case 16:case 8:default:return -28;case 9:return eI(28),-1}}catch(e){return void 0!==eB&&e instanceof eB.ErrnoError||ev(e),-e.errno}},Ke:function(e,t){try{var r=eO.getStreamFromFD(e);return eO.doStat(eB.stat,r.path,t)}catch(e){return void 0!==eB&&e instanceof eB.ErrnoError||ev(e),-e.errno}},Me:function(e,t,r,n){try{var a=eO.get64(r,n);return eB.ftruncate(e,a),0}catch(e){return void 0!==eB&&e instanceof eB.ErrnoError||ev(e),-e.errno}},Pe:function(e,t){try{if(0===t)return -28;var r=eB.cwd(),n=J(r);if(t<n+1)return -68;return Q(r,e,t),e}catch(e){return void 0!==eB&&e instanceof eB.ErrnoError||ev(e),-e.errno}},Ie:function(e,t,r){try{var n=eO.getStreamFromFD(e);n.getdents||(n.getdents=eB.readdir(n.path));for(var a=0,o=eB.llseek(n,0,1),i=Math.floor(o/280);i<n.getdents.length&&a+280<=r;){var s,l,u=n.getdents[i];if("."===u[0])s=1,l=4;else{var c=eB.lookupNode(n.node,u);s=c.id,l=eB.isChrdev(c.mode)?2:eB.isDir(c.mode)?4:eB.isLink(c.mode)?10:8}T=[s>>>0,(_=s,+Math.abs(_)>=1?_>0?Math.min(+Math.floor(_/0x100000000),0xffffffff)>>>0:~~Math.ceil((_-(~~_>>>0))/0x100000000)>>>0:0)],w[t+a>>2]=T[0],w[t+a+4>>2]=T[1],T=[(i+1)*280>>>0,(_=(i+1)*280,+Math.abs(_)>=1?_>0?Math.min(+Math.floor(_/0x100000000),0xffffffff)>>>0:~~Math.ceil((_-(~~_>>>0))/0x100000000)>>>0:0)],w[t+a+8>>2]=T[0],w[t+a+12>>2]=T[1],v[t+a+16>>1]=280,y[t+a+18|0]=l,Q(u,t+a+19,256),a+=280,i+=1}return eB.llseek(n,280*i,0),a}catch(e){return void 0!==eB&&e instanceof eB.ErrnoError||ev(e),-e.errno}},U:function(){return 0},ua:function(){return 42},Je:function(){return 0},Be:function(e,t,r){eO.varargs=r;try{var n=eO.getStreamFromFD(e);switch(t){case 21509:case 21505:case 21510:case 21511:case 21512:case 21506:case 21507:case 21508:case 21523:case 21524:if(!n.tty)return -59;return 0;case 21519:if(!n.tty)return -59;var a=eO.get();return w[a>>2]=0,0;case 21520:if(!n.tty)return -59;return -28;case 21531:var a=eO.get();return eB.ioctl(n,t,a);default:ev("bad ioctl syscall "+t)}}catch(e){return void 0!==eB&&e instanceof eB.ErrnoError||ev(e),-e.errno}},ye:function(e,t){return -34},Le:function(e,t){try{return e=eO.getStr(e),eO.doStat(eB.lstat,e,t)}catch(e){return void 0!==eB&&e instanceof eB.ErrnoError||ev(e),-e.errno}},De:function(e,t){try{return e=eO.getStr(e),eO.doMkdir(e,t)}catch(e){return void 0!==eB&&e instanceof eB.ErrnoError||ev(e),-e.errno}},Oe:function(e,t,r,n,a,o){try{var i=o;i<<=12;var s,l=!1;if((16&n)!=0&&e%16384!=0)return -28;if((32&n)!=0){if(!(s=ro(16384,t)))return -48;t1(s,0,t),l=!0}else{var u=eB.getStream(a);if(!u)return -8;var c=eB.mmap(u,e,t,i,r,n);s=c.ptr,l=c.allocated}return eO.mappings[s]={malloc:s,len:t,allocated:l,fd:a,prot:r,flags:n,offset:i},s}catch(e){return void 0!==eB&&e instanceof eB.ErrnoError||ev(e),-e.errno}},xe:function(e,t){try{if((0|e)==-1||0===t)return -28;var r=eO.mappings[e];if(!r)return 0;if(t===r.len){var n=eB.getStream(r.fd);2&r.prot&&eO.doMsync(e,n,t,r.flags,r.offset),eO.mappings[e]=null,r.allocated&&t4(r.malloc)}return 0}catch(e){return void 0!==eB&&e instanceof eB.ErrnoError||ev(e),-e.errno}},T:function(e,t,r){eO.varargs=r;try{var n=eO.getStr(e),a=eO.get();return eB.open(n,t,a).fd}catch(e){return void 0!==eB&&e instanceof eB.ErrnoError||ev(e),-e.errno}},Qe:function(e,t,r){try{for(var n=0,a=0;a<t;a++){var o=e+8*a,i=w[o>>2],s=v[o+4>>1],l=32,u=eB.getStream(i);u&&(l=eO.DEFAULT_POLLMASK,u.stream_ops.poll&&(l=u.stream_ops.poll(u))),(l&=8|s|16)&&n++,v[o+6>>1]=l}return n}catch(e){return void 0!==eB&&e instanceof eB.ErrnoError||ev(e),-e.errno}},He:function(e,t,r){try{var n=eO.getStreamFromFD(e);return eB.read(n,y,t,r)}catch(e){return void 0!==eB&&e instanceof eB.ErrnoError||ev(e),-e.errno}},ze:function(e,t,r){try{return e=eO.getStr(e),eO.doReadlink(e,t,r)}catch(e){return void 0!==eB&&e instanceof eB.ErrnoError||ev(e),-e.errno}},Ee:function(e,t){try{return e=eO.getStr(e),t=eO.getStr(t),eB.rename(e,t),0}catch(e){return void 0!==eB&&e instanceof eB.ErrnoError||ev(e),-e.errno}},Ce:function(e){try{return e=eO.getStr(e),eB.rmdir(e),0}catch(e){return void 0!==eB&&e instanceof eB.ErrnoError||ev(e),-e.errno}},va:function(e,t){try{return e=eO.getStr(e),eO.doStat(eB.stat,e,t)}catch(e){return void 0!==eB&&e instanceof eB.ErrnoError||ev(e),-e.errno}},Ae:function(e,t){try{return e=eO.getStr(e),t=eO.getStr(t),eB.symlink(e,t),0}catch(e){return void 0!==eB&&e instanceof eB.ErrnoError||ev(e),-e.errno}},Ne:function(e,t,r,n){try{e=eO.getStr(e);var a=eO.get64(r,n);return eB.truncate(e,a),0}catch(e){return void 0!==eB&&e instanceof eB.ErrnoError||ev(e),-e.errno}},Re:function(e){try{if(!e)return -21;var t={__size__:390,sysname:0,nodename:65,release:130,version:195,machine:260,domainname:325},r=function(r,n){var a=t[r];el(n,e+a)};return r("sysname","Emscripten"),r("nodename","emscripten"),r("release","1.0"),r("version","#1"),r("machine","x86-JS"),0}catch(e){return void 0!==eB&&e instanceof eB.ErrnoError||ev(e),-e.errno}},Se:function(e){try{return e=eO.getStr(e),eB.unlink(e),0}catch(e){return void 0!==eB&&e instanceof eB.ErrnoError||ev(e),-e.errno}},Ge:function(e,t,r,n){try{t=eO.getStr(t),t=eO.calculateAt(e,t);var a=w[r>>2],o=w[r+4>>2],i=1e3*a+o/1e6;r+=8,a=w[r>>2],o=w[r+4>>2];var s=1e3*a+o/1e6;return eB.utime(t,i,s),0}catch(e){return void 0!==eB&&e instanceof eB.ErrnoError||ev(e),-e.errno}},re:function(e,t,r,n,a){var o=eU(r);eJ(e,{name:t=eX(t),fromWireType:function(e){return!!e},toWireType:function(e,t){return t?n:a},argPackAdvance:8,readValueFromPointer:function(e){var n;if(1===r)n=y;else if(2===r)n=v;else if(4===r)n=w;else throw TypeError("Unknown boolean type size: "+t);return this.fromWireType(n[e>>o])},destructorFunction:null})},qe:function(e,t){eJ(e,{name:t=eX(t),fromWireType:function(e){var t=e1[e].value;return e2(e),t},toWireType:function(e,t){return e4(t)},argPackAdvance:8,readValueFromPointer:e8,destructorFunction:null})},sa:function(e,t,r){var n=eU(r);eJ(e,{name:t=eX(t),fromWireType:function(e){return e},toWireType:function(e,t){if("number"!=typeof t&&"boolean"!=typeof t)throw TypeError('Cannot convert "'+e3(t)+'" to '+this.name);return t},argPackAdvance:8,readValueFromPointer:function(e,t){switch(t){case 2:return function(e){return this.fromWireType(k[e>>2])};case 3:return function(e){return this.fromWireType(E[e>>3])};default:throw TypeError("Unknown float type: "+e)}}(t,n),destructorFunction:null})},w:function(t,r,n,a,o,i){var s,l,u,c=function(e,t){for(var r=[],n=0;n<e;n++)r.push(w[(t>>2)+n]);return r}(r,n);t=eX(t),s=a,l=o,s=eX(s),"function"!=typeof(u=function(){if(-1!=s.indexOf("j")){var t,r;return H((t=s).indexOf("j")>=0,"getDynCaller should only be called with i64 sigs"),r=[],function(){r.length=arguments.length;for(var n=0;n<arguments.length;n++)r[n]=arguments[n];return -1!=t.indexOf("j")?r&&r.length?e["dynCall_"+t].apply(null,[l].concat(r)):e["dynCall_"+t].call(null,l):h.get(l).apply(null,r)}}return h.get(l)}())&&eK("unknown function pointer with signature "+s+": "+l),o=u,function(t,r,n){if(e.hasOwnProperty(t)){(void 0===n||void 0!==e[t].overloadTable&&void 0!==e[t].overloadTable[n])&&eK("Cannot register public name '"+t+"' twice");var a=e;if(void 0===a[t].overloadTable){var o=a[t];a[t]=function(){return a[t].overloadTable.hasOwnProperty(arguments.length)||eK("Function '"+t+"' called with an invalid number of arguments ("+arguments.length+") - expects one of ("+a[t].overloadTable+")!"),a[t].overloadTable[arguments.length].apply(this,arguments)},a[t].overloadTable=[],a[t].overloadTable[o.argCount]=o}e.hasOwnProperty(n)&&eK("Cannot register multiple overloads of a function with the same number of arguments ("+n+")!"),e[t].overloadTable[n]=r}else e[t]=r,void 0!==n&&(e[t].numArguments=n)}(t,function(){var e="Cannot call "+t+" due to unbound types",r=[],n={};throw c.forEach(function e(t){if(!n[t]&&!eW[t]){if(eH[t])return void eH[t].forEach(e);r.push(t),n[t]=!0}}),new e7(e+": "+r.map(e9).join([", "]))},r-1),function(e,t,r){function n(t){var n=r(t);n.length!==e.length&&eQ("Mismatched type converter count");for(var a=0;a<e.length;++a)eJ(e[a],n[a])}e.forEach(function(e){eH[e]=t});var a=Array(t.length),o=[],i=0;t.forEach(function(e,t){eW.hasOwnProperty(e)?a[t]=eW[e]:(o.push(e),e$.hasOwnProperty(e)||(e$[e]=[]),e$[e].push(function(){a[t]=eW[e],++i===o.length&&n(a)}))}),0===o.length&&n(a)}([],c,function(n){var a,s,l,u=[n[0],null].concat(n.slice(1));return a=t,s=function(e,t,r,n,a){var o=t.length;o<2&&eK("argTypes array size mismatch! Must at least get return value and 'this' types!");for(var i=null!==t[1]&&!1,s=!1,l=1;l<t.length;++l)if(null!==t[l]&&void 0===t[l].destructorFunction){s=!0;break}for(var u="void"!==t[0].name,c="",d="",l=0;l<o-2;++l)c+=(0!==l?", ":"")+"arg"+l,d+=(0!==l?", ":"")+"arg"+l+"Wired";var f="return function "+eG(e)+"("+c+") {\nif (arguments.length !== "+(o-2)+") {\nthrowBindingError('function "+e+" called with ' + arguments.length + ' arguments, expected "+(o-2)+" args!');\n}\n";s&&(f+="var destructors = [];\n");var m=s?"destructors":"null",p=["throwBindingError","invoker","fn","runDestructors","retType","classParam"],h=[eK,n,a,e6,t[0],t[1]];i&&(f+="var thisWired = classParam.toWireType("+m+", this);\n");for(var l=0;l<o-2;++l)f+="var arg"+l+"Wired = argType"+l+".toWireType("+m+", arg"+l+"); // "+t[l+2].name+"\n",p.push("argType"+l),h.push(t[l+2]);if(i&&(d="thisWired"+(d.length>0?", ":"")+d),f+=(u?"var rv = ":"")+"invoker(fn"+(d.length>0?", ":"")+d+");\n",s)f+="runDestructors(destructors);\n";else for(var l=i?1:2;l<t.length;++l){var g=1===l?"thisWired":"arg"+(l-2)+"Wired";null!==t[l].destructorFunction&&(f+=g+"_dtor("+g+"); // "+t[l].name+"\n",p.push(g+"_dtor"),h.push(t[l].destructorFunction))}return u&&(f+="var ret = retType.fromWireType(rv);\nreturn ret;\n"),f+="}\n",p.push(f),e5(Function,p).apply(null,h)}(t,u,0,o,i),l=r-1,e.hasOwnProperty(a)||eQ("Replacing nonexistant public symbol"),void 0!==e[a].overloadTable&&void 0!==l?e[a].overloadTable[l]=s:(e[a]=s,e[a].argCount=l),[]})},F:function(e,t,r,n,a){t=eX(t),-1===a&&(a=0xffffffff);var o=eU(r),i=function(e){return e};if(0===n){var s=32-8*r;i=function(e){return e<<s>>>s}}var l=-1!=t.indexOf("unsigned");eJ(e,{name:t,fromWireType:i,toWireType:function(e,r){if("number"!=typeof r&&"boolean"!=typeof r)throw TypeError('Cannot convert "'+e3(r)+'" to '+this.name);if(r<n||r>a)throw TypeError('Passing a number "'+e3(r)+'" from JS side to C/C++ side to an argument of type "'+t+'", which is outside the valid range ['+n+", "+a+"]!");return l?r>>>0:0|r},argPackAdvance:8,readValueFromPointer:function(e,t,r){switch(t){case 0:return r?function(e){return y[e]}:function(e){return b[e]};case 1:return r?function(e){return v[e>>1]}:function(e){return x[e>>1]};case 2:return r?function(e){return w[e>>2]}:function(e){return S[e>>2]};default:throw TypeError("Unknown integer type: "+e)}}(t,o,0!==n),destructorFunction:null})},B:function(e,t,r){var n=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array][t];function a(e){e>>=2;var t=S,r=t[e],a=t[e+1];return new n(g,a,r)}eJ(e,{name:r=eX(r),fromWireType:a,argPackAdvance:8,readValueFromPointer:a},{ignoreDuplicateRegistrations:!0})},ra:function(e,t){var r="std::string"===(t=eX(t));eJ(e,{name:t,fromWireType:function(e){var t,n=S[e>>2];if(r)for(var a=e+4,o=0;o<=n;++o){var i=e+4+o;if(o==n||0==b[i]){var s=i-a,l=K(a,s);void 0===t?t=l:(t+="\0",t+=l),a=i+1}}else{for(var u=Array(n),o=0;o<n;++o)u[o]=String.fromCharCode(b[e+4+o]);t=u.join("")}return t4(e),t},toWireType:function(e,t){t instanceof ArrayBuffer&&(t=new Uint8Array(t));var n="string"==typeof t;n||t instanceof Uint8Array||t instanceof Uint8ClampedArray||t instanceof Int8Array||eK("Cannot pass non-string to std::string");var a=(r&&n?function(){return J(t)}:function(){return t.length})(),o=t2(4+a+1);if(S[o>>2]=a,r&&n)Q(t,o+4,a+1);else if(n)for(var i=0;i<a;++i){var s=t.charCodeAt(i);s>255&&(t4(o),eK("String has UTF-16 code units that do not fit in 8 bits")),b[o+4+i]=s}else for(var i=0;i<a;++i)b[o+4+i]=t[i];return null!==e&&e.push(t4,o),o},argPackAdvance:8,readValueFromPointer:e8,destructorFunction:function(e){t4(e)}})},R:function(e,t,r){var n,a,o,i,s;r=eX(r),2===t?(n=et,a=er,i=en,o=function(){return x},s=1):4===t&&(n=ea,a=eo,i=ei,o=function(){return S},s=2),eJ(e,{name:r,fromWireType:function(e){for(var r,a=S[e>>2],i=o(),l=e+4,u=0;u<=a;++u){var c=e+4+u*t;if(u==a||0==i[c>>s]){var d=c-l,f=n(l,d);void 0===r?r=f:(r+="\0",r+=f),l=c+t}}return t4(e),r},toWireType:function(e,n){"string"!=typeof n&&eK("Cannot pass non-string to C++ string type "+r);var o=i(n),l=t2(4+o+t);return S[l>>2]=o>>s,a(n,l+4,o+t),null!==e&&e.push(t4,l),l},argPackAdvance:8,readValueFromPointer:e8,destructorFunction:function(e){t4(e)}})},pe:function(e,t){eJ(e,{isVoid:!0,name:t=eX(t),argPackAdvance:0,fromWireType:function(){},toWireType:function(e,t){}})},v:function(e,t,r){e=te(e),t=tt(t,"emval::as");var n=[],a=e4(n);return w[r>>2]=a,t.toWireType(n,e)},qa:function(e,t,r,n){e=te(e);for(var a=tr(t,r),o=Array(t),i=0;i<t;++i){var s=a[i];o[i]=s.readValueFromPointer(n),n+=s.argPackAdvance}return e4(e.apply(void 0,o))},z:function(e,t,r,n,a){var o;return e=to[e],e(t=te(t),r=ta(r),(o=[],w[n>>2]=e4(o),o),a)},G:function(e,t,r,n){e=to[e],e(t=te(t),r=ta(r),null,n)},e:e2,O:function(e,t){return(e=te(e))==(t=te(t))},q:function(e){return 0===e?e4(ti()):(e=ta(e),e4(ti()[e]))},t:function(e,t){for(var r,n,a=tr(e,t),o=a[0],i=o.name+"_$"+a.slice(1).map(function(e){return e.name}).join("_")+"$",s=["retType"],l=[o],u="",c=0;c<e-1;++c)u+=(0!==c?", ":"")+"arg"+c,s.push("argType"+c),l.push(a[1+c]);for(var d="return function "+eG("methodCaller_"+i)+"(handle, name, destructors, args) {\n",f=0,c=0;c<e-1;++c)d+="    var arg"+c+" = argType"+c+".readValueFromPointer(args"+(f?"+"+f:"")+");\n",f+=a[c+1].argPackAdvance;d+="    var rv = handle[name]("+u+");\n";for(var c=0;c<e-1;++c)a[c+1].deleteObject&&(d+="    argType"+c+".deleteObject(arg"+c+");\n");return o.isVoid||(d+="    return retType.toWireType(destructors, rv);\n"),d+="};\n",s.push(d),r=e5(Function,s).apply(null,l),n=to.length,to.push(r),n},A:function(t){return e4(e[t=ta(t)])},m:function(e,t){return e4((e=te(e))[t=te(t)])},p:function(e){e>4&&(e1[e].refcount+=1)},oe:function(e){return"string"==typeof(e=te(e))},ne:function(t,r,n,a){t=te(t);var o=ts[r];return o||(o=function(t){for(var r="",n=0;n<t;++n)r+=(0!==n?", ":"")+"arg"+n;for(var a="return function emval_allocator_"+t+"(constructor, argTypes, args) {\n",n=0;n<t;++n)a+="var argType"+n+" = requireRegisteredType(Module['HEAP32'][(argTypes >>> 2) + "+n+'], "parameter '+n+'");\nvar arg'+n+" = argType"+n+".readValueFromPointer(args);\nargs += argType"+n+"['argPackAdvance'];\n";return Function("requireRegisteredType","Module","__emval_register",a+="var obj = new constructor("+r+");\nreturn __emval_register(obj);\n}\n")(tt,e,e4)}(r),ts[r]=o),o(t,n,a)},h:function(e){return e4(ta(e))},pa:function(){return e4({})},o:function(e){e6(e1[e].value),e2(e)},C:function(e,t,r){e=te(e),t=te(t),r=te(r),e[t]=r},E:function(e,t){return e4((e=tt(e,"_emval_take_value")).readValueFromPointer(t))},s:function(){ev()},M:function(e,t){var r;if(0===e)r=Date.now();else{if(1!==e&&4!==e)return eI(28),-1;r=j()}return w[t>>2]=r/1e3|0,w[t+4>>2]=r%1e3*1e6|0,0},me:function(e){ev("To use dlopen, you need to use Emscripten's linking support, see https://github.com/emscripten-core/emscripten/wiki/Linking")},le:function(){ev("To use dlopen, you need to use Emscripten's linking support, see https://github.com/emscripten-core/emscripten/wiki/Linking")},ke:function(e,t){ev("To use dlopen, you need to use Emscripten's linking support, see https://github.com/emscripten-core/emscripten/wiki/Linking")},je:function(e,t){ev("To use dlopen, you need to use Emscripten's linking support, see https://github.com/emscripten-core/emscripten/wiki/Linking")},ie:function(e){return t5(e)},oa:function(e,t,r){function n(){h.get(e)(t)}m=!0,r>=0?tc.safeSetTimeout(n,r):tc.safeRequestAnimationFrame(n)},na:function(){return Date.now()},L:function(e){m=!1,rp(e)},he:function(e,t,r){if(!(e=tm(e)))return -4;var n=tp(e);return E[t>>3]=n.width,E[r>>3]=n.height,0},ge:function(e){A.activeTexture(e)},fe:function(e,t){A.attachShader(th.programs[e],th.shaders[t])},ee:function(e,t){A.disjointTimerQueryExt.beginQueryEXT(e,th.timerQueriesEXT[t])},de:function(e,t,r){A.bindAttribLocation(th.programs[e],t,K(r))},ce:function(e,t){A.bindBuffer(e,th.buffers[t])},be:function(e,t){A.bindFramebuffer(e,th.framebuffers[t])},ae:function(e,t){A.bindRenderbuffer(e,th.renderbuffers[t])},$d:function(e,t){A.bindTexture(e,th.textures[t])},_d:function(e){A.bindVertexArray(th.vaos[e])},Zd:function(e,t,r,n){A.blendColor(e,t,r,n)},Yd:function(e){A.blendEquation(e)},Xd:function(e,t){A.blendEquationSeparate(e,t)},Wd:function(e,t){A.blendFunc(e,t)},Vd:function(e,t,r,n){A.blendFuncSeparate(e,t,r,n)},Ud:function(e,t,r,n){A.bufferData(e,r?b.subarray(r,r+t):t,n)},Td:function(e,t,r,n){A.bufferSubData(e,t,b.subarray(n,n+r))},Sd:function(e){return A.checkFramebufferStatus(e)},Rd:function(e){A.clear(e)},Qd:function(e,t,r,n){A.clearColor(e,t,r,n)},Pd:function(e){A.clearDepth(e)},Od:function(e){A.clearStencil(e)},Nd:function(e,t,r,n){A.colorMask(!!e,!!t,!!r,!!n)},Md:function(e){A.compileShader(th.shaders[e])},Ld:function(e,t,r,n,a,o,i,s){A.compressedTexImage2D(e,t,r,n,a,o,s?b.subarray(s,s+i):null)},Kd:function(e,t,r,n,a,o,i,s,l){A.compressedTexSubImage2D(e,t,r,n,a,o,i,l?b.subarray(l,l+s):null)},Jd:function(e,t,r,n,a,o,i,s){A.copyTexImage2D(e,t,r,n,a,o,i,s)},Id:function(e,t,r,n,a,o,i,s){A.copyTexSubImage2D(e,t,r,n,a,o,i,s)},Hd:function(){var e=th.getNewId(th.programs),t=A.createProgram();return t.name=e,th.programs[e]=t,e},Gd:function(e){var t=th.getNewId(th.shaders);return th.shaders[t]=A.createShader(e),t},Fd:function(e){A.cullFace(e)},Ed:function(e,t){for(var r=0;r<e;r++){var n=w[t+4*r>>2],a=th.buffers[n];a&&(A.deleteBuffer(a),a.name=0,th.buffers[n]=null)}},Dd:function(e,t){for(var r=0;r<e;++r){var n=w[t+4*r>>2],a=th.framebuffers[n];a&&(A.deleteFramebuffer(a),a.name=0,th.framebuffers[n]=null)}},Cd:function(e){if(e){var t=th.programs[e];if(!t)return void th.recordError(1281);A.deleteProgram(t),t.name=0,th.programs[e]=null,th.programInfos[e]=null}},Bd:function(e,t){for(var r=0;r<e;r++){var n=w[t+4*r>>2],a=th.timerQueriesEXT[n];a&&(A.disjointTimerQueryExt.deleteQueryEXT(a),th.timerQueriesEXT[n]=null)}},Ad:function(e,t){for(var r=0;r<e;r++){var n=w[t+4*r>>2],a=th.renderbuffers[n];a&&(A.deleteRenderbuffer(a),a.name=0,th.renderbuffers[n]=null)}},zd:function(e){if(e){var t=th.shaders[e];if(!t)return void th.recordError(1281);A.deleteShader(t),th.shaders[e]=null}},yd:function(e,t){for(var r=0;r<e;r++){var n=w[t+4*r>>2],a=th.textures[n];a&&(A.deleteTexture(a),a.name=0,th.textures[n]=null)}},xd:function(e,t){for(var r=0;r<e;r++){var n=w[t+4*r>>2];A.deleteVertexArray(th.vaos[n]),th.vaos[n]=null}},wd:function(e){A.depthFunc(e)},vd:function(e){A.depthMask(!!e)},ud:function(e,t){A.depthRange(e,t)},td:function(e,t){A.detachShader(th.programs[e],th.shaders[t])},sd:function(e){A.disable(e)},rd:function(e){A.disableVertexAttribArray(e)},qd:function(e,t,r){A.drawArrays(e,t,r)},pd:function(e,t,r,n){A.drawArraysInstanced(e,t,r,n)},od:function(e,t){for(var r=tg[e],n=0;n<e;n++)r[n]=w[t+4*n>>2];A.drawBuffers(r)},nd:function(e,t,r,n){A.drawElements(e,t,r,n)},md:function(e,t,r,n,a){A.drawElementsInstanced(e,t,r,n,a)},ld:function(e){A.enable(e)},kd:function(e){A.enableVertexAttribArray(e)},jd:function(e){A.disjointTimerQueryExt.endQueryEXT(e)},id:function(){A.finish()},hd:function(){A.flush()},gd:function(e,t,r,n){A.framebufferRenderbuffer(e,t,r,th.renderbuffers[n])},fd:function(e,t,r,n,a){A.framebufferTexture2D(e,t,r,th.textures[n],a)},ed:function(e){A.frontFace(e)},dd:function(e,t){ty(e,t,"createBuffer",th.buffers)},cd:function(e,t){ty(e,t,"createFramebuffer",th.framebuffers)},bd:function(e,t){for(var r=0;r<e;r++){var n=A.disjointTimerQueryExt.createQueryEXT();if(!n){for(th.recordError(1282);r<e;)w[t+4*r++>>2]=0;return}var a=th.getNewId(th.timerQueriesEXT);n.name=a,th.timerQueriesEXT[a]=n,w[t+4*r>>2]=a}},ad:function(e,t){ty(e,t,"createRenderbuffer",th.renderbuffers)},$c:function(e,t){ty(e,t,"createTexture",th.textures)},_c:function(e,t){ty(e,t,"createVertexArray",th.vaos)},Zc:function(e){A.generateMipmap(e)},Yc:function(e,t,r,n,a,o,i){tb("getActiveAttrib",e,t,r,n,a,o,i)},Xc:function(e,t,r,n,a,o,i){tb("getActiveUniform",e,t,r,n,a,o,i)},Wc:function(e,t,r,n){var a=A.getAttachedShaders(th.programs[e]),o=a.length;o>t&&(o=t),w[r>>2]=o;for(var i=0;i<o;++i){var s=th.shaders.indexOf(a[i]);w[n+4*i>>2]=s}},Vc:function(e,t){return A.getAttribLocation(th.programs[e],K(t))},Uc:function(e,t){tx(e,t,4)},Tc:function(e,t,r){r?w[r>>2]=A.getBufferParameter(e,t):th.recordError(1281)},Sc:function(){var e=A.getError()||th.lastError;return th.lastError=0,e},Rc:function(e,t){tx(e,t,2)},Qc:function(e,t,r,n){var a=A.getFramebufferAttachmentParameter(e,t,r);(a instanceof WebGLRenderbuffer||a instanceof WebGLTexture)&&(a=0|a.name),w[n>>2]=a},Pc:function(e,t){tx(e,t,0)},Oc:function(e,t,r,n){var a=A.getProgramInfoLog(th.programs[e]);null===a&&(a="(unknown error)");var o=t>0&&n?Q(a,n,t):0;r&&(w[r>>2]=o)},Nc:function(e,t,r){if(!r||e>=th.counter)return void th.recordError(1281);var n=th.programInfos[e];if(!n)return void th.recordError(1282);if(35716==t){var a=A.getProgramInfoLog(th.programs[e]);null===a&&(a="(unknown error)"),w[r>>2]=a.length+1}else if(35719==t)w[r>>2]=n.maxUniformLength;else if(35722==t){if(-1==n.maxAttributeLength){e=th.programs[e];var o=A.getProgramParameter(e,35721);n.maxAttributeLength=0;for(var i=0;i<o;++i){var s=A.getActiveAttrib(e,i);n.maxAttributeLength=Math.max(n.maxAttributeLength,s.name.length+1)}}w[r>>2]=n.maxAttributeLength}else if(35381==t){if(-1==n.maxUniformBlockNameLength){e=th.programs[e];var l=A.getProgramParameter(e,35382);n.maxUniformBlockNameLength=0;for(var i=0;i<l;++i){var u=A.getActiveUniformBlockName(e,i);n.maxUniformBlockNameLength=Math.max(n.maxUniformBlockNameLength,u.length+1)}}w[r>>2]=n.maxUniformBlockNameLength}else w[r>>2]=A.getProgramParameter(th.programs[e],t)},Mc:function(e,t,r){if(!r)return void th.recordError(1281);var n=th.timerQueriesEXT[e],a=A.disjointTimerQueryExt.getQueryObjectEXT(n,t);tv(r,"boolean"==typeof a?+!!a:a)},Lc:function(e,t,r){if(!r)return void th.recordError(1281);var n=th.timerQueriesEXT[e],a=A.disjointTimerQueryExt.getQueryObjectEXT(n,t);w[r>>2]="boolean"==typeof a?+!!a:a},Kc:function(e,t,r){if(!r)return void th.recordError(1281);var n=th.timerQueriesEXT[e],a=A.disjointTimerQueryExt.getQueryObjectEXT(n,t);tv(r,"boolean"==typeof a?+!!a:a)},Jc:function(e,t,r){if(!r)return void th.recordError(1281);var n=th.timerQueriesEXT[e],a=A.disjointTimerQueryExt.getQueryObjectEXT(n,t);w[r>>2]="boolean"==typeof a?+!!a:a},Ic:function(e,t,r){r?w[r>>2]=A.disjointTimerQueryExt.getQueryEXT(e,t):th.recordError(1281)},Hc:function(e,t,r){r?w[r>>2]=A.getRenderbufferParameter(e,t):th.recordError(1281)},Gc:function(e,t,r,n){var a=A.getShaderInfoLog(th.shaders[e]);null===a&&(a="(unknown error)");var o=t>0&&n?Q(a,n,t):0;r&&(w[r>>2]=o)},Fc:function(e,t,r,n){var a=A.getShaderPrecisionFormat(e,t);w[r>>2]=a.rangeMin,w[r+4>>2]=a.rangeMax,w[n>>2]=a.precision},Ec:function(e,t,r,n){var a=A.getShaderSource(th.shaders[e]);if(a){var o=t>0&&n?Q(a,n,t):0;r&&(w[r>>2]=o)}},Dc:function(e,t,r){if(!r)return void th.recordError(1281);if(35716==t){var n=A.getShaderInfoLog(th.shaders[e]);null===n&&(n="(unknown error)");var a=n?n.length+1:0;w[r>>2]=a}else if(35720==t){var o=A.getShaderSource(th.shaders[e]),i=o?o.length+1:0;w[r>>2]=i}else w[r>>2]=A.getShaderParameter(th.shaders[e],t)},Cc:function(e){if(th.stringCache[e])return th.stringCache[e];switch(e){case 7939:var t,r=A.getSupportedExtensions()||[];t=tw((r=r.concat(r.map(function(e){return"GL_"+e}))).join(" "));break;case 7936:case 7937:case 37445:case 37446:var n=A.getParameter(e);n||th.recordError(1280),t=tw(n);break;case 7938:var a=A.getParameter(7938);t=tw(a="OpenGL ES 2.0 ("+a+")");break;case 35724:var o=A.getParameter(35724),i=o.match(/^WebGL GLSL ES ([0-9]\.[0-9][0-9]?)(?:$| .*)/);null!==i&&(3==i[1].length&&(i[1]=i[1]+"0"),o="OpenGL ES GLSL ES "+i[1]+" ("+o+")"),t=tw(o);break;default:return th.recordError(1280),0}return th.stringCache[e]=t,t},Bc:function(e,t,r){r?k[r>>2]=A.getTexParameter(e,t):th.recordError(1281)},Ac:function(e,t,r){r?w[r>>2]=A.getTexParameter(e,t):th.recordError(1281)},zc:function(e,t){t=K(t);var r=0;if("]"==t[t.length-1]){var n=t.lastIndexOf("[");r="]"!=t[n+1]?parseInt(t.slice(n+1)):0,t=t.slice(0,n)}var a=th.programInfos[e]&&th.programInfos[e].uniforms[t];return a&&r>=0&&r<a[0]?a[1]+r:-1},yc:function(e,t,r){tS(e,t,r,2)},xc:function(e,t,r){tS(e,t,r,0)},wc:function(e,t,r){r?w[r>>2]=A.getVertexAttribOffset(e,t):th.recordError(1281)},vc:function(e,t,r){tk(e,t,r,2)},uc:function(e,t,r){tk(e,t,r,5)},tc:function(e,t){A.hint(e,t)},sc:function(e){var t=th.buffers[e];return t?A.isBuffer(t):0},rc:function(e){return A.isEnabled(e)},qc:function(e){var t=th.framebuffers[e];return t?A.isFramebuffer(t):0},pc:function(e){return(e=th.programs[e])?A.isProgram(e):0},oc:function(e){var t=th.timerQueriesEXT[e];return t?A.disjointTimerQueryExt.isQueryEXT(t):0},nc:function(e){var t=th.renderbuffers[e];return t?A.isRenderbuffer(t):0},mc:function(e){var t=th.shaders[e];return t?A.isShader(t):0},lc:function(e){var t=th.textures[e];return t?A.isTexture(t):0},kc:function(e){var t=th.vaos[e];return t?A.isVertexArray(t):0},jc:function(e){A.lineWidth(e)},ic:function(e){A.linkProgram(th.programs[e]),th.populateUniformTable(e)},hc:function(e,t){3317==e&&(th.unpackAlignment=t),A.pixelStorei(e,t)},gc:function(e,t){A.polygonOffset(e,t)},fc:function(e,t){A.disjointTimerQueryExt.queryCounterEXT(th.timerQueriesEXT[e],t)},ec:function(e,t,r,n,a,o,i){var s=tE(o,a,r,n,i);s?A.readPixels(e,t,r,n,a,o,s):th.recordError(1280)},dc:function(){},cc:function(e,t,r,n){A.renderbufferStorage(e,t,r,n)},bc:function(e,t){A.sampleCoverage(e,!!t)},ac:function(e,t,r,n){A.scissor(e,t,r,n)},$b:function(){th.recordError(1280)},_b:function(e,t,r,n){var a=th.getSource(e,t,r,n);A.shaderSource(th.shaders[e],a)},Zb:function(e,t,r){A.stencilFunc(e,t,r)},Yb:function(e,t,r,n){A.stencilFuncSeparate(e,t,r,n)},Xb:function(e){A.stencilMask(e)},Wb:function(e,t){A.stencilMaskSeparate(e,t)},Vb:function(e,t,r){A.stencilOp(e,t,r)},Ub:function(e,t,r,n){A.stencilOpSeparate(e,t,r,n)},Tb:function(e,t,r,n,a,o,i,s,l){A.texImage2D(e,t,r,n,a,o,i,s,l?tE(s,i,n,a,l):null)},Sb:function(e,t,r){A.texParameterf(e,t,r)},Rb:function(e,t,r){var n=k[r>>2];A.texParameterf(e,t,n)},Qb:function(e,t,r){A.texParameteri(e,t,r)},Pb:function(e,t,r){var n=w[r>>2];A.texParameteri(e,t,n)},Ob:function(e,t,r,n,a,o,i,s,l){var u=null;l&&(u=tE(s,i,a,o,l)),A.texSubImage2D(e,t,r,n,a,o,i,s,u)},Nb:function(e,t){A.uniform1f(th.uniforms[e],t)},Mb:function(e,t,r){if(t<=288)for(var n=t_[t-1],a=0;a<t;++a)n[a]=k[r+4*a>>2];else var n=k.subarray(r>>2,r+4*t>>2);A.uniform1fv(th.uniforms[e],n)},Lb:function(e,t){A.uniform1i(th.uniforms[e],t)},Kb:function(e,t,r){if(t<=288)for(var n=tT[t-1],a=0;a<t;++a)n[a]=w[r+4*a>>2];else var n=w.subarray(r>>2,r+4*t>>2);A.uniform1iv(th.uniforms[e],n)},Jb:function(e,t,r){A.uniform2f(th.uniforms[e],t,r)},Ib:function(e,t,r){if(t<=144)for(var n=t_[2*t-1],a=0;a<2*t;a+=2)n[a]=k[r+4*a>>2],n[a+1]=k[r+(4*a+4)>>2];else var n=k.subarray(r>>2,r+8*t>>2);A.uniform2fv(th.uniforms[e],n)},Hb:function(e,t,r){A.uniform2i(th.uniforms[e],t,r)},Gb:function(e,t,r){if(t<=144)for(var n=tT[2*t-1],a=0;a<2*t;a+=2)n[a]=w[r+4*a>>2],n[a+1]=w[r+(4*a+4)>>2];else var n=w.subarray(r>>2,r+8*t>>2);A.uniform2iv(th.uniforms[e],n)},Fb:function(e,t,r,n){A.uniform3f(th.uniforms[e],t,r,n)},Eb:function(e,t,r){if(t<=96)for(var n=t_[3*t-1],a=0;a<3*t;a+=3)n[a]=k[r+4*a>>2],n[a+1]=k[r+(4*a+4)>>2],n[a+2]=k[r+(4*a+8)>>2];else var n=k.subarray(r>>2,r+12*t>>2);A.uniform3fv(th.uniforms[e],n)},Db:function(e,t,r,n){A.uniform3i(th.uniforms[e],t,r,n)},Cb:function(e,t,r){if(t<=96)for(var n=tT[3*t-1],a=0;a<3*t;a+=3)n[a]=w[r+4*a>>2],n[a+1]=w[r+(4*a+4)>>2],n[a+2]=w[r+(4*a+8)>>2];else var n=w.subarray(r>>2,r+12*t>>2);A.uniform3iv(th.uniforms[e],n)},Bb:function(e,t,r,n,a){A.uniform4f(th.uniforms[e],t,r,n,a)},Ab:function(e,t,r){if(t<=72){var n=t_[4*t-1],a=k;r>>=2;for(var o=0;o<4*t;o+=4){var i=r+o;n[o]=a[i],n[o+1]=a[i+1],n[o+2]=a[i+2],n[o+3]=a[i+3]}}else var n=k.subarray(r>>2,r+16*t>>2);A.uniform4fv(th.uniforms[e],n)},zb:function(e,t,r,n,a){A.uniform4i(th.uniforms[e],t,r,n,a)},yb:function(e,t,r){if(t<=72)for(var n=tT[4*t-1],a=0;a<4*t;a+=4)n[a]=w[r+4*a>>2],n[a+1]=w[r+(4*a+4)>>2],n[a+2]=w[r+(4*a+8)>>2],n[a+3]=w[r+(4*a+12)>>2];else var n=w.subarray(r>>2,r+16*t>>2);A.uniform4iv(th.uniforms[e],n)},xb:function(e,t,r,n){if(t<=72)for(var a=t_[4*t-1],o=0;o<4*t;o+=4)a[o]=k[n+4*o>>2],a[o+1]=k[n+(4*o+4)>>2],a[o+2]=k[n+(4*o+8)>>2],a[o+3]=k[n+(4*o+12)>>2];else var a=k.subarray(n>>2,n+16*t>>2);A.uniformMatrix2fv(th.uniforms[e],!!r,a)},wb:function(e,t,r,n){if(t<=32)for(var a=t_[9*t-1],o=0;o<9*t;o+=9)a[o]=k[n+4*o>>2],a[o+1]=k[n+(4*o+4)>>2],a[o+2]=k[n+(4*o+8)>>2],a[o+3]=k[n+(4*o+12)>>2],a[o+4]=k[n+(4*o+16)>>2],a[o+5]=k[n+(4*o+20)>>2],a[o+6]=k[n+(4*o+24)>>2],a[o+7]=k[n+(4*o+28)>>2],a[o+8]=k[n+(4*o+32)>>2];else var a=k.subarray(n>>2,n+36*t>>2);A.uniformMatrix3fv(th.uniforms[e],!!r,a)},vb:function(e,t,r,n){if(t<=18){var a=t_[16*t-1],o=k;n>>=2;for(var i=0;i<16*t;i+=16){var s=n+i;a[i]=o[s],a[i+1]=o[s+1],a[i+2]=o[s+2],a[i+3]=o[s+3],a[i+4]=o[s+4],a[i+5]=o[s+5],a[i+6]=o[s+6],a[i+7]=o[s+7],a[i+8]=o[s+8],a[i+9]=o[s+9],a[i+10]=o[s+10],a[i+11]=o[s+11],a[i+12]=o[s+12],a[i+13]=o[s+13],a[i+14]=o[s+14],a[i+15]=o[s+15]}}else var a=k.subarray(n>>2,n+64*t>>2);A.uniformMatrix4fv(th.uniforms[e],!!r,a)},ub:function(e){A.useProgram(th.programs[e])},tb:function(e){A.validateProgram(th.programs[e])},sb:function(e,t){A.vertexAttrib1f(e,t)},rb:function(e,t){A.vertexAttrib1f(e,k[t>>2])},qb:function(e,t,r){A.vertexAttrib2f(e,t,r)},pb:function(e,t){A.vertexAttrib2f(e,k[t>>2],k[t+4>>2])},ob:function(e,t,r,n){A.vertexAttrib3f(e,t,r,n)},nb:function(e,t){A.vertexAttrib3f(e,k[t>>2],k[t+4>>2],k[t+8>>2])},mb:function(e,t,r,n,a){A.vertexAttrib4f(e,t,r,n,a)},lb:function(e,t){A.vertexAttrib4f(e,k[t>>2],k[t+4>>2],k[t+8>>2],k[t+12>>2])},kb:function(e,t){A.vertexAttribDivisor(e,t)},jb:function(e,t,r,n,a,o){A.vertexAttribPointer(e,t,r,!!n,a,o)},ib:function(e,t,r,n){A.viewport(e,t,r,n)},hb:function(e,t,r,n,a){tj.deleteFile(K(e),K(t),function(e){if(e){a&&h.get(a)(r);return}n&&h.get(n)(r)})},gb:function(e,t,r,n,a){tj.existsFile(K(e),K(t),function(e,t){if(e){a&&h.get(a)(r);return}n&&h.get(n)(r,t)})},fb:function(e,t,r,n,a){tj.getFile(K(e),K(t),function(e,t){if(e){a&&h.get(a)(r);return}var o=t2(t.length);b.set(t,o),h.get(n)(r,o,t.length),t4(o)})},eb:function(e,t,r,n,a,o,i){tj.setFile(K(e),K(t),new Uint8Array(b.subarray(r,r+n)),function(e){if(e){i&&h.get(i)(a);return}o&&h.get(o)(a)})},db:function(e){return!th.contexts[e]||th.contexts[e].GLctx.isContextLost()},cb:function(e,t,r){var n;n=Y(function(e,t){var r=e,n=t;function a(e){var t,r,a;return r=n,("double"===(a=e)||"i64"===a)&&7&r&&(r+=4),n=r,"double"===e?(t=E[n>>3],n+=8):"i64"==e?(t=[w[n>>2],w[n+4>>2]],n+=8):(e="i32",t=w[n>>2],n+=4),t}for(var o=[];;){var i=r;if(0===(S=y[0|r]))break;if(k=y[r+1|0],37==S){var s=!1,l=!1,u=!1,c=!1,d=!1;e:for(;;){switch(k){case 43:s=!0;break;case 45:l=!0;break;case 35:u=!0;break;case 48:if(c)break e;c=!0;break;case 32:d=!0;break;default:break e}k=y[++r+1|0]}var f=0;if(42==k)f=a("i32"),k=y[++r+1|0];else for(;k>=48&&k<=57;)f=10*f+(k-48),k=y[++r+1|0];var m=!1,p=-1;if(46==k){if(p=0,m=!0,42==(k=y[++r+1|0]))p=a("i32"),r++;else for(;;){var h=y[r+1|0];if(h<48||h>57)break;p=10*p+(h-48),r++}k=y[r+1|0]}switch(p<0&&(p=6,m=!1),String.fromCharCode(k)){case"h":var g=y[r+2|0];104==g?(r++,T=1):T=2;break;case"l":var g=y[r+2|0];108==g?(r++,T=8):T=4;break;case"L":case"q":case"j":T=8;break;case"z":case"t":case"I":T=4;break;default:T=null}switch(T&&r++,String.fromCharCode(k=y[r+1|0])){case"d":case"i":case"u":case"o":case"x":case"X":case"p":var v,x,S,k,_,T,j,A=100==k||105==k;_=a("i"+8*(T=T||4)),8==T&&(_=117==k?((v=_[0])>>>0)+(_[1]>>>0)*0x100000000:((x=_[0])>>>0)+0x100000000*_[1]),T<=4&&(_=(A?tA:tC)(_&Math.pow(256,T)-1,8*T));var C=Math.abs(_),M="";if(100==k||105==k)j=tA(_,8*T).toString(10);else if(117==k)j=tC(_,8*T).toString(10),_=Math.abs(_);else if(111==k)j=(u?"0":"")+C.toString(8);else if(120==k||88==k){if(M=u&&0!=_?"0x":"",_<0){_=-_,j=(C-1).toString(16);for(var N=[],P=0;P<j.length;P++)N.push((15-parseInt(j[P],16)).toString(16));for(j=N.join("");j.length<2*T;)j="f"+j}else j=C.toString(16);88==k&&(M=M.toUpperCase(),j=j.toUpperCase())}else 112==k&&(0===C?j="(nil)":(M="0x",j=C.toString(16)));if(m)for(;j.length<p;)j="0"+j;for(_>=0&&(s?M="+"+M:d&&(M=" "+M)),"-"==j.charAt(0)&&(M="-"+M,j=j.substr(1));M.length+j.length<f;)l?j+=" ":c?j="0"+j:M=" "+M;(j=M+j).split("").forEach(function(e){o.push(e.charCodeAt(0))});break;case"f":case"F":case"e":case"E":case"g":case"G":if(isNaN(_=a("double")))j="nan",c=!1;else if(isFinite(_)){var I,j,F=!1,D=Math.min(p,20);if(103==k||71==k){F=!0,p=p||1;var L=parseInt(_.toExponential(D).split("e")[1],10);p>L&&L>=-4?(k=(103==k?"f":"F").charCodeAt(0),p-=L+1):(k=(103==k?"e":"E").charCodeAt(0),p--),D=Math.min(p,20)}101==k||69==k?(j=_.toExponential(D),/[eE][-+]\d$/.test(j)&&(j=j.slice(0,-1)+"0"+j.slice(-1))):(102==k||70==k)&&(j=_.toFixed(D),0===_&&((I=_)<0||0===I&&1/I==-1/0)&&(j="-"+j));var R=j.split("e");if(F&&!u)for(;R[0].length>1&&-1!=R[0].indexOf(".")&&("0"==R[0].slice(-1)||"."==R[0].slice(-1));)R[0]=R[0].slice(0,-1);else for(u&&-1==j.indexOf(".")&&(R[0]+=".");p>D++;)R[0]+="0";j=R[0]+(R.length>1?"e"+R[1]:""),69==k&&(j=j.toUpperCase()),_>=0&&(s?j="+"+j:d&&(j=" "+j))}else j=(_<0?"-":"")+"inf",c=!1;for(;j.length<f;)l?j+=" ":j=c&&("-"==j[0]||"+"==j[0])?j[0]+"0"+j.slice(1):(c?"0":" ")+j;k<97&&(j=j.toUpperCase()),j.split("").forEach(function(e){o.push(e.charCodeAt(0))});break;case"s":var B=a("i8*"),O=B?t0(B):6;if(m&&(O=Math.min(O,p)),!l)for(;O<f--;)o.push(32);if(B)for(var P=0;P<O;P++)o.push(b[0|B++]);else o=o.concat(tZ("(null)".substr(0,O),!0));if(l)for(;O<f--;)o.push(32);break;case"c":for(l&&o.push(a("i8"));--f>0;)o.push(32);l||o.push(a("i8"));break;case"n":w[a("i32*")>>2]=o.length;break;case"%":o.push(S);break;default:for(var P=i;P<r+2;P++)o.push(y[0|P])}r+=2}else o.push(S),r+=1}return o}(t,r),0),24&e&&(n=n.replace(/\s+$/,""),n+=(n.length>0?"\n":"")+function(e){var t=eA(),r=t.lastIndexOf("_emscripten_log"),n=t.lastIndexOf("_emscripten_get_callstack"),a=t.indexOf("\n",Math.max(r,n))+1;t=t.slice(a),8&e&&"u"<typeof emscripten_source_map&&(z('Source map information is not available, emscripten_log with EM_LOG_C_STACK will be ignored. Build with "--pre-js $EMSCRIPTEN/src/emscripten-source-map.min.js" linker flag to add source map loading to code.'),e^=8,e|=16);var o=null;if(128&e)for(o=tM(arguments);o[1].indexOf("_emscripten_")>=0;)o=tM(o[0]);var i=t.split("\n");t="";var s=RegExp("\\s*(.*?)@(.*?):([0-9]+):([0-9]+)"),l=RegExp("\\s*(.*?)@(.*):(.*)(:(.*))?"),u=RegExp("\\s*at (.*?) \\((.*):(.*):(.*)\\)");for(var c in i){var d=i[c],f="",m="",p=0,h=0,g=u.exec(d);if(g&&5==g.length)f=g[1],m=g[2],p=g[3],h=g[4];else if((g=s.exec(d))||(g=l.exec(d)),g&&g.length>=4)f=g[1],m=g[2],p=g[3],h=0|g[4];else{t+=d+"\n";continue}var y=32&e?ej(f):f;y||(y=f);var b=!1;if(8&e){var v=emscripten_source_map.originalPositionFor({line:p,column:h});(b=v&&v.source)&&(64&e&&(v.source=v.source.substring(v.source.replace(/\\/g,"/").lastIndexOf("/")+1)),t+="    at "+y+" ("+v.source+":"+v.line+":"+v.column+")\n")}(16&e||!b)&&(64&e&&(m=m.substring(m.replace(/\\/g,"/").lastIndexOf("/")+1)),t+=(b?"     = "+f:"    at "+y)+" ("+m+":"+p+":"+h+")\n"),128&e&&o[0]&&(o[1]==f&&o[2].length>0&&(t=t.replace(/\s+$/,"")+(" with values: "+o[1]+o[2])+"\n"),o=tM(o[0]))}return t.replace(/\s+$/,"")}(e)),1&e?4&e?console.error(n):2&e?console.warn(n):512&e?console.info(n):256&e?console.debug(n):console.log(n):6&e?U(n):O(n)},g:function(e,t){throw rn(e,t||1),"longjmp"},bb:function(e,t,r){b.copyWithin(e,t,t+r)},ab:function(){tc.mainLoop.pause()},$a:function(e){e>>>=0;var t=b.length;if(e>0x80000000)return!1;for(var r=1;r<=4;r*=2){var n,a=t*(1+.2/r);if(a=Math.min(a,e+0x6000000),function(e){try{return p.grow(e-g.byteLength+65535>>>16),eu(p.buffer),1}catch(e){}}(Math.min(0x80000000,((n=Math.max(0x1000000,e,a))%65536>0&&(n+=65536-n%65536),n))))return!0}return!1},_a:function(){tc.mainLoop.resume()},ma:function(e,t,r,n,a){var o;return td.focusEvent||(td.focusEvent=t2(256)),o={target:tm(e),eventTypeString:"focus",callbackfunc:n,handlerFunc:function(e){var r=e||event,a=td.getNodeNameForTarget(r.target),o=r.target.id?r.target.id:"",i=td.focusEvent;Q(a,i+0,128),Q(o,i+128,128),h.get(n)(13,i,t)&&r.preventDefault()},useCapture:r},td.registerOrRemoveHandler(o),0},la:function(e,t,r,n,a){return tN(e,t,r,n,2,"keydown"),0},ka:function(e,t,r,n,a){return tN(e,t,r,n,3,"keyup"),0},Za:function(e,t,r,n){tu(function(){h.get(e)(t)},r,n,t)},ja:function(e,t,r,n,a){return tI(e,t,r,n,5,"mousedown"),0},ia:function(e,t,r,n,a){return tI(e,t,r,n,8,"mousemove"),0},ha:function(e,t,r,n,a){return tI(e,t,r,n,6,"mouseup"),0},Ya:function(e,t,r,n,a){var o,i;return o=e,td.uiEvent||(td.uiEvent=t2(36)),i={target:o=tm(o),eventTypeString:"resize",callbackfunc:n,handlerFunc:function(e){var r=e||event;if(r.target==o){var a=td.uiEvent,i=document.body;w[a>>2]=r.detail,w[a+4>>2]=i.clientWidth,w[a+8>>2]=i.clientHeight,w[a+12>>2]=innerWidth,w[a+16>>2]=innerHeight,w[a+20>>2]=outerWidth,w[a+24>>2]=outerHeight,w[a+28>>2]=pageXOffset,w[a+32>>2]=pageYOffset,h.get(n)(10,a,t)&&r.preventDefault()}},useCapture:r},td.registerOrRemoveHandler(i),0},ga:function(e,t,r,n,a){return tF(e,t,r,n,25,"touchcancel"),0},fa:function(e,t,r,n,a){return tF(e,t,r,n,23,"touchend"),0},ea:function(e,t,r,n,a){return tF(e,t,r,n,24,"touchmove"),0},da:function(e,t,r,n,a){return tF(e,t,r,n,22,"touchstart"),0},ca:function(e,t,r,n,a){var o;return void 0===(e=tm(e)).onwheel?-1:(o=e,td.wheelEvent||(td.wheelEvent=t2(96)),td.registerOrRemoveHandler({target:o,allowsDeferredCalls:!0,eventTypeString:"wheel",callbackfunc:n,handlerFunc:function(e){var r=e||event,a=td.wheelEvent;tP(a,r,o),E[a+64>>3]=r.deltaX,E[a+72>>3]=r.deltaY,E[a+80>>3]=r.deltaZ,w[a+88>>2]=r.deltaMode,h.get(n)(9,a,t)&&r.preventDefault()},useCapture:r}),0)},Xa:function(){throw"Please compile your program with async support in order to use asynchronous operations like emscripten_sleep"},Wa:function(e,t){var r={},n=t>>2;r.alpha=!!w[n+0],r.depth=!!w[n+1],r.stencil=!!w[n+2],r.antialias=!!w[n+3],r.premultipliedAlpha=!!w[n+4],r.preserveDrawingBuffer=!!w[n+5],r.powerPreference=tD[w[n+6]],r.failIfMajorPerformanceCaveat=!!w[n+7],r.majorVersion=w[n+8],r.minorVersion=w[n+9],r.enableExtensionsByDefault=w[n+10],r.explicitSwapControl=w[n+11],r.proxyContextToMainThread=w[n+12],r.renderViaOffscreenBackBuffer=w[n+13];var a=tm(e);return!a||r.explicitSwapControl?0:th.createContext(a,r)},Va:function(e){th.currentContext==e&&(th.currentContext=0),th.deleteContext(e)},Ua:function(e){for(var t=e>>2,r=0;r<14;++r)w[t+r]=0;w[t+0]=w[t+1]=w[t+3]=w[t+4]=w[t+8]=w[t+10]=1},Ta:tL,ve:function(e,t){var r=0;return tB().forEach(function(n,a){var o=t+r;w[e+4*a>>2]=o,el(n,o),r+=n.length+1}),0},ue:function(e,t){var r=tB();w[e>>2]=r.length;var n=0;return r.forEach(function(e){n+=e.length+1}),w[t>>2]=n,0},J:function(e){rp(e)},H:function(e){try{var t=eO.getStreamFromFD(e);return eB.close(t),0}catch(e){return void 0!==eB&&e instanceof eB.ErrnoError||ev(e),e.errno}},ta:function(e,t){try{var r=eO.getStreamFromFD(e),n=r.tty?2:eB.isDir(r.mode)?3:eB.isLink(r.mode)?7:4;return y[0|t]=n,0}catch(e){return void 0!==eB&&e instanceof eB.ErrnoError||ev(e),e.errno}},te:function(e,t,r,n){try{var a=eO.getStreamFromFD(e),o=eO.doReadv(a,t,r);return w[n>>2]=o,0}catch(e){return void 0!==eB&&e instanceof eB.ErrnoError||ev(e),e.errno}},Ga:function(e,t,r,n,a){try{var o=eO.getStreamFromFD(e),i=0x100000000*r+(t>>>0);if(i<=-0x20000000000000||i>=0x20000000000000)return -61;return eB.llseek(o,i,n),T=[o.position>>>0,(_=o.position,+Math.abs(_)>=1?_>0?Math.min(+Math.floor(_/0x100000000),0xffffffff)>>>0:~~Math.ceil((_-(~~_>>>0))/0x100000000)>>>0:0)],w[a>>2]=T[0],w[a+4>>2]=T[1],o.getdents&&0===i&&0===n&&(o.getdents=null),0}catch(e){return void 0!==eB&&e instanceof eB.ErrnoError||ev(e),e.errno}},se:function(e){try{var t=eO.getStreamFromFD(e);if(t.stream_ops&&t.stream_ops.fsync)return-t.stream_ops.fsync(t);return 0}catch(e){return void 0!==eB&&e instanceof eB.ErrnoError||ev(e),e.errno}},S:function(e,t,r,n){try{var a=eO.getStreamFromFD(e),o=eO.doWritev(a,t,r);return w[n>>2]=o,0}catch(e){return void 0!==eB&&e instanceof eB.ErrnoError||ev(e),e.errno}},ba:function(e,t){return 0},c:function(){return 0|X},K:function(e){var t=Date.now();return w[e>>2]=t/1e3|0,w[e+4>>2]=t%1e3*1e3|0,0},Sa:function(e){A.activeTexture(e)},Ra:function(e,t,r,n,a,o,i,s){A.compressedTexImage2D(e,t,r,n,a,o,s?b.subarray(s,s+i):null)},Qa:function(e,t,r,n,a,o,i,s,l){A.compressedTexSubImage2D(e,t,r,n,a,o,i,l?b.subarray(l,l+s):null)},Pa:function(e){A.generateMipmap(e)},Q:function(e,t,r,n,a,o,i,s,l){var u=null;l&&(u=tE(s,i,a,o,l)),A.texSubImage2D(e,t,r,n,a,o,i,s,u)},Oa:function(e,t,r,n){A.viewport(e,t,r,n)},f:function(e,t){var r=re();try{return h.get(e)(t)}catch(e){if(rt(r),e!==e+0&&"longjmp"!==e)throw e;rn(1,0)}},n:function(e,t,r){var n=re();try{return h.get(e)(t,r)}catch(e){if(rt(n),e!==e+0&&"longjmp"!==e)throw e;rn(1,0)}},r:function(e,t,r,n){var a=re();try{return h.get(e)(t,r,n)}catch(e){if(rt(a),e!==e+0&&"longjmp"!==e)throw e;rn(1,0)}},Na:function(e,t,r,n,a){var o=re();try{return h.get(e)(t,r,n,a)}catch(e){if(rt(o),e!==e+0&&"longjmp"!==e)throw e;rn(1,0)}},y:function(e,t,r,n,a){var o=re();try{return h.get(e)(t,r,n,a)}catch(e){if(rt(o),e!==e+0&&"longjmp"!==e)throw e;rn(1,0)}},Ma:function(e,t,r,n,a,o,i,s){var l=re();try{return h.get(e)(t,r,n,a,o,i,s)}catch(e){if(rt(l),e!==e+0&&"longjmp"!==e)throw e;rn(1,0)}},N:function(e,t,r,n,a,o,i,s,l,u){var c=re();try{return h.get(e)(t,r,n,a,o,i,s,l,u)}catch(e){if(rt(c),e!==e+0&&"longjmp"!==e)throw e;rn(1,0)}},Fa:function(e,t,r,n){var a=re();try{return ri(e,t,r,n)}catch(e){if(rt(a),e!==e+0&&"longjmp"!==e)throw e;rn(1,0)}},Ea:function(e,t){var r=re();try{return rs(e,t)}catch(e){if(rt(r),e!==e+0&&"longjmp"!==e)throw e;rn(1,0)}},aa:function(e){var t=re();try{h.get(e)()}catch(e){if(rt(t),e!==e+0&&"longjmp"!==e)throw e;rn(1,0)}},u:function(e,t){var r=re();try{h.get(e)(t)}catch(e){if(rt(r),e!==e+0&&"longjmp"!==e)throw e;rn(1,0)}},La:function(e,t,r,n){var a=re();try{h.get(e)(t,r,n)}catch(e){if(rt(a),e!==e+0&&"longjmp"!==e)throw e;rn(1,0)}},i:function(e,t,r){var n=re();try{h.get(e)(t,r)}catch(e){if(rt(n),e!==e+0&&"longjmp"!==e)throw e;rn(1,0)}},Ka:function(e,t,r,n){var a=re();try{h.get(e)(t,r,n)}catch(e){if(rt(a),e!==e+0&&"longjmp"!==e)throw e;rn(1,0)}},j:function(e,t,r,n){var a=re();try{h.get(e)(t,r,n)}catch(e){if(rt(a),e!==e+0&&"longjmp"!==e)throw e;rn(1,0)}},$:function(e,t,r,n,a){var o=re();try{h.get(e)(t,r,n,a)}catch(e){if(rt(o),e!==e+0&&"longjmp"!==e)throw e;rn(1,0)}},x:function(e,t,r,n,a){var o=re();try{h.get(e)(t,r,n,a)}catch(e){if(rt(o),e!==e+0&&"longjmp"!==e)throw e;rn(1,0)}},I:function(e,t,r,n,a,o){var i=re();try{h.get(e)(t,r,n,a,o)}catch(e){if(rt(i),e!==e+0&&"longjmp"!==e)throw e;rn(1,0)}},Ja:function(e,t,r,n,a,o,i){var s=re();try{h.get(e)(t,r,n,a,o,i)}catch(e){if(rt(s),e!==e+0&&"longjmp"!==e)throw e;rn(1,0)}},_:function(e,t,r,n,a,o,i,s){var l=re();try{h.get(e)(t,r,n,a,o,i,s)}catch(e){if(rt(l),e!==e+0&&"longjmp"!==e)throw e;rn(1,0)}},Ia:function(e,t,r,n,a,o,i,s,l,u){var c=re();try{h.get(e)(t,r,n,a,o,i,s,l,u)}catch(e){if(rt(c),e!==e+0&&"longjmp"!==e)throw e;rn(1,0)}},Ha:function(e,t){return eI(63),-1},a:p,Da:function(e){eN();var t=new Date(w[e+20>>2]+1900,w[e+16>>2],w[e+12>>2],w[e+8>>2],w[e+4>>2],w[e>>2],0),r=w[e+32>>2],n=t.getTimezoneOffset(),a=new Date(t.getFullYear(),0,1),o=new Date(t.getFullYear(),6,1).getTimezoneOffset(),i=a.getTimezoneOffset(),s=Math.min(i,o);if(r<0)w[e+32>>2]=Number(o!=i&&s==n);else if(r>0!=(s==n)){var l=Math.max(i,o);t.setTime(t.getTime()+((r>0?s:l)-n)*6e4)}w[e+24>>2]=t.getDay();var u=(t.getTime()-a.getTime())/864e5|0;return w[e+28>>2]=u,t.getTime()/1e3|0},Z:function(e,t){if(0===e)return eI(28),-1;var r=w[e>>2],n=w[e+4>>2];if(n<0||n>0x3b9ac9ff||r<0)return eI(28),-1;0!==t&&(w[t>>2]=0,w[t+4>>2]=0);for(var a=1e6*r+n/1e3,o=j();j()-o<a/1e3;);},Ca:function(){return 6},Ba:function(){},Y:function(){},Aa:function(){},za:function(){},b:function(e){$(0|e)},X:tW,ya:function(e,t,r,n){return tW(e,t,r,n)},xa:function(e){switch(e){case 30:case 75:return 16384;case 85:return 131072;case 132:case 133:case 12:case 137:case 138:case 15:case 235:case 16:case 17:case 18:case 19:case 20:case 149:case 13:case 10:case 236:case 153:case 9:case 21:case 22:case 159:case 154:case 14:case 77:case 78:case 139:case 80:case 81:case 82:case 68:case 67:case 164:case 11:case 29:case 47:case 48:case 95:case 52:case 51:case 46:case 79:return 200809;case 27:case 246:case 127:case 128:case 23:case 24:case 160:case 161:case 181:case 182:case 242:case 183:case 184:case 243:case 244:case 245:case 165:case 178:case 179:case 49:case 50:case 168:case 169:case 175:case 170:case 171:case 172:case 97:case 76:case 32:case 173:case 35:return -1;case 176:case 177:case 7:case 155:case 8:case 157:case 125:case 126:case 92:case 93:case 129:case 130:case 131:case 94:case 91:return 1;case 74:case 60:case 69:case 70:case 4:return 1024;case 31:case 42:case 72:return 32;case 87:case 26:case 33:return 0x7fffffff;case 34:case 1:return 47839;case 38:case 36:return 99;case 43:case 37:return 2048;case 0:return 2097152;case 3:return 65536;case 28:return 32768;case 44:return 32767;case 39:return 1e3;case 89:return 700;case 71:return 256;case 40:return 255;case 2:return 100;case 180:return 64;case 25:return 20;case 5:return 16;case 6:return 6;case 73:return 4;case 84:if("object"==typeof navigator)return navigator.hardwareConcurrency||1;return 1}return eI(28),-1},W:function(e){var t=Date.now()/1e3|0;return e&&(w[e>>2]=t),t},P:eN};!function(){var t={a:tQ};function r(t,r){var n=t.exports;e.asm=n,h=e.asm.Ve,eb()}function n(e){r(e.instance)}function a(e){return(!f&&(I||F)&&"function"==typeof fetch&&!ek(eE)?fetch(eE,{credentials:"same-origin"}).then(function(e){if(!e.ok)throw"failed to load wasm binary file at '"+eE+"'";return e.arrayBuffer()}).catch(function(){return e_()}):Promise.resolve().then(e_)).then(function(e){return WebAssembly.instantiate(e,t)}).then(e,function(e){U("failed to asynchronously prepare wasm: "+e),ev(e)})}if(ey(),e.instantiateWasm)try{return e.instantiateWasm(t,r)}catch(e){return U("Module.instantiateWasm callback failed with error: "+e),!1}!function(){if(f||"function"!=typeof WebAssembly.instantiateStreaming||eS(eE)||ek(eE)||"function"!=typeof fetch)return a(n);fetch(eE,{credentials:"same-origin"}).then(function(e){return WebAssembly.instantiateStreaming(e,t).then(n,function(e){return U("wasm streaming compile failed: "+e),U("falling back to ArrayBuffer instantiation"),a(n)})})}()}();var tJ=e.___wasm_call_ctors=function(){return(tJ=e.___wasm_call_ctors=e.asm.We).apply(null,arguments)},t0=e._strlen=function(){return(t0=e._strlen=e.asm.Xe).apply(null,arguments)},t1=e._memset=function(){return(t1=e._memset=e.asm.Ye).apply(null,arguments)};e._version=function(){return(e._version=e.asm.Ze).apply(null,arguments)},e._setLogLevel=function(){return(e._setLogLevel=e.asm._e).apply(null,arguments)},e._init=function(){return(e._init=e.asm.$e).apply(null,arguments)},e._addFont=function(){return(e._addFont=e.asm.af).apply(null,arguments)},e._load=function(){return(e._load=e.asm.bf).apply(null,arguments)},e._generateExcerpts=function(){return(e._generateExcerpts=e.asm.cf).apply(null,arguments)},e._title=function(){return(e._title=e.asm.df).apply(null,arguments)},e._subtitle=function(){return(e._subtitle=e.asm.ef).apply(null,arguments)},e._setTitleText=function(){return(e._setTitleText=e.asm.ff).apply(null,arguments)},e._setSubtitleText=function(){return(e._setSubtitleText=e.asm.gf).apply(null,arguments)},e._setComposerText=function(){return(e._setComposerText=e.asm.hf).apply(null,arguments)},e._setLyricistText=function(){return(e._setLyricistText=e.asm.jf).apply(null,arguments)},e._setSelectedText=function(){return(e._setSelectedText=e.asm.kf).apply(null,arguments)},e._appendPart=function(){return(e._appendPart=e.asm.lf).apply(null,arguments)},e._appendPartByMusicXmlId=function(){return(e._appendPartByMusicXmlId=e.asm.mf).apply(null,arguments)},e._removePart=function(){return(e._removePart=e.asm.nf).apply(null,arguments)},e._setPartVisible=function(){return(e._setPartVisible=e.asm.of).apply(null,arguments)},e._listInstrumentTemplates=function(){return(e._listInstrumentTemplates=e.asm.pf).apply(null,arguments)},e._addNoteFromRest=function(){return(e._addNoteFromRest=e.asm.qf).apply(null,arguments)},e._toggleRepeatStart=function(){return(e._toggleRepeatStart=e.asm.rf).apply(null,arguments)},e._toggleRepeatEnd=function(){return(e._toggleRepeatEnd=e.asm.sf).apply(null,arguments)},e._setRepeatCount=function(){return(e._setRepeatCount=e.asm.tf).apply(null,arguments)},e._setBarLineType=function(){return(e._setBarLineType=e.asm.uf).apply(null,arguments)},e._addVolta=function(){return(e._addVolta=e.asm.vf).apply(null,arguments)},e._insertMeasures=function(){return(e._insertMeasures=e.asm.wf).apply(null,arguments)},e._removeTrailingEmptyMeasures=function(){return(e._removeTrailingEmptyMeasures=e.asm.xf).apply(null,arguments)},e._removeSelectedMeasures=function(){return(e._removeSelectedMeasures=e.asm.yf).apply(null,arguments)},e._npages=function(){return(e._npages=e.asm.zf).apply(null,arguments)},e._measureSignatureCount=function(){return(e._measureSignatureCount=e.asm.Af).apply(null,arguments)},e._measureSignatureAt=function(){return(e._measureSignatureAt=e.asm.Bf).apply(null,arguments)},e._measureSignatures=function(){return(e._measureSignatures=e.asm.Cf).apply(null,arguments)},e._measureLineBreaks=function(){return(e._measureLineBreaks=e.asm.Df).apply(null,arguments)},e._setMeasureLineBreaks=function(){return(e._setMeasureLineBreaks=e.asm.Ef).apply(null,arguments)},e._saveXml=function(){return(e._saveXml=e.asm.Ff).apply(null,arguments)},e._saveMxl=function(){return(e._saveMxl=e.asm.Gf).apply(null,arguments)},e._saveMsc=function(){return(e._saveMsc=e.asm.Hf).apply(null,arguments)},e._saveSvg=function(){return(e._saveSvg=e.asm.If).apply(null,arguments)},e._savePng=function(){return(e._savePng=e.asm.Jf).apply(null,arguments)},e._savePdf=function(){return(e._savePdf=e.asm.Kf).apply(null,arguments)},e._saveMidi=function(){return(e._saveMidi=e.asm.Lf).apply(null,arguments)},e._saveAudio=function(){return(e._saveAudio=e.asm.Mf).apply(null,arguments)},e._selectElementAtPoint=function(){return(e._selectElementAtPoint=e.asm.Nf).apply(null,arguments)},e._selectMeasureAtPoint=function(){return(e._selectMeasureAtPoint=e.asm.Of).apply(null,arguments)},e._selectPartMeasureByIndex=function(){return(e._selectPartMeasureByIndex=e.asm.Pf).apply(null,arguments)},e._selectTextElementAtPoint=function(){return(e._selectTextElementAtPoint=e.asm.Qf).apply(null,arguments)},e._clearSelection=function(){return(e._clearSelection=e.asm.Rf).apply(null,arguments)},e._convertRangeToListSelection=function(){return(e._convertRangeToListSelection=e.asm.Sf).apply(null,arguments)},e._selectionMimeType=function(){return(e._selectionMimeType=e.asm.Tf).apply(null,arguments)},e._selectionMimeData=function(){return(e._selectionMimeData=e.asm.Uf).apply(null,arguments)},e._pasteSelection=function(){return(e._pasteSelection=e.asm.Vf).apply(null,arguments)},e._selectElementAtPointWithMode=function(){return(e._selectElementAtPointWithMode=e.asm.Wf).apply(null,arguments)},e._selectNextChord=function(){return(e._selectNextChord=e.asm.Xf).apply(null,arguments)},e._selectPrevChord=function(){return(e._selectPrevChord=e.asm.Yf).apply(null,arguments)},e._extendSelectionNextChord=function(){return(e._extendSelectionNextChord=e.asm.Zf).apply(null,arguments)},e._extendSelectionPrevChord=function(){return(e._extendSelectionPrevChord=e.asm._f).apply(null,arguments)},e._getSelectionBoundingBox=function(){return(e._getSelectionBoundingBox=e.asm.$f).apply(null,arguments)},e._getSelectionBoundingBoxes=function(){return(e._getSelectionBoundingBoxes=e.asm.ag).apply(null,arguments)},e._deleteSelection=function(){return(e._deleteSelection=e.asm.bg).apply(null,arguments)},e._pitchUp=function(){return(e._pitchUp=e.asm.cg).apply(null,arguments)},e._pitchDown=function(){return(e._pitchDown=e.asm.dg).apply(null,arguments)},e._flipStem=function(){return(e._flipStem=e.asm.eg).apply(null,arguments)},e._transpose=function(){return(e._transpose=e.asm.fg).apply(null,arguments)},e._setAccidental=function(){return(e._setAccidental=e.asm.gg).apply(null,arguments)},e._doubleDuration=function(){return(e._doubleDuration=e.asm.hg).apply(null,arguments)},e._halfDuration=function(){return(e._halfDuration=e.asm.ig).apply(null,arguments)},e._undo=function(){return(e._undo=e.asm.jg).apply(null,arguments)},e._redo=function(){return(e._redo=e.asm.kg).apply(null,arguments)},e._relayout=function(){return(e._relayout=e.asm.lg).apply(null,arguments)},e._setLayoutMode=function(){return(e._setLayoutMode=e.asm.mg).apply(null,arguments)},e._getLayoutMode=function(){return(e._getLayoutMode=e.asm.ng).apply(null,arguments)},e._toggleDot=function(){return(e._toggleDot=e.asm.og).apply(null,arguments)},e._toggleDoubleDot=function(){return(e._toggleDoubleDot=e.asm.pg).apply(null,arguments)},e._setNoteEntryMode=function(){return(e._setNoteEntryMode=e.asm.qg).apply(null,arguments)},e._setNoteEntryMethod=function(){return(e._setNoteEntryMethod=e.asm.rg).apply(null,arguments)},e._setInputStateFromSelection=function(){return(e._setInputStateFromSelection=e.asm.sg).apply(null,arguments)},e._setInputAccidentalType=function(){return(e._setInputAccidentalType=e.asm.tg).apply(null,arguments)},e._setInputDurationType=function(){return(e._setInputDurationType=e.asm.ug).apply(null,arguments)},e._toggleInputDot=function(){return(e._toggleInputDot=e.asm.vg).apply(null,arguments)},e._addPitchByStep=function(){return(e._addPitchByStep=e.asm.wg).apply(null,arguments)},e._enterRest=function(){return(e._enterRest=e.asm.xg).apply(null,arguments)},e._setDurationType=function(){return(e._setDurationType=e.asm.yg).apply(null,arguments)},e._toggleLineBreak=function(){return(e._toggleLineBreak=e.asm.zg).apply(null,arguments)},e._togglePageBreak=function(){return(e._togglePageBreak=e.asm.Ag).apply(null,arguments)},e._setVoice=function(){return(e._setVoice=e.asm.Bg).apply(null,arguments)},e._changeSelectedElementsVoice=function(){return(e._changeSelectedElementsVoice=e.asm.Cg).apply(null,arguments)},e._addDynamic=function(){return(e._addDynamic=e.asm.Dg).apply(null,arguments)},e._addHairpin=function(){return(e._addHairpin=e.asm.Eg).apply(null,arguments)},e._addPedal=function(){return(e._addPedal=e.asm.Fg).apply(null,arguments)},e._addSostenutoPedal=function(){return(e._addSostenutoPedal=e.asm.Gg).apply(null,arguments)},e._addUnaCorda=function(){return(e._addUnaCorda=e.asm.Hg).apply(null,arguments)},e._splitPedal=function(){return(e._splitPedal=e.asm.Ig).apply(null,arguments)},e._addRehearsalMark=function(){return(e._addRehearsalMark=e.asm.Jg).apply(null,arguments)},e._addTempoText=function(){return(e._addTempoText=e.asm.Kg).apply(null,arguments)},e._addArticulation=function(){return(e._addArticulation=e.asm.Lg).apply(null,arguments)},e._addSlur=function(){return(e._addSlur=e.asm.Mg).apply(null,arguments)},e._addTie=function(){return(e._addTie=e.asm.Ng).apply(null,arguments)},e._addGraceNote=function(){return(e._addGraceNote=e.asm.Og).apply(null,arguments)},e._addTuplet=function(){return(e._addTuplet=e.asm.Pg).apply(null,arguments)},e._addStaffText=function(){return(e._addStaffText=e.asm.Qg).apply(null,arguments)},e._addSystemText=function(){return(e._addSystemText=e.asm.Rg).apply(null,arguments)},e._addExpressionText=function(){return(e._addExpressionText=e.asm.Sg).apply(null,arguments)},e._addLyricText=function(){return(e._addLyricText=e.asm.Tg).apply(null,arguments)},e._addHarmonyText=function(){return(e._addHarmonyText=e.asm.Ug).apply(null,arguments)},e._addFingeringText=function(){return(e._addFingeringText=e.asm.Vg).apply(null,arguments)},e._addLeftHandGuitarFingeringText=function(){return(e._addLeftHandGuitarFingeringText=e.asm.Wg).apply(null,arguments)},e._addRightHandGuitarFingeringText=function(){return(e._addRightHandGuitarFingeringText=e.asm.Xg).apply(null,arguments)},e._addStringNumberText=function(){return(e._addStringNumberText=e.asm.Yg).apply(null,arguments)},e._addInstrumentChangeText=function(){return(e._addInstrumentChangeText=e.asm.Zg).apply(null,arguments)},e._addStickingText=function(){return(e._addStickingText=e.asm._g).apply(null,arguments)},e._addFiguredBassText=function(){return(e._addFiguredBassText=e.asm.$g).apply(null,arguments)},e._setTimeSignature=function(){return(e._setTimeSignature=e.asm.ah).apply(null,arguments)},e._setTimeSignatureWithType=function(){return(e._setTimeSignatureWithType=e.asm.bh).apply(null,arguments)},e._setKeySignature=function(){return(e._setKeySignature=e.asm.ch).apply(null,arguments)},e._getKeySignature=function(){return(e._getKeySignature=e.asm.dh).apply(null,arguments)},e._setClef=function(){return(e._setClef=e.asm.eh).apply(null,arguments)},e._synthAudio=function(){return(e._synthAudio=e.asm.fh).apply(null,arguments)},e._synthAudioFromSelection=function(){return(e._synthAudioFromSelection=e.asm.gh).apply(null,arguments)},e._synthAudioSelectionPreview=function(){return(e._synthAudioSelectionPreview=e.asm.hh).apply(null,arguments)},e._selectionPlaybackStartTime=function(){return(e._selectionPlaybackStartTime=e.asm.ih).apply(null,arguments)},e._processSynth=function(){return(e._processSynth=e.asm.jh).apply(null,arguments)},e._processSynthBatch=function(){return(e._processSynthBatch=e.asm.kh).apply(null,arguments)},e._savePositions=function(){return(e._savePositions=e.asm.lh).apply(null,arguments)},e._saveMetadata=function(){return(e._saveMetadata=e.asm.mh).apply(null,arguments)},e._destroy=function(){return(e._destroy=e.asm.nh).apply(null,arguments)};var t2=e._malloc=function(){return(t2=e._malloc=e.asm.oh).apply(null,arguments)},t4=e._free=function(){return(t4=e._free=e.asm.ph).apply(null,arguments)},t8=e.___errno_location=function(){return(t8=e.___errno_location=e.asm.qh).apply(null,arguments)},t3=e.___getTypeName=function(){return(t3=e.___getTypeName=e.asm.rh).apply(null,arguments)};e.___embind_register_native_and_builtin_types=function(){return(e.___embind_register_native_and_builtin_types=e.asm.sh).apply(null,arguments)};var t5=e._emscripten_GetProcAddress=function(){return(t5=e._emscripten_GetProcAddress=e.asm.th).apply(null,arguments)},t6=e.__get_tzname=function(){return(t6=e.__get_tzname=e.asm.uh).apply(null,arguments)},t7=e.__get_daylight=function(){return(t7=e.__get_daylight=e.asm.vh).apply(null,arguments)},t9=e.__get_timezone=function(){return(t9=e.__get_timezone=e.asm.wh).apply(null,arguments)},re=e.stackSave=function(){return(re=e.stackSave=e.asm.xh).apply(null,arguments)},rt=e.stackRestore=function(){return(rt=e.stackRestore=e.asm.yh).apply(null,arguments)},rr=e.stackAlloc=function(){return(rr=e.stackAlloc=e.asm.zh).apply(null,arguments)},rn=e._setThrew=function(){return(rn=e._setThrew=e.asm.Ah).apply(null,arguments)},ra=e.__ZSt18uncaught_exceptionv=function(){return(ra=e.__ZSt18uncaught_exceptionv=e.asm.Bh).apply(null,arguments)};e.___cxa_demangle=function(){return(e.___cxa_demangle=e.asm.Ch).apply(null,arguments)};var ro=e._memalign=function(){return(ro=e._memalign=e.asm.Dh).apply(null,arguments)},ri=e.dynCall_iij=function(){return(ri=e.dynCall_iij=e.asm.Eh).apply(null,arguments)};e.dynCall_viij=function(){return(e.dynCall_viij=e.asm.Fh).apply(null,arguments)},e.dynCall_viijii=function(){return(e.dynCall_viijii=e.asm.Gh).apply(null,arguments)},e.dynCall_vij=function(){return(e.dynCall_vij=e.asm.Hh).apply(null,arguments)};var rs=e.dynCall_ji=function(){return(rs=e.dynCall_ji=e.asm.Ih).apply(null,arguments)};if(e.dynCall_jiij=function(){return(e.dynCall_jiij=e.asm.Jh).apply(null,arguments)},e.dynCall_jij=function(){return(e.dynCall_jij=e.asm.Kh).apply(null,arguments)},e.dynCall_viiji=function(){return(e.dynCall_viiji=e.asm.Lh).apply(null,arguments)},e.dynCall_jiii=function(){return(e.dynCall_jiii=e.asm.Mh).apply(null,arguments)},e.dynCall_viijj=function(){return(e.dynCall_viijj=e.asm.Nh).apply(null,arguments)},e.dynCall_viiijj=function(){return(e.dynCall_viiijj=e.asm.Oh).apply(null,arguments)},e.dynCall_iiiij=function(){return(e.dynCall_iiiij=e.asm.Ph).apply(null,arguments)},e.dynCall_iiji=function(){return(e.dynCall_iiji=e.asm.Qh).apply(null,arguments)},e.dynCall_vijjii=function(){return(e.dynCall_vijjii=e.asm.Rh).apply(null,arguments)},e.dynCall_vijjiii=function(){return(e.dynCall_vijjiii=e.asm.Sh).apply(null,arguments)},e.dynCall_jjii=function(){return(e.dynCall_jjii=e.asm.Th).apply(null,arguments)},e.dynCall_jiji=function(){return(e.dynCall_jiji=e.asm.Uh).apply(null,arguments)},e.dynCall_iiiiij=function(){return(e.dynCall_iiiiij=e.asm.Vh).apply(null,arguments)},e.dynCall_iiiiijj=function(){return(e.dynCall_iiiiijj=e.asm.Wh).apply(null,arguments)},e.dynCall_iiiiiijj=function(){return(e.dynCall_iiiiiijj=e.asm.Xh).apply(null,arguments)},e.ccall=q,e.cwrap=function(e,t,r,n){var a=(r=r||[]).every(function(e){return"number"===e});return"string"!==t&&a&&!n?G(e):function(){return q(e,t,r,arguments)}},e.setValue=function(e,t,r,n){switch("*"===(r=r||"i8").charAt(r.length-1)&&(r="i32"),r){case"i1":case"i8":y[0|e]=t;break;case"i16":v[e>>1]=t;break;case"i32":w[e>>2]=t;break;case"i64":T=[t>>>0,+Math.abs(_=t)>=1?_>0?Math.min(+Math.floor(_/0x100000000),0xffffffff)>>>0:~~Math.ceil((_-(~~_>>>0))/0x100000000)>>>0:0],w[e>>2]=T[0],w[e+4>>2]=T[1];break;case"float":k[e>>2]=t;break;case"double":E[e>>3]=t;break;default:ev("invalid type for setValue: "+r)}},e.getValue=function(e,t,r){switch("*"===(t=t||"i8").charAt(t.length-1)&&(t="i32"),t){case"i1":case"i8":return y[0|e];case"i16":return v[e>>1];case"i32":case"i64":return w[e>>2];case"float":return k[e>>2];case"double":return E[e>>3];default:ev("invalid type for getValue: "+t)}return null},e.UTF8ToString=K,e.stringToUTF8=Q,e.addRunDependency=ey,e.removeRunDependency=eb,e.FS_createPath=eB.createPath,e.FS_createDataFile=eB.createDataFile,e.FS_createPreloadedFile=eB.createPreloadedFile,e.FS_createLazyFile=eB.createLazyFile,e.FS_createDevice=eB.createDevice,e.FS_unlink=eB.unlink,ex)if(eS(ex)||(ex=B(ex)),D||L){var rl=u(ex);b.set(rl,1024)}else{ey();var ru=function(t){t.byteLength&&(t=new Uint8Array(t)),b.set(t,1024),e.memoryInitializerRequest&&delete e.memoryInitializerRequest.response,eb()},rc=function(){i(ex,ru,function(){var e=Error("could not load memory initializer "+ex);n(e)})};if(e.memoryInitializerRequest){var rd=function(){var t=e.memoryInitializerRequest,r=t.response;if(200!==t.status&&0!==t.status){console.warn("a problem seems to have happened with Module.memoryInitializerRequest, status: "+t.status+", retrying "+ex),rc();return}ru(r)};e.memoryInitializerRequest.response?setTimeout(rd,0):e.memoryInitializerRequest.addEventListener("load",rd)}else rc()}function rf(e){this.name="ExitStatus",this.message="Program terminated with exit("+e+")",this.status=e}function rm(t){if(!(eh>0)){if(e.preRun)for("function"==typeof e.preRun&&(e.preRun=[e.preRun]);e.preRun.length;){var n;n=e.preRun.shift(),ed.unshift(n)}eT(ed),eh>0||(e.setStatus?(e.setStatus("Running..."),setTimeout(function(){setTimeout(function(){e.setStatus("")},1),a()},1)):a())}function a(){if(!C&&(C=!0,e.calledRun=!0,!W)){if(e.noFSInit||eB.init.initialized||eB.init(),eT(ef),eB.ignorePermissions=!1,eT(em),r(e),e.onRuntimeInitialized&&e.onRuntimeInitialized(),e.postRun)for("function"==typeof e.postRun&&(e.postRun=[e.postRun]);e.postRun.length;){var t;t=e.postRun.shift(),ep.unshift(t)}eT(ep)}}}function rp(t,r){r&&m&&0===t||(m||(e.onExit&&e.onExit(t),W=!0),P(t,new rf(t)))}if(eg=function e(){C||rm(),C||(eg=e)},e.run=rm,e.preInit)for("function"==typeof e.preInit&&(e.preInit=[e.preInit]);e.preInit.length>0;)e.preInit.pop()();return m=!0,rm(),e.ready});let n="object"==typeof s&&"object"==typeof s.versions&&"string"==typeof s.versions.node?{locateFile(e){let{join:t}=require("path");return t(__dirname,e)},getPreloadedPackage:e=>require("fs").readFileSync(e).buffer}:{locateFile(e){if(e.endsWith("webmscore.lib.mem.wasm"))return new URL(MSCORE_LIB_MEM,MSCORE_BASEURL).href;if(e.endsWith(".wasm"))return new URL(MSCORE_LIB_WASM,MSCORE_BASEURL).href;if(e.endsWith(".data"))return new URL(MSCORE_LIB_DATA,MSCORE_BASEURL).href;if(e.endsWith(".wasm.js"))throw Error("WebAssembly is not supported in your browser");return new URL(e,"/score-editor/").href}};n.getArguments=n.getArguments||(()=>["-platform","wasm"]),n.arguments=n.arguments||n.getArguments(),n.ENV=n.ENV||{},n.ENV.QT_QPA_PLATFORM=n.ENV.QT_QPA_PLATFORM||"wasm",n.INITIAL_MEMORY=n.INITIAL_MEMORY||0x10000000,n.__cxa_atexit=n.__cxa_atexit||function(){return 0},n.___cxa_atexit=n.___cxa_atexit||n.__cxa_atexit;let a=n,o=r(n),i=e=>{let t=4*e.length+1,r=a._malloc(t);return a.stringToUTF8(e,r,t),r},u=e=>{let t=e.length*e.BYTES_PER_ELEMENT,r=a._malloc(t);return a.HEAPU8.set(e,r),r};class c{constructor(e){this._ptr=e,this._size=c._getUint32(this._sizePtr),this._checkRet()}get _retCodePtr(){return this._ptr}get _sizePtr(){return this._retCodePtr+4}get _dataPtr(){return this._sizePtr+4}_checkRet(){let e=c._getUint32(this._retCodePtr);if(e!==m.CODE_OK){let t=this.text();throw this.free(),new m(e,t)}}data(){return new Uint8Array(a.HEAPU8.subarray(this._dataPtr,this._dataPtr+this._size))}text(){return a.UTF8ToString(this._dataPtr)}number(){return c._getUint32(this._dataPtr)}free(){return d(this._ptr)}static _getUint32(e){return new DataView(new Uint8Array(a.HEAPU8.subarray(e,e+4)).buffer).getUint32(0,!0)}static _readAndFree(e,t){let r=new c(e),n=r[t]();return r.free(),n}static readData(e){return c._readAndFree(e,"data")}static readText(e){return c._readAndFree(e,"text")}static readNum(e){return c._readAndFree(e,"number")}}let d=e=>{a._free(e)},f=new Promise(e=>{o.then(t=>{(a=t).ccall("init"),e(void 0)})});class m extends Error{constructor(e,t){super(),this.name="WasmError",this.errorCode=e,this.errorName=t,this.message=`WebMscore Err${this.errorName}`}}m.CODE_OK=0;let p=!1,h=!1;class g{static get ready(){return f}static async version(){return await g.ready,a.ccall("version","number")}static async setLogLevel(e){return h=!0,await g.ready,a.ccall("setLogLevel",null,["number"],[e])}static set stdout(e){a.stdout=e}static get stdout(){return a.stdout}static set stderr(e){a.stderr=e}static get stderr(){return a.stderr}static async load(e,t,r=[],n=!0){let[o]=await Promise.all([r,g.ready]);for(let e of o)await g.addFont(e);let s=i(e),l=u(t),f=a.ccall("load","number",["number","number","number","boolean"],[s,l,t.byteLength,n]);d(s),d(l);let m=c.readNum(f);return h||await g.setLogLevel(0),new g(m)}static async addFont(e){if("string"!=typeof e){let t=""+Math.random();a.FS_createDataFile("/fonts/",t,e,!0,!0),e="/fonts/"+t}let t=i(e),r=a.ccall("addFont","number",["number"],[t]);return d(t),!!r}static get hasSoundfont(){return p}static set hasSoundfont(e){p=e}static async setSoundFont(e){g.hasSoundfont&&a.FS_unlink("/MuseScore_General.sf3"),a.FS_createDataFile("/","MuseScore_General.sf3",e,!0,!0),g.hasSoundfont=!0}constructor(e){this.scoreptr=e,this.excerptId=-1}async setExcerptId(e){this.excerptId=e}async getExcerptId(){return this.excerptId}async generateExcerpts(){return a.ccall("generateExcerpts",null,["number"],[this.scoreptr])}async title(){let e=a.ccall("title","number",["number"],[this.scoreptr]);return c.readText(e)}async subtitle(){let e=a.ccall("subtitle","number",["number"],[this.scoreptr]);return c.readText(e)}async titleFilenameSafe(){return(await this.title()).replace(/[\s<>:{}"/\\|?*~.\0\cA-\cZ]+/g,"_")}async setTitleText(e){let t=i(null==e?"":String(e));try{return a.ccall("setTitleText","boolean",["number","number","number"],[this.scoreptr,t,this.excerptId])}finally{d(t)}}async setSubtitleText(e){let t=i(null==e?"":String(e));try{return a.ccall("setSubtitleText","boolean",["number","number","number"],[this.scoreptr,t,this.excerptId])}finally{d(t)}}async setComposerText(e){let t=i(null==e?"":String(e));try{return a.ccall("setComposerText","boolean",["number","number","number"],[this.scoreptr,t,this.excerptId])}finally{d(t)}}async setLyricistText(e){let t=i(null==e?"":String(e));try{return a.ccall("setLyricistText","boolean",["number","number","number"],[this.scoreptr,t,this.excerptId])}finally{d(t)}}async setSelectedText(e){let t=i(null==e?"":String(e));try{return a.ccall("setSelectedText","boolean",["number","number","number"],[this.scoreptr,t,this.excerptId])}finally{d(t)}}async appendPart(e){let t=i(null==e?"":String(e));try{return a.ccall("appendPart","boolean",["number","number","number"],[this.scoreptr,t,this.excerptId])}finally{d(t)}}async appendPartByMusicXmlId(e){let t=i(null==e?"":String(e));try{return a.ccall("appendPartByMusicXmlId","boolean",["number","number","number"],[this.scoreptr,t,this.excerptId])}finally{d(t)}}async removePart(e){return a.ccall("removePart","boolean",["number","number","number"],[this.scoreptr,e,this.excerptId])}async setPartVisible(e,t){return a.ccall("setPartVisible","boolean",["number","number","number","number"],[this.scoreptr,e,+!!t,this.excerptId])}async listInstrumentTemplates(){let e=a.ccall("listInstrumentTemplates","number",["number"],[this.scoreptr]);return JSON.parse(c.readText(e))}async npages(){let e=a.ccall("npages","number",["number","number"],[this.scoreptr,this.excerptId]);return c.readNum(e)}async measureSignatureCount(e){let t=a.ccall("measureSignatureCount","number",["number","number","number"],[this.scoreptr,e,this.excerptId]);return c.readNum(t)}async measureSignatureAt(e,t){let r=a.ccall("measureSignatureAt","number",["number","number","number","number"],[this.scoreptr,e,t,this.excerptId]);return c.readText(r)}async measureSignatures(e){let t=a.ccall("measureSignatures","number",["number","number","number"],[this.scoreptr,e,this.excerptId]);return JSON.parse(c.readText(t))}async measureLineBreaks(){let e=a.ccall("measureLineBreaks","number",["number","number"],[this.scoreptr,this.excerptId]);return JSON.parse(c.readText(e))}async setMeasureLineBreaks(e){let t=JSON.stringify(Array.isArray(e)?e:[]),r=i(t),n=a.ccall("setMeasureLineBreaks","boolean",["number","number","number","number"],[this.scoreptr,r,t.length,this.excerptId]);return d(r),n}async metadata(){return JSON.parse(await this.saveMetadata())}async measurePositions(){return JSON.parse(await this.savePositions(!1))}async segmentPositions(){return JSON.parse(await this.savePositions(!0))}async saveXml(){let e=a.ccall("saveXml","number",["number","number"],[this.scoreptr,this.excerptId]);return c.readText(e)}async saveMxl(){let e=a.ccall("saveMxl","number",["number","number"],[this.scoreptr,this.excerptId]);return c.readData(e)}async saveMsc(e="mscz"){let t=a.ccall("saveMsc","number",["number","boolean","number"],[this.scoreptr,"mscz"==e,this.excerptId]);return c.readData(t)}async saveSvg(e=0,t=!1,r=!1){let n=a.ccall("saveSvg","number",["number","number","boolean","boolean","number"],[this.scoreptr,e,t,r,this.excerptId]);return c.readText(n)}async savePng(e=0,t=!1,r=!0){let n=a.ccall("savePng","number",["number","number","boolean","boolean","number"],[this.scoreptr,e,t,r,this.excerptId]);return c.readData(n)}async savePdf(){let e=a.ccall("savePdf","number",["number","number"],[this.scoreptr,this.excerptId]);return c.readData(e)}async saveMidi(e=!0,t=!0){let r=a.ccall("saveMidi","number",["number","boolean","boolean","number"],[this.scoreptr,e,t,this.excerptId]);return c.readData(r)}async setSoundFont(e){return g.setSoundFont(e)}async saveAudio(e){if(!g.hasSoundfont)throw Error("The soundfont is not set.");let t=i(e),r=a.ccall("saveAudio","number",["number","number","number"],[this.scoreptr,t,this.excerptId]);return d(t),c.readData(r)}async synthAudio(e){let t=await this._synthAudio(e);return e=>this.processSynth(t,e)}async synthAudioBatch(e,t){let r=await this._synthAudio(e);return e=>this.processSynthBatch(r,t,e)}async synthAudioBatchFromSelection(e){if(!g.hasSoundfont)throw Error("The soundfont is not set.");let t=a.ccall("synthAudioFromSelection","number",["number","number"],[this.scoreptr,this.excerptId]);if(!t)throw Error("synthAudioFromSelection: Internal Error.");return r=>this.processSynthBatch(t,e,r)}async synthSelectionPreviewBatch(e,t=500){if(!g.hasSoundfont)throw Error("The soundfont is not set.");let r=Math.max(.05,Number(t)/1e3),n=a.ccall("synthAudioSelectionPreview","number",["number","number","number"],[this.scoreptr,r,this.excerptId]);if(!n)throw Error("synthAudioSelectionPreview: Internal Error.");return t=>this.processSynthBatch(n,e,t)}async _synthAudio(e=0){if(!g.hasSoundfont)throw Error("The soundfont is not set.");let t=a.ccall("synthAudio","number",["number","number","number"],[this.scoreptr,e,this.excerptId]);if(0===t)throw Error("synthAudio: Internal Error.");return t}async _synthAudioFromSelection(){if(!g.hasSoundfont)throw Error("The soundfont is not set.");let e=a.ccall("synthAudioFromSelection","number",["number","number"],[this.scoreptr,this.excerptId]);if(0===e)throw Error("synthAudioFromSelection: Internal Error.");return e}async _synthAudioSelectionPreview(e=500){if(!g.hasSoundfont)throw Error("The soundfont is not set.");let t=Math.max(.05,Number(e)/1e3),r=a.ccall("synthAudioSelectionPreview","number",["number","number","number"],[this.scoreptr,t,this.excerptId]);if(0===r)throw Error("synthAudioSelectionPreview: Internal Error.");return r}_parseSynthRes(e){let t=a.getValue(e+0,"i8"),r=+a.getValue(e+4,"float"),n=+a.getValue(e+8,"float"),o=a.getValue(e+12,"i32"),i=e+16,s=new Uint8Array(a.HEAPU8.subarray(i,i+o));return d(e),{done:!!t,startTime:r,endTime:n,chunk:s}}async processSynth(e,t=!1){let r=a.ccall("processSynth","number",["number","boolean"],[e,t]);return this._parseSynthRes(r)}async processSynthBatch(e,t,r=!1){let n=a.ccall("processSynthBatch","number",["number","number","boolean"],[e,t,r]),o=[];for(let e=0;e<t;e++){let t=a.getValue(n+4*e,"*"),r=this._parseSynthRes(t);o.push(r)}return d(n),o}async savePositions(e){let t=a.ccall("savePositions","number",["number","boolean","number"],[this.scoreptr,e,this.excerptId]);return c.readText(t)}async saveMetadata(){let e=a.ccall("saveMetadata","number",["number"],[this.scoreptr]);return c.readText(e)}async selectElementAtPoint(e,t,r){return a.ccall("selectElementAtPoint","boolean",["number","number","number","number","number"],[this.scoreptr,e,t,r,this.excerptId])}async selectMeasureAtPoint(e,t,r){return a.ccall("selectMeasureAtPoint","boolean",["number","number","number","number","number"],[this.scoreptr,e,t,r,this.excerptId])}async selectPartMeasureByIndex(e,t){return a.ccall("selectPartMeasureByIndex","boolean",["number","number","number","number"],[this.scoreptr,e,t,this.excerptId])}async selectTextElementAtPoint(e,t,r){return a.ccall("selectTextElementAtPoint","boolean",["number","number","number","number","number"],[this.scoreptr,e,t,r,this.excerptId])}async clearSelection(){return a.ccall("clearSelection","boolean",["number","number"],[this.scoreptr,this.excerptId])}async selectNextChord(){return a.ccall("selectNextChord","boolean",["number","number"],[this.scoreptr,this.excerptId])}async selectPrevChord(){return a.ccall("selectPrevChord","boolean",["number","number"],[this.scoreptr,this.excerptId])}async extendSelectionNextChord(){return a.ccall("extendSelectionNextChord","boolean",["number","number"],[this.scoreptr,this.excerptId])}async extendSelectionPrevChord(){return a.ccall("extendSelectionPrevChord","boolean",["number","number"],[this.scoreptr,this.excerptId])}async getSelectionBoundingBox(){let e=a.ccall("getSelectionBoundingBox","number",["number","number"],[this.scoreptr,this.excerptId]),t=c.readText(e);if(!t)return null;try{return JSON.parse(t)}catch(e){return null}}async getSelectionBoundingBoxes(){let e=a.ccall("getSelectionBoundingBoxes","number",["number","number"],[this.scoreptr,this.excerptId]),t=c.readText(e);if(!t)return[];try{return JSON.parse(t)}catch(e){return[]}}async selectionMimeType(){let e=a.ccall("selectionMimeType","number",["number","number"],[this.scoreptr,this.excerptId]);return c.readText(e)}async selectionMimeData(){let e=a.ccall("selectionMimeData","number",["number","number"],[this.scoreptr,this.excerptId]);return c.readData(e)}async pasteSelection(e,t){let r=i(e),n=u(t),o=a.ccall("pasteSelection","boolean",["number","number","number","number","number"],[this.scoreptr,r,n,t.byteLength,this.excerptId]);return d(r),d(n),o}async selectElementAtPointWithMode(e,t,r,n){return a.ccall("selectElementAtPointWithMode","boolean",["number","number","number","number","number","number"],[this.scoreptr,e,t,r,n,this.excerptId])}async deleteSelection(){return a.ccall("deleteSelection","boolean",["number","number"],[this.scoreptr,this.excerptId])}async pitchUp(){return a.ccall("pitchUp","boolean",["number","number"],[this.scoreptr,this.excerptId])}async pitchDown(){return a.ccall("pitchDown","boolean",["number","number"],[this.scoreptr,this.excerptId])}async transpose(e){return a.ccall("transpose","boolean",["number","number","number"],[this.scoreptr,e,this.excerptId])}async setAccidental(e){return a.ccall("setAccidental","boolean",["number","number","number"],[this.scoreptr,e,this.excerptId])}async doubleDuration(){return a.ccall("doubleDuration","boolean",["number","number"],[this.scoreptr,this.excerptId])}async halfDuration(){return a.ccall("halfDuration","boolean",["number","number"],[this.scoreptr,this.excerptId])}async toggleDot(){return a.ccall("toggleDot","boolean",["number","number"],[this.scoreptr,this.excerptId])}async toggleDoubleDot(){return a.ccall("toggleDoubleDot","boolean",["number","number"],[this.scoreptr,this.excerptId])}async setNoteEntryMode(e){return a.ccall("setNoteEntryMode","boolean",["number","number","number"],[this.scoreptr,+!!e,this.excerptId])}async setNoteEntryMethod(e){return a.ccall("setNoteEntryMethod","boolean",["number","number","number"],[this.scoreptr,e,this.excerptId])}async setInputStateFromSelection(){return a.ccall("setInputStateFromSelection","boolean",["number","number"],[this.scoreptr,this.excerptId])}async setInputAccidentalType(e){return a.ccall("setInputAccidentalType","boolean",["number","number","number"],[this.scoreptr,e,this.excerptId])}async setInputDurationType(e){return a.ccall("setInputDurationType","boolean",["number","number","number"],[this.scoreptr,e,this.excerptId])}async toggleInputDot(){return a.ccall("toggleInputDot","boolean",["number","number"],[this.scoreptr,this.excerptId])}async addPitchByStep(e,t=!1,r=!1){return a.ccall("addPitchByStep","boolean",["number","number","number","number","number"],[this.scoreptr,e,+!!t,+!!r,this.excerptId])}async enterRest(){return a.ccall("enterRest","boolean",["number","number"],[this.scoreptr,this.excerptId])}async setDurationType(e){return a.ccall("setDurationType","boolean",["number","number","number"],[this.scoreptr,e,this.excerptId])}async toggleLineBreak(){return a.ccall("toggleLineBreak","boolean",["number","number"],[this.scoreptr,this.excerptId])}async togglePageBreak(){return a.ccall("togglePageBreak","boolean",["number","number"],[this.scoreptr,this.excerptId])}async setVoice(e){return a.ccall("setVoice","boolean",["number","number","number"],[this.scoreptr,e,this.excerptId])}async changeSelectedElementsVoice(e){return a.ccall("changeSelectedElementsVoice","boolean",["number","number","number"],[this.scoreptr,e,this.excerptId])}async undo(){return a.ccall("undo","boolean",["number","number"],[this.scoreptr,this.excerptId])}async redo(){return a.ccall("redo","boolean",["number","number"],[this.scoreptr,this.excerptId])}async relayout(){return a.ccall("relayout","boolean",["number","number"],[this.scoreptr,this.excerptId])}async setLayoutMode(e){return a.ccall("setLayoutMode","boolean",["number","number","number"],[this.scoreptr,e,this.excerptId])}async getLayoutMode(){let e=a.ccall("getLayoutMode","number",["number","number"],[this.scoreptr,this.excerptId]);return c.readNum(e)}async addDynamic(e){return a.ccall("addDynamic","boolean",["number","number","number"],[this.scoreptr,e,this.excerptId])}async addHairpin(e){return a.ccall("addHairpin","boolean",["number","number","number"],[this.scoreptr,e,this.excerptId])}async addPedal(e){return a.ccall("addPedal","boolean",["number","number","number"],[this.scoreptr,e,this.excerptId])}async addSostenutoPedal(){return a.ccall("addSostenutoPedal","boolean",["number","number"],[this.scoreptr,this.excerptId])}async addUnaCorda(){return a.ccall("addUnaCorda","boolean",["number","number"],[this.scoreptr,this.excerptId])}async splitPedal(){return a.ccall("splitPedal","boolean",["number","number"],[this.scoreptr,this.excerptId])}async addRehearsalMark(){return a.ccall("addRehearsalMark","boolean",["number","number"],[this.scoreptr,this.excerptId])}async addTempoText(e){return a.ccall("addTempoText","boolean",["number","number","number"],[this.scoreptr,e,this.excerptId])}async addStaffText(e){let t=i(null==e?"":String(e));try{return a.ccall("addStaffText","boolean",["number","number","number"],[this.scoreptr,t,this.excerptId])}finally{d(t)}}async addSystemText(e){let t=i(null==e?"":String(e));try{return a.ccall("addSystemText","boolean",["number","number","number"],[this.scoreptr,t,this.excerptId])}finally{d(t)}}async addExpressionText(e){let t=i(null==e?"":String(e));try{return a.ccall("addExpressionText","boolean",["number","number","number"],[this.scoreptr,t,this.excerptId])}finally{d(t)}}async addLyricText(e){let t=i(null==e?"":String(e));try{return a.ccall("addLyricText","boolean",["number","number","number"],[this.scoreptr,t,this.excerptId])}finally{d(t)}}async addHarmonyText(e,t){let r=i(null==t?"":String(t));try{return a.ccall("addHarmonyText","boolean",["number","number","number","number"],[this.scoreptr,e,r,this.excerptId])}finally{d(r)}}async addFingeringText(e){let t=i(null==e?"":String(e));try{return a.ccall("addFingeringText","boolean",["number","number","number"],[this.scoreptr,t,this.excerptId])}finally{d(t)}}async addLeftHandGuitarFingeringText(e){let t=i(null==e?"":String(e));try{return a.ccall("addLeftHandGuitarFingeringText","boolean",["number","number","number"],[this.scoreptr,t,this.excerptId])}finally{d(t)}}async addRightHandGuitarFingeringText(e){let t=i(null==e?"":String(e));try{return a.ccall("addRightHandGuitarFingeringText","boolean",["number","number","number"],[this.scoreptr,t,this.excerptId])}finally{d(t)}}async addStringNumberText(e){let t=i(null==e?"":String(e));try{return a.ccall("addStringNumberText","boolean",["number","number","number"],[this.scoreptr,t,this.excerptId])}finally{d(t)}}async addInstrumentChangeText(e){let t=i(null==e?"":String(e));try{return a.ccall("addInstrumentChangeText","boolean",["number","number","number"],[this.scoreptr,t,this.excerptId])}finally{d(t)}}async addStickingText(e){let t=i(null==e?"":String(e));try{return a.ccall("addStickingText","boolean",["number","number","number"],[this.scoreptr,t,this.excerptId])}finally{d(t)}}async addFiguredBassText(e){let t=i(null==e?"":String(e));try{return a.ccall("addFiguredBassText","boolean",["number","number","number"],[this.scoreptr,t,this.excerptId])}finally{d(t)}}async addArticulation(e){let t=i(e);try{return a.ccall("addArticulation","boolean",["number","number","number"],[this.scoreptr,t,this.excerptId])}finally{d(t)}}async addSlur(){return a.ccall("addSlur","boolean",["number","number"],[this.scoreptr,this.excerptId])}async addTie(){return a.ccall("addTie","boolean",["number","number"],[this.scoreptr,this.excerptId])}async addGraceNote(e){return a.ccall("addGraceNote","boolean",["number","number","number"],[this.scoreptr,e,this.excerptId])}async addTuplet(e){return a.ccall("addTuplet","boolean",["number","number","number"],[this.scoreptr,e,this.excerptId])}async addNoteFromRest(){return a.ccall("addNoteFromRest","boolean",["number","number"],[this.scoreptr,this.excerptId])}async toggleRepeatStart(){return a.ccall("toggleRepeatStart","boolean",["number","number"],[this.scoreptr,this.excerptId])}async toggleRepeatEnd(){return a.ccall("toggleRepeatEnd","boolean",["number","number"],[this.scoreptr,this.excerptId])}async setRepeatCount(e){return a.ccall("setRepeatCount","boolean",["number","number","number"],[this.scoreptr,e,this.excerptId])}async setBarLineType(e){return a.ccall("setBarLineType","boolean",["number","number","number"],[this.scoreptr,e,this.excerptId])}async addVolta(e){return a.ccall("addVolta","boolean",["number","number","number"],[this.scoreptr,e,this.excerptId])}async insertMeasures(e,t){return a.ccall("insertMeasures","boolean",["number","number","number","number"],[this.scoreptr,e,t,this.excerptId])}async removeTrailingEmptyMeasures(){return a.ccall("removeTrailingEmptyMeasures","boolean",["number","number"],[this.scoreptr,this.excerptId])}async removeSelectedMeasures(){return a.ccall("removeSelectedMeasures","boolean",["number","number"],[this.scoreptr,this.excerptId])}async setTimeSignature(e,t){return a.ccall("setTimeSignature","boolean",["number","number","number","number"],[this.scoreptr,e,t,this.excerptId])}async setTimeSignatureWithType(e,t,r){return a.ccall("setTimeSignatureWithType","boolean",["number","number","number","number","number"],[this.scoreptr,e,t,r,this.excerptId])}async setKeySignature(e){return a.ccall("setKeySignature","boolean",["number","number","number"],[this.scoreptr,e,this.excerptId])}async getKeySignature(){return a.ccall("getKeySignature","number",["number","number"],[this.scoreptr,this.excerptId])}async setClef(e){return a.ccall("setClef","boolean",["number","number","number"],[this.scoreptr,e,this.excerptId])}destroy(e=!0){if(!e)throw Error("unimplemented");a.ccall("destroy","void",["number"],[this.scoreptr]),d(this.scoreptr)}}let y=(e,t,r)=>{self.postMessage({id:e,result:t},r)},b=(e,t)=>{let r={id:e,error:{name:t.name,message:t.message,stack:t.stack}};self.postMessage(r)},v=e=>{if(e){if(Array.isArray(e))return e.reduce((e,t)=>e.concat(v(t)),[]).filter(Boolean);else if(e instanceof Uint8Array)return[e.buffer];else if(e.chunk instanceof Uint8Array)return[e.chunk.buffer]}};self.onmessage=async t=>{let{id:r,method:n,params:a}=t.data;try{switch(n){case"ready":await g.ready,y(r,"done");break;case"load":await g.ready,e=await g.load.apply(void 0,a),y(r,"done");break;case"setLogLevel":await g.setLogLevel.apply(void 0,a),y(r,"done");break;default:e||b(r,Error("Score not loaded"));let t=await e[n].apply(e,a);y(r,t,v(t))}}catch(e){b(r,e)}}}()};"object"==typeof s&&"object"==typeof s.versions&&s.versions.node;var c=function(){var e="u">typeof self?self:window;if(e.window||("function"==typeof importScripts?e.window=e:e.window={addEventListener:function(){},location:new URL("file:///"),encodeURIComponent:encodeURIComponent}),!e.navigator)try{e.navigator={}}catch(e){}};function d(e,t){if(e){if("string"==typeof e)return f(e,t);var r=({}).toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?f(e,t):void 0}}function f(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function m(){var e,t,r="function"==typeof Symbol?Symbol:{},n=r.iterator||"@@iterator",a=r.toStringTag||"@@toStringTag";function o(r,n,a,o){var l=Object.create((n&&n.prototype instanceof s?n:s).prototype);return p(l,"_invoke",function(r,n,a){var o,s,l,u=0,c=a||[],d=!1,f={p:0,n:0,v:e,a:m,f:m.bind(e,4),d:function(t,r){return o=t,s=0,l=e,f.n=r,i}};function m(r,n){for(s=r,l=n,t=0;!d&&u&&!a&&t<c.length;t++){var a,o=c[t],m=f.p,p=o[2];r>3?(a=p===n)&&(l=o[(s=o[4])?5:(s=3,3)],o[4]=o[5]=e):o[0]<=m&&((a=r<2&&m<o[1])?(s=0,f.v=n,f.n=o[1]):m<p&&(a=r<3||o[0]>n||n>p)&&(o[4]=r,o[5]=n,f.n=p,s=0))}if(a||r>1)return i;throw d=!0,n}return function(a,c,p){if(u>1)throw TypeError("Generator is already running");for(d&&1===c&&m(c,p),s=c,l=p;(t=s<2?e:l)||!d;){o||(s?s<3?(s>1&&(f.n=-1),m(s,l)):f.n=l:f.v=l);try{if(u=2,o){if(s||(a="next"),t=o[a]){if(!(t=t.call(o,l)))throw TypeError("iterator result is not an object");if(!t.done)return t;l=t.value,s<2&&(s=0)}else 1===s&&(t=o.return)&&t.call(o),s<2&&(l=TypeError("The iterator does not provide a '"+a+"' method"),s=1);o=e}else if((t=(d=f.n<0)?l:r.call(n,f))!==i)break}catch(t){o=e,s=1,l=t}finally{u=1}}return{value:t,done:d}}}(r,a,o),!0),l}var i={};function s(){}function l(){}function u(){}t=Object.getPrototypeOf;var c=u.prototype=s.prototype=Object.create([][n]?t(t([][n]())):(p(t={},n,function(){return this}),t));function d(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,u):(e.__proto__=u,p(e,a,"GeneratorFunction")),e.prototype=Object.create(c),e}return l.prototype=u,p(c,"constructor",u),p(u,"constructor",l),l.displayName="GeneratorFunction",p(u,a,"GeneratorFunction"),p(c),p(c,a,"Generator"),p(c,n,function(){return this}),p(c,"toString",function(){return"[object Generator]"}),(m=function(){return{w:o,m:d}})()}function p(e,t,r,n){var a=Object.defineProperty;try{a({},"",{})}catch(e){a=0}(p=function(e,t,r,n){function o(t,r){p(e,t,function(e){return this._invoke(t,r,e)})}t?a?a(e,t,{value:r,enumerable:!n,configurable:!n,writable:!n}):e[t]=r:(o("next",0),o("throw",1),o("return",2))})(e,t,r,n)}function h(e,t,r,n,a,o,i){try{var s=e[o](i),l=s.value}catch(e){return void r(e)}s.done?t(l):Promise.resolve(l).then(n,a)}function g(e){return function(){var t=this,r=arguments;return new Promise(function(n,a){var o=e.apply(t,r);function i(e){h(o,n,a,i,s,"next",e)}function s(e){h(o,n,a,i,s,"throw",e)}i(void 0)})}}function y(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(n.key),n)}}function b(e,t,r){return t&&y(e.prototype,t),r&&y(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function v(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}function x(e){var t="function"==typeof Map?new Map:void 0;return(x=function(e){if(null===e||!function(e){try{return -1!==Function.toString.call(e).indexOf("[native code]")}catch(t){return"function"==typeof e}}(e))return e;if("function"!=typeof e)throw TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,r)}function r(){return function(e,t,r){if(w())return Reflect.construct.apply(null,arguments);var n=[null];n.push.apply(n,t);var a=new(e.bind.apply(e,n));return r&&S(a,r.prototype),a}(e,arguments,k(this).constructor)}return r.prototype=Object.create(e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),S(r,e)})(e)}function w(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(w=function(){return!!e})()}function S(e,t){return(S=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function k(e){return(k=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var E=void 0!==globalThis.MSCORE_SCRIPT_URL?globalThis.MSCORE_SCRIPT_URL:(n="","u">typeof document?n=document.currentScript&&document.currentScript.src||document.baseURI:"u">typeof location&&(n=location.href),n),_=function(e){function t(e){var r,n;return v(this,t),n=k(n=t),(r=function(e,t){if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw TypeError("Derived constructors may only return object or undefined");var r=e;if(void 0===r)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return r}(this,w()?Reflect.construct(n,[],k(this).constructor):n.apply(this,void 0))).name=e.name,r.message=e.message,r.originalStack=e.stack,r}if("function"!=typeof e&&null!==e)throw TypeError("Super expression must either be null or a function");return t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&S(t,e),b(t)}(x(Error)),T=0,j=function(){var e,t,r,n,a,o,i,s;function l(){v(this,l);var e=URL.createObjectURL(new Blob(['(function () { var MSCORE_SCRIPT_URL = "'.concat(E,'";')+"var $RefreshSig$ = () => (type) => type; var $RefreshReg$ = () => {};("+c.toString()+")();"+'var MSCORE_LIB_WASM = "'.concat("webmscore.lib.wasm",'", MSCORE_LIB_DATA = "').concat("webmscore.lib.data",'", MSCORE_LIB_MEM = "').concat("webmscore.lib.mem.wasm",'", MSCORE_BASEURL = "').concat(document.baseURI,'";')+"("+u.toString()+")()})()"]));this.worker=new Worker(e),this.workerURL=e}return b(l,[{key:"rpc",value:(e=g(m().m(function e(t){var r,n,a,o=this,i=arguments;return m().w(function(e){for(;;)if(0===e.n)return r=i.length>1&&void 0!==i[1]?i[1]:[],n=i.length>2&&void 0!==i[2]?i[2]:[],a=Math.random(),e.a(2,new Promise(function(e,i){var s=function(t){var r=t.data;r.id===a&&(r.error&&i(new _(r.error)),o.worker.removeEventListener("message",s),e(r.result))};o.worker.addEventListener("message",s),o.worker.postMessage({id:a,method:t,params:r},n)}))},e)})),function(t){return e.apply(this,arguments)})},{key:"setExcerptId",value:function(e){return this.rpc("setExcerptId",[e])}},{key:"getExcerptId",value:function(){return this.rpc("getExcerptId")}},{key:"generateExcerpts",value:function(){return this.rpc("generateExcerpts")}},{key:"title",value:function(){return this.rpc("title")}},{key:"subtitle",value:function(){return this.rpc("subtitle")}},{key:"titleFilenameSafe",value:function(){return this.rpc("titleFilenameSafe")}},{key:"setTitleText",value:function(e){return this.rpc("setTitleText",[e])}},{key:"setSubtitleText",value:function(e){return this.rpc("setSubtitleText",[e])}},{key:"setComposerText",value:function(e){return this.rpc("setComposerText",[e])}},{key:"setLyricistText",value:function(e){return this.rpc("setLyricistText",[e])}},{key:"setSelectedText",value:function(e){return this.rpc("setSelectedText",[e])}},{key:"appendPart",value:function(e){return this.rpc("appendPart",[e])}},{key:"appendPartByMusicXmlId",value:function(e){return this.rpc("appendPartByMusicXmlId",[e])}},{key:"removePart",value:function(e){return this.rpc("removePart",[e])}},{key:"setPartVisible",value:function(e,t){return this.rpc("setPartVisible",[e,t])}},{key:"listInstrumentTemplates",value:function(){return this.rpc("listInstrumentTemplates")}},{key:"npages",value:function(){return this.rpc("npages")}},{key:"measureSignatureCount",value:function(e){return this.rpc("measureSignatureCount",[e])}},{key:"measureSignatureAt",value:function(e,t){return this.rpc("measureSignatureAt",[e,t])}},{key:"measureSignatures",value:function(e){return this.rpc("measureSignatures",[e])}},{key:"measureLineBreaks",value:function(){return this.rpc("measureLineBreaks")}},{key:"setMeasureLineBreaks",value:function(e){return this.rpc("setMeasureLineBreaks",[e])}},{key:"metadata",value:function(){return this.rpc("metadata")}},{key:"measurePositions",value:function(){return this.rpc("measurePositions")}},{key:"segmentPositions",value:function(){return this.rpc("segmentPositions")}},{key:"saveXml",value:function(){return this.rpc("saveXml")}},{key:"saveMxl",value:function(){return this.rpc("saveMxl")}},{key:"saveMsc",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"mscz";return this.rpc("saveMsc",[e])}},{key:"saveSvg",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return this.rpc("saveSvg",[e,t,r])}},{key:"savePng",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=!(arguments.length>2)||void 0===arguments[2]||arguments[2];return this.rpc("savePng",[e,t,r])}},{key:"savePdf",value:function(){return this.rpc("savePdf")}},{key:"saveMidi",value:function(){var e=!(arguments.length>0)||void 0===arguments[0]||arguments[0],t=!(arguments.length>1)||void 0===arguments[1]||arguments[1];return this.rpc("saveMidi",[e,t])}},{key:"setSoundFont",value:function(e){return this.rpc("setSoundFont",[e],[e.buffer])}},{key:"saveAudio",value:function(e){return this.rpc("saveAudio",[e])}},{key:"savePositions",value:function(e){return this.rpc("savePositions",[e])}},{key:"synthAudio",value:(t=g(m().m(function e(){var t,r,n=this,a=arguments;return m().w(function(e){for(;;)switch(e.n){case 0:return t=a.length>0&&void 0!==a[0]?a[0]:0,e.n=1,this.rpc("_synthAudio",[t]);case 1:return r=e.v,e.a(2,function(e){return n.rpc("processSynth",[r,e])})}},e,this)})),function(){return t.apply(this,arguments)})},{key:"synthAudioBatch",value:(r=g(m().m(function e(t,r){var n,a=this;return m().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,this.rpc("_synthAudio",[t]);case 1:return n=e.v,e.a(2,function(e){return a.rpc("processSynthBatch",[n,r,e])})}},e,this)})),function(e,t){return r.apply(this,arguments)})},{key:"synthAudioBatchFromSelection",value:(n=g(m().m(function e(t){var r,n=this;return m().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,this.rpc("_synthAudioFromSelection");case 1:return r=e.v,e.a(2,function(e){return n.rpc("processSynthBatch",[r,t,e])})}},e,this)})),function(e){return n.apply(this,arguments)})},{key:"synthSelectionPreviewBatch",value:(a=g(m().m(function e(t){var r,n,a=this,o=arguments;return m().w(function(e){for(;;)switch(e.n){case 0:return r=o.length>1&&void 0!==o[1]?o[1]:500,e.n=1,this.rpc("_synthAudioSelectionPreview",[r]);case 1:return n=e.v,e.a(2,function(e){return a.rpc("processSynthBatch",[n,t,e])})}},e,this)})),function(e){return a.apply(this,arguments)})},{key:"saveMetadata",value:function(){return this.rpc("saveMetadata")}},{key:"selectElementAtPoint",value:function(e,t,r){return this.rpc("selectElementAtPoint",[e,t,r])}},{key:"selectMeasureAtPoint",value:function(e,t,r){return this.rpc("selectMeasureAtPoint",[e,t,r])}},{key:"selectPartMeasureByIndex",value:function(e,t){return this.rpc("selectPartMeasureByIndex",[e,t])}},{key:"selectTextElementAtPoint",value:function(e,t,r){return this.rpc("selectTextElementAtPoint",[e,t,r])}},{key:"clearSelection",value:function(){return this.rpc("clearSelection")}},{key:"selectNextChord",value:function(){return this.rpc("selectNextChord")}},{key:"selectPrevChord",value:function(){return this.rpc("selectPrevChord")}},{key:"extendSelectionNextChord",value:function(){return this.rpc("extendSelectionNextChord")}},{key:"extendSelectionPrevChord",value:function(){return this.rpc("extendSelectionPrevChord")}},{key:"getSelectionBoundingBox",value:function(){return this.rpc("getSelectionBoundingBox")}},{key:"getSelectionBoundingBoxes",value:function(){return this.rpc("getSelectionBoundingBoxes")}},{key:"selectionMimeType",value:function(){return this.rpc("selectionMimeType")}},{key:"selectionMimeData",value:function(){return this.rpc("selectionMimeData")}},{key:"pasteSelection",value:function(e,t){return this.rpc("pasteSelection",[e,t])}},{key:"selectElementAtPointWithMode",value:function(e,t,r,n){return this.rpc("selectElementAtPointWithMode",[e,t,r,n])}},{key:"deleteSelection",value:function(){return this.rpc("deleteSelection")}},{key:"pitchUp",value:function(){return this.rpc("pitchUp")}},{key:"pitchDown",value:function(){return this.rpc("pitchDown")}},{key:"transpose",value:function(e){return this.rpc("transpose",[e])}},{key:"setAccidental",value:function(e){return this.rpc("setAccidental",[e])}},{key:"doubleDuration",value:function(){return this.rpc("doubleDuration")}},{key:"halfDuration",value:function(){return this.rpc("halfDuration")}},{key:"toggleDot",value:function(){return this.rpc("toggleDot")}},{key:"toggleDoubleDot",value:function(){return this.rpc("toggleDoubleDot")}},{key:"setNoteEntryMode",value:function(e){return this.rpc("setNoteEntryMode",[+!!e])}},{key:"setNoteEntryMethod",value:function(e){return this.rpc("setNoteEntryMethod",[e])}},{key:"setInputStateFromSelection",value:function(){return this.rpc("setInputStateFromSelection")}},{key:"setInputAccidentalType",value:function(e){return this.rpc("setInputAccidentalType",[e])}},{key:"setInputDurationType",value:function(e){return this.rpc("setInputDurationType",[e])}},{key:"toggleInputDot",value:function(){return this.rpc("toggleInputDot")}},{key:"addPitchByStep",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return this.rpc("addPitchByStep",[e,+!!t,+!!r])}},{key:"enterRest",value:function(){return this.rpc("enterRest")}},{key:"setDurationType",value:function(e){return this.rpc("setDurationType",[e])}},{key:"toggleLineBreak",value:function(){return this.rpc("toggleLineBreak")}},{key:"togglePageBreak",value:function(){return this.rpc("togglePageBreak")}},{key:"setVoice",value:function(e){return this.rpc("setVoice",[e])}},{key:"changeSelectedElementsVoice",value:function(e){return this.rpc("changeSelectedElementsVoice",[e])}},{key:"addDynamic",value:function(e){return this.rpc("addDynamic",[e])}},{key:"addHairpin",value:function(e){return this.rpc("addHairpin",[e])}},{key:"addPedal",value:function(e){return this.rpc("addPedal",[e])}},{key:"addSostenutoPedal",value:function(){return this.rpc("addSostenutoPedal")}},{key:"addUnaCorda",value:function(){return this.rpc("addUnaCorda")}},{key:"splitPedal",value:function(){return this.rpc("splitPedal")}},{key:"addRehearsalMark",value:function(){return this.rpc("addRehearsalMark")}},{key:"addTempoText",value:function(e){return this.rpc("addTempoText",[e])}},{key:"addStaffText",value:function(e){return this.rpc("addStaffText",[e])}},{key:"addSystemText",value:function(e){return this.rpc("addSystemText",[e])}},{key:"addExpressionText",value:function(e){return this.rpc("addExpressionText",[e])}},{key:"addLyricText",value:function(e){return this.rpc("addLyricText",[e])}},{key:"addHarmonyText",value:function(e,t){return this.rpc("addHarmonyText",[e,t])}},{key:"addFingeringText",value:function(e){return this.rpc("addFingeringText",[e])}},{key:"addLeftHandGuitarFingeringText",value:function(e){return this.rpc("addLeftHandGuitarFingeringText",[e])}},{key:"addRightHandGuitarFingeringText",value:function(e){return this.rpc("addRightHandGuitarFingeringText",[e])}},{key:"addStringNumberText",value:function(e){return this.rpc("addStringNumberText",[e])}},{key:"addInstrumentChangeText",value:function(e){return this.rpc("addInstrumentChangeText",[e])}},{key:"addStickingText",value:function(e){return this.rpc("addStickingText",[e])}},{key:"addFiguredBassText",value:function(e){return this.rpc("addFiguredBassText",[e])}},{key:"addArticulation",value:function(e){return this.rpc("addArticulation",[e])}},{key:"addSlur",value:function(){return this.rpc("addSlur")}},{key:"addTie",value:function(){return this.rpc("addTie")}},{key:"addGraceNote",value:function(e){return this.rpc("addGraceNote",[e])}},{key:"addTuplet",value:function(e){return this.rpc("addTuplet",[e])}},{key:"addNoteFromRest",value:function(){return this.rpc("addNoteFromRest")}},{key:"toggleRepeatStart",value:function(){return this.rpc("toggleRepeatStart")}},{key:"toggleRepeatEnd",value:function(){return this.rpc("toggleRepeatEnd")}},{key:"setRepeatCount",value:function(e){return this.rpc("setRepeatCount",[e])}},{key:"setBarLineType",value:function(e){return this.rpc("setBarLineType",[e])}},{key:"addVolta",value:function(e){return this.rpc("addVolta",[e])}},{key:"insertMeasures",value:function(e,t){return this.rpc("insertMeasures",[e,t])}},{key:"removeTrailingEmptyMeasures",value:function(){return this.rpc("removeTrailingEmptyMeasures")}},{key:"removeSelectedMeasures",value:function(){return this.rpc("removeSelectedMeasures")}},{key:"undo",value:function(){return this.rpc("undo")}},{key:"redo",value:function(){return this.rpc("redo")}},{key:"relayout",value:function(){return this.rpc("relayout")}},{key:"setLayoutMode",value:function(e){return this.rpc("setLayoutMode",[e])}},{key:"getLayoutMode",value:function(){return this.rpc("getLayoutMode")}},{key:"setTimeSignature",value:function(e,t){return this.rpc("setTimeSignature",[e,t])}},{key:"setTimeSignatureWithType",value:function(e,t,r){return this.rpc("setTimeSignatureWithType",[e,t,r])}},{key:"setKeySignature",value:function(e){return this.rpc("setKeySignature",[e])}},{key:"getKeySignature",value:function(){return this.rpc("getKeySignature")}},{key:"setClef",value:function(e){return this.rpc("setClef",[e])}},{key:"destroy",value:function(){var e=!(arguments.length>0)||void 0===arguments[0]||arguments[0];e?this.rpc("destroy",[e]):(this.worker.terminate(),URL.revokeObjectURL(this.workerURL))}}],[{key:"ready",get:function(){return Promise.resolve()}},{key:"version",value:(o=g(m().m(function e(){return m().w(function(e){for(;;)if(0===e.n)return e.a(2,-1)},e)})),function(){return o.apply(this,arguments)})},{key:"setLogLevel",value:(i=g(m().m(function e(t){return m().w(function(e){for(;;)switch(e.n){case 0:T=t;case 1:return e.a(2)}},e)})),function(e){return i.apply(this,arguments)})},{key:"load",value:(s=g(m().m(function e(t,r){var n,a,o,i,s=arguments;return m().w(function(e){for(var u,c;;)switch(e.n){case 0:return n=s.length>2&&void 0!==s[2]?s[2]:[],a=!(s.length>3)||void 0===s[3]||s[3],o=new l,e.n=1,Promise.all([n,o.rpc("ready")]);case 1:return i=(function(e){if(Array.isArray(e))return e}(u=e.v)||function(e,t){var r=null==e?null:"u">typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,a,o,i,s=[],l=!0,u=!1;try{o=(r=r.call(e)).next,!1;for(;!(l=(n=o.call(r)).done)&&(s.push(n.value),1!==s.length);l=!0);}catch(e){u=!0,a=e}finally{try{if(!l&&null!=r.return&&(i=r.return(),Object(i)!==i))return}finally{if(u)throw a}}return s}}(u,1)||d(u,1)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}())[0],e.n=2,o.rpc("setLogLevel",[T]);case 2:return e.n=3,o.rpc("load",[t,r,i,a],[r.buffer].concat(function(e){if(Array.isArray(e))return f(e)}(c=i.map(function(e){return e.buffer}))||function(e){if("u">typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(c)||d(c)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()));case 3:return e.a(2,o)}},e)})),function(e,t){return s.apply(this,arguments)})}])}();let A=!1,C=async()=>(A||(await j.ready,A=!0),j),M="checkpoints",N=()=>new Promise((e,t)=>{if(!("u">typeof indexedDB))return void t(Error("IndexedDB is not available in this environment."));let r=indexedDB.open("ots-web",2);r.onupgradeneeded=()=>{let e,t=r.result;(e=t.objectStoreNames.contains(M)?r.transaction?.objectStore(M):t.createObjectStore(M,{keyPath:"id",autoIncrement:!0})).indexNames.contains("createdAt")||e.createIndex("createdAt","createdAt"),e.indexNames.contains("scoreId")||e.createIndex("scoreId","scoreId")},r.onsuccess=()=>e(r.result),r.onerror=()=>t(r.error??Error("Failed to open IndexedDB."))}),P=async e=>{let t=await N();return new Promise((r,n)=>{let a=t.transaction(M,"readwrite"),o=a.objectStore(M).add(e);o.onsuccess=()=>r(o.result),o.onerror=()=>n(o.error??Error("Failed to save checkpoint.")),a.oncomplete=()=>t.close(),a.onerror=()=>t.close(),a.onabort=()=>t.close()})},I=async e=>{let t=await N();return new Promise((r,n)=>{let a=t.transaction(M,e?"readwrite":"readonly"),o=a.objectStore(M),i=o.getAll();i.onsuccess=()=>{let t=i.result.filter(Boolean);e&&t.filter(e=>!e.scoreId).forEach(t=>{o.put({...t,scoreId:e})});let n=(e?t.filter(t=>(t.scoreId??e)===e):t).map(e=>({id:e.id,scoreId:e.scoreId,title:e.title,createdAt:e.createdAt,format:e.format,size:e.size}));n.sort((e,t)=>t.createdAt-e.createdAt),r(n)},i.onerror=()=>n(i.error??Error("Failed to read checkpoints.")),a.oncomplete=()=>t.close(),a.onerror=()=>t.close(),a.onabort=()=>t.close()})},F=async e=>{let t=await N();return new Promise((r,n)=>{let a=t.transaction(M,"readonly"),o=a.objectStore(M).get(e);o.onsuccess=()=>r(o.result??null),o.onerror=()=>n(o.error??Error("Failed to load checkpoint.")),a.oncomplete=()=>t.close(),a.onerror=()=>t.close(),a.onabort=()=>t.close()})},D=async e=>{let t=await N();return new Promise((r,n)=>{let a=t.transaction(M,"readwrite"),o=a.objectStore(M).delete(e);o.onsuccess=()=>r(),o.onerror=()=>n(o.error??Error("Failed to delete checkpoint.")),a.oncomplete=()=>t.close(),a.onerror=()=>t.close(),a.onabort=()=>t.close()})},L=async()=>{let e=await N();return new Promise((t,r)=>{let n=e.transaction(M,"readonly"),a=n.objectStore(M).getAll();a.onsuccess=()=>{let e=a.result.filter(Boolean),r=new Map;for(let t of e){let e=t.scoreId??"legacy",n=r.get(e);n?(n.count+=1,t.createdAt>n.lastUpdated&&(n.lastUpdated=t.createdAt,n.title=t.title)):r.set(e,{scoreId:e,title:t.title,lastUpdated:t.createdAt,count:1})}t(Array.from(r.values()).sort((e,t)=>t.lastUpdated-e.lastUpdated))},a.onerror=()=>r(a.error??Error("Failed to read score summaries.")),n.oncomplete=()=>e.close(),n.onerror=()=>e.close(),n.onabort=()=>e.close()})};var R=r(9561),B=r(7071),O=r(6732),U=r(9873),z=r(7482),X=r(5460),$=r(6252);let W=R.Lz.theme({"&":{height:"var(--cm-height, 80vh)",maxHeight:"var(--cm-max-height, none)",backgroundColor:"#ffffff"},"&.cm-editor.cm-focused":{outline:"1px solid #3b82f6"},".cm-scroller":{fontFamily:'ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace',fontSize:"12px",overflowX:"auto"}}),H=R.Lz.theme({"&":{backgroundColor:"#f3f4f6"},".cm-content":{color:"#9ca3af"}}),G=(0,U.bu)(e=>(e=>{if("u"<typeof DOMParser)return[];let t=[],r=new DOMParser().parseFromString(e,"application/xml"),n=r.querySelector("parsererror");if(n){let r=n.textContent?.trim()||"Invalid XML.";return t.push({from:0,to:Math.min(1,e.length),severity:"error",message:r}),t}let a=r.documentElement;if(!a)return t.push({from:0,to:Math.min(1,e.length),severity:"error",message:"XML document is empty."}),t;let o=a.localName||a.nodeName;return"score-partwise"!==o&&"score-timewise"!==o?t.push({from:0,to:Math.min(1,e.length),severity:"warning",message:"Root element is not a MusicXML score."}):(r.querySelector("part-list")||t.push({from:0,to:Math.min(1,e.length),severity:"warning",message:"Missing <part-list> element."}),r.querySelector("part")||t.push({from:0,to:Math.min(1,e.length),severity:"warning",message:"No <part> elements found."})),t})(e.state.doc.toString())),q=(0,U.bu)(e=>(e=>{if(!e.trim())return[];try{return JSON.parse(e),[]}catch(o){let t=o instanceof Error?o.message:"Invalid JSON.",r=t.match(/position (\d+)/i),n=r?Number(r[1]):0,a=Number.isFinite(n)?Math.max(0,Math.min(n,e.length)):0;return[{from:a,to:Math.min(a+1,e.length),severity:"error",message:t}]}})(e.state.doc.toString())),V=({value:e,onChange:t,readOnly:r=!1,placeholderText:n,testId:i,className:s,language:l="xml",lint:u=!0,height:c,maxHeight:d})=>{let f=(0,o.useRef)(null),m=(0,o.useRef)(null),p=(0,o.useRef)(t),h=(0,o.useRef)(new B.xx),g=(0,o.useRef)(!1);(0,o.useEffect)(()=>{p.current=t},[t]);let y=()=>{let e=[B.$t.readOnly.of(r),R.Lz.editable.of(!r)];return n&&e.push((0,R.qf)(n)),r&&e.push(H),"xml"===l?(e.push((0,z._n)()),u&&e.push(G,(0,U.pJ)())):"json"===l&&(e.push((0,X.Pq)()),u&&e.push(q,(0,U.pJ)())),e};return(0,o.useEffect)(()=>{if(!f.current||m.current)return;let t=B.$t.create({doc:e,extensions:[$.oQ,(0,O.Lv)(),R.w4.of(O.f7),(0,O.y9)(O.Zt,{fallback:!0}),W,R.Lz.updateListener.of(e=>{if(e.docChanged){if(g.current)return;let t=e.state.doc.toString();p.current(t)}}),h.current.of(y())]});return m.current=new R.Lz({state:t,parent:f.current}),()=>{m.current?.destroy(),m.current=null}},[]),(0,o.useEffect)(()=>{let t=m.current;if(!t)return;let r=t.state.doc.toString();e!==r&&(g.current=!0,t.dispatch({changes:{from:0,to:r.length,insert:e}}),g.current=!1)},[e]),(0,o.useEffect)(()=>{let e=m.current;e&&e.dispatch({effects:h.current.reconfigure(y())})},[r,n,l,u]),(0,a.jsx)("div",{ref:f,"data-testid":i,className:`w-full rounded border border-gray-300 ${s??""}`,style:{"--cm-height":c??void 0,"--cm-max-height":d??void 0}})};var Y=r(5291);let K=(...e)=>e.filter(Boolean).join(" "),Z=Y.bL,Q=Y.l9;Y.ZL;let J=o.forwardRef(({className:e,sideOffset:t=6,align:r="start",...n},o)=>(0,a.jsx)(Y.UC,{ref:o,sideOffset:t,align:r,className:K("z-50 min-w-[14rem] rounded border border-gray-200 bg-white p-2 shadow-lg outline-none",e),...n}));J.displayName=Y.UC.displayName;let ee=o.forwardRef(({className:e,...t},r)=>(0,a.jsx)(Y.JU,{ref:r,className:K("px-2 py-1 text-[10px] uppercase tracking-wide text-gray-500",e),...t}));ee.displayName=Y.JU.displayName,o.forwardRef(({className:e,...t},r)=>(0,a.jsx)(Y.wv,{ref:r,className:K("my-1 h-px bg-gray-200",e),...t})).displayName=Y.wv.displayName;let et=o.forwardRef(({className:e,...t},r)=>(0,a.jsx)(Y.q7,{ref:r,className:K("flex cursor-pointer select-none items-center rounded px-3 py-1 text-xs text-blue-700 outline-none data-[highlighted]:bg-blue-50 data-[highlighted]:text-blue-900 data-[disabled]:pointer-events-none data-[disabled]:text-slate-600",e),...t}));et.displayName=Y.q7.displayName;var er=r(3332);let en=er.bL,ea=er.YJ,eo=er.WT,ei=o.forwardRef(({className:e,...t},r)=>(0,a.jsx)(er.JU,{ref:r,className:K("px-2 py-1 text-[10px] uppercase tracking-wide text-gray-500",e),...t}));ei.displayName=er.JU.displayName;let es=o.forwardRef(({className:e,children:t,...r},n)=>(0,a.jsxs)(er.l9,{ref:n,className:K("flex items-center justify-between rounded border border-gray-300 bg-white px-2 py-1 text-xs text-gray-700 shadow-sm transition focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:cursor-not-allowed disabled:bg-slate-200 disabled:text-slate-600",e),...r,children:[t,(0,a.jsx)(er.In,{className:"ml-2 text-[10px] text-gray-400",children:"v"})]}));es.displayName=er.l9.displayName;let el=o.forwardRef(({className:e,children:t,position:r="popper",sideOffset:n=6,...o},i)=>(0,a.jsx)(er.ZL,{children:(0,a.jsx)(er.UC,{ref:i,position:r,sideOffset:n,className:K("z-[200] min-w-[12rem] overflow-hidden rounded border border-gray-200 bg-white shadow-lg",e),...o,children:(0,a.jsx)(er.LM,{className:"p-2",children:t})})}));el.displayName=er.UC.displayName;let eu=o.forwardRef(({className:e,children:t,...r},n)=>(0,a.jsx)(er.q7,{ref:n,className:K("relative flex cursor-pointer select-none items-center rounded px-2 py-1 text-xs text-gray-700 outline-none data-[highlighted]:bg-blue-50 data-[highlighted]:text-blue-900 data-[disabled]:pointer-events-none data-[disabled]:text-slate-500",e),...r,children:(0,a.jsx)(er.p4,{children:t})}));eu.displayName=er.q7.displayName,o.forwardRef(({className:e,...t},r)=>(0,a.jsx)(er.wv,{ref:r,className:K("my-1 h-px bg-gray-200",e),...t})).displayName=er.wv.displayName;var ec=r(2442);let ed={primary:"bg-blue-600 text-white border-blue-600 hover:bg-blue-700",secondary:"bg-blue-600 text-white border-blue-600 hover:bg-blue-700",outline:"bg-white text-blue-700 border-blue-600 hover:bg-blue-50",ghost:"bg-transparent text-blue-700 border-transparent hover:bg-blue-50",danger:"bg-red-600 text-white border-red-600 hover:bg-red-700"},ef={xs:"px-2 py-0.5 text-[11px] sm:text-xs",sm:"px-2 py-1 text-xs sm:text-sm",md:"px-3 py-2 text-sm"},em=o.forwardRef(({asChild:e,className:t,variant:r="outline",size:n="sm",type:o,...i},s)=>{let l=e?ec.DX:"button";return(0,a.jsx)(l,{ref:s,type:e?void 0:o??"button",className:K("inline-flex items-center justify-center rounded border font-medium transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-blue-500 focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:bg-slate-200 disabled:text-slate-700 disabled:border-slate-300 disabled:opacity-100",ed[r],ef[n],t),...i})});em.displayName="Button";var ep=r(9820);let eh=ep.bL,eg=ep.l9,ey=ep.UC,eb="rounded border border-gray-300 bg-white px-2 py-1 text-xs sm:text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:bg-gray-100 disabled:text-gray-500 disabled:border-gray-200 disabled:cursor-not-allowed",ev=e=>{if(e&&"clientX"in e&&"number"==typeof e.clientX&&"number"==typeof e.clientY)return{clientX:e.clientX,clientY:e.clientY};let t=e?.currentTarget;if(t?.getBoundingClientRect){let e=t.getBoundingClientRect();return{clientX:e.left+e.width/2,clientY:e.top+e.height/2}}return{clientX:window.innerWidth/2,clientY:window.innerHeight/2}},ex=({label:e,disabled:t=!1,children:r,testId:n,triggerClassName:i,triggerVariant:s="secondary"})=>{let[l,u]=(0,o.useState)(!1);return(0,o.useEffect)(()=>{t&&u(!1)},[t]),(0,a.jsxs)(Z,{open:l,onOpenChange:u,modal:!1,children:[(0,a.jsx)(Q,{asChild:!0,children:(0,a.jsx)(em,{"data-testid":n,variant:s,size:"sm",className:i,disabled:t,"aria-expanded":l,children:e})}),!t&&(0,a.jsx)(J,{children:r})]})},ew=({onNewScore:e,onFileUpload:t,onZoomIn:r,onZoomOut:n,onFitWidth:i,onFitHeight:s,zoomLevel:l,onDeleteSelection:u,onUndo:c,onRedo:d,onPitchUp:f,onPitchDown:m,onDurationLonger:p,onDurationShorter:h,onTranspose:g,onSetAccidental:y,mutationsEnabled:b=!1,selectionActive:v=!1,onExportSvg:x,onExportPdf:w,onExportPng:S,onExportMxl:k,onExportMscz:E,onExportMidi:_,onExportAudio:T,onSoundFontUpload:j,exportsEnabled:A=!1,pngAvailable:C=!1,audioAvailable:M=!1,onPlayAudio:N,onPlayFromSelectionAudio:P,onStopAudio:I,isPlaying:F=!1,audioBusy:D=!1,onSetTimeSignature:L,timeSignatureOptions:R,onSetTimeSignature44:B,onSetTimeSignature34:O,onSetKeySignature:U,keySignatureOptions:z,onSetClef:X,clefOptions:$,onToggleDot:W,onToggleDoubleDot:H,onSetDurationType:G,onToggleLineBreak:q,onTogglePageBreak:V,onSetVoice:Y,onAddDynamic:K,onAddHairpin:Z,onAddPedal:Q,onAddSostenutoPedal:J,onAddUnaCorda:er,onSplitPedal:ec,onAddTempoText:ed,onAddStaffText:ef,onAddSystemText:ep,onAddExpressionText:ew,onAddLyricText:eS,onAddHarmonyText:ek,onAddFingeringText:eE,onAddLeftHandGuitarFingeringText:e_,onAddRightHandGuitarFingeringText:eT,onAddStringNumberText:ej,onAddInstrumentChangeText:eA,onAddStickingText:eC,onAddFiguredBassText:eM,onAddArticulation:eN,onAddSlur:eP,onAddTie:eI,onAddGraceNote:eF,onAddTuplet:eD,onAddNoteFromRest:eL,onToggleRepeatStart:eR,onToggleRepeatEnd:eB,onSetRepeatCount:eO,onSetBarLineType:eU,onAddVolta:ez,onInsertMeasures:eX,onRemoveContainingMeasures:e$,onRemoveTrailingEmptyMeasures:eW,insertMeasuresDisabled:eH=!1,parts:eG=[],instrumentGroups:eq=[],onAddPart:eV,onRemovePart:eY,onTogglePartVisible:eK,onOpenHeaderEditor:eZ})=>{let[eQ,eJ]=(0,o.useState)(""),[e0,e1]=(0,o.useState)("4"),[e2,e4]=(0,o.useState)(1),[e8,e3]=(0,o.useState)("after-selection"),[e5,e6]=(0,o.useState)("120"),[e7,e9]=(0,o.useState)(!1),te=()=>{if(!ed)return;let e=e5.trim();if(!e)return;let t=Number(e),r=Number.isFinite(t)?Math.max(1,Math.floor(t)):120;e6(String(r)),ed(r)},[tt,tr]=(0,o.useState)("4");(0,o.useEffect)(()=>{window.innerWidth<1024&&e9(!0)},[]);let tn=!b,ta=eH||!eX||tn,to=tn||!v&&!eZ,ti=eq.flatMap(e=>e.instruments.map(t=>({...t,groupName:t.groupName??e.name,groupId:t.groupId??e.id}))),ts=(0,o.useMemo)(()=>[{key:"piano",ids:["piano"]},{key:"violin",ids:["violin"]},{key:"viola",ids:["viola"]},{key:"cello",ids:["violoncello","cello"]},{key:"double-bass",ids:["double-bass","contrabass"],label:"Double Bass"},{key:"flute",ids:["flute"]},{key:"oboe",ids:["oboe"]},{key:"clarinet",ids:["clarinet"],label:"Clarinet"},{key:"bassoon",ids:["bassoon"]},{key:"trumpet",ids:["trumpet"],label:"Trumpet"},{key:"horn",ids:["horn"]},{key:"trombone",ids:["trombone"]},{key:"tuba",ids:["tuba"]},{key:"alto-saxophone",ids:["alto-saxophone"]},{key:"tenor-saxophone",ids:["tenor-saxophone"]},{key:"bass-guitar",ids:["bass-guitar"]},{key:"guitar",ids:["guitar-nylon","guitar-steel"]},{key:"voice",ids:["voice"]},{key:"drumset",ids:["drumset"]}],[]),tl=(0,o.useMemo)(()=>{let e=[],t=new Set;for(let r of ts){let n=r.ids.map(e=>ti.find(t=>t.id===e)).find(Boolean);n&&!t.has(n.id)&&(t.add(n.id),e.push({instrument:n,label:r.label??n.name}))}return e},[ts,ti]),tu=ti.length>0,tc=eQ||(tu?ti[0].id:""),td=!tn&&!!eV&&tu,tf=!tn&&!!eK,tm=!tn&&!!eY,tp=!tn&&!!L,th=Number.parseInt(e0,10),tg=Number.parseInt(tt,10),ty=Number.isInteger(th)&&Number.isInteger(tg)&&th>0&&tg>0;return(0,a.jsx)(eh,{open:!e7,onOpenChange:e=>e9(!e),children:(0,a.jsxs)("div",{className:"relative flex flex-col border-b border-gray-300 bg-gray-100 p-2 sm:p-3 lg:p-4 overflow-visible",style:{zIndex:100},children:[(0,a.jsxs)("div",{className:"flex items-center justify-between gap-2",children:[(0,a.jsx)("span",{className:"text-[10px] sm:text-xs font-semibold uppercase tracking-wide text-gray-500",children:"Toolbar"}),(0,a.jsx)(eg,{asChild:!0,children:(0,a.jsx)(em,{"aria-expanded":!e7,"aria-controls":"toolbar-content",variant:"secondary",size:"sm",children:e7?"Show tools":"Hide tools"})})]}),(0,a.jsxs)(ey,{id:"toolbar-content",className:"flex flex-col gap-3 sm:gap-4",children:[(0,a.jsxs)("div",{className:"flex flex-wrap items-center gap-2 sm:gap-4",children:[(0,a.jsxs)("div",{className:"flex flex-wrap items-center gap-2 sm:gap-4",children:[(0,a.jsx)(em,{onClick:e,variant:"primary",size:"sm",disabled:!e,children:"New Score"}),(0,a.jsx)(em,{asChild:!0,variant:"primary",size:"sm",children:(0,a.jsxs)("label",{className:"cursor-pointer",children:["Load Score",(0,a.jsx)("input",{"data-testid":"open-score-input",type:"file",accept:".mscz,.xml,.musicxml",onChange:e=>{let r=e.target.files?.[0];r&&t(r)},className:"hidden"})]})}),(0,a.jsxs)(ex,{label:"Export",disabled:!A,testId:"dropdown-export",triggerVariant:"primary",children:[(0,a.jsx)(et,{"data-testid":"btn-export-svg",disabled:!A||!x,onSelect:()=>x?.(),children:"SVG"}),(0,a.jsx)(et,{"data-testid":"btn-export-pdf",disabled:!A||!w,onSelect:()=>w?.(),children:"PDF"}),(0,a.jsx)(et,{"data-testid":"btn-export-png",disabled:!A||!S||!C,onSelect:()=>S?.(),children:"PNG"}),(0,a.jsx)(et,{"data-testid":"btn-export-mxl",disabled:!A||!k,onSelect:()=>k?.(),children:"MXL"}),(0,a.jsx)(et,{"data-testid":"btn-export-mscz",disabled:!A||!E,onSelect:()=>E?.(),children:"MSCZ"}),(0,a.jsx)(et,{"data-testid":"btn-export-midi",disabled:!A||!_,onSelect:()=>_?.(),children:"MIDI"}),(0,a.jsx)(et,{"data-testid":"btn-export-audio",disabled:!A||!T||!M||D,onSelect:()=>T?.(),children:D?"Exporting":"WAV"})]}),(0,a.jsx)(em,{asChild:!0,variant:"secondary",size:"sm",children:(0,a.jsxs)("label",{className:"cursor-pointer",children:["Load SoundFont",(0,a.jsx)("input",{"data-testid":"soundfont-input",type:"file",accept:".sf2,.sf3",onChange:e=>{let t=e.target.files?.[0];t&&j&&j(t)},className:"hidden"})]})})]}),(0,a.jsxs)("div",{className:"ml-auto flex items-center gap-2",children:[(0,a.jsx)(em,{"data-testid":"btn-fit-width",onClick:i,disabled:!i,variant:"secondary",size:"sm",children:"Fit W"}),(0,a.jsx)(em,{"data-testid":"btn-fit-height",onClick:s,disabled:!s,variant:"secondary",size:"sm",children:"Fit H"}),(0,a.jsx)(em,{"data-testid":"btn-zoom-out",onClick:n,variant:"secondary",size:"sm",children:"-"}),(0,a.jsxs)("span",{className:"w-14 text-center text-xs sm:text-sm text-gray-600",children:[(100*l).toFixed(0),"%"]}),(0,a.jsx)(em,{"data-testid":"btn-zoom-in",onClick:r,variant:"secondary",size:"sm",children:"+"})]})]}),(0,a.jsxs)("div",{className:"flex flex-wrap items-center gap-2 text-xs sm:text-sm",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("span",{className:"text-gray-600",children:"Playback:"}),(0,a.jsx)(em,{"data-testid":"btn-play",onClick:N,disabled:!M||!N||D,variant:"secondary",size:"sm",children:D?"Working":F?"Replay":"Play"}),(0,a.jsx)(em,{"data-testid":"btn-play-from-selection",onClick:P,disabled:!M||!P||!v||D,variant:"secondary",size:"sm",children:"From Selection"}),(0,a.jsx)(em,{"data-testid":"btn-stop",onClick:I,disabled:!M||!I,variant:"secondary",size:"sm",children:"Stop"})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("span",{className:"text-xs font-semibold uppercase tracking-wide text-gray-500",children:"Tempo"}),(0,a.jsx)("input",{"data-testid":"input-tempo-bpm",type:"number",min:1,value:e5,onChange:e=>e6(e.currentTarget.value),onKeyDown:e=>{"Enter"===e.key&&(e.preventDefault(),te())},className:`${eb} w-20`}),(0,a.jsx)(em,{"data-testid":"btn-tempo-apply",onClick:te,disabled:tn||!ed,variant:"secondary",size:"sm",children:"Tempo"})]})]}),(0,a.jsxs)("div",{className:"flex flex-wrap items-center gap-2 text-xs sm:text-sm",children:[(0,a.jsx)("span",{className:"text-xs font-semibold uppercase tracking-wide text-gray-500",children:"Add measures"}),(0,a.jsx)("input",{"data-testid":"input-measure-count",type:"number",min:1,value:e2,onChange:e=>e4(Number(e.currentTarget.value)||1),className:`${eb} w-16`}),(0,a.jsxs)("select",{"data-testid":"select-measure-target",value:e8,onChange:e=>e3(e.target.value),className:`${eb} w-40`,children:[(0,a.jsx)("option",{value:"beginning",children:"Beginning"}),(0,a.jsx)("option",{value:"after-selection",children:"After Selection"}),(0,a.jsx)("option",{value:"end",children:"End"})]}),(0,a.jsx)(em,{"data-testid":"btn-insert-measures",onClick:()=>{if(!eX)return;let e=Math.max(1,Math.floor(e2));e4(e),eX(e,e8)},disabled:ta,variant:"secondary",size:"sm",children:"Apply"}),(0,a.jsx)(em,{"data-testid":"btn-remove-containing-measures",onClick:e$,disabled:tn||!v||!e$,variant:"secondary",size:"sm",children:"Remove Containing Measures"}),(0,a.jsx)(em,{"data-testid":"btn-remove-trailing-empty",onClick:eW,disabled:tn||!eW,variant:"secondary",size:"sm",children:"Remove Trailing Empty Measures"})]}),(0,a.jsxs)("div",{className:"flex flex-wrap items-center gap-2 text-xs sm:text-sm",children:[(0,a.jsx)(ex,{label:"Time Signature",disabled:tn,testId:"dropdown-signature",children:(R??[{label:"Common time",numerator:4,denominator:4,timeSigType:1},{label:"Cut time",numerator:2,denominator:2,timeSigType:2}]).map(e=>{let t=L?()=>L(e.numerator,e.denominator,e.timeSigType):"Common time"===e.label?B:"Cut time"===e.label?O:void 0;return(0,a.jsx)(et,{"data-testid":`btn-timesig-${e.numerator}-${e.denominator}`,disabled:tn||!t,onSelect:()=>t?.(),children:e.label},e.label)})}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("span",{className:"text-gray-600",children:"Custom Time:"}),(0,a.jsx)("input",{"data-testid":"input-timesig-numerator",type:"number",min:1,value:e0,onChange:e=>e1(e.target.value),disabled:!tp,className:`${eb} w-16`}),(0,a.jsx)("span",{className:"text-gray-500",children:"/"}),(0,a.jsx)("input",{"data-testid":"input-timesig-denominator",type:"number",min:1,value:tt,onChange:e=>tr(e.target.value),disabled:!tp,className:`${eb} w-16`}),(0,a.jsx)(em,{"data-testid":"btn-timesig-custom",onClick:()=>{L&&ty&&L(th,tg)},disabled:!tp||!ty,variant:"secondary",size:"sm",children:"Apply"})]})]}),(0,a.jsxs)("div",{className:"flex flex-wrap items-center gap-2 text-xs sm:text-sm",children:[(0,a.jsxs)(ex,{label:"Instruments",disabled:!A,testId:"dropdown-instruments",children:[(0,a.jsx)(ee,{children:"Add"}),tu?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(en,{value:tc,onValueChange:e=>eJ(e),disabled:tn,children:[(0,a.jsx)(es,{"data-testid":"select-instrument-add",className:"w-full",children:(0,a.jsx)(eo,{placeholder:"Select instrument"})}),(0,a.jsxs)(el,{children:[tl.length>0&&(0,a.jsxs)(ea,{children:[(0,a.jsx)(ei,{children:"Common"}),tl.map((e,t)=>(0,a.jsx)(eu,{value:e.instrument.id,children:e.label},`common-${e.instrument.id}-${t}`))]}),eq.map(e=>(0,a.jsxs)(ea,{children:[(0,a.jsx)(ei,{children:e.name}),e.instruments.map(e=>(0,a.jsx)(eu,{value:e.id,children:e.name},e.id))]},e.id))]})]}),(0,a.jsx)(et,{disabled:!td||!tc,onSelect:()=>{tc&&eV&&eV(tc)},children:"Add Instrument"})]}):(0,a.jsx)("div",{className:"px-2 py-1 text-xs text-gray-500",children:"Instrument list unavailable."}),(0,a.jsx)(ee,{children:"On Score"}),eG.length?eG.map(e=>(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("span",{className:"flex-1 text-xs sm:text-sm truncate",children:e.name||e.instrumentName||e.instrumentId}),(0,a.jsx)(et,{"data-testid":`btn-part-visible-${e.index}`,disabled:!tf,onSelect:()=>eK?.(e.index,!e.isVisible),children:e.isVisible?"Hide":"Show"}),(0,a.jsx)(et,{"data-testid":`btn-part-remove-${e.index}`,disabled:!tm,onSelect:()=>{if(!eY)return;let t=e.name||e.instrumentName||"this part";window.confirm(`Remove ${t}?`)&&eY(e.index)},children:"Remove"})]},`${e.index}-${e.instrumentId}`)):(0,a.jsx)("div",{className:"px-2 py-1 text-xs text-gray-500",children:"No parts loaded."})]}),(0,a.jsxs)(ex,{label:"Key",disabled:tn||!U,testId:"dropdown-key",children:[(0,a.jsx)(ee,{children:"Major"}),(z??[{label:"C",fifths:0},{label:"G",fifths:1},{label:"D",fifths:2},{label:"A",fifths:3},{label:"E",fifths:4},{label:"B",fifths:5},{label:"F#",fifths:6},{label:"C#",fifths:7},{label:"F",fifths:-1},{label:"Bb",fifths:-2},{label:"Eb",fifths:-3},{label:"Ab",fifths:-4},{label:"Db",fifths:-5},{label:"Gb",fifths:-6},{label:"Cb",fifths:-7}]).map(e=>(0,a.jsx)(et,{"data-testid":`btn-keysig-${e.fifths}`,disabled:tn||!U,onSelect:()=>U?.(e.fifths),children:e.label},e.fifths))]}),(0,a.jsxs)(ex,{label:"Clef",disabled:tn||!X,testId:"dropdown-clef",children:[(0,a.jsx)(ee,{children:"Common"}),($??[{label:"Treble",value:0},{label:"Bass",value:20},{label:"French Violin",value:7},{label:"Treble 15mb",value:1},{label:"Treble 8vb",value:2},{label:"Treble 8va",value:3},{label:"Treble 15ma",value:4},{label:"Treble 8vb (O)",value:5},{label:"Treble 8vb (P)",value:6},{label:"Soprano",value:8},{label:"Mezzo",value:9},{label:"Alto",value:10},{label:"Tenor",value:11},{label:"Baritone",value:12},{label:"C (19c)",value:13},{label:"C1 (F18c)",value:14},{label:"C3 (F18c)",value:15},{label:"C4 (F18c)",value:16},{label:"C1 (F20c)",value:17},{label:"C3 (F20c)",value:18},{label:"C4 (F20c)",value:19},{label:"Bass 15mb",value:21},{label:"Bass 8vb",value:22},{label:"Bass 8va",value:23},{label:"Bass 15ma",value:24},{label:"F (B)",value:25},{label:"F (C)",value:26},{label:"F (F18c)",value:27},{label:"F (19c)",value:28},{label:"Perc",value:29},{label:"Perc 2",value:30},{label:"TAB",value:31},{label:"TAB4",value:32},{label:"TAB Serif",value:33},{label:"TAB4 Serif",value:34}]).map(e=>(0,a.jsx)(et,{"data-testid":`btn-clef-${e.value}`,disabled:tn||!X,onSelect:()=>X?.(e.value),children:e.label},e.value))]}),(0,a.jsxs)(ex,{label:"Repeats/Barlines",disabled:tn||!v,testId:"dropdown-repeats",children:[(0,a.jsx)(ee,{children:"Repeats"}),(0,a.jsx)(et,{"data-testid":"btn-repeat-start",disabled:tn||!v||!eR,onSelect:()=>eR?.(),children:"Start Repeat"}),(0,a.jsx)(et,{"data-testid":"btn-repeat-end",disabled:tn||!v||!eB,onSelect:()=>eB?.(),children:"End Repeat"}),(0,a.jsx)(ee,{children:"Repeat Count"}),[{label:"2x",count:2},{label:"3x",count:3},{label:"4x",count:4}].map(e=>(0,a.jsx)(et,{"data-testid":`btn-repeat-count-${e.count}`,disabled:tn||!v||!eO,onSelect:()=>eO?.(e.count),children:e.label},e.count)),(0,a.jsx)(ee,{children:"Barlines"}),[{label:"Normal",value:1},{label:"Double",value:2},{label:"Final",value:32},{label:"Heavy",value:512},{label:"Heavy-Heavy",value:1024},{label:"Dashed",value:16},{label:"Dotted",value:128},{label:"Reverse Final",value:256}].map(e=>(0,a.jsx)(et,{"data-testid":`btn-barline-${e.value}`,disabled:tn||!v||!eU,onSelect:()=>eU?.(e.value),children:e.label},e.value)),(0,a.jsx)(ee,{children:"Voltas"}),[{label:"1st Ending",ending:1},{label:"2nd Ending",ending:2}].map(e=>(0,a.jsx)(et,{"data-testid":`btn-volta-${e.ending}`,disabled:tn||!v||!ez,onSelect:()=>ez?.(e.ending),children:e.label},e.ending))]}),(0,a.jsx)(ex,{label:"Grace Notes",disabled:tn,testId:"dropdown-grace-notes",children:[{label:"Acciaccatura",value:1,testId:"btn-grace-acciaccatura"},{label:"Appoggiatura",value:2,testId:"btn-grace-appoggiatura"},{label:"Grace 16th",value:8,testId:"btn-grace-16"},{label:"Grace 32nd",value:16,testId:"btn-grace-32"},{label:"Grace 8th After",value:32,testId:"btn-grace-8-after"},{label:"Grace 16th After",value:64,testId:"btn-grace-16-after"},{label:"Grace 32nd After",value:128,testId:"btn-grace-32-after"}].map(e=>(0,a.jsx)(et,{"data-testid":e.testId,disabled:tn||!v||!eF,onSelect:()=>eF?.(e.value),children:e.label},e.value))}),(0,a.jsxs)(ex,{label:"Rhythm",disabled:tn,testId:"dropdown-rhythm",children:[(0,a.jsx)(ee,{children:"Notes"}),(0,a.jsx)(et,{"data-testid":"btn-add-note-dropdown",disabled:tn||!v||!eL,onSelect:()=>eL?.(),children:"Add Note"}),(0,a.jsx)(ee,{children:"Duration"}),[{label:"32nd",value:7,shortcut:"2",testId:"btn-duration-32"},{label:"16th",value:6,shortcut:"3",testId:"btn-duration-16"},{label:"8th",value:5,shortcut:"4",testId:"btn-duration-8"},{label:"Quarter",value:4,shortcut:"5",testId:"btn-duration-4"},{label:"Half",value:3,shortcut:"6",testId:"btn-duration-2"},{label:"Whole",value:2,shortcut:"7",testId:"btn-duration-1"}].map(e=>(0,a.jsx)(et,{"data-testid":e.testId,disabled:tn||!v||!G,title:`Shortcut: press ${e.shortcut} for ${e.label}`,onSelect:()=>G?.(e.value),children:e.label},e.value)),(0,a.jsx)(ee,{children:"Dots"}),(0,a.jsx)(et,{"data-testid":"btn-dot",disabled:tn||!v||!W,onSelect:()=>W?.(),children:"Dot"}),(0,a.jsx)(et,{"data-testid":"btn-double-dot",disabled:tn||!v||!H,onSelect:()=>H?.(),children:"Double Dot"}),(0,a.jsx)(ee,{children:"Tuplets"}),[{label:"Duplet",count:2},{label:"Triplet",count:3},{label:"Quintuplet",count:5},{label:"Sextuplet",count:6},{label:"Septuplet",count:7},{label:"Octuplet",count:8}].map(e=>(0,a.jsx)(et,{"data-testid":`btn-tuplet-${e.count}`,disabled:tn||!v||!eD,onSelect:()=>eD?.(e.count),children:e.label},e.count))]}),(0,a.jsx)(ex,{label:"Voice",disabled:tn,testId:"dropdown-voice",children:[1,2,3,4].map(e=>(0,a.jsxs)(et,{"data-testid":`btn-voice-${e}`,disabled:tn||!Y,onSelect:()=>Y?.(e-1),children:["Voice ",e]},e))}),(0,a.jsxs)(ex,{label:"Slur/Tie",disabled:tn||!v,testId:"dropdown-slur-tie",children:[(0,a.jsx)(et,{"data-testid":"btn-slur",disabled:tn||!v||!eP,onSelect:()=>eP?.(),children:"Slur"}),(0,a.jsx)(et,{"data-testid":"btn-tie",disabled:tn||!v||!eI,onSelect:()=>eI?.(),children:"Tie"})]}),(0,a.jsxs)(ex,{label:"Markings",disabled:tn,testId:"dropdown-markings",children:[(0,a.jsx)(ee,{children:"Dynamics"}),[{label:"p",value:6},{label:"mp",value:7},{label:"mf",value:8},{label:"f",value:9},{label:"pp",value:5},{label:"ff",value:10},{label:"ppp",value:4},{label:"fff",value:11},{label:"pppp",value:3},{label:"ffff",value:12},{label:"ppppp",value:2},{label:"fffff",value:13},{label:"pppppp",value:1},{label:"ffffff",value:14},{label:"fp",value:15},{label:"pf",value:16},{label:"sf",value:17},{label:"sfz",value:18},{label:"sff",value:19},{label:"sffz",value:20},{label:"sfp",value:21},{label:"sfpp",value:22},{label:"rfz",value:23},{label:"rf",value:24},{label:"fz",value:25},{label:"m",value:26},{label:"r",value:27},{label:"s",value:28},{label:"z",value:29},{label:"n",value:30}].map(e=>(0,a.jsx)(et,{"data-testid":`btn-dynamic-${e.value}`,disabled:tn||!v||!K,onSelect:()=>K?.(e.value),children:e.label},e.label)),(0,a.jsx)(ee,{children:"Hairpins"}),[{label:"Crescendo",value:0,testId:"btn-hairpin-cresc"},{label:"Decrescendo",value:1,testId:"btn-hairpin-decresc"}].map(e=>(0,a.jsx)(et,{"data-testid":e.testId,disabled:tn||!v||!Z,onSelect:()=>Z?.(e.value),children:e.label},e.label))]}),(0,a.jsxs)(ex,{label:"Pedal",disabled:tn,testId:"dropdown-pedal",children:[[{label:"Pedal Line",value:0,testId:"btn-pedal-line"},{label:"Ped. *",value:1,testId:"btn-pedal-text"}].map(e=>(0,a.jsx)(et,{"data-testid":e.testId,disabled:tn||!v||!Q,onSelect:()=>Q?.(e.value),children:e.label},e.label)),(0,a.jsx)(ee,{children:"Special"}),(0,a.jsx)(et,{"data-testid":"btn-pedal-sostenuto",disabled:tn||!v||!J,onSelect:()=>J?.(),children:"Sostenuto Pedal"}),(0,a.jsx)(et,{"data-testid":"btn-pedal-una-corda",disabled:tn||!v||!er,onSelect:()=>er?.(),children:"Una Corda"}),(0,a.jsx)(ee,{children:"Variants"}),(0,a.jsx)(et,{"data-testid":"btn-pedal-split",disabled:tn||!v||!ec,onSelect:()=>ec?.(),children:"Pedal Change"})]}),(0,a.jsxs)(ex,{label:"Text",disabled:to,testId:"dropdown-text",children:[(0,a.jsx)(ee,{children:"Score Header"}),(0,a.jsx)(et,{"data-testid":"btn-text-title",disabled:tn||!eZ,onSelect:e=>eZ?.("title",ev(e)),children:"Title"}),(0,a.jsx)(et,{"data-testid":"btn-text-subtitle",disabled:tn||!eZ,onSelect:e=>eZ?.("subtitle",ev(e)),children:"Subtitle"}),(0,a.jsx)(et,{"data-testid":"btn-text-composer",disabled:tn||!eZ,onSelect:e=>eZ?.("composer",ev(e)),children:"Composer"}),(0,a.jsx)(et,{"data-testid":"btn-text-lyricist",disabled:tn||!eZ,onSelect:e=>eZ?.("lyricist",ev(e)),children:"Lyricist"}),(0,a.jsx)(ee,{children:"Score Text"}),(0,a.jsx)(et,{"data-testid":"btn-text-staff",disabled:tn||!v||!ef,onSelect:()=>ef?.(),children:"Staff Text"}),(0,a.jsx)(et,{"data-testid":"btn-text-system",disabled:tn||!v||!ep,onSelect:()=>ep?.(),children:"System Text"}),(0,a.jsx)(et,{"data-testid":"btn-text-expression",disabled:tn||!v||!ew,onSelect:()=>ew?.(),children:"Expression Text"}),(0,a.jsx)(et,{"data-testid":"btn-text-lyrics",disabled:tn||!v||!eS,onSelect:()=>eS?.(),children:"Lyrics"}),(0,a.jsx)(ee,{children:"Harmony"}),(0,a.jsx)(et,{"data-testid":"btn-text-harmony-standard",disabled:tn||!v||!ek,onSelect:()=>ek?.(0),children:"Chord Symbol"}),(0,a.jsx)(et,{"data-testid":"btn-text-harmony-roman",disabled:tn||!v||!ek,onSelect:()=>ek?.(1),children:"Roman Numeral"}),(0,a.jsx)(et,{"data-testid":"btn-text-harmony-nashville",disabled:tn||!v||!ek,onSelect:()=>ek?.(2),children:"Nashville Number"}),(0,a.jsx)(ee,{children:"Figured Bass"}),(0,a.jsx)(et,{"data-testid":"btn-text-figured-bass",disabled:tn||!v||!eM,onSelect:()=>eM?.(),children:"Figured Bass"}),(0,a.jsx)(ee,{children:"Fingering"}),(0,a.jsx)(et,{"data-testid":"btn-text-fingering",disabled:tn||!v||!eE,onSelect:()=>eE?.(),children:"Fingering"}),(0,a.jsx)(et,{"data-testid":"btn-text-fingering-lh",disabled:tn||!v||!e_,onSelect:()=>e_?.(),children:"LH Guitar Fingering"}),(0,a.jsx)(et,{"data-testid":"btn-text-fingering-rh",disabled:tn||!v||!eT,onSelect:()=>eT?.(),children:"RH Guitar Fingering"}),(0,a.jsx)(et,{"data-testid":"btn-text-string-number",disabled:tn||!v||!ej,onSelect:()=>ej?.(),children:"String Number"}),(0,a.jsx)(ee,{children:"Sticking"}),(0,a.jsx)(et,{"data-testid":"btn-text-sticking",disabled:tn||!v||!eC,onSelect:()=>eC?.(),children:"Sticking"}),(0,a.jsx)(ee,{children:"Instrument"}),(0,a.jsx)(et,{"data-testid":"btn-text-instrument-change",disabled:tn||!v||!eA,onSelect:()=>eA?.(),children:"Instrument Change"})]}),(0,a.jsx)(ex,{label:"Articulations",disabled:tn||!v,testId:"dropdown-articulations",children:[{label:"Staccato",symbol:"articStaccatoAbove"},{label:"Tenuto",symbol:"articTenutoAbove"},{label:"Marcato",symbol:"articMarcatoAbove"},{label:"Accent",symbol:"articAccentAbove"}].map(e=>(0,a.jsx)(et,{"data-testid":`btn-artic-${e.symbol}`,disabled:tn||!v||!eN,onSelect:()=>eN?.(e.symbol),children:e.label},e.symbol))})]}),(0,a.jsxs)("div",{className:"flex flex-wrap items-center gap-2 text-xs sm:text-sm",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(em,{"data-testid":"btn-delete",title:"Shortcut: Delete / Backspace",onClick:u,disabled:tn||!u||!v,variant:"secondary",size:"sm",children:"Delete"}),(0,a.jsx)(em,{"data-testid":"btn-undo",title:"Shortcut: Ctrl/Cmd + Z",onClick:c,disabled:tn||!c,variant:"secondary",size:"sm",children:"Undo"}),(0,a.jsx)(em,{"data-testid":"btn-redo",title:"Shortcut: Ctrl + Y, Cmd + Shift + Z",onClick:d,disabled:tn||!d,variant:"secondary",size:"sm",children:"Redo"})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("span",{className:"inline-flex",title:tn||!v?"Select a note or rest to split the bar.":void 0,children:(0,a.jsx)(em,{"data-testid":"btn-new-line",onClick:q,disabled:tn||!v||!q,variant:"secondary",size:"sm",children:"New Line"})}),(0,a.jsx)("span",{className:"inline-flex",title:tn||!v?"Select a note or rest to split the bar.":void 0,children:(0,a.jsx)(em,{"data-testid":"btn-new-page",onClick:V,disabled:tn||!v||!V,variant:"secondary",size:"sm",children:"New Page"})})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(em,{"data-testid":"btn-add-note-top",onClick:eL,disabled:tn||!v||!eL,variant:"secondary",size:"sm",children:"Add Note"}),(0,a.jsx)(em,{"data-testid":"btn-pitch-down",title:"Shortcut: Arrow Down (Pitch Down)",onClick:m,disabled:tn||!m||!v,variant:"secondary",size:"sm",children:"Pitch "}),(0,a.jsx)(em,{"data-testid":"btn-pitch-up",title:"Shortcut: Arrow Up (Pitch Up)",onClick:f,disabled:tn||!f||!v,variant:"secondary",size:"sm",children:"Pitch "}),(0,a.jsx)(em,{"data-testid":"btn-transpose--12",onClick:()=>g?.(-12),title:"Shortcut: Ctrl/Cmd + Arrow Down (Octave Down)",disabled:tn||!v||!g,variant:"secondary",size:"sm",children:"Octave "}),(0,a.jsx)(em,{"data-testid":"btn-transpose-12",title:"Shortcut: Ctrl/Cmd + Arrow Up (Octave Up)",onClick:()=>g?.(12),disabled:tn||!v||!g,variant:"secondary",size:"sm",children:"Octave "})]}),(0,a.jsx)(ex,{label:"Accidental",disabled:tn||!v||!y,testId:"dropdown-accidental",children:[{label:"",value:3},{label:"",value:1},{label:"",value:2},{label:"x",value:4},{label:"",value:5},{label:"Clear",value:0}].map(e=>(0,a.jsx)(et,{"data-testid":`btn-acc-${e.value}`,disabled:tn||!v||!y,onSelect:()=>y?.(e.value),children:e.label},e.label))}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(em,{"data-testid":"btn-duration-shorter",onClick:h,disabled:tn||!h||!v,variant:"secondary",size:"sm",children:"Shorter"}),(0,a.jsx)(em,{"data-testid":"btn-duration-longer",onClick:p,disabled:tn||!p||!v,variant:"secondary",size:"sm",children:"Longer"})]}),(0,a.jsx)(ex,{label:"Shortcuts",testId:"dropdown-shortcuts",children:[{label:"Delete: Delete / Backspace",title:"Shortcut: Delete / Backspace"},{label:"Undo: Ctrl/Cmd + Z",title:"Shortcut: Ctrl/Cmd + Z"},{label:"Redo: Ctrl + Y, Cmd + Shift + Z",title:"Shortcut: Ctrl + Y, Cmd + Shift + Z"},{label:"Pitch: Arrow Up/Down",title:"Shortcut: Arrow Up/Down"},{label:"Octave: Ctrl/Cmd + Arrow Up/Down",title:"Shortcut: Ctrl/Cmd + Arrow Up/Down"},{label:"Duration numbers: 1=64th, 2=32nd, 3=16th, 4=8th, 5=Quarter, 6=Half, 7=Whole, 8=Breve",title:"Shortcut: Press 1-8 to respell the selected note's duration"},{label:"Pitch letters: A-G (Shift to add to chord)",title:"Shortcut: Press A-G to respell pitch, hold Shift to add another pitch to the chord"},{label:"Rest: 0 (insert rest)",title:"Shortcut: Press 0 to insert a rest instead of a note"},{label:"Copy: Ctrl/Cmd + C",title:"Shortcut: Ctrl/Cmd + C"},{label:"Paste: Ctrl/Cmd + V",title:"Shortcut: Ctrl/Cmd + V"}].map(e=>(0,a.jsx)("div",{className:"px-3 py-1 text-xs sm:text-sm text-gray-700",title:e.title,children:e.label},e.label))})]})]})]})})};var eS=r(1463);let ek={openai:"OpenAI",anthropic:"Claude",gemini:"Gemini"},eE={openai:"gpt-5.2",anthropic:"claude-opus-4-5",gemini:"gemini-3-pro-preview"},e_="2023-06-01",eT={beginning:2,"after-selection":0,end:3},ej=["Text","RehearsalMark","StaffText","SystemText","ExpressionText","LyricText","HarmonyText","FingeringText","LeftHandGuitarFingeringText","RightHandGuitarFingeringText","StringNumberText","InstrumentChangeText","StickingText","FiguredBassText","TempoText"],eA=[".Note",".Rest",".Chord",".LayoutBreak",".Pedal",".PedalSegment",".Measure",ej.map(e=>`.${e}`).join(", ")].filter(Boolean).join(", "),eC=new Set(["Note","Rest","Chord","LayoutBreak","Pedal","PedalSegment","Measure",...ej]),eM=new Set(ej),eN=e=>!!e&&e.split(/\s+/).some(e=>eC.has(e)),eP=e=>!!e&&e.split(/\s+/).some(e=>eM.has(e)),eI=e=>{if(!e)return!1;if(eP(e.getAttribute("class")))return!0;let t=e.tagName?.toLowerCase();return"text"===t||"tspan"===t||!!e.closest?.("text")},eF=(e,t)=>{if(!eI(e))return t;let r=t.split(/\s+/).filter(Boolean);return r.includes("Text")?t:[...r,"Text"].join(" ").trim()||"Text"},eD=e=>"tspan"===e.tagName?.toLowerCase()?e.closest?.("text")??e:e,eL=e=>!!e&&!!(e.deleteSelection||e.undo||e.redo||e.pitchUp||e.pitchDown||e.doubleDuration||e.halfDuration);function eR(){let e=(0,i.useSearchParams)(),t=(eS.env.NEXT_PUBLIC_LLM_PROXY_URL||"").trim().replace(/\/+$/,""),r=!!t,n=(0,o.useCallback)(e=>t?`${t}${e}`:e,[t]),s=e.get("compareLeft"),l=e.get("compareRight"),u=e.get("leftLabel")||"Left",c=e.get("rightLabel")||"Right",d=!!(s&&l),[f,m]=(0,o.useState)(null),p=(0,o.useRef)(null),[h,g]=(0,o.useState)(1),y=(0,o.useRef)(null),b=(0,o.useRef)(null),v=(0,o.useRef)(null),x=e=>Math.min(Math.max(e,.5),3),[w,S]=(0,o.useState)(!1),[k,E]=(0,o.useState)(null),[_,T]=(0,o.useState)(null),[j,A]=(0,o.useState)(null),[M,N]=(0,o.useState)([]),[R,B]=(0,o.useState)(!1),[O,U]=(0,o.useState)(!1),[z,X]=(0,o.useState)(""),[$,W]=(0,o.useState)(""),[H,G]=(0,o.useState)(null),[q,Y]=(0,o.useState)(null),[K,Z]=(0,o.useState)(null),Q=(0,o.useRef)(!1),J=(0,o.useRef)(null),ee=(0,o.useRef)(null),et=(0,o.useRef)(null),er=(0,o.useRef)(null),en=(0,o.useRef)(!1),ea=(0,o.useRef)(!1),eo=(0,o.useRef)(!1),ei=(0,o.useRef)(!1),es=(0,o.useRef)(0),[el,eu]=(0,o.useState)(!1),[ec,ed]=(0,o.useState)(!1),[ef,em]=(0,o.useState)(!1),ep=(0,o.useRef)(ec),eh=(0,o.useRef)(ef),eg=(0,o.useRef)(null),[ey,eb]=(0,o.useState)(""),[ev,ex]=(0,o.useState)(""),[ej,eC]=(0,o.useState)(""),[eM,eR]=(0,o.useState)(""),[eB,eO]=(0,o.useState)([]),[eU,ez]=(0,o.useState)([]),[eX,e$]=(0,o.useState)([]),[eW,eH]=(0,o.useState)(""),[eG,eq]=(0,o.useState)(!1),[eV,eY]=(0,o.useState)(!1),[eK,eZ]=(0,o.useState)(null),[eQ,eJ]=(0,o.useState)(null),[e0,e1]=(0,o.useState)(!1),[e2,e4]=(0,o.useState)(""),[e8,e3]=(0,o.useState)(""),[e5,e6]=(0,o.useState)(null),e7=(0,o.useRef)(null),e9=(0,o.useRef)(null),[te,tt]=(0,o.useState)([]),[tr,tn]=(0,o.useState)(1),[ta,to]=(0,o.useState)(!1),[ti,ts]=(0,o.useState)(null),[tl,tu]=(0,o.useState)(null),[tc,td]=(0,o.useState)(null),[tf,tm]=(0,o.useState)(null),[tp,th]=(0,o.useState)(null),[tg,ty]=(0,o.useState)(null),[tb,tv]=(0,o.useState)([]),[tx,tw]=(0,o.useState)(!1),[tS,tk]=(0,o.useState)(0),[tE,t_]=(0,o.useState)(!1),[tT,tj]=(0,o.useState)(null),[tA,tC]=(0,o.useState)(!1),[tM,tN]=(0,o.useState)(!1),tP=(0,o.useRef)(null),tI=(0,o.useRef)(null),tF=(0,o.useRef)(null),tD=(0,o.useRef)(null),tL=(0,o.useRef)(null),tR=(0,o.useRef)(null),tB=(0,o.useRef)(null),tO=(0,o.useRef)(null),tU=(0,o.useRef)(null),tz=(0,o.useRef)(!1),tX=(0,o.useRef)(!1),[t$,tW]=(0,o.useState)(!1),[tH,tG]=(0,o.useState)("checkpoints"),[tq,tV]=(0,o.useState)([]),[tY,tK]=(0,o.useState)(!1),[tZ,tQ]=(0,o.useState)(null),[tJ,t0]=(0,o.useState)(!1),[t1,t2]=(0,o.useState)(!1),[t4,t8]=(0,o.useState)("closed"),[t3,t5]=(0,o.useState)("xml"),[t6,t7]=(0,o.useState)(""),[t9,re]=(0,o.useState)(!1),[rt,rr]=(0,o.useState)(!1),[rn,ra]=(0,o.useState)(null),[ro,ri]=(0,o.useState)("openai"),[rs,rl]=(0,o.useState)(""),[ru,rc]=(0,o.useState)(""),[rd,rf]=(0,o.useState)(""),[rm,rp]=(0,o.useState)(!0),[rh,rg]=(0,o.useState)("auto"),[ry,rb]=(0,o.useState)(4096),[rv,rx]=(0,o.useState)(""),[rw,rS]=(0,o.useState)(null),[rk,rE]=(0,o.useState)(null),[r_,rT]=(0,o.useState)(""),[rj,rA]=(0,o.useState)(""),[rC,rM]=(0,o.useState)(!1),[rN,rP]=(0,o.useState)(null),[rI,rF]=(0,o.useState)([]),[rD,rL]=(0,o.useState)(!1),[rR,rB]=(0,o.useState)(null),[rO,rU]=(0,o.useState)(0),[rz,rX]=(0,o.useState)(1),[r$,rW]=(0,o.useState)(""),[rH,rG]=(0,o.useState)(!1),[rq,rV]=(0,o.useState)(""),[rY,rK]=(0,o.useState)(""),[rZ,rQ]=(0,o.useState)([]),[rJ,r0]=(0,o.useState)(""),[r1,r2]=(0,o.useState)(4),[r4,r8]=(0,o.useState)(0),[r3,r5]=(0,o.useState)(4),[r6,r7]=(0,o.useState)(4),[r9,ne]=(0,o.useState)(null),[nt,nr]=(0,o.useState)(null),[nn,na]=(0,o.useState)([]),[no,ni]=(0,o.useState)(null),ns=(0,o.useRef)(null),[nl,nu]=(0,o.useState)(0),nc=(0,o.useRef)(null),[nd,nf]=(0,o.useState)(!1),[nm,np]=(0,o.useState)(!1),nh=(0,o.useRef)(null),ng=(0,o.useRef)(null),ny=(0,o.useRef)([]),nb=(0,o.useRef)(null),nv=(0,o.useRef)(0),nx=(0,o.useRef)([]),nw=(0,o.useRef)(null),nS=(0,o.useRef)(0),nk=(0,o.useRef)(null),nE=(0,o.useRef)(rO),n_=(0,o.useRef)(_),nT=`ots_${ro}_api_key`,nj=`ots_${ro}_model`,nA=(0,o.useRef)(!0),nC=(0,o.useCallback)(async(e,t)=>{if(e.measureSignatures){let r=(e=>{if(Array.isArray(e))return e.filter(e=>"string"==typeof e);if("string"==typeof e)try{let t=JSON.parse(e);if(Array.isArray(t))return t.filter(e=>"string"==typeof e)}catch(e){console.warn("Failed to parse measure signatures payload:",e)}return null})(await e.measureSignatures(t));if(r&&r.length>0)return r;if(r&&0===r.length&&e.measureSignatureCount&&e.measureSignatureAt){let n=await e.measureSignatureCount(t);if(n>0){let r=[];for(let a=0;a<n;a+=1)r.push(await e.measureSignatureAt(t,a));return r}return r}if(r)return r}if(e.measureSignatureCount&&e.measureSignatureAt){let r=await e.measureSignatureCount(t),n=[];for(let a=0;a<r;a+=1)n.push(await e.measureSignatureAt(t,a));return n}return[]},[]),nM=(0,o.useCallback)(async e=>{if(!e.measureLineBreaks)return[];let t=await e.measureLineBreaks();return Array.isArray(t)?t.map(Boolean):[]},[]),nN=(0,o.useCallback)(async(e,t)=>!!e.setMeasureLineBreaks&&e.setMeasureLineBreaks(t),[]),nP=(0,o.useCallback)(async(e,t)=>{if(e.measurePositions)try{let r=await e.measurePositions();t(r??null)}catch(e){console.warn("Failed to load measure positions for compare highlight:",e)}},[]),nI=(0,o.useCallback)(e=>{if("u"<typeof DOMParser)return[];let t=new DOMParser().parseFromString(e,"application/xml");if(t.getElementsByTagName("parsererror").length>0)throw Error("Invalid MusicXML");let r=new XMLSerializer,n=t.documentElement?.tagName==="museScore",a=e=>{Array.from(e.attributes).forEach(t=>{let r;("width"===(r=t.name.toLowerCase())||"id"===r||"xml:id"===r||"x"===r||"y"===r||"default-x"===r||"default-y"===r||"relative-x"===r||"relative-y"===r||r.startsWith("font-")||0)&&e.removeAttribute(t.name)}),Array.from(e.children).forEach(e=>a(e))},o=e=>{let t=e.cloneNode(!0);return t.removeAttribute("number"),t.removeAttribute("width"),n||Array.from(t.getElementsByTagName("print")).forEach(e=>e.remove()),Array.from(t.getElementsByTagName("LayoutBreak")).forEach(e=>e.remove()),a(t),r.serializeToString(t).replace(/>\s+</g,"><").trim()};if(n){let e=t.querySelector("Score");return e?Array.from(e.children).filter(e=>"Staff"===e.tagName).map(e=>Array.from(e.getElementsByTagName("Measure")).map(e=>o(e))):[]}return Array.from(t.getElementsByTagName("part")).map(e=>Array.from(e.getElementsByTagName("measure")).map(e=>o(e)))},[]),nF=(0,o.useCallback)((e,t,r,n)=>{if(!e.trim()||!t.trim())return{xml:"",error:"MusicXML content is empty."};if("u"<typeof DOMParser)return{xml:"",error:"XML parsing is unavailable in this environment."};let a=new DOMParser,o=a.parseFromString(e,"application/xml"),i=a.parseFromString(t,"application/xml");if(o.querySelector("parsererror")||i.querySelector("parsererror"))return{xml:"",error:"MusicXML is not valid XML."};let s=e=>{let t=Array.from(e.getElementsByTagName("part"))[r]??null;if(!t)return{part:null,measures:[]};let n=Array.from(t.children).filter(e=>e.nodeType===Node.ELEMENT_NODE&&"measure"===e.tagName);return{part:t,measures:n}},{measures:l}=s(o),{measures:u}=s(i);for(let e of n){let t=l[e.sourceIndex],r=u[e.targetIndex];if(!t||!r)return{xml:"",error:"Measure not found for the selected part/index."};let n=i.importNode(t,!0),a=r.getAttribute("number");a&&n.setAttribute("number",a),r.parentNode?.replaceChild(n,r)}return{xml:new XMLSerializer().serializeToString(i),error:""}},[]);(0,o.useCallback)((e,t,r,n,a)=>nF(e,t,r,[{sourceIndex:n,targetIndex:a}]),[nF]);let nD=(0,o.useCallback)(e=>{let t=[],r=-1;return e.forEach((e,n)=>{let a=!e.match;a&&-1===r&&(r=n),a||-1===r||(t.push({start:r,end:n-1}),r=-1)}),-1!==r&&t.push({start:r,end:e.length-1}),t},[]),nL=(0,o.useCallback)((e,t,r)=>{let n=Array.from({length:r},()=>!1);if(!e.length||r<=0)return n;for(let a of nD(e)){let o=null,i=null;for(let r=a.start;r<=a.end;r+=1){let n="left"===t?e[r].leftIndex:e[r].rightIndex;null!==n&&(null===o&&(o=n),i=n)}null!==o&&null!==i&&(o>0&&o-1<r&&(n[o-1]=!0),i>=0&&i<r&&(n[i]=!0))}return n},[nD]),nR=(0,o.useCallback)((e,t)=>{let r=Math.max(e.length,t.length),n=[];for(let a=0;a<r;a+=1){let r=a<e.length?a:null,o=a<t.length?a:null,i=null!==r&&null!==o&&e[r]===t[o];n.push({leftIndex:r,rightIndex:o,match:i})}return n},[]),nB=(0,o.useCallback)(e=>{let t=[],r=[],n=[],a=()=>{let e=Math.min(r.length,n.length);for(let a=0;a<e;a+=1)t.push({leftIndex:r[a],rightIndex:n[a],match:!1});for(let n=e;n<r.length;n+=1)t.push({leftIndex:r[n],rightIndex:null,match:!1});for(let r=e;r<n.length;r+=1)t.push({leftIndex:null,rightIndex:n[r],match:!1});r=[],n=[]};return e.forEach(e=>{if(e.match||null!==e.leftIndex&&null!==e.rightIndex){a(),t.push(e);return}null!==e.leftIndex&&r.push(e.leftIndex),null!==e.rightIndex&&n.push(e.rightIndex)}),a(),t},[]),nO=(0,o.useCallback)((e,t)=>{let r=e.length,n=t.length,a=Array.from({length:r+1},()=>Array(n+1).fill(0));for(let o=0;o<r;o+=1)for(let r=0;r<n;r+=1)e[o]===t[r]?a[o+1][r+1]=a[o][r]+1:a[o+1][r+1]=Math.max(a[o][r+1],a[o+1][r]);let o=[],i=r,s=n;for(;i>0&&s>0;)e[i-1]===t[s-1]?(o.push({leftIndex:i-1,rightIndex:s-1,match:!0}),i-=1,s-=1):a[i-1][s]>=a[i][s-1]?(o.push({leftIndex:i-1,rightIndex:null,match:!1}),i-=1):(o.push({leftIndex:null,rightIndex:s-1,match:!1}),s-=1);for(;i>0;)o.push({leftIndex:i-1,rightIndex:null,match:!1}),i-=1;for(;s>0;)o.push({leftIndex:null,rightIndex:s-1,match:!1}),s-=1;o.reverse();let l=a[r][n],u=Math.max(r,n);return{rows:nB(o),lcsRatio:u>0?l/u:0}},[nB]);(0,o.useEffect)(()=>{p.current=f},[f]),(0,o.useEffect)(()=>{nE.current=rO},[rO]),(0,o.useEffect)(()=>{n_.current=_},[_]),(0,o.useEffect)(()=>{ep.current=ec},[ec]),(0,o.useEffect)(()=>{eh.current=ef},[ef]),(0,o.useEffect)(()=>{},[k,R]),(0,o.useEffect)(()=>{rc(window.localStorage.getItem(nT)??"")},[!0,nT]),(0,o.useEffect)(()=>{ru.trim()?window.localStorage.setItem(nT,ru):window.localStorage.removeItem(nT)},[ru,!0,nT]),(0,o.useEffect)(()=>{let e=window.localStorage.getItem(nj);e?rl(e):rl(eE[ro]??"")},[!0,nj,ro]),(0,o.useEffect)(()=>{rs.trim()?window.localStorage.setItem(nj,rs):window.localStorage.removeItem(nj)},[!0,rs,nj]),(0,o.useEffect)(()=>{},[!0,t3]),(0,o.useEffect)(()=>{if(!ns.current)return;let e=()=>{nu(Math.round(ns.current?.getBoundingClientRect().height??0))};if(e(),"u"<typeof ResizeObserver)return;let t=new ResizeObserver(()=>e());return t.observe(ns.current),()=>t.disconnect()},[]),(0,o.useEffect)(()=>{s&&l&&(async()=>{eq(!0);try{let[e,t]=await Promise.all([fetch(s),fetch(l)]);if(!e.ok||!t.ok)throw Error("Failed to fetch files");let r=await e.text(),n=await t.text(),a=new Blob([n],{type:"application/xml"}),o=new File([a],"right.xml");await aC(o,{preserveScoreId:!1,updateUrl:!1}),eJ({title:u,currentXml:n,checkpointXml:r})}catch(t){console.error("Failed to load comparison:",t);let e=t instanceof Error?t.message:"Unknown error";alert(`Failed to load files:
${e}`)}finally{eq(!1)}})()},[s,l,u]),(0,o.useEffect)(()=>{let e=sessionStorage.getItem("openInEditor");e&&(async()=>{try{let{xml:t,filename:r}=JSON.parse(e);sessionStorage.removeItem("openInEditor");let n=new Blob([t],{type:"application/xml"}),a=new File([n],r);await aC(a,{preserveScoreId:!1,updateUrl:!1})}catch(e){console.error("Failed to load score from session:",e)}})()},[]),(0,o.useEffect)(()=>{let e=!1;return f&&z.includes("LayoutBreak")?((async()=>{let t,r=await f.selectionMimeData?.();if(e)return;if(!r)return G(null);try{t=new TextDecoder().decode(r)}catch(e){console.warn("Failed to decode selection MIME data",e),G(null);return}let n=t.match(/<subtype>([^<]+)<\/subtype>/);n&&("line"===n[1]||"page"===n[1])?G(n[1]):G(null)})(),()=>{e=!0}):void G(null)},[f,z]),(0,o.useEffect)(()=>{let e=eP(z)||!!q;if(!f||!e)return void W("");let t=!1,r=new TextDecoder,n="u">typeof DOMParser?new DOMParser:null;return(async()=>{let e;if(!f.selectionMimeData||!n)return W("");let a=await f.selectionMimeData?.();if(t)return;if(!a)return W("");try{e=r.decode(a)}catch(e){console.warn("Failed to decode text selection MIME data",e),W("");return}let o=n.parseFromString(e,"application/xml").querySelector("text");W((o?.textContent??"").trim())})(),()=>{t=!0}},[f,z,q]);let nU=e=>new Date(e).toLocaleString(),nz=(e,t)=>{let r=e.trim();if(r)return r;let n=t.trim()||"Untitled Score";return`${n} ${nU(Date.now())}`},nX=e=>{let t=e.replace(/[\\/:*?"<>|]+/g,"_").trim();return t.length>0?t.slice(0,64):"checkpoint"},n$=e=>{let t=new URL(window.location.href);t.searchParams.set("scoreId",e),t.searchParams.delete("score"),window.history.replaceState({},"",t.toString())},nW=e=>{if(r$)return r$;let t=`${e}:${crypto.randomUUID()}`;return rW(t),n$(t),t},nH=e=>e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;"),nG=eU.length>0?eU:nn,nq=(0,o.useMemo)(()=>nG.length?nG.flatMap(e=>e.instruments.map(t=>({id:t.id,name:t.name,label:e.name?`${t.name} (${e.name})`:t.name}))):[{id:"piano",name:"Piano",label:"Piano"},{id:"violin",name:"Violin",label:"Violin"},{id:"flute",name:"Flute",label:"Flute"},{id:"guitar",name:"Guitar",label:"Guitar"},{id:"voice",name:"Voice",label:"Voice"}],[nG]),nV=(0,o.useMemo)(()=>[{key:"piano",ids:["piano"]},{key:"violin",ids:["violin"]},{key:"viola",ids:["viola"]},{key:"cello",ids:["violoncello","cello"]},{key:"double-bass",ids:["double-bass","contrabass"],label:"Double Bass"},{key:"flute",ids:["flute"]},{key:"oboe",ids:["oboe"]},{key:"clarinet",ids:["clarinet"],label:"Clarinet"},{key:"bassoon",ids:["bassoon"]},{key:"trumpet",ids:["trumpet"],label:"Trumpet"},{key:"horn",ids:["horn"]},{key:"trombone",ids:["trombone"]},{key:"tuba",ids:["tuba"]},{key:"alto-saxophone",ids:["alto-saxophone"]},{key:"tenor-saxophone",ids:["tenor-saxophone"]},{key:"bass-guitar",ids:["bass-guitar"]},{key:"guitar",ids:["guitar-nylon","guitar-steel"]},{key:"voice",ids:["voice"]},{key:"drumset",ids:["drumset"]}],[]),nY=(0,o.useMemo)(()=>{let e=[],t=new Set;for(let r of nV){let n=r.ids.map(e=>nq.find(t=>t.id===e)).find(Boolean);n&&!t.has(n.id)&&(t.add(n.id),e.push({instrument:n,label:r.label??n.name}))}return e},[nV,nq]),nK=Math.max(eB.length,te.length,1),nZ=eQ?.title||"Checkpoint",nQ=(0,o.useMemo)(()=>e0?e5:f,[e0,e5,f]),nJ=(0,o.useMemo)(()=>e0?f:e5,[e0,f,e5]),n0=(0,o.useMemo)(()=>e0?te:eB,[e0,te,eB]),n1=(0,o.useMemo)(()=>e0?eB:te,[e0,eB,te]),n2=d?e0?c:u:e0?nZ:"Current",n4=d?e0?u:c:e0?"Current":nZ,n8=eQ?e0?eQ.checkpointXml:eQ.currentXml:"",n3=eQ?e0?eQ.currentXml:eQ.checkpointXml:"",n5=nQ===f,n6=nJ===f,n7=!!(f?.measureLineBreaks&&f?.setMeasureLineBreaks&&e5?.measureLineBreaks&&e5?.setMeasureLineBreaks&&f?.setLayoutMode&&e5?.setLayoutMode),n9=(0,o.useMemo)(()=>{let e=new Map;for(let t of tb)e.set(t.partIndex,t);return e},[tb]),ae=tl??.5,at={width:tc?`${tc.width*ae}px`:"auto",height:tc?`${tc.height*ae}px`:"auto"},ar={width:tf?`${tf.width*ae}px`:"auto",height:tf?`${tf.height*ae}px`:"auto"},an=(0,o.useMemo)(()=>{let e=e=>{if(!e||!e.elements.length)return 0;let t=e.pageSize?.height??0,r=1/0;return e.elements.forEach(e=>{if("number"!=typeof e.y)return;let n="number"==typeof e.sy?e.sy:"number"==typeof e.height?e.height:0,a=t>0&&e.page>0&&e.y+n<=1.2*t?e.page*t:0,o=e.y+a;o<r&&(r=o)}),Number.isFinite(r)?r:0};return Math.max(e(tp),e(tg),0)*ae},[tp,tg,ae]),aa=(0,o.useCallback)((e,t)=>{if(!e||!e.elements.length)return[];let r=e.pageSize?.height??0;return e.elements.map(e=>{let n="number"==typeof e.sy?e.sy:"number"==typeof e.height?e.height:0,a=r>0&&e.page>0&&e.y+n<=1.2*r?e.page*r:0;return{top:(e.y+a)*t,height:n*t}})},[]),ao=(0,o.useMemo)(()=>aa(tp,ae),[aa,tp,ae]),ai=(0,o.useMemo)(()=>aa(tg,ae),[aa,tg,ae]),as=(0,o.useMemo)(()=>Math.max(tc?tc.height*ae:0,tf?tf.height*ae:0,an+56*Math.max(0,...tb.map(e=>e.rows.length))),[tc,tf,ae,tb,an,56]),al=(0,o.useMemo)(()=>{let e=tp?.elements.length??Math.max(0,...tb.map(e=>e.leftCount)),t=tg?.elements.length??Math.max(0,...tb.map(e=>e.rightCount)),r=Array.from({length:e},()=>!1),n=Array.from({length:t},()=>!1);return tb.forEach(e=>{e.rows.forEach(e=>{!e.match&&(null!==e.leftIndex&&e.leftIndex>=0&&e.leftIndex<r.length&&(r[e.leftIndex]=!0),null!==e.rightIndex&&e.rightIndex>=0&&e.rightIndex<n.length&&(n[e.rightIndex]=!0))})}),{left:r.map(e=>e?"old-diff":null),right:n.map(e=>e?"new-diff":null)}},[tb,tp,tg]),au=(0,o.useCallback)((e,t,r)=>{if(!e||!e.elements.length)return[];let n=e.pageSize?.height??0;return e.elements.flatMap((e,a)=>{let o=t[a];if(!o)return[];let i="number"==typeof e.sx?e.sx:"number"==typeof e.width?e.width:0,s="number"==typeof e.sy?e.sy:"number"==typeof e.height?e.height:0,l=n>0&&e.page>0&&e.y+s<=1.2*n?e.page*n:0;return[{id:e.id??a,status:o,left:e.x*r,top:(e.y+l)*r,width:i*r,height:s*r}]})},[]),ac=(0,o.useMemo)(()=>au(tp,al.left,ae),[au,tp,al.left,ae]),ad=(0,o.useMemo)(()=>au(tg,al.right,ae),[au,tg,al.right,ae]),af=nl>0?{top:`${nl}px`}:void 0,am=nl>0?`calc(100dvh - ${nl+48}px)`:"calc(100dvh - 3rem)",ap={G:{sign:"G",line:2},G8va:{sign:"G",line:2,octave:1},G8vb:{sign:"G",line:2,octave:-1},G15ma:{sign:"G",line:2,octave:2},F:{sign:"F",line:4},F8va:{sign:"F",line:4,octave:1},F8vb:{sign:"F",line:4,octave:-1},F15ma:{sign:"F",line:4,octave:2},C1:{sign:"C",line:1},C2:{sign:"C",line:2},C3:{sign:"C",line:3},C4:{sign:"C",line:4},C5:{sign:"C",line:5},PERC:{sign:"percussion",line:2}},ah=(0,o.useCallback)(async e=>e?e instanceof Uint8Array?e:e instanceof ArrayBuffer?new Uint8Array(e):ArrayBuffer.isView(e)?new Uint8Array(e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength)):"string"==typeof e?new TextEncoder().encode(e):e instanceof Blob?new Uint8Array(await e.arrayBuffer()):(console.warn("Unexpected saveXml response type",e),null):null,[]),ag=(0,o.useCallback)(async e=>{let t=await ah(e);return t?new TextDecoder().decode(t):null},[ah]),ay=(0,o.useCallback)(async(e,t)=>{if(!e?.saveXml)return t;try{let r=await e.saveXml();return await ag(r)??t}catch(e){return console.warn("Failed to export MusicXML from score:",e),t}},[ag]),ab=(0,o.useCallback)(async()=>{let e=p.current??f;if(!e?.saveXml)return alert('This build of webmscore does not expose "saveXml".'),null;let t=await e.saveXml();return await ah(t)},[f,ah]),av=(0,o.useCallback)(async()=>{if(!f){t7(""),re(!1),t2(!1);return}rr(!0),ra(null);try{let e=await ab();if(!e)return;let t=new TextDecoder().decode(e);t7(t),re(!1),t2(!1)}catch(e){console.error("Failed to load MusicXML",e),ra("Unable to load MusicXML from the current score.")}finally{rr(!1)}},[f,ab]),ax=(0,o.useCallback)(async e=>{if(!e?.saveMsc)return null;let t=await e.saveMsc("mscx");return await ag(t)},[ag]),aw=(0,o.useCallback)(async()=>{if(t6.trim())return t6;let e=await ab();if(!e)return"";let t=new TextDecoder().decode(e);return t7(t),re(!1),t2(!1),t},[t6,ab]),aS=async()=>{if(!("u">typeof indexedDB))return alert("IndexedDB is not available; cannot verify checkpoint status."),{ok:!1,currentXml:""};let e=await ab();if(!e)return alert("Unable to read MusicXML for checkpointing."),{ok:!1,currentXml:""};let t=nW("score"),r=new TextDecoder,n=r.decode(e),a=eX[0],o=!0;if(a){let e=await F(a.id);e&&(o=n!==r.decode(new Uint8Array(e.data)))}if(o){let r=e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength),n=nz("","Auto checkpoint");await P({title:n,createdAt:Date.now(),format:"musicxml",data:r,size:e.byteLength,scoreId:t}),t0(!1),await a_()}return{ok:!0,currentXml:n}},ak=async e=>{if(!f)return void alert("Load a score before applying XML edits.");if(!e.trim())return void alert("XML content is empty.");let t=await aS();if(!t.ok)return;let r=t.currentXml.trim()!==e.trim(),n=new TextEncoder().encode(e),a=ey?nX(ey):"score",o=new File([n],`${a}.musicxml`,{type:"application/xml"});re(!1),await aC(o,{preserveScoreId:!0,updateUrl:!1}),t0(r),t2(!1)},aE=(0,o.useCallback)(async()=>{if(!("u">typeof indexedDB)){tV([]),tQ("IndexedDB is not available in this browser.");return}tK(!0);try{let e=await L(),t=e;r$&&!e.some(e=>e.scoreId===r$)&&(t=[{scoreId:r$,title:ey||"Current score",lastUpdated:Date.now(),count:0},...e]),tV(t),tQ(null)}catch(e){console.warn("Failed to load score summaries",e),tV([]),tQ("Unable to load scores from browser storage.")}finally{tK(!1)}},[r$,ey]),a_=(0,o.useCallback)(async e=>{if(!("u">typeof indexedDB))return void eZ("IndexedDB is not available in this browser.");let t=e??r$;if(!t)return void e$([]);eY(!0);try{let e=await I(t);e$(e),eZ(null)}catch(e){console.warn("Failed to load checkpoints",e),eZ("Unable to load checkpoints from browser storage.")}finally{eY(!1),aE()}},[r$,aE]),aT=(0,o.useCallback)(async(e,t)=>{if("u">typeof indexedDB&&e?.saveXml)try{let r=await e.saveXml(),n=await ah(r);if(!n||0===n.byteLength)return;let a=t||nW("score");await P({title:"Init on Load Score",createdAt:Date.now(),format:"musicxml",data:n.buffer.slice(n.byteOffset,n.byteOffset+n.byteLength),size:n.byteLength,scoreId:a}),await a_(a),t0(!1)}catch(e){console.warn("Failed to create initial load checkpoint",e)}},[nW,a_,ah]),aj=e=>{window.__webmscore=e};(0,o.useEffect)(()=>{a_()},[a_]),(0,o.useEffect)(()=>{aE()},[aE]),(0,o.useEffect)(()=>{let t=e.get("scoreId"),r=e.get("score"),n=t||(r?`url:${r}`:"");n&&n!==r$&&rW(n)},[e,r$]),(0,o.useEffect)(()=>{if(!f){t7(""),re(!1);return}t9||av()},[f,t9,av]),(0,o.useEffect)(()=>{"assistant"===t3&&rm&&!t6.trim()&&av()},[t3,rm,t6,av]),(0,o.useEffect)(()=>{let e=ru.trim();if(!e){rF([]),rB(null),rL(!1);return}let t=!1;return rL(!0),rB(null),(async()=>{try{let a=[];if("openai"===ro){let t=r?await fetch(n("/api/llm/openai/models"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({apiKey:e})}):await fetch("https://api.openai.com/v1/models",{headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"}});if(!t.ok){let e=await t.text();throw Error(e||"Failed to load models.")}let o=await t.json();a=Array.isArray(o?.models)?o.models.filter(e=>"string"==typeof e):Array.isArray(o?.data)?o.data.map(e=>e?.id).filter(e=>"string"==typeof e):[]}else if("anthropic"===ro){let t=r?await fetch(n("/api/llm/anthropic/models"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({apiKey:e})}):await fetch("https://api.anthropic.com/v1/models",{headers:{"x-api-key":e,"anthropic-version":e_,"Content-Type":"application/json"}});if(!t.ok){let e=await t.text();throw Error(e||"Failed to load models.")}let o=await t.json();a=Array.isArray(o?.models)?o.models.map(e=>e?.id).filter(e=>"string"==typeof e):Array.isArray(o?.data)?o.data.map(e=>e?.id).filter(e=>"string"==typeof e):[]}else if("gemini"===ro){let t=r?await fetch(n("/api/llm/gemini/models"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({apiKey:e})}):await fetch("https://generativelanguage.googleapis.com/v1beta/models",{headers:{"Content-Type":"application/json","x-goog-api-key":e}});if(!t.ok){let e=await t.text();throw Error(e||"Failed to load models.")}let o=await t.json(),i=(Array.isArray(o?.models)?o.models:[]).filter(e=>{let t=Array.isArray(e?.supportedGenerationMethods)?e.supportedGenerationMethods:[];return 0===t.length||t.includes("generateContent")}),s=[];for(let e of i)"string"==typeof e?.baseModelId&&s.push(e.baseModelId),"string"==typeof e?.name&&s.push(e.name.replace(/^models\//,""));a=s.filter(e=>"string"==typeof e)}if(t)return;let o="openai"===ro?a.filter(e=>/^gpt-|^o/.test(e)):a,i=[...new Set(o.length?o:a)].sort();if(rF(i),!rs||!i.includes(rs)){let e=i.find(e=>e===eE[ro])||i[0]||eE[ro]||"";rl(e)}}catch(e){t||(console.error(`Failed to load ${ek[ro]} models`,e),rF([]),rB("Failed to load models. Check your API key or enter a model manually."))}finally{t||rL(!1)}})(),()=>{t=!0}},[ru,rs,!0,ro,r,n]),(0,o.useEffect)(()=>{if(!rH||0===nq.length)return;let e=nq[0].id;rJ&&nq.some(e=>e.id===rJ)||r0(e),0===rZ.length&&rQ([e])},[rH,rZ.length,nq,rJ]),(0,o.useEffect)(()=>{rH&&f&&(eU.length>0||aO(f))},[rH,eU.length,f]),(0,o.useEffect)(()=>{if(!rH||r9)return;let e=!1;return(async()=>{try{let t=await fetch("/api/instruments/clefs");if(!t.ok)throw Error("Failed to load clef map.");let r=await t.json();e||(ne(r?.map??null),nr(null))}catch(t){e||(console.warn("Failed to load instrument clefs",t),ne(null),nr("Unable to load clef defaults. Using treble clef."))}})(),()=>{e=!0}},[rH,r9]),(0,o.useEffect)(()=>{if(!rH||eU.length>0||nn.length>0)return;let e=!1;return(async()=>{try{let t=await fetch("/api/instruments/templates");if(!t.ok)throw Error("Failed to load instrument templates.");let r=await t.json();if(!e){let e=Array.isArray(r?.groups)?r.groups:[];na(e),ni(e.length>0?null:"No instruments found.")}}catch(t){e||(console.warn("Failed to load fallback instruments",t),na([]),ni("Unable to load instrument list."))}})(),()=>{e=!0}},[rH,eU.length,nn.length]),(0,o.useEffect)(()=>{let t=new AbortController;return(async()=>{try{if(await C(),t.signal.aborted)return;console.log("webmscore initialized");let r=e.get("score");r&&await aA(r,t.signal)}catch(e){t.signal.aborted||console.error("Failed to initialize webmscore",e)}})(),()=>t.abort()},[e]);let aA=async(t,r)=>{if(r?.aborted)return;let n=e.get("scoreId")||`url:${t}`;n!==r$&&rW(n),S(!0),E(null),N([]),T(null),A(null),X(""),G(null),eu(!1),ep.current=!1,eh.current=!1,eg.current=null,ed(!1),em(!1),t0(!1),t2(!1),t7(""),re(!1),ra(null),eb(""),ex(""),eC(""),eR(""),eO([]),ez([]),rU(0),rX(1),nA.current=!0;try{let e=await fetch(t,r?{signal:r}:void 0);if(!e.ok)throw Error("Failed to fetch score");let n=await e.arrayBuffer(),a=new Uint8Array(n),o=await C(),i="mscz";(t.endsWith(".xml")||t.endsWith(".musicxml"))&&(i="musicxml"),f&&f.destroy();let s=await o.load(i,a);if(r?.aborted)return void s.destroy();m(s),aj(s),eL(s)||console.warn("Mutation APIs not detected on loaded score; enabling toolbar anyway."),eu(!0);let l=await aM(s,0);await aN(s,l),nA.current&&1?window.requestAnimationFrame(()=>{window.requestAnimationFrame(()=>{oJ(),nA.current=!1})}):(oJ(),nA.current=!1),await aB(s),await aO(s),s.saveAudio&&await aU(s)}catch(e){console.error("Error auto-loading file:",e)}finally{r?.aborted||S(!1)}},aC=async(e,t)=>{S(!0);let r=t?.updateUrl??!0,n=r$;t?.scoreIdOverride?n=t.scoreIdOverride:t?.preserveScoreId||(n=`file:${e.name}:${e.lastModified}`),n&&n!==r$&&(rW(n),r&&n$(n)),E(null),N([]),T(null),A(null),X(""),G(null),eu(!1),ep.current=!1,eh.current=!1,eg.current=null,ed(!1),em(!1),t0(!1),t2(!1),t7(""),re(!1),ra(null),eb(""),ex(""),eC(""),eR(""),eO([]),ez([]),nA.current=!0;try{let r=await e.arrayBuffer(),a=new Uint8Array(r),o=await C(),i=e.name.toLowerCase(),s="mscz";(i.endsWith(".xml")||i.endsWith(".musicxml"))&&(s="musicxml"),f&&f.destroy();let l=await o.load(s,a);m(l),aj(l),eL(l)||console.warn("Mutation APIs not detected on loaded score; enabling toolbar anyway."),eu(!0);let u=await aM(l,0);await aN(l,u),nA.current&&1?window.requestAnimationFrame(()=>{window.requestAnimationFrame(()=>{oJ(),nA.current=!1})}):(oJ(),nA.current=!1),await aB(l),await aO(l),l.saveAudio&&await aU(l),t?.createInitialCheckpoint&&await aT(l,n)}catch(e){console.error("Error loading file:",e),alert("Failed to load score. See console for details.")}finally{S(!1)}},aM=async(e,t=nE.current)=>{if(!e?.npages)return rX(1),rU(0),0;try{let r=Math.max(1,await e.npages()),n=Math.max(0,Math.min(t,r-1));return rX(r),rU(n),n}catch(e){return console.warn("Failed to read page count:",e),rX(1),rU(0),0}},aN=async(e,t,r=!0)=>{if(e&&y.current)try{let n="number"==typeof t?t:rO,a=await e.saveSvg(n,!0,r);a&&(y.current.innerHTML=a)}catch(e){console.error("Error rendering score:",e)}},aP=(0,o.useCallback)(async(e,t,r,n=!1)=>{if(!e||!t)return!1;if(!e.saveSvg)return console.error("Error rendering compare score: saveSvg method not available"),!1;try{let a=await e.saveSvg("number"==typeof r?r:0,!0,n);if(!a)return!1;t.innerHTML=a;let o=t.querySelector("svg");return o instanceof SVGSVGElement&&(o.style.width="100%",o.style.height="100%"),!0}catch(e){return console.error("Error rendering compare score:",e),!1}},[]),aI=e=>{if(!e||e.includes("%"))return null;let t=Number.parseFloat(e);return Number.isFinite(t)?t:null},aF=(0,o.useCallback)((e,t)=>{let r=e?.querySelector("svg");if(!(r instanceof SVGSVGElement))return;let n=((e,t)=>{let r=aI(e.getAttribute("width")),n=aI(e.getAttribute("height")),a=r??null,o=n??null;if((!a||!o)&&e.getAttribute("viewBox")){let t=e.getAttribute("viewBox")?.trim().split(/[\s,]+/).map(e=>Number.parseFloat(e));t&&4===t.length&&(a=a??(Number.isFinite(t[2])?t[2]:null),o=o??(Number.isFinite(t[3])?t[3]:null))}if(!a||!o){let r=e.getBoundingClientRect();t>0&&(a=a??r.width/t,o=o??r.height/t)}return a&&o?{width:a,height:o}:null})(r,ae);n&&t(n)},[ae]),aD=(0,o.useCallback)(e=>tA||!e?0:e===f?rO:e===e5?Math.min(rO,Math.max(tr-1,0)):rO,[tA,f,e5,rO,tr]),aL=(0,o.useCallback)(async(e,t,r,n)=>{if(!tE&&e&&t&&0!==n.length){t_(!0);try{let a=e===f?eQ?.currentXml??null:eQ?.checkpointXml??null,o=t===f?eQ?.currentXml??null:eQ?.checkpointXml??null,[i,s]=await Promise.all([ay(e,a),ay(t,o)]);if(!i||!s)return void console.warn("Compare overwrite: unable to load MusicXML for swap.");let l=nF(i,s,r,n.map(e=>({sourceIndex:e.leftIndex,targetIndex:e.rightIndex})));if(l.error||!l.xml)return void console.warn("Compare overwrite failed:",l.error||"Unknown error");t===f?(await ak(l.xml),eJ(e=>e?{...e,currentXml:l.xml}:e)):eJ(e=>e?{...e,checkpointXml:l.xml}:e),tk(e=>e+1)}catch(e){console.warn("Compare overwrite failed:",e)}finally{t_(!1)}}},[tE,f,eQ,ay,nF,ak]);(0,o.useCallback)(async(e,t,r,n,a)=>{null!==n&&null!==a&&await aL(e,t,r,[{leftIndex:n,rightIndex:a}])},[aL]);let aR=(0,o.useCallback)(e=>(Array.isArray(e?.parts)?e.parts:[]).map((e,t)=>({index:t,name:"string"==typeof e?.name?e.name:"",instrumentName:"string"==typeof e?.instrumentName?e.instrumentName:"",instrumentId:"string"==typeof e?.instrumentId?e.instrumentId:"",isVisible:"true"===String(e?.isVisible??"").toLowerCase()})),[]),aB=async e=>{try{let t=await e.metadata();eb("string"==typeof t.title?t.title:""),ex("string"==typeof t.subtitle?t.subtitle:""),eC("string"==typeof t.composer?t.composer:"");let r="string"==typeof t.lyricist?t.lyricist:"string"==typeof t.poet?t.poet:"";eR(r),eO(aR(t))}catch(e){console.warn("Failed to read score metadata",e),ex(""),eR(""),eO([])}},aO=async e=>{if(!e.listInstrumentTemplates)return void ez([]);try{let t=await e.listInstrumentTemplates();ez(Array.isArray(t)?t:[])}catch(e){console.warn("Failed to read instrument templates",e),ez([])}},aU=async(e,t)=>{if(ep.current)return console.debug("[AUDIO] soundfont already loaded"),!0;let r=e??f;if(!r||!r.setSoundFont)return console.warn("[AUDIO] soundfont load skipped: setSoundFont unavailable"),!1;let n=!!t?.forceRetry;if(eh.current&&!n)return console.warn("[AUDIO] soundfont load skipped: previous attempt already failed"),!1;if(eg.current)return eg.current;n&&eh.current&&console.debug("[AUDIO] retrying soundfont load after previous failure");let a=(async()=>{eh.current=!0,em(!0);let e=(()=>{let e=[],t=new Set,r=r=>{!r||t.has(r)||(t.add(r),e.push(r))},n="https://ftp.osuosl.org/pub/musescore/soundfont/MuseScore_General".trim();if(n){let e=n.replace(/\/+$/,""),t=e.toLowerCase();t.endsWith(".sf2")||t.endsWith(".sf3")?r(e):(r(`${e}.sf3`),r(`${e}.sf2`),r(`${e}/MuseScore_General.sf3`),r(`${e}/MuseScore_General.sf2`),r(`${e}/default.sf3`),r(`${e}/default.sf2`))}return r("/soundfonts/MuseScore_General.sf3"),r("/soundfonts/MuseScore_General.sf2"),r("/soundfonts/default.sf3"),r("/soundfonts/default.sf2"),e})();for(let t of(console.debug("[AUDIO] soundfont candidates",{candidates:e}),e))try{let e=await fetch(t);if(!e.ok){console.warn("[AUDIO] soundfont candidate not found",{url:t,status:e.status});continue}let n=new Uint8Array(await e.arrayBuffer());return await r.setSoundFont(n),ep.current=!0,ed(!0),console.debug("[AUDIO] soundfont loaded",{url:t,bytes:n.byteLength}),!0}catch(e){console.warn("Default soundfont load failed for",t,e)}return!1})();eg.current=a;try{return await a}finally{eg.current===a&&(eg.current=null)}},az=async e=>{if(!f||!f.setSoundFont)return void alert("SoundFont loading is not available in this build.");try{let t=await e.arrayBuffer(),r=new Uint8Array(t);await f.setSoundFont(r),ep.current=!0,eh.current=!0,eg.current=null,ed(!0),em(!0)}catch(e){console.error("Failed to load soundfont",e),alert("Failed to load soundfont. See console for details.")}},aX=async()=>{var e;let t,r,n,a,o,i,s,l,u=Math.max(1,Math.floor(r1)),c=rZ.length>0?rZ:nq.slice(0,1).map(e=>e.id);if(0===c.length)return void alert("Select at least one instrument.");let d=(t=nH((e={title:rq,composer:rY,instruments:c.map(e=>{let t=nq.find(t=>t.id===e);return{id:e,name:t?.name||e||"Instrument"}}),measures:u,keyFifths:r4,timeNumerator:r3,timeDenominator:r6}).title.trim()),r=nH(e.composer.trim()),n=Math.round(64*e.timeNumerator/e.timeDenominator),a=e.instruments.map((t,r)=>{let a=`P${r+1}`,o=t.name.trim()||"Instrument",i=nH(o),s=((e,t)=>{let r=r9?.[e];if(r)return r;let n=t.toLowerCase();return n.includes("piano")||n.includes("organ")||n.includes("harp")?{staves:2,clefs:[{staff:1,clef:"G"},{staff:2,clef:"F"}]}:n.includes("viola")?{staves:1,clefs:[{staff:1,clef:"C3"}]}:n.includes("cello")||n.includes("contrabass")||n.includes("double bass")||n.includes("tuba")||n.includes("bassoon")?{staves:1,clefs:[{staff:1,clef:"F"}]}:n.includes("percussion")||n.includes("drum")?{staves:1,clefs:[{staff:1,clef:"PERC"}]}:{staves:1,clefs:[{staff:1,clef:"G"}]}})(t.id,o),l=Math.max(s.staves||1,s.clefs.length||1),u=s.clefs.map(e=>{let t=ap[e.clef]??ap.G,r=l>1?` number="${e.staff}"`:"",n=t.octave?`
        <clef-octave-change>${t.octave}</clef-octave-change>`:"";return`        <clef${r}>
          <sign>${t.sign}</sign>
          <line>${t.line}</line>${n}
        </clef>`}).join("\n"),c=Array.from({length:e.measures},(t,r)=>{let a=0===r?`
      <attributes>
        <divisions>16</divisions>
        <key><fifths>${e.keyFifths}</fifths></key>
        <time><beats>${e.timeNumerator}</beats><beat-type>${e.timeDenominator}</beat-type></time>
        ${l>1?`<staves>${l}</staves>`:""}
${u}
      </attributes>`:"",o=Array.from({length:l},(e,t)=>`      <note>
        <rest measure="yes"/>
        <duration>${n}</duration>
        <voice>1</voice>
        ${l>1?`<staff>${t+1}</staff>`:""}
      </note>`).join("\n");return`    <measure number="${r+1}">
${a}
${o}
    </measure>`}).join("\n");return{partList:`    <score-part id="${a}">
      <part-name>${i}</part-name>
      <score-instrument id="${a}-I1">
        <instrument-name>${i}</instrument-name>
      </score-instrument>
    </score-part>`,part:`  <part id="${a}">
${c}
  </part>`}}),o=t?`  <work><work-title>${t}</work-title></work>
`:"",i=r?`  <identification><creator type="composer">${r}</creator></identification>
`:"",s=a.map(e=>e.partList).join("\n"),l=a.map(e=>e.part).join("\n"),`<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE score-partwise PUBLIC "-//Recordare//DTD MusicXML 3.1 Partwise//EN" "http://www.musicxml.org/dtds/partwise.dtd">
<score-partwise version="3.1">
${o}${i}  <part-list>
${s}
  </part-list>
${l}
</score-partwise>
`),f=rq.trim()?nX(rq):"new_score",m=new File([new TextEncoder().encode(d)],`${f}.musicxml`,{type:"application/xml"});rG(!1);let p=`new:${crypto.randomUUID()}`;rW(p),n$(p),await aC(m,{scoreIdOverride:p,updateUrl:!1})},a$=async()=>{if(!f)return void alert("Load a score before saving a checkpoint.");if(!("u">typeof indexedDB))return void alert("IndexedDB is not available in this browser.");eq(!0);try{let e=await ab();if(!e)return;let t=nW("score"),r=e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength),n=nz(eW,ey);await P({title:n,createdAt:Date.now(),format:"musicxml",data:r,size:e.byteLength,scoreId:t}),t0(!1),eH(""),await a_()}catch(e){console.error("Failed to save checkpoint",e),alert("Failed to save checkpoint. See console for details.")}finally{eq(!1)}},aW=(0,o.useCallback)(async e=>{if(!eQ)return;if(!("u">typeof indexedDB))return void alert("IndexedDB is not available in this browser.");let t="left"===e?n5:n6,r="left"===e?n2:n4;eq(!0);try{let n;if(t){let e=await ab();if(!e)return void alert("Unable to read current score MusicXML.");n=e}else{let e=await ay(e5,eQ.checkpointXml);if(!e)return void alert("Unable to read checkpoint MusicXML.");n=new TextEncoder().encode(e)}let a=nW("score"),o=nz("left"===e?e2:e8,r);await P({title:o,createdAt:Date.now(),format:"musicxml",data:n.buffer.slice(n.byteOffset,n.byteOffset+n.byteLength),size:n.byteLength,scoreId:a}),await a_(),"left"===e?e4(""):e3("")}catch(e){console.error("Failed to save compare checkpoint",e),alert("Failed to save compare checkpoint. See console for details.")}finally{eq(!1)}},[eQ,n5,n6,e2,e8,n2,n4,e5,ab,ay,nW,a_]),aH=async e=>{if(!("u">typeof indexedDB))return void alert("IndexedDB is not available in this browser.");if(window.confirm(`Restore checkpoint "${e.title}"? Unsaved changes will be lost.`)){eq(!0);try{let t=await F(e.id);if(!t)return void alert("Checkpoint not found.");let r=`${nX(e.title)}.musicxml`,n=new File([new Uint8Array(t.data)],r,{type:"application/xml"});await aC(n,{preserveScoreId:!0,updateUrl:!1})}catch(e){console.error("Failed to restore checkpoint",e),alert("Failed to restore checkpoint. See console for details.")}finally{eq(!1)}}},aG=async e=>{if(!f)return void alert("Load a score before comparing checkpoints.");if(!("u">typeof indexedDB))return void alert("IndexedDB is not available in this browser.");eq(!0);try{let t=await F(e.id);if(!t)return void alert("Checkpoint not found.");let r=await ab();if(!r)return;let n=new TextDecoder,a=n.decode(r),o=n.decode(new Uint8Array(t.data));eJ({title:e.title,currentXml:a,checkpointXml:o})}catch(e){console.error("Failed to compare checkpoint",e),alert("Failed to compare checkpoint. See console for details.")}finally{eq(!1)}},aq=(0,o.useCallback)(()=>{e1(e=>!e)},[]),aV=(0,o.useCallback)(e=>{if(!eQ)return;let t="left"===e?n8:n3,r="left"===e?n2:n4,n=`${r.replace(/[^a-zA-Z0-9]/g,"_")}.xml`;sessionStorage.setItem("openInEditor",JSON.stringify({xml:t,filename:n})),window.open("/score-editor/index.html","_blank")},[eQ,n8,n3,n2,n4]);(0,o.useEffect)(()=>{if(!eQ){e7.current&&(e7.current.destroy(),e7.current=null),e9.current=null,e6(null),tt([]),tn(1),to(!1),ts(null),tu(null),td(null),tm(null),th(null),ty(null),tj(null),e1(!1),e4(""),e3("");return}if(e9.current===eQ.checkpointXml)return;let e=!1;return(async()=>{to(!0),ts(null),e7.current&&(e7.current.destroy(),e7.current=null);try{let t=await C(),r=new TextEncoder().encode(eQ.checkpointXml),n=await t.load("musicxml",r);if(e)return void n.destroy();if(e7.current=n,e9.current=eQ.checkpointXml,e6(n),n.npages){let t=await n.npages();e||tn(Math.max(1,t))}let a=await n.metadata();e||tt(aR(a))}catch(t){console.error("Failed to load compare checkpoint score",t),e||ts("Unable to load checkpoint score.")}finally{e||to(!1)}})(),()=>{e=!0}},[eQ,aR]),(0,o.useEffect)(()=>()=>{e7.current&&(e7.current.destroy(),e7.current=null)},[]),(0,o.useEffect)(()=>{if(!eQ||!nQ||!e0&&nQ===e5&&(ta||ti||e7.current&&e7.current!==e5))return;let e=aD(nQ);aP(nQ,tF.current,e,!1).then(()=>{aF(tF.current,td),nP(nQ,th)})},[eQ,nQ,e5,ta,ti,e0,aP,aF,nP,aD]),(0,o.useEffect)(()=>{if(!eQ||!nJ)return;let e=nJ===e5;if(e&&(ta||ti||e7.current&&e7.current!==e5)||tX.current)return;let t=aD(nJ);tX.current=!0,aP(nJ,tD.current,t,!1).then(t=>{t||ti||!e?(aF(tD.current,tm),nP(nJ,ty)):ts("No SVG output from checkpoint score.")}).finally(()=>{tX.current=!1})},[eQ,nJ,e5,ti,ta,aP,aF,nP,aD]),(0,o.useEffect)(()=>{if(!eQ){tC(!1),tN(!1);let e=tP.current;tP.current=null,null!==e&&f?.setLayoutMode&&f.setLayoutMode(e).then(()=>aN(f,nE.current)).catch(e=>{console.warn("Failed to restore layout mode after compare:",e)});return}if(!f||!e5||!f.setLayoutMode||!e5.setLayoutMode)return void tC(!1);let e=!1;return(async()=>{try{null===tP.current&&f.getLayoutMode&&(tP.current=await f.getLayoutMode());let t=tM?3:2;if(await f.setLayoutMode(t),await e5.setLayoutMode(t),e)return;tC(!0),await aP(nQ,tF.current,0,!1),aF(tF.current,td),await aP(nJ,tD.current,0,!1),aF(tD.current,tm)}catch(t){console.warn("Failed to enable continuous layout for compare:",t),e||tC(!1)}})(),()=>{e=!0}},[eQ,f,e5,tM,aN,aP,aF,nQ,nJ]),(0,o.useEffect)(()=>{eQ&&tM&&!n7&&tN(!1)},[eQ,tM,n7]),(0,o.useEffect)(()=>{!eQ||n7&&tN(!0)},[eQ,n7]),(0,o.useEffect)(()=>{if(!eQ){let e=tI.current;tI.current=null,e&&f&&nN(f,e.left);return}if(!tM){let e=tI.current;if(!e||(tI.current=null,!f||!e5||!n7))return;Promise.all([nN(f,e.left),nN(e5,e.right)]).then(()=>{let e=tA?0:nE.current;aP(f,tF.current,e,!1).then(()=>{aF(tF.current,td),nP(f,th)}),aP(e5,tD.current,e,!1).then(()=>{aF(tD.current,tm),nP(e5,ty)})});return}if(!eQ||!f||!e5||!n7)return;let e=!1;return(async()=>{let t=tI.current,r=t?.left??[],n=t?.right??[];if(t||([r,n]=await Promise.all([nM(f),nM(e5)])),e)return;tI.current||(tI.current={left:r,right:n});let a=r.length||Math.max(0,...tb.map(e=>e.leftCount)),o=n.length||Math.max(0,...tb.map(e=>e.rightCount)),i=Array.from({length:a},(e,t)=>!!r[t]),s=Array.from({length:o},(e,t)=>!!n[t]),l=Array.from({length:a},()=>!1),u=Array.from({length:o},()=>!1);tb.forEach(e=>{let t=nL(e.rows,"left",a),r=nL(e.rows,"right",o);t.forEach((e,t)=>{e&&(l[t]=!0)}),r.forEach((e,t)=>{e&&(u[t]=!0)})});let c=i.map((e,t)=>e||l[t]),d=s.map((e,t)=>e||u[t]);if(await nN(f,c),await nN(e5,d),e)return;let m=tA?0:nE.current;await aP(f,tF.current,m,!1),aF(tF.current,td),await nP(f,th),await aP(e5,tD.current,m,!1),aF(tD.current,tm),await nP(e5,ty)})(),()=>{e=!0}},[eQ,tM,n7,f,e5,tA,nN,nM,tb,nL,nP,aP,aF]),(0,o.useEffect)(()=>{if(!eQ){tv([]),tw(!1),tj(null);return}let e=!1;return(async()=>{tw(!0);try{let t=[],r=[],n=!1;try{if(eQ.currentXml&&eQ.checkpointXml)t=nI(eQ.currentXml),r=nI(eQ.checkpointXml),n=!0;else if(f&&e5){let[e,a]=await Promise.all([ax(f),ax(e5)]);e&&a&&(t=nI(e),r=nI(a),n=!0)}}catch(e){console.warn("Failed to parse MusicXML for compare signatures; falling back to WASM.",e)}if(!n){if(!f||!e5){tv([]),tj(null);return}let e=Math.max(eB.length,te.length,1);t=await Promise.all(Array.from({length:e},(e,t)=>nC(f,t))),r=await Promise.all(Array.from({length:e},(e,t)=>nC(e5,t)))}if(e)return;let a=Math.max(t.length,r.length,1),o=Array.from({length:a},(e,n)=>{let a=t[n]??[],o=r[n]??[];if(0===a.length&&0===o.length)return{partIndex:n,rows:[],strategy:"index",lcsRatio:0,leftCount:0,rightCount:0};let{rows:i,lcsRatio:s}=nO(a,o),l=i.some(e=>e.match)?"lcs":"index",u="lcs"===l?i:nR(a,o);return{partIndex:n,rows:u,strategy:l,lcsRatio:s,leftCount:a.length,rightCount:o.length}});tv(o),tj({left:t,right:r})}catch(t){console.error("Failed to compute compare alignment",t),e||(tv([]),tj(null))}finally{e||tw(!1)}})(),()=>{e=!0}},[eQ,tS,eB.length,te.length,f,e5,nC,nO,nR,nI,ax]),(0,o.useEffect)(()=>{if(!eQ)return;let e=tB.current,t=tO.current,r=tU.current;if(!e||!t||!r)return;let n=(e,t,r)=>{tz.current||(tz.current=!0,t.scrollTop=e.scrollTop,t.scrollLeft=e.scrollLeft,r.scrollTop=e.scrollTop,tz.current=!1)},a=()=>n(e,t,r),o=()=>n(t,e,r),i=()=>n(r,e,t);return e.addEventListener("scroll",a),t.addEventListener("scroll",o),r.addEventListener("scroll",i),()=>{e.removeEventListener("scroll",a),t.removeEventListener("scroll",o),r.removeEventListener("scroll",i)}},[eQ]),(0,o.useEffect)(()=>{if(!eQ||ta||ti)return;let e=tB.current,t=tO.current;if(!e||!t||!tc||!tf)return;let r=e.clientWidth,n=t.clientWidth;r&&n&&window.requestAnimationFrame(()=>{let e=Math.min(r/tc.width,n/tf.width);if(!Number.isFinite(e)||e<=0)return;let t=Math.min(tl??.5,Math.max(.2,Math.min(e,1.5)));(null===tl||Math.abs(tl-t)>.01)&&tu(t)})},[eQ,ta,ti,rO,ae,tl,tc,tf]);let aY=async()=>{f?(!t9||window.confirm("Discard local MusicXML edits and reload from the score?"))&&await av():alert("Load a score before refreshing MusicXML.")},aK=async()=>{rr(!0),ra(null);try{await ak(t6)}catch(e){console.error("Failed to apply MusicXML edits",e),alert("Failed to apply MusicXML edits. See console for details.")}finally{rr(!1)}},aZ=async e=>{if(!("u">typeof indexedDB))return void alert("IndexedDB is not available in this browser.");if(window.confirm(`Delete checkpoint "${e.title}"?`)){eq(!0);try{await D(e.id),await a_()}catch(e){console.error("Failed to delete checkpoint",e),alert("Failed to delete checkpoint. See console for details.")}finally{eq(!1)}}},aQ=async e=>{let t,a,o,{provider:i,apiKey:s,model:l,prompt:u,xml:c,maxTokens:d}=e,f="You are a MusicXML editor. Return only a JSON patch payload (musicxml-patch@1), no markdown or commentary.",m=(t=`Return ONLY valid JSON in the following format:
{
  "format": "musicxml-patch@1",
  "ops": [
    { "op": "replace", "path": "/score-partwise/part[@id='P1']/measure[@number='1']/note[1]", "value": "<note>...</note>" },
    { "op": "setText", "path": "/score-partwise/part[@id='P1']/measure[@number='1']/note[1]/duration", "value": "2" },
    { "op": "setAttr", "path": "/score-partwise/part[@id='P1']/measure[@number='1']/note[1]", "name": "default-x", "value": "123.45" },
    { "op": "insertAfter", "path": "/score-partwise/part[@id='P1']/measure[@number='1']/note[1]", "value": "<note>...</note>" },
    { "op": "delete", "path": "/score-partwise/part[@id='P1']/measure[@number='1']/note[2]" }
  ]
}
Use ONLY these ops: replace, setText, setAttr, insertBefore, insertAfter, delete.
Each XPath must match exactly one node.`,c&&c.trim()?`${u}

Current MusicXML:
${c}

${t}`:`${u}

${t}`);if(r){let e=await fetch(n(`/api/llm/${i}`),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({apiKey:s,model:l,prompt:u,xml:c,maxTokens:d??void 0})});if(!e.ok)throw Error(await e.text()||"Request failed.");let t=await e.json();return"string"==typeof t?.text?t.text:""}if("openai"===i){let e={model:l,instructions:f,input:m,temperature:0};d&&(e.max_output_tokens=d);let t=await fetch("https://api.openai.com/v1/responses",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${s}`},body:JSON.stringify(e)});if(!t.ok){let e,r=await t.text(),n={model:l,messages:[{role:"system",content:f},{role:"user",content:m}],temperature:0};d&&(n.max_tokens=d);let a=await fetch("https://api.openai.com/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${s}`},body:JSON.stringify(n)});if(!a.ok)throw Error(await a.text()||r||"OpenAI request failed.");return e=await a.json(),e?.choices?.[0]?.message?.content??""}var p,h,g=await t.json();if("string"==typeof g?.output_text)return g.output_text;for(let e of Array.isArray(g?.output)?g.output:[])if(e?.type==="message")return(Array.isArray(e?.content)?e.content:[]).map(e=>e?.text||"").join("");return""}if("anthropic"===i){let e=await fetch("https://api.anthropic.com/v1/messages",{method:"POST",headers:{"Content-Type":"application/json","x-api-key":s,"anthropic-version":e_},body:JSON.stringify({model:l,max_tokens:d??2048,temperature:0,system:f,messages:[{role:"user",content:m}]})});if(!e.ok)throw Error(await e.text()||"Anthropic request failed.");return p=await e.json(),(Array.isArray(p?.content)?p.content:[]).map(e=>e?.type==="text"&&e?.text||"").join("")}let y=(a=l.trim())?a.includes("/")?a:`models/${a}`:"";if(!y)throw Error("Missing Gemini model.");let b={systemInstruction:{parts:[{text:f}]},contents:[{role:"user",parts:[{text:m}]}],generationConfig:{temperature:0}};d&&(b.generationConfig.maxOutputTokens=d);let v=await fetch(`https://generativelanguage.googleapis.com/v1beta/${y}:generateContent`,{method:"POST",headers:{"Content-Type":"application/json","x-goog-api-key":s},body:JSON.stringify(b)});if(!v.ok)throw Error(await v.text()||"Gemini request failed.");return h=await v.json(),Array.isArray(o=h?.candidates?.[0]?.content?.parts)?o.map(e=>e?.text||"").join(""):""},aJ=(0,o.useCallback)(async(e,t)=>{if(rx(e),rS(null),rE(null),rT(""),!e.trim())return void rE("AI output is empty.");let r=(e=>{let t;if(!e.trim())return{patch:null,error:"AI response is empty."};try{t=JSON.parse(e)}catch(e){return{patch:null,error:"AI response is not valid JSON."}}if(!t||"musicxml-patch@1"!==t.format||!Array.isArray(t.ops))return{patch:null,error:"AI response is not a musicxml-patch@1 payload."};let r=[],n=new Set(["replace","setText","setAttr","insertBefore","insertAfter","delete"]);for(let e=0;e<t.ops.length;e+=1){let a=t.ops[e];if(!a||"object"!=typeof a)return{patch:null,error:`Patch op ${e+1} is not an object.`};let o=String(a.op||"");if(!n.has(o))return{patch:null,error:`Patch op ${e+1} has unsupported op "${o}".`};let i="string"==typeof a.path?a.path.trim():"";if(!i)return{patch:null,error:`Patch op ${e+1} is missing a valid path.`};let s={op:o,path:i};if("setText"===o||"replace"===o||"insertBefore"===o||"insertAfter"===o){if("string"!=typeof a.value)return{patch:null,error:`Patch op ${e+1} requires a string value.`};s.value=a.value}if("setAttr"===o){if("string"!=typeof a.name||!a.name.trim())return{patch:null,error:`Patch op ${e+1} requires an attribute name.`};if("string"!=typeof a.value)return{patch:null,error:`Patch op ${e+1} requires a string value.`};s.name=a.name,s.value=a.value}r.push(s)}return{patch:{format:"musicxml-patch@1",ops:r},error:""}})(e);if(r.error||!r.patch)return void rE(r.error||"Invalid patch payload.");rS(r.patch);let n=t??rj??await aw();if(!n.trim())return void rE("Unable to apply patch without MusicXML.");let a=((e,t)=>{if(!e.trim())return{xml:"",error:"Base MusicXML is empty."};if("u"<typeof DOMParser)return{xml:"",error:"XML parsing is unavailable in this environment."};let r=new DOMParser,n=r.parseFromString(e,"application/xml");if(n.querySelector("parsererror"))return{xml:"",error:"Base MusicXML is not valid XML."};let a=n.createNSResolver(n.documentElement),o=e=>{let t=r.parseFromString(`<wrapper>${e}</wrapper>`,"application/xml");if(t.querySelector("parsererror"))return{node:null,error:"Patch value is not valid XML."};let a=t.documentElement,o=Array.from(a.childNodes).filter(e=>e.nodeType===Node.ELEMENT_NODE),i=Array.from(a.childNodes).filter(e=>e.nodeType===Node.TEXT_NODE&&(e.textContent??"").trim());return 1!==o.length||i.length>0?{node:null,error:"Patch value must contain exactly one element."}:{node:n.importNode(o[0],!0),error:""}},i=e=>{try{let t=n.evaluate(e,n,a,XPathResult.ORDERED_NODE_SNAPSHOT_TYPE,null);if(1!==t.snapshotLength)return{node:null,error:`XPath "${e}" matched ${t.snapshotLength} nodes.`};return{node:t.snapshotItem(0),error:""}}catch(t){return{node:null,error:`XPath "${e}" could not be evaluated.`}}};for(let e=0;e<t.ops.length;e+=1){let r=t.ops[e],{node:n,error:a}=i(r.path);if(a||!n)return{xml:"",error:`Patch op ${e+1} failed: ${a||"Target not found."}`};if("setText"===r.op){n.textContent=r.value??"";continue}if("setAttr"===r.op){if(n.nodeType!==Node.ELEMENT_NODE)return{xml:"",error:`Patch op ${e+1} targets a non-element node.`};n.setAttribute(r.name??"",r.value??"");continue}if("delete"===r.op){if(!n.parentNode)return{xml:"",error:`Patch op ${e+1} target has no parent.`};n.parentNode.removeChild(n);continue}let s=o(r.value??"");if(s.error||!s.node)return{xml:"",error:`Patch op ${e+1} failed: ${s.error||"Invalid value."}`};if(!n.parentNode)return{xml:"",error:`Patch op ${e+1} target has no parent.`};if("replace"===r.op){n.parentNode.replaceChild(s.node,n);continue}if("insertBefore"===r.op){n.parentNode.insertBefore(s.node,n);continue}if("insertAfter"===r.op){n.parentNode.insertBefore(s.node,n.nextSibling);continue}}return{xml:new XMLSerializer().serializeToString(n),error:""}})(n,r.patch);a.error||!a.xml.trim()?rE(a.error||"Failed to apply patch to MusicXML."):(rE(null),rT(a.xml))},[rj,aw]),a0=async()=>{if(!ru.trim())return void alert(`Enter your ${ek[ro]} API key.`);if(!rd.trim())return void alert("Enter an instruction for the assistant.");if(!rs.trim())return void alert("Select a model.");if("custom"===rh&&ry<=0)return void alert("Enter a max output token limit.");rM(!0),rP(null),rx(""),rS(null),rE(null),rT("");try{var e;let t,r=rm?await aw():"";if(rm&&!r.trim())return void alert("Unable to load MusicXML for context.");let n=rm?r:await aw();rA(n);let a=(t=(e=await aQ({provider:ro,apiKey:ru,model:rs,prompt:rd,xml:rm?r:"",maxTokens:"custom"===rh?ry:null})).match(/```(?:json)?\s*([\s\S]*?)```/i))?t[1].trim():e.trim();if(!a)return void rP("No patch was returned by the model.");await aJ(a,n)}catch(e){console.error("AI request failed",e),rP("AI request failed. See console for details.")}finally{rM(!1)}},a1=async()=>{if(!r_.trim())return void alert(rk||"AI patch has not produced valid MusicXML.");rr(!0),ra(null);try{await ak(r_)}catch(e){console.error("Failed to apply AI XML",e),alert("Failed to apply AI XML. See console for details.")}finally{rr(!1)}},a2=async()=>{if(!(M.length>1)&&f&&_)try{let{page:e,x:t,y:r}=_;if((eP(z)||q)&&f.selectTextElementAtPoint)return void await f.selectTextElementAtPoint(e,t,r);if(!f.selectElementAtPoint)return;await f.selectElementAtPoint(e,t,r)}catch(e){console.warn("Re-select in WASM failed; continuing anyway",e)}},a4=(e,t,r)=>{if(console.log("[refreshSelectionOverlay] Called with fallbackIndex:",e,"fallbackPoint:",t),!y.current)return void console.log("[refreshSelectionOverlay] No containerRef, returning");if(void 0!==r&&r!==es.current||ei.current)return;let n=void 0!==e?e:j,a=void 0!==t?t:_;console.log("[refreshSelectionOverlay] useIndex:",n,"usePoint:",a);let o=y.current.getBoundingClientRect(),i=Array.from(new Set([".selected",".note-selected",".ms-selection"].flatMap(e=>Array.from(y.current.querySelectorAll(e))))),s=Array.from(y.current.querySelectorAll(eA));console.log("[refreshSelectionOverlay] candidates.length:",i.length);let l=[];if(i.length>0)l=i.map(e=>{let t=e.getBoundingClientRect(),r=(t.left-o.left)/h,n=(t.top-o.top)/h,a=t.width/h,i=t.height/h;if(!(a>0&&i>0))return null;let l=o0(e),u=eF(e,e.getAttribute("class")??""),c=s.indexOf(e);if(c<0){let t=e;for(;t&&t!==y.current&&!((c=s.indexOf(t))>=0);)t=t.parentElement}return{index:c>=0?c:null,page:l,x:r,y:n,w:a,h:i,centerX:r+a/2,centerY:n+i/2,classes:u}}).filter(e=>!!e).sort((e,t)=>e.page-t.page||e.y-t.y||e.x-t.x||(e.index??Number.MAX_SAFE_INTEGER)-(t.index??Number.MAX_SAFE_INTEGER));else if(null!==n){console.log("[refreshSelectionOverlay] Using index fallback"),console.log("[refreshSelectionOverlay] Found",s.length,"Note/Rest/Chord/LayoutBreak elements");let e=s[n]??null;if(e){console.log("[refreshSelectionOverlay] Selected element at index",n);let t=e.getBoundingClientRect(),r=(t.left-o.left)/h,a=(t.top-o.top)/h,i=t.width/h,s=t.height/h;i>0&&s>0&&(l=[{index:n,page:o0(e),x:r,y:a,w:i,h:s,centerX:r+i/2,centerY:a+s/2,classes:e.getAttribute("class")??""}])}else console.log("[refreshSelectionOverlay] No element at index",n)}if(0===l.length){console.log("[refreshSelectionOverlay] No element found, clearing selection state"),N([]),E(null),T(null),A(null),X(""),G(null);return}N(l);let u=null;if(a){let e=a.page??nE.current,t=l.filter(t=>t.page===e);u=(t.length>0?t:l).reduce((e,t)=>{if(!e)return t;let r=Math.hypot(e.centerX-a.x,e.centerY-a.y);return Math.hypot(t.centerX-a.x,t.centerY-a.y)<r?t:e},null)}else u=null!==n?l.find(e=>e.index===n)??l[0]:l[0];u?(console.log("[refreshSelectionOverlay] Setting selectedElement"),E({x:u.x,y:u.y,w:u.w,h:u.h}),T({page:u.page,x:u.centerX,y:u.centerY}),A(u.index),X(u.classes),console.log("[refreshSelectionOverlay] Done updating selection")):console.log("[refreshSelectionOverlay] No primary box found, returning")},a8=async e=>{if(f&&!(e<0)&&!(e>=rz)){rU(e);try{await aN(f,e),a4(j,_)}catch(e){console.error("Failed to change page:",e)}}},a3=e=>{let t=p.current??f,r=t&&t[e];return r?(...e)=>r.apply(t,e):(console.warn(`Mutation binding "${e}" is missing on Score instance.`),alert(`This build of webmscore does not expose "${e}".`),null)},a5=(e,t)=>{let r=window.prompt(e,t??"");return null===r?null:r},a6=async(e,t,r)=>{if(!f)return void console.warn(`Mutation "${e}" requested but no score is loaded.`);if(!t)return void console.warn(`Mutation "${e}" requested but binding is missing on Score instance.`);let n=M.length>1,a=!r?.skipSelectionFallback,o=!!r?.playSelectionPreview;try{console.debug(`Mutation "${e}" start`);let i=await t();console.debug(`Mutation "${e}" result:`,i);let s=!1!==i;if(s||console.warn(`Mutation "${e}" returned false (no-op).`),r?.clearSelection&&(ei.current=!0,es.current+=1,B(!0),E(null),N([]),T(null),A(null),X(""),G(null)),!s)return;if(t0(!0),t2(!0),!r?.skipRelayout&&f.relayout)try{await f.relayout()}catch(e){console.warn("Relayout after mutation failed:",e)}let l=await aM(f,nE.current);if(await aN(f,l),!r?.skipWasmReselect&&!n&&_&&f.selectElementAtPoint)try{await f.selectElementAtPoint(_.page,_.x,_.y)}catch(e){console.warn("Re-select in WASM after mutation failed; continuing with overlay fallback",e)}if(!r?.clearSelection&&a&&(null!==j&&null===j&&A(j),_&&!_&&T(_)),r?.clearSelection)return;o&&oV(`mutation:${e}`,_??void 0,{reselect:!0});let u=a?j:null,c=a?_:null,d=r?.advanceSelection,m=r?.advanceSelectionStep??1;if(n)return void console.log("[performMutation] Skipping overlay refresh for multi-selection (backend highlighting)");console.log("[performMutation] Scheduling refresh with preservedIndex:",u,"preservedPoint:",c),window.requestAnimationFrame(()=>{console.log("[performMutation] RAF 1"),window.requestAnimationFrame(()=>{console.log("[performMutation] RAF 2, calling refreshSelectionOverlay"),d?((e,t,r=1)=>{if(!y.current)return;let n=Array.from(y.current.querySelectorAll(eA));if(0===n.length)return;let a=e??j,o=t??_??(k?{page:0,x:k.x+k.w/2,y:k.y+k.h/2}:null);if(o){let e=y.current.getBoundingClientRect();a=n.reduce((t,r,a)=>{let i=r.getBoundingClientRect(),s=(i.left-e.left+i.width/2)/h,l=(i.top-e.top+i.height/2)/h,u=n[t]?.getBoundingClientRect(),c=u?(u.left-e.left+u.width/2)/h:s,d=u?(u.top-e.top+u.height/2)/h:l,f=Math.hypot(c-o.x,d-o.y);return Math.hypot(s-o.x,l-o.y)<f?a:t},0)}let i=a??0,s=Math.min(n.length-1,Math.max(0,i+r)),l=n[s];if(!l)return;let u=l.getBoundingClientRect(),c=y.current.getBoundingClientRect(),d=(u.left-c.left)/h,f=(u.top-c.top)/h,m=u.width/h,p=u.height/h;if(!(m>0&&p>0))return;let g=o0(l),b=d+m/2,v=f+p/2;N([{index:s,page:g,x:d,y:f,w:m,h:p,centerX:b,centerY:v}]),E({x:d,y:f,w:m,h:p}),T({page:g,x:b,y:v}),A(s)})(j,_,m):a4(u,c)})})}catch(t){console.error(`Mutation "${e}" failed:`,t),alert(`Unable to ${e}. Check the console for details.`)}},a7=(e,t,r)=>{window.requestAnimationFrame(()=>{window.requestAnimationFrame(()=>{a4(e,t,r)})})},a9=async e=>{if(f){ei.current=!1;try{B(!1),await aN(f,nE.current);let t=++es.current;a7(e?.index??null,e?.point??null,t)}catch(e){console.warn("Failed to refresh selection highlight from SVG:",e)}}},oe=()=>a6("delete selection",async()=>{await a2();let e=a3("deleteSelection");return!!e&&await e()},{clearSelection:!0}),ot=e=>{W(e)},or=()=>a6("set selected text",async()=>{await a2();let e=a3("setSelectedText");return!!e&&e($)}),on=()=>a6("undo",f?.undo?.bind(f)),oa=()=>a6("redo",f?.redo?.bind(f)),oo=()=>a6("raise pitch",async()=>{let e=a3("pitchUp");if(e)return e()},{playSelectionPreview:!0}),oi=()=>a6("lower pitch",async()=>{let e=a3("pitchDown");if(e)return e()},{playSelectionPreview:!0}),os=e=>a6(`transpose ${e}`,async()=>{let t=a3("transpose");if(t)return t(e)},{skipWasmReselect:!0,playSelectionPreview:!0}),ol=async()=>{if(!f)return;await a2();let e=a3("selectNextChord");if(!e||!await e.call(f))return;let t=nE.current,r=p.current??f,n=r.getSelectionBoundingBox;if("function"==typeof n){let e=await n.call(r);e&&"number"==typeof e.page&&(t=e.page)}if(t!==nE.current){await a8(t),oV("select-next-chord");return}await a9(),oV("select-next-chord")},ou=async()=>{if(!f)return;await a2();let e=a3("selectPrevChord");if(!e||!await e.call(f))return;let t=nE.current,r=p.current??f,n=r.getSelectionBoundingBox;if("function"==typeof n){let e=await n.call(r);e&&"number"==typeof e.page&&(t=e.page)}if(t!==nE.current){await a8(t),oV("select-prev-chord");return}await a9(),oV("select-prev-chord")},oc=async()=>{if(!f)return;await a2();let e=a3("extendSelectionNextChord"),t=a3("getSelectionBoundingBoxes");if(e&&t&&await e.call(f)){let e=await t.call(f);if(await aN(f,nE.current),e&&e.length>0){let t=e.map((e,t)=>({index:t,page:e.page,x:e.x,y:e.y,w:e.width,h:e.height,centerX:e.x+e.width/2,centerY:e.y+e.height/2})),r=e[e.length-1];E({x:r.x,y:r.y,w:r.width,h:r.height}),T({page:r.page,x:r.x+r.width/2,y:r.y+r.height/2}),N(t)}}},od=async()=>{if(!f)return;await a2();let e=a3("extendSelectionPrevChord"),t=a3("getSelectionBoundingBoxes");if(e&&t&&await e.call(f)){let e=await t.call(f);if(await aN(f,nE.current),e&&e.length>0){let t=e.map((e,t)=>({index:t,page:e.page,x:e.x,y:e.y,w:e.width,h:e.height,centerX:e.x+e.width/2,centerY:e.y+e.height/2})),r=e[0];E({x:r.x,y:r.y,w:r.width,h:r.height}),T({page:r.page,x:r.x+r.width/2,y:r.y+r.height/2}),N(t)}}},of=e=>a6(`set accidental ${e}`,async()=>{await a2();let t=a3("setAccidental");if(t)return t(e)},{playSelectionPreview:!0}),om=()=>a6("toggle dot",async()=>{await a2();let e=a3("toggleDot");if(e)return e()},{playSelectionPreview:!0}),op=e=>a6("set duration",async()=>{await a2();let t=a3("setDurationType");if(t)return t(e)},{playSelectionPreview:!0}),oh=(e,t)=>{let r=!t;return a6("add pitch",async()=>{await a2();let r=a3("addPitchByStep");if(r)return r(e,t,!1)},{skipWasmReselect:!0,skipSelectionFallback:r,advanceSelection:r,playSelectionPreview:!0})},og=()=>a6("enter rest",async()=>{await a2();let e=a3("enterRest");if(e)return e()},{skipWasmReselect:!0,skipSelectionFallback:!0,advanceSelection:!0}),oy=()=>a6("toggle line break",async()=>{await a2();let e=a3("toggleLineBreak");if(e)return e()},{skipWasmReselect:!0}),ob=()=>a6("toggle page break",async()=>{await a2();let e=a3("togglePageBreak");if(e)return e()},{skipWasmReselect:!0}),ov=()=>a6("add tie",async()=>{await a2();let e=a3("addTie");if(e)return e()}),ox={0:"Chord symbol",1:"Roman numeral",2:"Nashville number"},ow=async()=>{f&&(await a6("set title",async()=>{let e=a3("setTitleText");if(e)return e(ey)},{skipWasmReselect:!0}),await aB(f))},oS=async()=>{f&&(await a6("set subtitle",async()=>{let e=a3("setSubtitleText");if(e)return e(ev)},{skipWasmReselect:!0}),await aB(f))},ok=async()=>{f&&(await a6("set composer",async()=>{let e=a3("setComposerText");if(e)return e(ej)},{skipWasmReselect:!0}),await aB(f))},oE=async()=>{f&&(await a6("set lyricist",async()=>{let e=a3("setLyricistText");if(e)return e(eM)},{skipWasmReselect:!0}),await aB(f))},o_=async e=>{f&&e&&(await a6("add instrument",async()=>{let t=a3("appendPart");if(t)return t(e)},{skipWasmReselect:!0}),await aB(f))},oT=async e=>{f&&(await a6("remove instrument",async()=>{let t=a3("removePart");if(t)return t(e)},{clearSelection:!0,skipWasmReselect:!0}),await aB(f))},oj=async(e,t)=>{f&&(await a6("toggle part visibility",async()=>{let r=a3("setPartVisible");if(r)return r(e,t)},{skipWasmReselect:!0}),await aB(f))},oA=async()=>{if(!f)return!1;await a2();let e=a3("selectionMimeType"),t=a3("selectionMimeData");if(!e||!t)return!1;let r=await e();if(!r)return!1;let n=await t();return!!n&&0!==n.length&&(nk.current={mimeType:r,data:n instanceof Uint8Array?n:new Uint8Array(n)},!0)},oC=()=>a6("paste selection",async()=>{let e=nk.current;if(!e)return alert("Nothing copied yet."),!1;await a2();let t=a3("pasteSelection");if(t)return t(e.mimeType,e.data)},{skipWasmReselect:!0});(0,o.useEffect)(()=>{let e=e=>{if(e.defaultPrevented||!f||(e=>{if(!(e instanceof HTMLElement))return!1;let t=e.tagName.toLowerCase();return e.isContentEditable||"input"===t||"textarea"===t||"select"===t})(e.target))return;let t=e.key,r=t.toLowerCase(),n=e.ctrlKey||e.metaKey;if(n){if("z"===r){e.preventDefault(),e.shiftKey?oa():on();return}if("y"===r){e.preventDefault(),oa();return}if("c"===r){e.preventDefault(),oA();return}if("v"===r){e.preventDefault(),oC();return}}if(!n){let n={c:0,d:1,e:2,f:3,g:4,a:5,b:6},a={1:8,2:7,3:6,4:5,5:4,6:3,7:2,8:1},o=!!k||M.length>0;if(el&&o){if(t in a){e.preventDefault(),op(a[t]);return}if("0"===t){e.preventDefault(),og();return}if("."===t){e.preventDefault(),om();return}if("+"===t){e.preventDefault(),of(3);return}if("-"===t){e.preventDefault(),of(1);return}if("="===t){e.preventDefault(),of(2);return}if("T"===t){e.preventDefault(),ov();return}if(!e.altKey&&r in n){e.preventDefault(),oh(n[r],e.shiftKey);return}}}if("arrowup"===r||"arrowdown"===r){if(!el||!(k||M.length>0))return;e.preventDefault(),n?os("arrowup"===r?12:-12):"arrowup"===r?oo():oi();return}if("arrowleft"===r||"arrowright"===r){if(!el||!(k||M.length>0))return;e.preventDefault(),e.shiftKey?"arrowright"===r?oc():od():"arrowright"===r?ol():ou();return}if(("delete"===r||"backspace"===r)&&el&&(k||M.length>0)){if(e.preventDefault(),"line"===H)return void oy();if("page"===H)return void ob();oe()}};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[f,el,k,M.length,oh,og,of,op,om,ov,on,oa,oo,oi,os,ol,ou,oc,od,oe,oA,oC]);let oM=async(e,t,r)=>{if(f&&f.setTimeSignature){np(!0);try{await a2(),"number"==typeof r&&f.setTimeSignatureWithType?await f.setTimeSignatureWithType(e,t,r):("number"!=typeof r||f.setTimeSignatureWithType||console.warn("Time signature type requested but not supported by this WASM build."),await f.setTimeSignature(e,t)),f.relayout&&await f.relayout(),await aN(f),a7(j,_,es.current)}catch(e){console.error("Failed to set time signature",e),alert("Unable to set time signature. See console for details.")}finally{np(!1)}}},oN=async e=>{if(f&&f.setKeySignature){np(!0);try{await a2(),await f.setKeySignature(e),f.relayout&&await f.relayout(),await aN(f),a7(j,_,es.current)}catch(e){console.error("Failed to set key signature",e),alert("Unable to set key signature. See console for details.")}finally{np(!1)}}},oP=async e=>{if(f&&f.setClef){np(!0);try{await a2(),await f.setClef(e),f.relayout&&await f.relayout(),await aN(f),a7(j,_,es.current)}catch(e){console.error("Failed to set clef",e),alert("Unable to set clef. See console for details.")}finally{np(!1)}}},oI=(e,t,r)=>{let n=new Blob([e],{type:r}),a=URL.createObjectURL(n),o=document.createElement("a");o.href=a,o.download=t,o.click(),URL.revokeObjectURL(a)},oF=async()=>{if(f)try{let e=await f.saveSvg(0,!0);oI(e,"score.svg","image/svg+xml")}catch(e){console.error("Failed to export SVG",e),alert("Unable to export SVG. See console for details.")}},oD=async()=>{if(f)try{let e=await f.savePdf();oI(e,"score.pdf","application/pdf")}catch(e){console.error("Failed to export PDF",e),alert("Unable to export PDF. See console for details.")}},oL=async()=>{if(!f||!f.savePng)return void alert("PNG export is not available in this build.");try{let e=await f.savePng(0,!0,!0);oI(e,"score.png","image/png")}catch(e){console.error("Failed to export PNG",e),alert("Unable to export PNG. See console for details.")}},oR=async()=>{if(!f||!f.saveMxl)return void alert("MXL export is not available in this build.");try{let e=await f.saveMxl();oI(e,"score.mxl","application/vnd.recordare.musicxml")}catch(e){console.error("Failed to export MXL",e),alert("Unable to export MXL. See console for details.")}},oB=async()=>{if(!f||!f.saveMsc)return void alert("MSCZ export is not available in this build.");try{let e=await f.saveMsc("mscz");oI(e,"score.mscz","application/vnd.musescore.mscz")}catch(e){console.error("Failed to export MSCZ",e),alert("Unable to export MSCZ. See console for details.")}},oO=async()=>{if(!f||!f.saveMidi)return void alert("MIDI export is not available in this build.");try{let e=await f.saveMidi(!0,!0);oI(e,"score.mid","audio/midi")}catch(e){console.error("Failed to export MIDI",e),alert("Unable to export MIDI. See console for details.")}},oU=async()=>{if(!f||!f.saveAudio)return void alert("Audio export is not available in this build.");try{if(np(!0),!await aU(void 0,{forceRetry:!0}))return void alert("No default soundfont found. Configure NEXT_PUBLIC_SOUNDFONT_CDN_URL or provide /public/soundfonts/default.sf3 (or .sf2).");let e=await f.saveAudio("wav");oI(e,"score.wav","audio/wav")}catch(e){console.error("Failed to export audio",e),alert("Unable to export audio. See console for details.")}finally{np(!1)}},oz=async(e,t,r)=>{e.current.forEach(e=>{try{e.stop()}catch(e){}}),e.current=[];let n=t.current;if(t.current=null,n){let e=n(!0).catch(()=>{});r?.awaitCancel&&await e}},oX=async e=>{nS.current+=1,await oz(nx,nw,e)},o$=async e=>{nv.current+=1,nc.current&&(nc.current.pause(),nc.current.currentTime=0),await oz(ny,nb,e),await oX(e),nf(!1)},oW=async()=>{let e=ng.current||new AudioContext({sampleRate:44100});return ng.current=e,"suspended"===e.state&&await e.resume(),e},oH=async(e,t)=>{let r=await oW(),n=++t.generationRef.current;t.iteratorRef.current=e;let a=r.currentTime+.015,o=null,i=null,s=!1;for(;t.generationRef.current===n;){let n=await e(!1);if(!Array.isArray(n)||0===n.length)break;let l=!1;for(let e of n){if(!e)continue;let n=Number.isFinite(e.startTime)?Number(e.startTime):0;null===o&&(o=n);let u=Math.max(0,n-o);e.done&&(l=!0);let c="number"==typeof e.endTime?Math.max(0,e.endTime-o):null;t.maxDurationSeconds&&"number"==typeof c&&c>=t.maxDurationSeconds&&(l=!0);let d=new Float32Array(e.chunk.buffer,e.chunk.byteOffset,e.chunk.byteLength/4),f=Math.floor(d.length/512);(!Number.isInteger(f)||f<1)&&(f=1),f>2&&(f=2);let m=r.createBuffer(f,512,r.sampleRate);for(let e=0;e<f;e++){let t=512*e,r=d.subarray(t,t+512);m.copyToChannel(r,e)}let p=r.createBufferSource();if(p.buffer=m,p.connect(r.destination),p.start(a+u),t.sourcesRef.current.push(p),i=p,s=!0,t.trackTransportState&&nf(!0),l)break}if(l)break}if(!s||t.generationRef.current!==n){oz(t.sourcesRef,t.iteratorRef),t.trackTransportState&&nf(!1);return}i&&(i.onended=()=>{t.generationRef.current===n&&(t.sourcesRef.current=[],t.iteratorRef.current=null,t.trackTransportState&&nf(!1))})},oG=async e=>{nc.current&&(nc.current.pause(),nc.current.src="");let t=new Audio(e);nc.current=t,t.onended=()=>nf(!1),await t.play(),nf(!0)},oq=async e=>{if(!f||!f.saveAudio)return void alert("Audio playback is not available in this build.");try{if(np(!0),!await aU(void 0,{forceRetry:!0}))return void alert("No default soundfont found. Configure NEXT_PUBLIC_SOUNDFONT_CDN_URL or provide /public/soundfonts/default.sf3 (or .sf2).");await o$({awaitCancel:!0});let t=e&&"function"==typeof f.synthAudioBatchFromSelection,r=e?t:"function"==typeof f.synthAudioBatch,n=!1,a=null;if(r)try{let e=t?await f.synthAudioBatchFromSelection(1):await f.synthAudioBatch(0,2);await oH(e,{sourcesRef:ny,iteratorRef:nb,generationRef:nv,trackTransportState:!0}),n=!0}catch(e){console.warn("Streaming playback failed; falling back to WAV",e),a=e,await o$({awaitCancel:!0})}if(!n){if(e){if("function"==typeof f.synthAudioBatchFromSelection)if(a){let e=a instanceof Error?a.message:String(a);alert(`Play from selection failed: ${e}`)}else alert("Play from selection is not available in this build.");else alert("Play from selection is not available in this running build. Rebuild webmscore JS glue (`cd webmscore-fork/web-public && npm run bundle`) and restart `npm run dev`.");return}if(nh.current)await oG(nh.current);else{let e=await f.saveAudio("wav"),t=new Blob([e],{type:"audio/wav"}),r=URL.createObjectURL(t);nh.current=r,await oG(r)}}}catch(e){console.error("Failed to play audio",e),alert("Unable to play audio. See console for details."),await o$({awaitCancel:!0})}finally{np(!1)}},oV=async(e="unknown",t,r)=>{let n=p.current??f;if(!n||!n.synthSelectionPreviewBatch||nd||nm)return void console.debug("[AUDITION] skipped preview request",{trigger:e,hasScore:!!n,hasPreviewApi:!!n?.synthSelectionPreviewBatch,isPlaying:nd,audioBusy:nm});let a=r?.reselect??e.startsWith("mutation:"),o=t??n_.current;if(a&&o&&n.selectElementAtPoint)try{let t=await n.selectElementAtPoint(o.page,o.x,o.y);!1===t&&console.warn("[AUDITION] preview reselection returned false",{trigger:e,page:o.page,x:o.x,y:o.y})}catch(t){console.warn("[AUDITION] preview reselection failed",{trigger:e,err:t})}if(!await aU(n,{forceRetry:!0}))return void console.warn("[AUDITION] skipped preview: soundfont unavailable",{trigger:e});await oX({awaitCancel:!0});try{console.debug("[AUDITION] requesting preview stream",{trigger:e,batchSize:1,durationMs:350});let t=await n.synthSelectionPreviewBatch(1,350);await oH(t,{sourcesRef:nx,iteratorRef:nw,generationRef:nS,maxDurationSeconds:.6,trackTransportState:!1}),console.debug("[AUDITION] preview playback started",{trigger:e})}catch(t){console.warn("[AUDITION] selection preview playback failed",{trigger:e,err:t}),await oX({awaitCancel:!0})}},oY=async()=>{await oq(!1)},oK=async()=>{await oq(!0)},oZ=e=>{let t=e?Number.parseFloat(e):NaN;return Number.isFinite(t)?t:0},oQ=e=>{if(!v.current||!b.current||h<=0)return null;let t=v.current,r=window.getComputedStyle(t),n=oZ(r.paddingLeft),a=oZ(r.paddingRight),o=oZ(r.paddingBottom),i=0;if("width"===e)i=t.clientWidth-n-a;else{let e=b.current.offsetTop;i=t.clientHeight-e-o}if(i<=0)return null;let s=b.current.getBoundingClientRect(),l="width"===e?s.width:s.height;if(l<=0)return null;let u=l/h;if(u<=0)return null;let c=i/u;return Number.isFinite(c)?x(c):null},oJ=()=>{let e=oQ("width");null!==e&&g(e)},o0=e=>{let t=(e=>{let t=e;for(;t&&t!==y.current;){let e=t.dataset?.page;if(e&&!Number.isNaN(Number(e))){let t=Number(e);return t>=0?t:null}let r=t.getAttribute("id");if(r){let e=r.match(/page-?(\d+)/i);if(e){let t=Number(e[1]);return Number.isNaN(t)?null:Math.max(t-1,0)}}t=t.parentElement}return null})(e);return null===t||0===t&&nE.current>0?nE.current:t},o1=(e,t)=>{if(!y.current)return null;let r=y.current.getBoundingClientRect();return{x:(e-r.left)/h,y:(t-r.top)/h}},o2=async(e,t)=>{if(!y.current||!f)return null;let r=y.current.getBoundingClientRect(),n=Array.from(y.current.querySelectorAll(eA)).map((t,n)=>{let a=t.getBoundingClientRect(),o={x:(a.left-r.left)/h,y:(a.top-r.top)/h,w:a.width/h,h:a.height/h};if(!(o.w>0&&o.h>0)||!(e.x+e.w>=o.x)||!(o.x+o.w>=e.x)||!(e.y+e.h>=o.y)||!(o.y+o.h>=e.y))return null;let i=o0(t),s=o.x+o.w/2,l=o.y+o.h/2;return{el:t,index:n,pageIndex:i,box:o,centerX:s,centerY:l}}).filter(e=>!!e).sort((e,t)=>e.pageIndex-t.pageIndex||e.box.y-t.box.y||e.box.x-t.box.x||e.index-t.index);if(0===n.length)return!t&&(E(null),N([]),T(null),A(null),X(""),G(null),f.clearSelection&&await f.clearSelection().catch(e=>{console.warn("clearSelection not available or failed:",e)})),null;let a=n[0],o=n.map(e=>({index:e.index,page:e.pageIndex,x:e.box.x,y:e.box.y,w:e.box.w,h:e.box.h,centerX:e.centerX,centerY:e.centerY,classes:e.el.getAttribute("class")??""}));t?N(e=>{let t=new Set;for(let r of e)null!==r.index&&t.add(r.index);let r=[...e];for(let e of o)null!==e.index&&t.has(e.index)||(null!==e.index&&t.add(e.index),r.push(e));return r}):N(o),E(a.box),T({page:a.pageIndex,x:a.centerX,y:a.centerY}),A(a.index);let i={index:a.index,point:{page:a.pageIndex,x:a.centerX,y:a.centerY}};if(f.selectElementAtPointWithMode){let e=n.some(e=>(e.el.getAttribute("class")??"").includes("Note")),r=+!!t;if(e&&n.length>1){let e=n[0],t=n[0];for(let r of n)r.box.x<e.box.x&&(e=r),r.box.x+r.box.w>t.box.x+t.box.w&&(t=r);await f.selectElementAtPointWithMode(e.pageIndex,e.centerX,e.centerY,r),await f.selectElementAtPointWithMode(t.pageIndex,t.centerX,t.centerY,3)}else{await f.selectElementAtPointWithMode(a.pageIndex,a.centerX,a.centerY,r);for(let e=1;e<n.length;e++){let t=n[e];await f.selectElementAtPointWithMode(t.pageIndex,t.centerX,t.centerY,1)}}return i}return f.selectElementAtPoint?(!t&&f.clearSelection&&await f.clearSelection().catch(e=>{console.warn("clearSelection not available or failed:",e)}),await f.selectElementAtPoint(a.pageIndex,a.centerX,a.centerY)):console.warn("selectElementAtPoint is not available; cannot update selection in WASM"),i},o4=async e=>{if("pointer"!==J.current||ee.current!==e.pointerId)return;let t=ea.current,r=en.current,n=er.current;J.current=null,eo.current=!1,ee.current=null,et.current=null,er.current=null,en.current=!1,ea.current=!1;try{e.currentTarget.releasePointerCapture(e.pointerId)}catch{}if(!t||!n)return;Q.current=!0;let a=o1(e.clientX,e.clientY);if(!a)return void Z(null);let o=Math.min(n.x,a.x),i=Math.min(n.y,a.y),s={x:o,y:i,w:Math.max(n.x,a.x)-o,h:Math.max(n.y,a.y)-i};Z(s);let l=await o2(s,r);Z(null),await a9(l)},o8=async e=>{if("mouse"!==J.current||-1!==ee.current)return;let t=ea.current,r=en.current,n=er.current;if(J.current=null,ee.current=null,et.current=null,er.current=null,en.current=!1,ea.current=!1,!t||!n)return;Q.current=!0;let a=o1(e.clientX,e.clientY);if(!a)return void Z(null);let o=Math.min(n.x,a.x),i=Math.min(n.y,a.y),s={x:o,y:i,w:Math.max(n.x,a.x)-o,h:Math.max(n.y,a.y)-i};Z(s);let l=await o2(s,r);Z(null),await a9(l)},o3=e=>{if(Q.current){Q.current=!1;return}if(!y.current)return;let t=()=>{E(null),N([]),T(null),A(null),X(""),G(null),U(!1);let e=()=>aN(f,rO,!1);ei.current=!0,es.current+=1,B(!0),f?.clearSelection?f.clearSelection().then(e).catch(t=>{console.warn("clearSelection not available or failed:",t),e()}):e()},r=e.metaKey||e.ctrlKey||e.shiftKey,n=e.shiftKey&&!e.metaKey&&!e.ctrlKey,a=e.target,o=a,i=!1;for(;o;){if(eN(o.getAttribute("class"))){i=!0;break}if(eI(o)){i=!0,o=eD(o);break}if(o===y.current||null===o.parentElement)break;o=o.parentElement}if(!i||!o){if(f?.selectMeasureAtPoint||f?.selectElementAtPoint){let r=o1(e.clientX,e.clientY);if(!r)return void t();let n=o0(a),o={index:null,point:{page:n,x:r.x,y:r.y}};return void(async()=>!!(f.selectElementAtPoint&&await f.selectElementAtPoint(n,r.x,r.y))||!!f.selectMeasureAtPoint&&await f.selectMeasureAtPoint(n,r.x,r.y))().then(async e=>{if(!1===e)return void t();let r=!1;if(f.getSelectionBoundingBoxes)try{let e=await f.getSelectionBoundingBoxes();if(e&&e.length>0){r=!0;let t=e.map(e=>({x:e.x,y:e.y,width:e.width,height:e.height}));N(t),U(!0)}}catch(e){console.warn("[ScoreEditor] Failed to get selection bounding boxes:",e)}r?(await aN(f,n),oV("selection-click:measure",o.point)):(U(!1),await a9(),oV("selection-click:element",o.point,{reselect:!0}))}).catch(e=>{console.warn("selectMeasureAtPoint/selectElementAtPoint not available or failed:",e),t()})}return void t()}let s=o,l=s.getBoundingClientRect(),u=y.current.getBoundingClientRect(),c=(l.left-u.left)/h,d=(l.top-u.top)/h,m=l.width/h,p=l.height/h;if(m>0&&p>0){let e=o0(s),t=c+m/2,a=d+p/2,l=Array.from(y.current.querySelectorAll(eA)),u=-1;if(i&&o&&(u=l.indexOf(o)),u<0&&(u=l.indexOf(s)),u<0&&s){let e=s;for(;e&&e!==y.current&&!((u=l.indexOf(e))>=0);)e=e.parentElement}let h={index:u>=0?u:null,page:e,x:c,y:d,w:m,h:p,centerX:t,centerY:a,classes:eF(s,s.getAttribute("class")??"")},g={index:h.index,point:{page:e,x:t,y:a}},b=!!f?.selectElementAtPointWithMode,v=r&&null!==h.index&&M.some(e=>e.index===h.index),x=M.length>0,w=b?f.selectElementAtPointWithMode(e,t,a,b?r?v?2:n&&x?3:1:0:null):f?.selectElementAtPoint?.(e,t,a);if(void 0!==w&&Promise.resolve(w).then(e=>{if(!1===e)throw Error("selectElementAtPoint returned false");return a9(g)}).then(()=>{oV("selection-click:element",g.point,{reselect:!r&&!n})}).catch(e=>{console.warn("selectElementAtPoint not available or failed:",e),E(null),N([]),T(null),A(null),X(""),G(null)}),!r){N([h]),E({x:c,y:d,w:m,h:p}),A(h.index),T({page:e,x:t,y:a});return}if(v&&null!==h.index){let e=M.filter(e=>e.index!==h.index);if(N(e),j===h.index){let t=e.at(-1)??null;t?(E({x:t.x,y:t.y,w:t.w,h:t.h}),T({page:t.page,x:t.centerX,y:t.centerY}),A(t.index)):(E(null),T(null),A(null))}return}N([...M,h]),E({x:c,y:d,w:m,h:p}),A(h.index),T({page:e,x:t,y:a})}else E(null),N([]),T(null),A(null),X(""),G(null)},o5=()=>{Y(null)},o6=M.filter(e=>(null===j||e.index!==j)&&(!k||e.x!==k.x||e.y!==k.y||e.w!==k.w||e.h!==k.h)),o7=k?{x:k.x,y:k.y,w:k.w,h:k.h}:1===M.length?{x:M[0].x,y:M[0].y,w:M[0].w,h:M[0].h}:null,o9=eP(z)||!!q,ie=!el||!f?.setSelectedText,it=eG||eV,ir=it||!f||!f?.saveXml,ia=it||!f,io=rt||!f||!f?.saveXml,ii=!io&&t9,is=!io&&t1,il=rv.trim()?rk?{valid:!1,message:rk}:rw?{valid:!0,message:`${rw.ops.length} ops ready`}:{valid:!1,message:"AI output is not a valid patch."}:{valid:!0,message:""},iu=(0,o.useMemo)(()=>{let e=rs.trim();return e?"openai"!==ro||/^gpt-|^o/.test(e)?"anthropic"!==ro||/^claude-/.test(e)?"gemini"!==ro||/^gemini-/.test(e)||e.includes("/")?null:"Gemini models usually start with gemini- (still allowed).":"Claude model names usually start with claude- (still allowed).":"OpenAI model names usually start with gpt- or o- (still allowed).":null},[rs,ro]),ic=io||!r_.trim()||!!rk;return(0,a.jsxs)("div",{className:"flex flex-col h-screen",children:[!d&&(0,a.jsx)("div",{className:"relative",style:{zIndex:100},ref:ns,children:(0,a.jsx)(ew,{onNewScore:()=>{rV(""),rK(""),r2(4),r8(0),r5(4),r7(4),nq.length>0&&(r0(nq[0].id),rQ([nq[0].id])),rG(!0)},onFileUpload:e=>aC(e,{createInitialCheckpoint:!0}),onSoundFontUpload:az,scoreTitle:ey,scoreSubtitle:ev,scoreComposer:ej,scoreLyricist:eM,onScoreTitleChange:eb,onScoreSubtitleChange:ex,onScoreComposerChange:eC,onScoreLyricistChange:eR,onSetTitleText:ow,onSetSubtitleText:oS,onSetComposerText:ok,onSetLyricistText:f?.setLyricistText?oE:void 0,headerTextAvailable:!!(f?.setTitleText&&f?.setComposerText),onZoomIn:()=>{g(e=>x(e+.1))},onZoomOut:()=>{g(e=>x(e-.1))},zoomLevel:h,onFitWidth:oJ,onFitHeight:()=>{let e=oQ("height");null!==e&&g(e)},onDeleteSelection:oe,onUndo:on,onRedo:oa,onPitchUp:oo,onPitchDown:oi,onTranspose:os,onSetAccidental:of,onDurationLonger:()=>a6("lengthen duration",async()=>{await a2();let e=a3("doubleDuration");if(e)return e()},{playSelectionPreview:!0}),onDurationShorter:()=>a6("shorten duration",async()=>{await a2();let e=a3("halfDuration");if(e)return e()},{playSelectionPreview:!0}),mutationsEnabled:el,selectionActive:!!k||M.length>0||!!_,onExportSvg:oF,onExportPdf:oD,onExportPng:oL,onExportMxl:oR,onExportMscz:oB,onExportMidi:oO,onExportAudio:oU,onPlayAudio:oY,onPlayFromSelectionAudio:oK,onStopAudio:()=>{o$({awaitCancel:!0})},isPlaying:nd,audioBusy:nm,exportsEnabled:!!f,pngAvailable:!!f?.savePng,audioAvailable:!!f?.saveAudio,onSetTimeSignature:oM,onSetKeySignature:oN,onSetClef:oP,onToggleDot:om,onToggleDoubleDot:()=>a6("toggle double dot",async()=>{await a2();let e=a3("toggleDoubleDot");if(e)return e()},{playSelectionPreview:!0}),onSetDurationType:op,onToggleLineBreak:oy,onTogglePageBreak:ob,onSetVoice:e=>k||M.length>0?a6(`change voice ${e+1}`,async()=>{await a2();let t=a3("changeSelectedElementsVoice");if(t)return t(e)}):void alert("Select notes or rests to move them to another voice."),onAddDynamic:e=>a6("add dynamic",async()=>{await a2();let t=a3("addDynamic");if(t)return t(e)}),onAddHairpin:e=>a6("add hairpin",async()=>{await a2();let t=a3("addHairpin");if(t)return t(e)}),onAddPedal:e=>a6("add pedal",async()=>{await a2();let t=a3("addPedal");if(t)return t(e)}),onAddSostenutoPedal:()=>a6("add sostenuto pedal",async()=>{await a2();let e=a3("addSostenutoPedal");if(e)return e()}),onAddUnaCorda:()=>a6("add una corda",async()=>{await a2();let e=a3("addUnaCorda");if(e)return e()}),onSplitPedal:()=>a6("split pedal",async()=>{await a2();let e=a3("splitPedal");if(e)return e()}),onAddTempoText:e=>a6("add tempo text",async()=>{let t=a3("addTempoText");if(t)return t(e)},k?void 0:{clearSelection:!0}),onAddStaffText:()=>{let e=a5("Staff text:");if(null!==e)return a6("add staff text",async()=>{await a2();let t=a3("addStaffText");if(t)return t(e)})},onAddSystemText:()=>{let e=a5("System text:");if(null!==e)return a6("add system text",async()=>{await a2();let t=a3("addSystemText");if(t)return t(e)})},onAddExpressionText:()=>{let e=a5("Expression text:");if(null!==e)return a6("add expression text",async()=>{await a2();let t=a3("addExpressionText");if(t)return t(e)})},onAddLyricText:()=>{let e=a5("Lyrics text:");if(null!==e)return a6("add lyric text",async()=>{await a2();let t=a3("addLyricText");if(t)return t(e)})},onAddHarmonyText:e=>{let t=ox[e],r=a5(`${t} text:`);if(null!==r)return a6(`${t.toLowerCase()} text`,async()=>{await a2();let t=a3("addHarmonyText");if(t)return t(e,r)})},onAddFingeringText:()=>{let e=a5("Fingering text:");if(null!==e)return a6("add fingering text",async()=>{await a2();let t=a3("addFingeringText");if(t)return t(e)})},onAddLeftHandGuitarFingeringText:()=>{let e=a5("Left-hand guitar fingering text:");if(null!==e)return a6("add left-hand guitar fingering text",async()=>{await a2();let t=a3("addLeftHandGuitarFingeringText");if(t)return t(e)})},onAddRightHandGuitarFingeringText:()=>{let e=a5("Right-hand guitar fingering text:");if(null!==e)return a6("add right-hand guitar fingering text",async()=>{await a2();let t=a3("addRightHandGuitarFingeringText");if(t)return t(e)})},onAddStringNumberText:()=>{let e=a5("String number text:");if(null!==e)return a6("add string number text",async()=>{await a2();let t=a3("addStringNumberText");if(t)return t(e)})},onAddInstrumentChangeText:()=>{let e=a5("Instrument change text:");if(null!==e)return a6("add instrument change text",async()=>{await a2();let t=a3("addInstrumentChangeText");if(t)return t(e)})},onAddStickingText:()=>{let e=a5("Sticking text:");if(null!==e)return a6("add sticking text",async()=>{await a2();let t=a3("addStickingText");if(t)return t(e)})},onAddFiguredBassText:()=>{let e=a5("Figured bass text:");if(null!==e)return a6("add figured bass text",async()=>{await a2();let t=a3("addFiguredBassText");if(t)return t(e)})},onAddArticulation:e=>a6(`add articulation ${e}`,async()=>{await a2();let t=a3("addArticulation");if(t)return t(e)}),onAddSlur:()=>a6("add slur",async()=>{await a2();let e=a3("addSlur");if(e)return e()}),onAddTie:ov,onAddGraceNote:e=>a6(`add grace note ${e}`,async()=>{await a2();let t=a3("addGraceNote");if(t)return t(e)}),onAddTuplet:e=>a6(`add tuplet ${e}`,async()=>{await a2();let t=a3("addTuplet");if(t)return t(e)}),onAddNoteFromRest:()=>a6("add note",async()=>{await a2();let e=a3("addNoteFromRest");if(e)return e()},{playSelectionPreview:!0}),onToggleRepeatStart:()=>a6("toggle repeat start",async()=>{await a2();let e=a3("toggleRepeatStart");if(e)return e()}),onToggleRepeatEnd:()=>a6("toggle repeat end",async()=>{await a2();let e=a3("toggleRepeatEnd");if(e)return e()}),onSetRepeatCount:e=>a6(`set repeat count ${e}`,async()=>{await a2();let t=a3("setRepeatCount");if(t)return t(e)}),onSetBarLineType:e=>a6(`set barline type ${e}`,async()=>{await a2();let t=a3("setBarLineType");if(t)return t(e)}),onAddVolta:e=>a6(`add volta ${e}`,async()=>{await a2();let t=a3("addVolta");if(t)return t(e)}),onInsertMeasures:(e,t)=>a6("insert measures",async()=>{await a2();let r=a3("insertMeasures");return!!r&&r(Math.max(1,Math.floor(e)),eT[t]??eT["after-selection"])}),onRemoveTrailingEmptyMeasures:()=>a6("remove trailing empty measures",async()=>{let e=a3("removeTrailingEmptyMeasures");return!!e&&e()},{clearSelection:!0,skipWasmReselect:!0}),insertMeasuresDisabled:!f?.insertMeasures,parts:eB,instrumentGroups:eU,onAddPart:o_,onRemovePart:oT,onTogglePartVisible:oj,selectedTextActive:o9,selectedTextValue:$,onSelectedTextChange:ot,onApplySelectedText:or,selectedTextDisabled:ie})}),(0,a.jsxs)("div",{className:"flex flex-1 min-h-0",children:[!d&&(0,a.jsxs)("aside",{className:`shrink-0 border-r bg-white text-sm ${"full"===t4?"hidden":t$?"w-12":"w-72"} ${t$?"":"overflow-y-auto"}`,"data-testid":"checkpoint-sidebar",children:[(0,a.jsxs)("div",{className:t$?"flex items-center justify-center p-2":"flex items-center justify-between p-4",children:[!t$&&(0,a.jsx)("span",{className:"text-xs font-semibold uppercase tracking-wide text-gray-500",children:"Checkpoints"}),(0,a.jsxs)("div",{className:t$?"":"flex items-center gap-2",children:[!t$&&(0,a.jsx)("button",{type:"button","data-testid":"btn-checkpoint-refresh",onClick:a_,disabled:it,className:"text-xs font-medium text-gray-600 hover:text-gray-900 disabled:opacity-50 disabled:cursor-not-allowed",children:"Refresh"}),(0,a.jsx)("button",{type:"button","data-testid":"btn-checkpoint-toggle","aria-expanded":!t$,"aria-controls":"checkpoint-sidebar-content","aria-label":t$?"Show checkpoints":"Hide checkpoints",onClick:()=>tW(e=>!e),className:"text-xs font-medium text-gray-600 hover:text-gray-900",children:t$?">>":"<<"})]})]}),!t$&&(0,a.jsxs)("div",{id:"checkpoint-sidebar-content",className:"px-4 pb-4",children:[(0,a.jsxs)("div",{className:"mt-3 flex gap-2 text-xs font-medium text-gray-600",children:[(0,a.jsx)("button",{type:"button","data-testid":"tab-checkpoints",onClick:()=>tG("checkpoints"),className:`rounded border px-2 py-1 ${"checkpoints"===tH?"border-gray-400 bg-gray-100 text-gray-900":"border-transparent text-gray-500 hover:text-gray-700"}`,children:"Checkpoints"}),(0,a.jsx)("button",{type:"button","data-testid":"tab-scores",onClick:()=>tG("scores"),className:`rounded border px-2 py-1 ${"scores"===tH?"border-gray-400 bg-gray-100 text-gray-900":"border-transparent text-gray-500 hover:text-gray-700"}`,children:"Scores"})]}),"checkpoints"===tH&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"mt-3 flex flex-col gap-2",children:[(0,a.jsx)("input",{"data-testid":"input-checkpoint-label",type:"text",value:eW,onChange:e=>eH(e.target.value),placeholder:"Checkpoint label",className:"w-full rounded border border-gray-300 px-2 py-1 text-sm focus:border-blue-500 focus:outline-none"}),(0,a.jsx)("button",{type:"button","data-testid":"btn-checkpoint-save",onClick:a$,disabled:ir,className:`w-full rounded border px-3 py-1 text-sm font-medium disabled:opacity-50 disabled:cursor-not-allowed ${!ir&&tJ?"border-blue-600 bg-blue-600 text-white hover:bg-blue-700":"border-gray-300 bg-white text-gray-700 hover:bg-gray-50"}`,children:"Save Checkpoint"}),!f&&(0,a.jsx)("span",{className:"text-xs text-gray-400",children:"Load a score to enable checkpoints."})]}),eK&&(0,a.jsx)("div",{className:"mt-3 text-xs text-red-600",children:eK}),eV&&(0,a.jsx)("div",{className:"mt-3 text-xs text-gray-400",children:"Loading checkpoints..."}),!eV&&0===eX.length&&(0,a.jsx)("div",{className:"mt-3 text-xs text-gray-400",children:"No checkpoints yet."}),(0,a.jsx)("div",{className:"mt-3 space-y-3",children:eX.map(e=>(0,a.jsxs)("div",{className:"rounded border border-gray-200 p-2",children:[(0,a.jsx)("div",{className:"text-sm font-medium text-gray-800",children:e.title}),(0,a.jsxs)("div",{className:"text-xs text-gray-500",children:[nU(e.createdAt),e.size?` \xb7 ${(e=>{if(!Number.isFinite(e))return"";let t=["B","KB","MB","GB"],r=e,n=0;for(;r>=1024&&n<t.length-1;)r/=1024,n+=1;let a=r>=10||0===n?0:1;return`${r.toFixed(a)} ${t[n]}`})(e.size)}`:""]}),(0,a.jsxs)("div",{className:"mt-2 flex flex-wrap gap-2",children:[(0,a.jsx)("button",{type:"button","data-testid":`btn-checkpoint-restore-${e.id}`,onClick:()=>aH(e),disabled:it,className:"rounded border border-gray-300 px-2 py-1 text-xs text-gray-700 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"Restore"}),(0,a.jsx)("button",{type:"button","data-testid":`btn-checkpoint-compare-${e.id}`,onClick:()=>aG(e),disabled:ia,className:"rounded border border-gray-300 px-2 py-1 text-xs text-gray-700 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"Compare"}),(0,a.jsx)("button",{type:"button","data-testid":`btn-checkpoint-delete-${e.id}`,onClick:()=>aZ(e),disabled:it,className:"rounded border border-gray-300 px-2 py-1 text-xs text-red-600 hover:bg-red-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"Delete"})]})]},e.id))})]}),"scores"===tH&&(0,a.jsxs)(a.Fragment,{children:[tZ&&(0,a.jsx)("div",{className:"mt-3 text-xs text-red-600",children:tZ}),tY&&(0,a.jsx)("div",{className:"mt-3 text-xs text-gray-400",children:"Loading scores..."}),!tY&&0===tq.length&&(0,a.jsx)("div",{className:"mt-3 text-xs text-gray-400",children:"No saved scores yet."}),(0,a.jsx)("div",{className:"mt-3 space-y-3",children:tq.map(e=>{let t=(e=>{if(e.startsWith("url:")){let t=e.slice(4);return{title:t.split("/").pop()||t,detail:t,type:"url"}}return e.startsWith("file:")?{title:e.slice(5).split(":")[0]||"File import",detail:"File import",type:"file"}:e.startsWith("new:")?{title:"New score",detail:e.slice(4),type:"new"}:"legacy"===e?{title:"Legacy checkpoints",detail:"Unscoped checkpoints",type:"legacy"}:{title:e,detail:"",type:"other"}})(e.scoreId),r=e.scoreId===r$;return(0,a.jsxs)("div",{className:`rounded border p-2 ${r?"border-blue-300 bg-blue-50":"border-gray-200"}`,children:[(0,a.jsxs)("div",{className:"flex items-center justify-between gap-2",children:[(0,a.jsx)("div",{className:"text-sm font-medium text-gray-800",children:t.title}),r&&(0,a.jsx)("span",{className:"text-[10px] font-semibold uppercase text-blue-700",children:"Current"})]}),t.detail&&(0,a.jsx)("div",{className:"text-xs text-gray-500 break-all",children:t.detail}),(0,a.jsxs)("div",{className:"mt-1 text-xs text-gray-500",children:[e.count," checkpoint",1===e.count?"":"s",e.lastUpdated?` \xb7 ${nU(e.lastUpdated)}`:""]}),(0,a.jsx)("div",{className:"mt-2 flex flex-wrap gap-2",children:(0,a.jsx)("button",{type:"button",onClick:()=>(e=>{if(!e.scoreId.startsWith("url:")){var t;return void((t=e.scoreId)&&(rW(t),!t.startsWith("url:")&&n$(t),tG("checkpoints")))}let r=e.scoreId.slice(4),n=new URL(window.location.href);n.searchParams.set("score",r),n.searchParams.delete("scoreId"),window.location.assign(n.toString())})(e),className:"rounded border border-gray-300 px-2 py-1 text-xs text-gray-700 hover:bg-gray-50",children:"Open score"})})]},e.scoreId)})})]})]})]}),(0,a.jsxs)("div",{ref:v,className:`relative z-0 flex-1 overflow-auto bg-gray-50 p-8 ${"full"===t4?"hidden":""}`,children:[w&&(0,a.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,a.jsx)("div",{className:"text-xl text-gray-500",children:"Loading score..."})}),!w&&!f&&(0,a.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,a.jsx)("div",{className:"text-xl text-gray-400",children:"No score loaded. Open a file to begin."})}),!w&&f&&(0,a.jsxs)("div",{className:"mb-3 flex items-center justify-end gap-2 text-sm text-gray-600",children:[(0,a.jsxs)("span",{"data-testid":"page-indicator",children:["Page ",rO+1," of ",rz]}),(0,a.jsx)("select",{className:"px-2 py-1 border border-gray-300 rounded bg-white text-sm",onChange:e=>{let t=Number(e.target.value);Number.isNaN(t)||a8(t)},value:rO,"data-testid":"page-select",children:Array.from({length:rz},(e,t)=>(0,a.jsxs)("option",{value:t,children:["Page ",t+1]},t))}),(0,a.jsx)("button",{type:"button",onClick:()=>void(!(rO<=0)&&a8(rO-1)),disabled:rO<=0,className:"px-3 py-1 bg-white border border-gray-300 rounded hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"Prev"}),(0,a.jsx)("button",{type:"button",onClick:()=>void(!(rO>=rz-1)&&a8(rO+1)),disabled:rO>=rz-1,className:"px-3 py-1 bg-white border border-gray-300 rounded hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"Next"})]}),(0,a.jsxs)("div",{ref:b,className:"relative origin-top-left transition-transform duration-200 ease-out bg-white shadow-lg mx-auto","data-testid":"score-wrapper",style:{transform:`scale(${h})`,width:"fit-content"},onClick:o3,onPointerDown:e=>{if(0!==e.button||J.current&&"pointer"!==J.current||null!==ee.current||!y.current||!f)return;let t=o1(e.clientX,e.clientY);t&&(ee.current=e.pointerId,J.current="pointer",eo.current=!1,et.current={x:e.clientX,y:e.clientY},er.current=t,en.current=e.metaKey||e.ctrlKey,ea.current=!1)},onPointerMove:e=>{if("pointer"!==J.current||(eo.current=!0,ee.current!==e.pointerId))return;let t=et.current,r=er.current;if(!t||!r)return;let n=e.clientX-t.x,a=e.clientY-t.y;if(!ea.current){if(4>Math.hypot(n,a))return;ea.current=!0;try{e.currentTarget.setPointerCapture(e.pointerId)}catch{}}let o=o1(e.clientX,e.clientY);if(!o)return;let i=Math.min(r.x,o.x),s=Math.min(r.y,o.y);Z({x:i,y:s,w:Math.max(r.x,o.x)-i,h:Math.max(r.y,o.y)-s}),e.preventDefault()},onPointerUp:o4,onPointerCancel:e=>{if("pointer"===J.current&&ee.current===e.pointerId){J.current=null,eo.current=!1,ee.current=null,et.current=null,er.current=null,en.current=!1,ea.current=!1,Z(null);try{e.currentTarget.releasePointerCapture(e.pointerId)}catch{}}},onMouseDown:e=>{if(0!==e.button||"pointer"===J.current||null!==ee.current||!y.current||!f)return;let t=o1(e.clientX,e.clientY);t&&(J.current="mouse",ee.current=-1,eo.current=!1,et.current={x:e.clientX,y:e.clientY},er.current=t,en.current=e.metaKey||e.ctrlKey,ea.current=!1)},onMouseMove:e=>{if("pointer"===J.current&&!eo.current&&null!==ee.current){let t=et.current,r=er.current;if(!t||!r)return;let n=e.clientX-t.x,a=e.clientY-t.y;if(!ea.current){if(4>Math.hypot(n,a))return;ea.current=!0;try{e.currentTarget.setPointerCapture(ee.current)}catch{}}let o=o1(e.clientX,e.clientY);if(!o)return;let i=Math.min(r.x,o.x),s=Math.min(r.y,o.y);Z({x:i,y:s,w:Math.max(r.x,o.x)-i,h:Math.max(r.y,o.y)-s}),e.preventDefault();return}if("mouse"!==J.current||-1!==ee.current)return;let t=et.current,r=er.current;if(!t||!r)return;let n=e.clientX-t.x,a=e.clientY-t.y;if(!ea.current){if(4>Math.hypot(n,a))return;ea.current=!0}let o=o1(e.clientX,e.clientY);if(!o)return;let i=Math.min(r.x,o.x),s=Math.min(r.y,o.y);Z({x:i,y:s,w:Math.max(r.x,o.x)-i,h:Math.max(r.y,o.y)-s}),e.preventDefault()},onMouseUp:o8,onContextMenu:e=>{(e=>{if(!y.current||!f)return;let t=e.target,r=!1;for(;t;){if(eI(t)){r=!0,t=eD(t);break}if(t===y.current)break;t=t.parentElement}r&&t?(e.preventDefault(),o3(e),Y({x:e.clientX,y:e.clientY})):Y(null)})(e)},children:[(0,a.jsx)("div",{ref:y,"data-testid":"svg-container"}),K&&(0,a.jsx)("div",{"data-testid":"drag-selection-rect",className:"absolute border border-blue-600 bg-blue-200 bg-opacity-20 pointer-events-none",style:{left:K.x,top:K.y,width:K.w,height:K.h}}),o6.map((e,t)=>(0,a.jsx)("div",{className:"absolute pointer-events-none",style:{left:e.x,top:e.y,width:e.w,height:e.h}},t)),o7&&!R&&M.length<=1&&(0,a.jsx)("div",{"data-testid":"selection-overlay",className:"absolute pointer-events-none border-2 border-blue-600",style:{left:o7.x,top:o7.y,width:o7.w,height:o7.h}}),M.length>1&&!R&&!O&&M.map((e,t)=>(0,a.jsx)("div",{"data-testid":`selection-overlay-${t}`,className:`absolute pointer-events-none ${e.isMeasureBbox?"border border-blue-400/50":"bg-blue-200/40 border border-blue-400/60"}`,style:{left:e.x,top:e.y,width:e.w,height:e.h}},t)),q&&(0,a.jsxs)("div",{className:"fixed z-50 flex flex-col gap-2 rounded border bg-white p-3 shadow-lg",style:{left:q.x,top:q.y},onClick:e=>e.stopPropagation(),onMouseDown:e=>e.stopPropagation(),onPointerDown:e=>e.stopPropagation(),children:[(0,a.jsx)("label",{className:"text-xs uppercase tracking-wide text-gray-500",children:"Text content"}),(0,a.jsx)("input",{"data-testid":"ctxmenu-text-input",type:"text",value:$,onChange:e=>ot(e.target.value),onClick:e=>e.stopPropagation(),className:"min-w-[200px] rounded border border-gray-300 px-2 py-1 text-sm focus:border-blue-500 focus:outline-none"}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)("button",{type:"button",onClick:()=>{or(),o5()},className:"flex-1 rounded border border-gray-300 px-3 py-1 text-sm font-medium text-gray-700 hover:bg-gray-100",children:"Save"}),(0,a.jsx)("button",{type:"button",onClick:o5,className:"flex-1 rounded border border-gray-300 px-3 py-1 text-sm font-medium text-gray-700 hover:bg-gray-100",children:"Cancel"})]})]})]})]}),(0,a.jsxs)("aside",{className:`shrink-0 border-l bg-white text-sm ${"closed"===t4?"w-12":"full"===t4?"flex-1 w-full max-w-full":"w-80"} ${"closed"===t4?"":"overflow-y-auto"}`,"data-testid":"xml-sidebar",children:[(0,a.jsxs)("div",{className:"sticky top-0 z-10 bg-white",children:[(0,a.jsxs)("div",{className:"closed"===t4?"flex items-center justify-center p-2":"flex items-center justify-between p-4",children:["closed"!==t4&&(0,a.jsx)("span",{className:"text-xs font-semibold uppercase tracking-wide text-gray-500",children:"MusicXML"}),(0,a.jsx)("button",{type:"button","data-testid":"btn-xml-toggle","aria-expanded":"closed"!==t4,"aria-controls":"xml-sidebar-content","aria-label":"closed"===t4?"Open MusicXML sidebar":"open"===t4?"Expand MusicXML sidebar":"Close MusicXML sidebar",onClick:()=>{t8(e=>"closed"===e?"open":"open"===e?"full":"closed")},className:"text-xs font-medium text-gray-600 hover:text-gray-900",children:"closed"===t4?"Open":"open"===t4?"Full":"Close"})]}),"closed"!==t4&&(0,a.jsxs)("div",{className:"px-4 pb-3",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between text-xs text-gray-500",children:[(0,a.jsx)("span",{children:0===eX.length?"No checkpoint yet":tJ?"Unsaved score changes":""}),rt&&(0,a.jsx)("span",{children:"Loading..."})]}),(0,a.jsxs)("div",{className:"mt-3 flex items-center justify-between text-xs font-medium text-gray-600",children:[(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)("button",{type:"button","data-testid":"tab-xml",onClick:()=>t5("xml"),className:`rounded border px-2 py-1 ${"xml"===t3?"border-gray-400 bg-gray-100 text-gray-900":"border-transparent text-gray-500 hover:text-gray-700"}`,children:"XML"}),(0,a.jsx)("button",{type:"button","data-testid":"tab-ai",onClick:()=>t5("assistant"),className:`rounded border px-2 py-1 ${"assistant"===t3?"border-gray-400 bg-gray-100 text-gray-900":"border-transparent text-gray-500 hover:text-gray-700"}`,children:"Assistant"})]}),(0,a.jsx)("div",{})]})]})]}),"closed"!==t4&&(0,a.jsxs)("div",{id:"xml-sidebar-content",className:"px-4 pb-4",children:["xml"===t3&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"mt-3 flex flex-wrap gap-2",children:[(0,a.jsx)("button",{type:"button","data-testid":"btn-xml-apply",onClick:aK,disabled:!ii,title:"Applying edits will auto-checkpoint if the score has unsaved changes.",className:`flex-1 rounded border px-3 py-1 text-xs font-medium disabled:opacity-50 disabled:cursor-not-allowed ${ii?"border-blue-600 bg-blue-600 text-white hover:bg-blue-700":"border-gray-300 bg-white text-gray-700"}`,children:"Apply edits"}),(0,a.jsx)("button",{type:"button","data-testid":"btn-xml-reload",onClick:aY,disabled:!is,title:is?"The score has changed, reload to update XML. Any XML changes will be lost on update.":void 0,className:`flex-1 rounded border px-3 py-1 text-xs font-medium disabled:opacity-50 disabled:cursor-not-allowed ${is?"border-blue-600 bg-blue-600 text-white hover:bg-blue-700":"border-gray-300 bg-white text-gray-700"}`,children:"Reload"})]}),(0,a.jsx)("div",{className:"mt-2",children:(0,a.jsx)(V,{testId:"xml-editor",value:t6,onChange:e=>{t7(e),re(!0)},readOnly:io,placeholderText:f?"MusicXML will appear here.":"Load a score to view MusicXML.",language:"xml",height:"full"===t4?"55vh":"45vh",maxHeight:"full"===t4?"65vh":"55vh"})})]}),"assistant"===t3&&(0,a.jsxs)("div",{className:"mt-3 space-y-3 text-sm text-gray-700",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-xs font-semibold uppercase tracking-wide text-gray-500",children:"Provider"}),(0,a.jsx)("select",{value:ro,onChange:e=>ri(e.target.value),className:"mt-1 w-full rounded border border-gray-300 px-2 py-1 text-sm",children:Object.keys(ek).map(e=>(0,a.jsx)("option",{value:e,children:ek[e]},e))})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-xs font-semibold uppercase tracking-wide text-gray-500",children:"Model"}),(0,a.jsx)("input",{list:"ai-models",value:rs,onChange:e=>rl(e.target.value),className:"mt-1 w-full rounded border border-gray-300 px-2 py-1 text-sm",placeholder:"Enter model name"}),(0,a.jsx)("datalist",{id:"ai-models",children:rI.map(e=>(0,a.jsx)("option",{value:e},e))}),rD&&(0,a.jsx)("div",{className:"mt-1 text-[11px] text-gray-500",children:"Loading models..."}),!rD&&!rI.length&&!rR&&(0,a.jsx)("div",{className:"mt-1 text-[11px] text-gray-500",children:"No models loaded. Enter a model name manually."}),rR&&(0,a.jsx)("div",{className:"mt-1 text-xs text-red-600",children:rR}),iu&&(0,a.jsx)("div",{className:"mt-1 text-[11px] text-amber-600",children:iu})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{className:"text-xs font-semibold uppercase tracking-wide text-gray-500",children:["API Key (",ek[ro],")"]}),(0,a.jsx)("input",{type:"password",value:ru,onChange:e=>rc(e.target.value),className:"mt-1 w-full rounded border border-gray-300 px-2 py-1 text-sm",placeholder:"Paste your key"}),(0,a.jsx)("div",{className:"mt-1 text-[11px] text-gray-500",children:"Stored locally in this browser. Requests are sent directly unless a proxy is configured."})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between gap-2 text-xs text-gray-600",children:[(0,a.jsxs)("label",{className:"flex items-center gap-2",children:[(0,a.jsx)("input",{type:"checkbox",checked:rm,onChange:e=>rp(e.target.checked)}),"Include full MusicXML"]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("span",{children:"Max output"}),(0,a.jsxs)("select",{value:rh,onChange:e=>rg(e.target.value),className:"rounded border border-gray-300 px-2 py-1 text-xs",children:[(0,a.jsx)("option",{value:"auto",children:"Auto"}),(0,a.jsx)("option",{value:"custom",children:"Custom"})]}),"custom"===rh&&(0,a.jsx)("input",{type:"number",min:256,value:ry,onChange:e=>rb(Number(e.target.value)||0),className:"w-20 rounded border border-gray-300 px-2 py-1 text-xs"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-xs font-semibold uppercase tracking-wide text-gray-500",children:"Instruction"}),(0,a.jsx)("textarea",{value:rd,onChange:e=>rf(e.target.value),rows:4,className:"mt-1 w-full rounded border border-gray-300 px-2 py-1 text-sm",placeholder:"Describe the change you want in the MusicXML."})]}),(0,a.jsx)("button",{type:"button",onClick:a0,disabled:rC,className:"w-full rounded border border-gray-300 bg-white px-3 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:rC?"Working...":"Generate Patch"}),rN&&(0,a.jsx)("div",{className:"text-xs text-red-600",children:rN}),rv&&(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between text-xs text-gray-500",children:[(0,a.jsx)("span",{children:"AI Patch"}),il.message&&(0,a.jsx)("span",{className:il.valid?"text-gray-500":"text-red-600",children:il.message})]}),(0,a.jsx)("button",{type:"button",onClick:a1,disabled:ic,title:"Applying edits will auto-checkpoint if the score has unsaved changes.",className:"w-full rounded border border-gray-300 bg-white px-3 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"Apply Patch"}),(0,a.jsx)(V,{value:rv,onChange:e=>{aJ(e)},readOnly:!1,language:"json",placeholderText:"AI patch will appear here.",height:"35vh",maxHeight:"45vh"})]})]}),rn&&(0,a.jsx)("div",{className:"mt-2 text-xs text-red-600",children:rn})]})]}),rH&&(0,a.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/40 p-6","data-testid":"new-score-modal",children:(0,a.jsxs)("div",{className:"w-full max-w-xl rounded bg-white p-4 shadow-lg",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("div",{className:"text-sm font-semibold text-gray-800",children:"New Score"}),(0,a.jsx)("button",{type:"button",onClick:()=>rG(!1),className:"rounded border border-gray-300 px-2 py-1 text-xs text-gray-700 hover:bg-gray-50",children:"Close"})]}),(0,a.jsxs)("div",{className:"mt-4 grid gap-3 text-sm text-gray-700",children:[(0,a.jsx)("div",{className:"rounded border border-amber-200 bg-amber-50 px-3 py-2 text-xs text-amber-900",children:"Creating a new score will replace the current score and switch to a new checkpoint set. Export your score if you want a copy; you can return to the previous URL to access older checkpoints."}),nt&&(0,a.jsx)("div",{className:"rounded border border-amber-200 bg-amber-50 px-3 py-2 text-xs text-amber-900",children:nt}),no&&(0,a.jsx)("div",{className:"rounded border border-amber-200 bg-amber-50 px-3 py-2 text-xs text-amber-900",children:no}),(0,a.jsxs)("label",{className:"flex flex-col gap-1",children:[(0,a.jsx)("span",{className:"text-xs font-semibold uppercase tracking-wide text-gray-500",children:"Title"}),(0,a.jsx)("input",{type:"text",value:rq,onChange:e=>rV(e.target.value),className:"rounded border border-gray-300 px-2 py-1 text-sm",placeholder:"Untitled score"})]}),(0,a.jsxs)("label",{className:"flex flex-col gap-1",children:[(0,a.jsx)("span",{className:"text-xs font-semibold uppercase tracking-wide text-gray-500",children:"Composer"}),(0,a.jsx)("input",{type:"text",value:rY,onChange:e=>rK(e.target.value),className:"rounded border border-gray-300 px-2 py-1 text-sm",placeholder:"Composer"})]}),(0,a.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,a.jsx)("span",{className:"text-xs font-semibold uppercase tracking-wide text-gray-500",children:"Instruments"}),nq.length>0?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsxs)("select",{value:rJ,onChange:e=>r0(e.target.value),className:"flex-1 rounded border border-gray-300 px-2 py-1 text-sm",children:[nY.length>0&&(0,a.jsx)("optgroup",{label:"Common",children:nY.map((e,t)=>(0,a.jsx)("option",{value:e.instrument.id,children:e.label},`common-${e.instrument.id}-${t}`))}),nG.length>0?nG.map(e=>(0,a.jsx)("optgroup",{label:e.name,children:e.instruments.map(e=>(0,a.jsx)("option",{value:e.id,children:e.name},e.id))},e.id)):nq.map(e=>(0,a.jsx)("option",{value:e.id,children:e.label},e.id))]}),(0,a.jsx)("button",{type:"button",onClick:()=>{rJ&&rQ(e=>[...e,rJ])},disabled:!rJ,className:"rounded border border-gray-300 bg-white px-3 py-1 text-sm text-gray-700 hover:bg-gray-50 disabled:cursor-not-allowed disabled:opacity-50",children:"Add"})]}),(0,a.jsx)("div",{className:"space-y-1 rounded border border-gray-200 bg-gray-50 p-2 text-xs text-gray-700",children:rZ.length>0?rZ.map((e,t)=>{let r=nq.find(t=>t.id===e),n=r?.label||r?.name||e;return(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("span",{className:"flex-1 truncate",children:n}),(0,a.jsx)("button",{type:"button",onClick:()=>{rQ(e=>e.filter((e,r)=>r!==t))},className:"rounded border border-gray-300 bg-white px-2 py-0.5 text-[11px] text-gray-700 hover:bg-gray-100",children:"Remove"})]},`${e}-${t}`)}):(0,a.jsx)("div",{className:"text-gray-500",children:"No instruments selected."})})]}):(0,a.jsx)("div",{className:"rounded border border-gray-200 bg-gray-50 px-2 py-1 text-xs text-gray-500",children:"Instrument list unavailable."})]}),(0,a.jsxs)("div",{className:"grid gap-3 sm:grid-cols-2",children:[(0,a.jsxs)("label",{className:"flex flex-col gap-1",children:[(0,a.jsx)("span",{className:"text-xs font-semibold uppercase tracking-wide text-gray-500",children:"Measures"}),(0,a.jsx)("input",{type:"number",min:1,value:r1,onChange:e=>r2(Number(e.target.value)||1),className:"rounded border border-gray-300 px-2 py-1 text-sm"})]}),(0,a.jsxs)("label",{className:"flex flex-col gap-1",children:[(0,a.jsx)("span",{className:"text-xs font-semibold uppercase tracking-wide text-gray-500",children:"Key Signature"}),(0,a.jsx)("select",{value:String(r4),onChange:e=>r8(Number(e.target.value)),className:"rounded border border-gray-300 px-2 py-1 text-sm",children:[{label:"C",fifths:0},{label:"G",fifths:1},{label:"D",fifths:2},{label:"A",fifths:3},{label:"E",fifths:4},{label:"B",fifths:5},{label:"F#",fifths:6},{label:"C#",fifths:7},{label:"F",fifths:-1},{label:"Bb",fifths:-2},{label:"Eb",fifths:-3},{label:"Ab",fifths:-4},{label:"Db",fifths:-5},{label:"Gb",fifths:-6},{label:"Cb",fifths:-7}].map(e=>(0,a.jsx)("option",{value:e.fifths,children:e.label},e.fifths))})]})]}),(0,a.jsxs)("label",{className:"flex flex-col gap-1",children:[(0,a.jsx)("span",{className:"text-xs font-semibold uppercase tracking-wide text-gray-500",children:"Time Signature"}),(0,a.jsx)("select",{value:`${r3}/${r6}`,onChange:e=>{let[t,r]=e.target.value.split("/").map(e=>Number(e));Number.isFinite(t)&&Number.isFinite(r)&&(r5(t),r7(r))},className:"rounded border border-gray-300 px-2 py-1 text-sm",children:[{label:"4/4",numerator:4,denominator:4},{label:"3/4",numerator:3,denominator:4},{label:"2/4",numerator:2,denominator:4},{label:"6/8",numerator:6,denominator:8},{label:"2/2",numerator:2,denominator:2},{label:"5/4",numerator:5,denominator:4},{label:"7/8",numerator:7,denominator:8},{label:"3/8",numerator:3,denominator:8},{label:"9/8",numerator:9,denominator:8},{label:"12/8",numerator:12,denominator:8}].map(e=>(0,a.jsx)("option",{value:`${e.numerator}/${e.denominator}`,children:e.label},e.label))})]})]}),(0,a.jsxs)("div",{className:"mt-4 flex gap-2",children:[(0,a.jsx)("button",{type:"button",onClick:aX,className:"flex-1 rounded border border-gray-300 bg-blue-600 px-3 py-2 text-sm font-medium text-white hover:bg-blue-700",children:"Create Score"}),(0,a.jsx)("button",{type:"button",onClick:()=>rG(!1),className:"flex-1 rounded border border-gray-300 bg-white px-3 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50",children:"Cancel"})]})]})}),eQ&&(0,a.jsx)("div",{className:d?"fixed inset-0 z-50 flex items-start justify-center overflow-hidden bg-gray-50":"fixed bottom-0 left-0 right-0 z-50 flex items-start justify-center overflow-hidden bg-black/40 p-6",style:d?{}:af,"data-testid":"checkpoint-compare-modal",children:(0,a.jsxs)("div",{className:d?"flex min-h-0 w-full h-full flex-col gap-4 overflow-hidden bg-white":"flex min-h-0 w-full flex-col gap-4 overflow-hidden rounded bg-white p-4 shadow-lg",style:d?{}:{maxHeight:am,maxWidth:"calc(100dvw - 3rem)"},children:[!d&&(0,a.jsxs)("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsx)("div",{className:"text-sm font-semibold text-gray-800",children:"Compare Checkpoint"}),(0,a.jsxs)("div",{className:"text-xs text-gray-500",children:["Current vs ",eQ.title]})]}),(0,a.jsx)("div",{className:"flex items-center gap-2",children:(0,a.jsx)("button",{type:"button",onClick:()=>eJ(null),className:"rounded border border-gray-300 px-2 py-1 text-xs text-gray-700 hover:bg-gray-50",children:"Close"})})]}),(0,a.jsxs)("div",{className:d?"flex min-h-0 flex-1 flex-col gap-4 overflow-auto p-4":"flex min-h-0 flex-1 flex-col gap-4 overflow-auto",children:[(0,a.jsx)("div",{className:"flex min-h-0 min-w-0 flex-1 overflow-x-auto",children:(0,a.jsxs)("div",{className:"flex min-h-0 min-w-[960px] flex-1 gap-4",children:[(0,a.jsxs)("div",{className:"flex min-h-0 min-w-0 flex-1 basis-0 flex-col gap-3",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between text-xs font-semibold uppercase tracking-wide text-gray-500",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("span",{children:n2}),!n5&&(0,a.jsx)("span",{className:"rounded bg-blue-100 px-2 py-0.5 text-[10px] font-normal text-blue-700",children:"Checkpoint"}),d&&(0,a.jsx)("button",{type:"button",onClick:()=>aV("left"),className:"rounded border border-blue-500 bg-blue-50 px-2 py-0.5 text-[10px] font-normal text-blue-700 hover:bg-blue-100",title:"Open this score in the full editor",children:"\uD83D\uDCDD Open in Editor"})]}),!d&&(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("input",{type:"text",value:e2,onChange:e=>e4(e.target.value),placeholder:"Label (optional)",className:"w-32 rounded border border-gray-300 bg-white px-2 py-0.5 text-[10px] text-gray-700 placeholder-gray-400"}),(0,a.jsx)("button",{type:"button",onClick:()=>aW("left"),disabled:eG,className:"rounded border border-gray-300 bg-white px-2 py-0.5 text-[10px] font-normal text-gray-600 hover:bg-gray-50 disabled:opacity-50",title:n5?"Save current score as checkpoint":"Save this checkpoint",children:"\uD83D\uDCBE Save checkpoint"})]})]}),(0,a.jsxs)("div",{className:"flex min-h-0 flex-1 flex-col gap-3",children:[(0,a.jsxs)("div",{ref:tB,className:"relative min-h-0 min-w-0 flex-1 overflow-auto rounded border border-gray-200 bg-white","data-testid":"compare-pane-left",children:[!nQ&&(0,a.jsx)("div",{className:"p-3 text-xs text-gray-500",children:"Load a score to compare."}),(0,a.jsxs)("div",{ref:tL,className:"relative origin-top-left",style:at,children:[(0,a.jsx)("div",{ref:tF}),(0,a.jsx)("div",{className:"pointer-events-none absolute inset-0 z-10",children:ac.map(e=>(0,a.jsx)("div",{"data-testid":"compare-left-highlight",className:"absolute rounded-sm border-2",style:{left:`${e.left}px`,top:`${e.top}px`,width:`${e.width}px`,height:`${e.height}px`,backgroundColor:"new-diff"===e.status?"rgba(16, 185, 129, 0.3)":"rgba(244, 63, 94, 0.3)",borderColor:"new-diff"===e.status?"rgb(16, 185, 129)":"rgb(244, 63, 94)"}},`compare-left-highlight-${e.id}`))})]})]}),(0,a.jsx)("div",{className:"grid gap-2 text-xs text-gray-500",children:Array.from({length:nK}).map((e,t)=>{let r=n0[t]?.name||n0[t]?.instrumentName||`Part ${t+1}`,n=n9.get(t),o=n?.leftCount??0,i=n?.rightCount??0;return(0,a.jsxs)("div",{className:"flex items-center justify-between rounded border border-dashed border-gray-200 bg-white px-2 py-2",children:[(0,a.jsx)("span",{children:r}),(0,a.jsxs)("span",{className:"text-[10px] text-gray-400",children:[o,"/",i," measures"]})]},`compare-left-part-${t}`)})})]})]}),(0,a.jsxs)("div",{className:"flex min-h-0 w-44 flex-none flex-col items-center gap-2",children:[(0,a.jsx)("button",{type:"button",onClick:aq,className:"rounded border border-gray-300 bg-white px-3 py-1 text-xs text-gray-700 hover:bg-gray-50",title:"Swap left and right panes",children:" Swap"}),(0,a.jsxs)("div",{ref:tU,className:"flex min-h-0 flex-1 flex-col gap-3 overflow-auto rounded border border-gray-200 bg-gray-50 p-2 text-[10px] text-gray-500",children:[tx&&(0,a.jsx)("div",{className:"rounded border border-dashed border-gray-200 bg-white px-2 py-2 text-center text-[10px] text-gray-400",children:"Aligning measures..."}),!tx&&Array.from({length:nK}).map((e,t)=>{let r=n9.get(t),n=r?.rows??[],o=nD(n),i=n0[t]?.name||n0[t]?.instrumentName||n1[t]?.name||n1[t]?.instrumentName||`Part ${t+1}`;return(0,a.jsxs)("div",{className:"flex flex-col gap-2 rounded border border-dashed border-gray-200 bg-white px-2 py-2",children:[(0,a.jsx)("div",{className:"flex items-center justify-between text-[10px] font-semibold uppercase tracking-wide text-gray-400",children:(0,a.jsx)("span",{children:i})}),(0,a.jsxs)("div",{className:"grid gap-2",children:[0===n.length&&(0,a.jsx)("div",{className:"rounded border border-dashed border-gray-200 bg-gray-50 px-2 py-2 text-center text-[10px] text-gray-400",children:"No measures"}),0===o.length&&n.length>0&&(0,a.jsx)("div",{className:"text-center text-[10px] text-gray-400",children:"No changes"}),o.length>0&&(0,a.jsx)("div",{className:"relative w-full",style:{height:`${as}px`},children:o.map((e,r)=>{let o=n.slice(e.start,e.end+1),i=o.map(e=>e.leftIndex).filter(e=>null!==e),s=o.map(e=>e.rightIndex).filter(e=>null!==e),l=i[0],u=i[i.length-1],c=s[0],f=s[s.length-1],m=i.length?`L${l+1}${u!==l?`${u+1}`:""}`:"L",p=s.length?`R${c+1}${f!==c?`${f+1}`:""}`:"R",h=i.length>0,g=s.length>0,y=o.map(e=>null!==e.leftIndex&&null!==e.rightIndex?{leftIndex:e.leftIndex,rightIndex:e.rightIndex}:null).filter(e=>!!e),b=y.length>0,v=o.flatMap((t,r)=>{let n=[];return(null!==t.leftIndex&&ao[t.leftIndex]&&n.push(ao[t.leftIndex]),null!==t.rightIndex&&ai[t.rightIndex]&&n.push(ai[t.rightIndex]),0===n.length)?[{top:an+(e.start+r)*56,height:56}]:n}),x=an+56*e.start,w=(e.end-e.start+1)*56;if(v.length){let e=Math.min(...v.map(e=>e.top)),t=Math.max(...v.map(e=>e.top+e.height));x=e,w=Math.max(56,t-e)}return(0,a.jsxs)("div",{className:"absolute left-0 right-0 rounded border border-gray-200 bg-white px-2 py-2",style:{top:`${x}px`,height:`${w}px`},children:[(0,a.jsxs)("div",{className:"flex items-center justify-between text-[9px] text-gray-400",children:[(0,a.jsx)("span",{className:`rounded px-1 py-0.5 ${h?"bg-rose-100 text-rose-600":""}`,children:m}),(0,a.jsx)("span",{className:`rounded px-1 py-0.5 ${g?"bg-emerald-100 text-emerald-600":""}`,children:p})]}),!d&&b&&(0,a.jsxs)("div",{className:"mt-1 flex items-center justify-between gap-2",children:[(0,a.jsx)("button",{type:"button",disabled:tE||!nQ||!nJ,className:"flex h-6 w-10 items-center justify-center rounded border border-gray-200 bg-gray-100 text-[10px] text-gray-500 disabled:opacity-50","aria-label":`Overwrite right with ${m}`,onClick:()=>aL(nQ,nJ,t,y),children:"->"}),(0,a.jsx)("button",{type:"button",disabled:tE||!nQ||!nJ,className:"flex h-6 w-10 items-center justify-center rounded border border-gray-200 bg-gray-100 text-[10px] text-gray-500 disabled:opacity-50","aria-label":`Overwrite left with ${p}`,onClick:()=>aL(nJ,nQ,t,y.map(e=>({leftIndex:e.rightIndex,rightIndex:e.leftIndex}))),children:"<-"})]})]},`compare-gutter-block-${t}-${r}`)})})]})]},`compare-gutter-${t}`)})]})]}),(0,a.jsxs)("div",{className:"flex min-h-0 min-w-0 flex-1 basis-0 flex-col gap-3",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between text-xs font-semibold uppercase tracking-wide text-gray-500",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("span",{children:n4}),!n6&&(0,a.jsx)("span",{className:"rounded bg-blue-100 px-2 py-0.5 text-[10px] font-normal text-blue-700",children:"Checkpoint"}),d&&(0,a.jsx)("button",{type:"button",onClick:()=>aV("right"),className:"rounded border border-blue-500 bg-blue-50 px-2 py-0.5 text-[10px] font-normal text-blue-700 hover:bg-blue-100",title:"Open this score in the full editor",children:"\uD83D\uDCDD Open in Editor"})]}),!d&&(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("input",{type:"text",value:e8,onChange:e=>e3(e.target.value),placeholder:"Label (optional)",className:"w-32 rounded border border-gray-300 bg-white px-2 py-0.5 text-[10px] text-gray-700 placeholder-gray-400"}),(0,a.jsx)("button",{type:"button",onClick:()=>aW("right"),disabled:eG,className:"rounded border border-gray-300 bg-white px-2 py-0.5 text-[10px] font-normal text-gray-600 hover:bg-gray-50 disabled:opacity-50",title:n6?"Save current score as checkpoint":"Save this checkpoint",children:"\uD83D\uDCBE Save checkpoint"})]})]}),(0,a.jsxs)("div",{className:"flex min-h-0 flex-1 flex-col gap-3",children:[(0,a.jsxs)("div",{ref:tO,className:"relative min-h-0 min-w-0 flex-1 overflow-auto rounded border border-gray-200 bg-white","data-testid":"compare-pane-right",children:[(ta||ti||!e5)&&(0,a.jsx)("div",{className:"absolute inset-0 flex items-center justify-center bg-white/80 p-3 text-xs text-gray-500",children:ti??(ta?"Loading checkpoint score...":"Score not loaded.")}),(0,a.jsxs)("div",{ref:tR,className:"relative origin-top-left",style:ar,children:[(0,a.jsx)("div",{ref:tD}),(0,a.jsx)("div",{className:"pointer-events-none absolute inset-0 z-10",children:ad.map(e=>(0,a.jsx)("div",{"data-testid":"compare-right-highlight",className:"absolute rounded-sm border-2",style:{left:`${e.left}px`,top:`${e.top}px`,width:`${e.width}px`,height:`${e.height}px`,backgroundColor:"old-diff"===e.status?"rgba(244, 63, 94, 0.3)":"rgba(16, 185, 129, 0.3)",borderColor:"old-diff"===e.status?"rgb(244, 63, 94)":"rgb(16, 185, 129)"}},`compare-right-highlight-${e.id}`))})]})]}),(0,a.jsx)("div",{className:"grid gap-2 text-xs text-gray-500",children:Array.from({length:nK}).map((e,t)=>{let r=n1[t]?.name||n1[t]?.instrumentName||`Part ${t+1}`,n=n9.get(t),o=n?.leftCount??0,i=n?.rightCount??0;return(0,a.jsxs)("div",{className:"flex items-center justify-between rounded border border-dashed border-gray-200 bg-white px-2 py-2",children:[(0,a.jsx)("span",{children:r}),(0,a.jsxs)("span",{className:"text-[10px] text-gray-400",children:[o,"/",i," measures"]})]},`compare-right-part-${t}`)})})]})]})]})}),(0,a.jsxs)("details",{className:"rounded border border-gray-200 bg-gray-50 px-3 py-2",children:[(0,a.jsx)("summary",{className:"cursor-pointer text-xs font-semibold uppercase tracking-wide text-gray-500",children:"Raw MusicXML"}),(0,a.jsxs)("div",{className:"mt-3 grid gap-4 md:grid-cols-2",style:{height:"calc(100vh - 300px)"},children:[(0,a.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,a.jsx)("span",{className:"text-xs font-semibold uppercase tracking-wide text-gray-500",children:"Current"}),(0,a.jsx)("textarea",{readOnly:!0,value:eQ.currentXml,className:"min-h-0 flex-1 w-full rounded border border-gray-200 bg-white p-2 font-mono text-xs text-gray-700"})]}),(0,a.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,a.jsx)("span",{className:"text-xs font-semibold uppercase tracking-wide text-gray-500",children:eQ.title}),(0,a.jsx)("textarea",{readOnly:!0,value:eQ.checkpointXml,className:"min-h-0 flex-1 w-full rounded border border-gray-200 bg-white p-2 font-mono text-xs text-gray-700"})]})]})]})]})]})}),d&&eG&&(0,a.jsx)("div",{className:"fixed inset-0 z-[60] flex items-center justify-center bg-white",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"mb-4 inline-block h-12 w-12 animate-spin rounded-full border-4 border-gray-200 border-t-blue-600"}),(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"Loading comparison..."})]})})]})]})}}}]);