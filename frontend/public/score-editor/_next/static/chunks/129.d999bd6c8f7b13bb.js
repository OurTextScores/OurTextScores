"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[129],{6129:(e,t,r)=>{r.r(t),r.d(t,{default:()=>eu});var n,a=r(5155),o=r(2115),i=r(3321),s=r(1463),l=r(2619).Buffer;let u=function(){!function(){let e;var t,r=(t="u">typeof document&&document.currentScript?document.currentScript.src:void 0,"u">typeof __filename&&(t=t||__filename),function(e){var r,n,a,o,i,u,c,d,f,p,m,h,g,y,b,v,x,w,k,_,S,E,T,C,N,A,e=void 0!==(e=e||{})?e:{};e.ready=new Promise(function(e,t){r=e,n=t}),e.expectedDataFileDownloads||(e.expectedDataFileDownloads=0),e.expectedDataFileDownloads++,function(t){window.encodeURIComponent(window.location.pathname.toString().substring(0,window.location.pathname.toString().lastIndexOf("/"))+"/");var r,n,a="webmscore.lib.data";"function"!=typeof e.locateFilePackage||e.locateFile||(e.locateFile=e.locateFilePackage,U("warning: you defined Module.locateFilePackage, that has been renamed to Module.locateFile (using your locateFilePackage for now)"));var o=e.locateFile?e.locateFile(a,""):a,i=t.remote_package_size;t.package_uuid;var s=null,l=e.getPreloadedPackage?e.getPreloadedPackage(o,i):null;function u(){function r(e,t){if(!e)throw t+Error().stack}function n(n){r(n,"Loading data file failed."),r(n instanceof ArrayBuffer,"bad input to processPackageData");var a=new Uint8Array(n),o={data:null,cachedOffset:4096164,cachedIndexes:[-1,-1],cachedChunks:[null,null],offsets:[0,2041,4089,6137,8185,10233,12281,14329,16377,18425,20473,22521,24569,26617,28665,30713,32761,34809,36857,38905,40953,43001,45049,47097,49145,51193,53241,55289,57337,59385,61433,63481,65529,67577,69625,71673,73721,75769,77817,79865,81913,83961,86009,88057,90105,92153,94201,96249,98297,100345,102393,104441,106489,108537,110585,112633,114681,116729,118777,120825,122873,124921,126969,129017,131065,133113,135161,137209,139257,141305,143353,145401,147445,149493,151541,153589,155637,157685,159733,161781,163829,165877,167925,169973,172021,174069,176117,178165,180213,182261,184309,186357,188405,190453,192501,194549,196597,198645,200695,202743,204791,206839,208887,210935,212983,215031,217079,219127,221175,223223,225271,227319,229367,231415,233463,235511,237559,239607,241655,243703,245751,247799,249847,251895,253943,255997,258045,260093,262141,264189,266237,268285,270333,272381,274429,276477,278525,280573,282621,284669,286717,288765,290813,292861,294909,296957,299005,301053,303101,305149,307197,309245,311293,313347,315395,317451,319499,321547,323595,325643,327691,329739,331787,333835,335883,337931,339979,342027,344075,346123,348171,350219,352267,354315,356363,358411,360459,362514,364562,366610,368658,370706,372748,374796,376844,378892,380940,382982,385030,387078,389130,391178,393226,395274,397322,399370,401381,403437,405279,407327,409375,411376,413400,415415,417463,419386,421434,423469,425513,427484,429532,431580,433573,434919,435863,436459,437850,439898,441946,443994,446042,448090,450138,452186,454234,456282,458330,460378,462426,464474,466522,468570,470618,472666,474714,476762,478810,480858,482913,484961,487009,489057,491105,493153,495201,497249,499297,501345,503393,505441,507489,509537,511585,513633,515681,517729,519777,521825,523873,525921,527969,530017,532065,534113,536161,538209,540257,542305,544353,546401,548449,550497,552545,554593,556641,558689,560737,562785,564833,566881,568929,570977,573025,575073,577121,579169,581217,583265,585313,587361,589409,591457,593505,595553,597601,599649,601697,603745,605793,607841,609889,611937,613985,616033,618081,620129,622177,624225,626273,628321,630369,632417,634465,636513,638561,640609,642657,644705,646753,648801,650849,652897,654945,656993,659041,661089,663137,665185,667233,669281,671329,673377,675425,677473,679521,681569,683617,685665,687713,689761,691809,693857,695905,697953,700001,702049,704097,706145,708193,710241,712289,714337,716385,718433,720481,722529,724577,726625,728677,730733,732781,734829,736877,738925,740973,743021,745069,747117,749165,751213,753261,755309,757357,759405,761453,763501,765529,767343,769156,771016,772881,774623,776476,778270,780254,782302,784350,786398,788446,790489,792537,794585,796633,798681,800729,802777,804831,806879,808927,810975,813023,815071,817119,819167,821215,823263,825311,827359,829328,831311,833359,835407,837455,839503,841551,843599,845647,847695,849743,851791,853839,855887,857935,859983,862031,864079,866127,868175,870223,872271,874319,876367,878415,880463,882511,884559,886607,888655,890703,892751,894799,896847,898895,900943,902991,905039,907087,909135,911183,913231,915279,917327,919375,921423,923471,925519,927567,929615,931663,933711,935759,937807,939855,941903,943951,945999,948047,950095,952143,954191,956239,958287,960335,962383,964431,966479,968527,970575,972623,974671,976719,978767,980815,982863,984911,986959,989007,991055,993103,995151,997199,999247,1001295,1003343,1005391,1007439,1009487,1011535,1013583,1015631,1017679,1019727,1021775,1023823,1025871,1027919,1029967,1032015,1034063,1036111,1038159,1040207,1042255,1044303,1046351,1048399,1050447,1052495,1054548,1056596,1058644,1060692,1062740,1064788,1066836,1068884,1070932,1072980,1075028,1077076,1079124,1081172,1083220,1085268,1087316,1089364,1091412,1093460,1095508,1097556,1099613,1101661,1103709,1105753,1107801,1109849,1111897,1113945,1115993,1118041,1120089,1122137,1124185,1126233,1128287,1130335,1132383,1134431,1136479,1138527,1140575,1142623,1144671,1146719,1148767,1150815,1152863,1154911,1156959,1159002,1161050,1163098,1165146,1167194,1169242,1171290,1173338,1175386,1177434,1179482,1181530,1183578,1185626,1187674,1189722,1191770,1193818,1194978,1195298,1195687,1196185,1196683,1197129,1197589,1198104,1198406,1198755,1199110,1199517,1199902,1200278,1200611,1201768,1203816,1205864,1207914,1209537,1211352,1213400,1215448,1217496,1219544,1221592,1223640,1225688,1227736,1229784,1231832,1233880,1235928,1237976,1240024,1242072,1244120,1246168,1248216,1250264,1252312,1254360,1256408,1258456,1260504,1262552,1264600,1266648,1268696,1270744,1272792,1274840,1276888,1278936,1280984,1283032,1285080,1287128,1289176,1291224,1293272,1295320,1297368,1299416,1301464,1303512,1305560,1307608,1309656,1311704,1313752,1315800,1317848,1319896,1321944,1323992,1326040,1328088,1330136,1332184,1334232,1336280,1338328,1340376,1342424,1344472,1346520,1348568,1350616,1352664,1354712,1356760,1358808,1360856,1362904,1364952,1367e3,1369048,1371096,1373144,1375192,1377240,1379288,1381336,1383384,1385432,1387480,1389528,1391576,1393624,1395672,1397720,1399768,1401816,1403864,1405912,1407960,1410008,1412056,1414104,1416152,1418200,1420248,1422296,1424344,1426392,1428440,1430488,1432536,1434584,1436632,1438680,1440728,1442776,1444824,1446637,1447326,1447760,1448284,1448756,1449256,1449682,1450203,1450704,1451184,1451646,1452167,1452733,1453127,1453580,1454018,1454493,1454983,1455761,1456462,1457117,1457828,1458564,1459256,1460022,1460678,1461428,1462197,1462764,1463460,1463928,1464449,1464979,1465701,1466035,1466430,1466763,1467229,1467764,1468232,1468889,1469492,1469960,1470523,1471157,1471628,1472114,1472646,1473230,1473768,1474239,1474709,1475499,1477547,1479595,1481643,1483691,1485739,1487787,1489835,1491883,1493397,1493868,1494214,1494499,1494733,1494995,1495281,1495540,1495818,1496188,1496522,1496935,1497343,1497711,1498128,1498527,1498894,1499209,1499609,1499961,1500451,1502220,1504268,1506316,1508364,1510412,1512460,1514508,1516556,1517834,1518304,1518816,1519290,1519766,1520245,1520764,1521283,1521763,1522277,1522799,1523317,1523800,1524278,1524803,1525297,1525794,1526240,1526691,1527200,1527499,1527800,1528145,1528478,1528827,1529193,1529779,1530070,1530331,1530636,1530902,1531202,1531468,1531829,1532233,1532624,1532991,1533346,1533837,1534284,1534709,1535103,1535485,1535950,1536351,1536722,1537016,1537377,1537740,1538166,1538517,1538982,1539415,1539780,1540098,1540407,1540720,1541017,1541783,1543831,1545879,1547927,1549975,1552023,1554071,1556119,1558167,1560215,1562263,1564311,1566359,1568407,1570455,1572503,1574551,1576599,1578647,1580695,1582743,1584791,1586839,1588887,1590935,1592983,1594896,1595612,1596152,1596676,1597191,1597647,1597981,1598448,1598925,1599428,1599896,1600427,1600971,1601525,1601850,1603830,1605878,1607635,1609683,1611731,1613779,1615827,1617875,1619923,1621971,1624019,1626067,1628115,1630163,1632211,1634259,1636307,1638355,1640403,1642451,1644499,1646547,1648595,1650643,1652691,1654739,1656787,1658835,1660883,1662931,1664979,1667027,1669075,1671123,1673171,1675219,1677267,1679315,1681363,1683411,1685459,1687507,1689555,1691603,1693651,1695699,1697747,1699795,1701843,1703891,1705939,1707987,1710035,1712083,1714131,1716179,1718227,1720275,1722323,1724371,1726419,1728467,1730515,1732563,1734611,1736659,1738707,1740755,1742803,1744851,1746899,1748947,1750995,1753043,1755091,1757139,1759187,1761235,1763283,1765331,1767379,1769427,1771475,1773523,1775571,1777619,1779667,1781715,1783763,1785811,1787859,1789907,1791955,1794003,1796051,1798099,1800147,1802195,1804243,1806291,1808339,1810387,1812435,1814483,1816531,1818579,1820627,1822675,1824723,1826771,1828819,1830867,1831774,1832250,1832735,1833243,1833749,1834169,1834728,1835247,1835685,1836236,1836755,1837259,1837686,1838130,1838585,1839068,1839750,1840468,1841137,1841860,1842550,1843304,1844040,1844805,1845572,1846057,1846609,1847322,1847624,1847915,1848204,1848795,1849452,1850071,1850719,1851442,1852055,1852694,1853301,1853946,1854438,1854900,1855926,1857974,1860027,1861561,1863552,1865600,1867648,1869696,1871744,1873792,1875840,1877888,1879936,1881984,1884032,1886080,1888128,1890176,1892224,1894272,1896320,1898368,1900416,1902464,1904512,1906560,1908608,1910656,1912704,1914752,1916800,1918848,1920896,1922944,1924992,1927040,1929088,1931136,1933184,1935232,1937280,1939328,1941376,1943424,1945472,1947520,1949568,1951616,1953664,1955712,1957760,1959808,1961856,1963904,1965952,1968e3,1970048,1972096,1974144,1976192,1978240,1980288,1982336,1984384,1986432,1988480,1990528,1992576,1994624,1995682,1996143,1996520,1997078,1997713,1997962,1998214,1998521,1998989,1999397,1999942,2000456,2000996,2001529,2001917,2002477,2002994,2003636,2004140,2004636,2005090,2006954,2009010,2011058,2013106,2015154,2017202,2019250,2021298,2023346,2025394,2027442,2029490,2031538,2033586,2035634,2037682,2039730,2041778,2043826,2045874,2047922,2049970,2050846,2051400,2051982,2052712,2053348,2054067,2054829,2055570,2056262,2056839,2057450,2058083,2058635,2059263,2059980,2060514,2061160,2061816,2062422,2062965,2063520,2064177,2064713,2065289,2065941,2066568,2067296,2067957,2068632,2069334,2070012,2070673,2071392,2071819,2072568,2073123,2073672,2074280,2074801,2075465,2076079,2076731,2077481,2078135,2078797,2079430,2080105,2080827,2081445,2082094,2082690,2083332,2083946,2084616,2085254,2085761,2086347,2086878,2087490,2088081,2088693,2089179,2089721,2090405,2091058,2091723,2092446,2093208,2093834,2094487,2095129,2095765,2096494,2097159,2097866,2098516,2099076,2099695,2100432,2101186,2101788,2102312,2102891,2103376,2103802,2104374,2104923,2105568,2106125,2106776,2107340,2107832,2108392,2108897,2109450,2110027,2110579,2111077,2111696,2112267,2112876,2113332,2113920,2114576,2115220,2115820,2116405,2116959,2117555,2118212,2118786,2119244,2119906,2120561,2121253,2121976,2122678,2123475,2124118,2124655,2125175,2125721,2126310,2127008,2127753,2128418,2129194,2129970,2130727,2131419,2132137,2132858,2133568,2134338,2134905,2135483,2136240,2136951,2137731,2138207,2138795,2139353,2140034,2140682,2141362,2142056,2142572,2143144,2143617,2144202,2144950,2145739,2146430,2147166,2147933,2148596,2149202,2150084,2150985,2151849,2152704,2153550,2154385,2155056,2155769,2156501,2157255,2157996,2158919,2159872,2160736,2161595,2162430,2163193,2163818,2164568,2165268,2166181,2166947,2167624,2168253,2168949,2169639,2170373,2171029,2171835,2172787,2173542,2174251,2175110,2175870,2176676,2177402,2178171,2179014,2179808,2180593,2181497,2182341,2182974,2183440,2183968,2184507,2184977,2185604,2186073,2186543,2187182,2187648,2188129,2188756,2189224,2189771,2190297,2190767,2191398,2191865,2192337,2192988,2193453,2193929,2194618,2195232,2196106,2196679,2198181,2200229,2202286,2204334,2206382,2208430,2210478,2212526,2214574,2216622,2218670,2220718,2222766,2224814,2226862,2228910,2230958,2233006,2235054,2237102,2239150,2241198,2243246,2245294,2247342,2249390,2251438,2253486,2255534,2257582,2259630,2261678,2263726,2265774,2267822,2269870,2271918,2273966,2276014,2278062,2280110,2282158,2284206,2286254,2288302,2290350,2292398,2294446,2296494,2298542,2300590,2302638,2304686,2306734,2308782,2310830,2312878,2314926,2316974,2319022,2321070,2323118,2325166,2327214,2329262,2331310,2333358,2335406,2337454,2339502,2341550,2343598,2345646,2347694,2349742,2351790,2353838,2355886,2357934,2359982,2362030,2364078,2366126,2368174,2370222,2372270,2374318,2376366,2378414,2380462,2382510,2384558,2386606,2388654,2390702,2392750,2394798,2396846,2398894,2400942,2402990,2405038,2407086,2409134,2411182,2413230,2415278,2417326,2419374,2421422,2423470,2425518,2427566,2429614,2431662,2433710,2435758,2437806,2439854,2441902,2443950,2445998,2448046,2450094,2452142,2454190,2456238,2458286,2460334,2462382,2464430,2466472,2468527,2470575,2472631,2474679,2476727,2478775,2480823,2482871,2484919,2486967,2489015,2491063,2493111,2495159,2497207,2499255,2501303,2503359,2505407,2507455,2509503,2511551,2513599,2515647,2517695,2519743,2521791,2523839,2525887,2527935,2529983,2532031,2534079,2536127,2538175,2540223,2542271,2544319,2546367,2548415,2550463,2552511,2554559,2556607,2558655,2560703,2562751,2564799,2566847,2568895,2570943,2572991,2575039,2577087,2579135,2581183,2583231,2585279,2587327,2589375,2591423,2593471,2595519,2597567,2599615,2601663,2603711,2605759,2607807,2609855,2611903,2613951,2615999,2618047,2620095,2622143,2624191,2626239,2628287,2630335,2632383,2634431,2636479,2638527,2640575,2642623,2644671,2646719,2648767,2650815,2652863,2654911,2656959,2659007,2661055,2663103,2665151,2667199,2669247,2671295,2673343,2675391,2677439,2679487,2681535,2683583,2685631,2687679,2689727,2691775,2693823,2695871,2697919,2699967,2702015,2704063,2706111,2708159,2710207,2712255,2714303,2716351,2718399,2720447,2722495,2724543,2726591,2728639,2730687,2732735,2734783,2736831,2738879,2740927,2742975,2745023,2747071,2749119,2751167,2753215,2755263,2757311,2759359,2761407,2763455,2765503,2767551,2769599,2771647,2773695,2775743,2777791,2779839,2781887,2783935,2785983,2788031,2790079,2792127,2794175,2796223,2798271,2800319,2802367,2804415,2806463,2808511,2810559,2812607,2814655,2816703,2818751,2820799,2822847,2824895,2826943,2828991,2831039,2833087,2835135,2837183,2839231,2841279,2843327,2845375,2847423,2849471,2851519,2853567,2855615,2857663,2859711,2861759,2863807,2865855,2867903,2869951,2871999,2874047,2876095,2878143,2880191,2882239,2884287,2886335,2888383,2890431,2892479,2894527,2896575,2898623,2900671,2902719,2904767,2906815,2908863,2910911,2912959,2915007,2917055,2919103,2921151,2923199,2925247,2927295,2929343,2931391,2933439,2935487,2937535,2939583,2941631,2943679,2945727,2947775,2949823,2951871,2953919,2955967,2958015,2960063,2962111,2964159,2966207,2968255,2970303,2972351,2974399,2976447,2978495,2980543,2982591,2984639,2986687,2988735,2990783,2992831,2994879,2996927,2998975,3001023,3003071,3005119,3007167,3009215,3011263,3013311,3015359,3017407,3019455,3021503,3023551,3025599,3027647,3029695,3031743,3033791,3035839,3037887,3039935,3041983,3044031,3046079,3048127,3050175,3052223,3054271,3056319,3058367,3060415,3062463,3064511,3066559,3068607,3070655,3072703,3074751,3076799,3078847,3080895,3082943,3084991,3087039,3089087,3091135,3093183,3095231,3097279,3099327,3101375,3103423,3105471,3107519,3109567,3111615,3113663,3115711,3117759,3119807,3121855,3123903,3125951,3127999,3130047,3132095,3134143,3136191,3138239,3140287,3142335,3144383,3146431,3148479,3150527,3152575,3154623,3156671,3158719,3160767,3162815,3164863,3166911,3168959,3171007,3173055,3175103,3177151,3179199,3181247,3183295,3185343,3187391,3189439,3191487,3193535,3195583,3197631,3199679,3201727,3203775,3205823,3207871,3209919,3211967,3214015,3216063,3218111,3220159,3222207,3224255,3226303,3228351,3230399,3232447,3234495,3236543,3238591,3240639,3242687,3244735,3246783,3248831,3250879,3252927,3254975,3257023,3259071,3261119,3263167,3265215,3267263,3269311,3271359,3273407,3275455,3277503,3279551,3281599,3283647,3285695,3287743,3289791,3291839,3293887,3295930,3297978,3300026,3302074,3304122,3306170,3308218,3310266,3312314,3314362,3316410,3318458,3320506,3322554,3324602,3326650,3328698,3330746,3332794,3334842,3336890,3338938,3340986,3343034,3345082,3347130,3349178,3351226,3353274,3355322,3357370,3359418,3361466,3363514,3365562,3367610,3369658,3371706,3373754,3375802,3377850,3379898,3381946,3383994,3386042,3388090,3390138,3392186,3394234,3396282,3398330,3400378,3402426,3404474,3406522,3408570,3410618,3412666,3414714,3416762,3418810,3420858,3422906,3424954,3427002,3429050,3431098,3433146,3435194,3437242,3439290,3441338,3443386,3445434,3447482,3449530,3451578,3453626,3455674,3457722,3459770,3461818,3463866,3465914,3467962,3470010,3472058,3474106,3476152,3478200,3480248,3482296,3484344,3486392,3488440,3490488,3492536,3494584,3496632,3498680,3500728,3502776,3504824,3506872,3508920,3510968,3513016,3515064,3517112,3519160,3521208,3523256,3525304,3527352,3529400,3531448,3533496,3535544,3537592,3539640,3541688,3543736,3545784,3547832,3549880,3551928,3553976,3556024,3558072,3560120,3562168,3564216,3566264,3568312,3570360,3572408,3574456,3576504,3578552,3580600,3582648,3584696,3586744,3588792,3590840,3592878,3593587,3594338,3595234,3596130,3597e3,3597902,3598697,3599427,3600170,3601149,3602125,3602681,3603557,3604361,3605058,3605668,3606261,3606867,3607569,3608226,3608919,3609567,3610244,3610890,3611595,3612288,3612982,3613719,3614537,3615507,3616311,3617186,3618051,3618800,3619396,3620349,3621372,3622046,3622859,3623681,3624371,3624991,3625581,3626163,3626853,3627525,3628229,3628913,3629600,3630261,3630982,3631674,3632364,3633046,3633811,3634760,3635545,3636426,3637324,3638146,3638745,3639664,3640691,3641505,3642162,3643079,3643826,3644480,3645052,3645644,3646285,3646971,3647657,3648300,3648985,3649680,3650417,3651119,3651809,3652496,3653248,3654205,3655109,3656e3,3656909,3657769,3658547,3659194,3660146,3661145,3661940,3662641,3663574,3664332,3665067,3665744,3666372,3666982,3667675,3668416,3669132,3669897,3670591,3671305,3672056,3672741,3673484,3674207,3674928,3675638,3676403,3677324,3678365,3679455,3680319,3680676,3681102,3682353,3683062,3683586,3684104,3684633,3685199,3685878,3686522,3687281,3688050,3688669,3689377,3690026,3690680,3691326,3691915,3692466,3693114,3693851,3694467,3694996,3695634,3696234,3696813,3697392,3697933,3698463,3698991,3699585,3700106,3700689,3701345,3701934,3702618,3703340,3704015,3704685,3705437,3706114,3706691,3707306,3707893,3708485,3709127,3709689,3710287,3710865,3711430,3712011,3712637,3713187,3713752,3714299,3715006,3715675,3716286,3716967,3717593,3718246,3718981,3719743,3720480,3721239,3722055,3722654,3723242,3723941,3724620,3725357,3726022,3726700,3727445,3728187,3728763,3729436,3730112,3730859,3731510,3732229,3732772,3733476,3734153,3734926,3735636,3736399,3736933,3737446,3737967,3738494,3739024,3739582,3740164,3740719,3741236,3742028,3742684,3743282,3743917,3744548,3745304,3745946,3746617,3747216,3747898,3748511,3749231,3749882,3750580,3751335,3752040,3752778,3753414,3754005,3754560,3755210,3755808,3756564,3757201,3757850,3758540,3759251,3759896,3760512,3761135,3761729,3762382,3762941,3763610,3764264,3764872,3765352,3766046,3766605,3767195,3767918,3768530,3769234,3769828,3770592,3771178,3771870,3772370,3772950,3773586,3774310,3774979,3775569,3776251,3776956,3777672,3778465,3779109,3779627,3780253,3781007,3781808,3782485,3783090,3783709,3784332,3785100,3785853,3786659,3787261,3787853,3788407,3789005,3789694,3790499,3791182,3792064,3792828,3793618,3794422,3795188,3795908,3796634,3797404,3798206,3798982,3799748,3800522,3801276,3802106,3802826,3803559,3804292,3805047,3805796,3806591,3807321,3808125,3808913,3809658,3810414,3811171,3811906,3812724,3813427,3814180,3814980,3815766,3816505,3817259,3818041,3818463,3818852,3819234,3820082,3820886,3821598,3822279,3823070,3823811,3824667,3825377,3825883,3826668,3827102,3827498,3827872,3828681,3829042,3829594,3830293,3830633,3831515,3832230,3832991,3833660,3834213,3834781,3835335,3835874,3836581,3837134,3837808,3838510,3839156,3839777,3840495,3841181,3841830,3842483,3843111,3843770,3844465,3845213,3845875,3846570,3847245,3847892,3848545,3849140,3849780,3850421,3851162,3851866,3852499,3853149,3853799,3854477,3855113,3855909,3856671,3857331,3858141,3858821,3859591,3860403,3861160,3862014,3862746,3863526,3864228,3864963,3865697,3866492,3867316,3867997,3868770,3869595,3870381,3871129,3871928,3872601,3873260,3873983,3874618,3875365,3876129,3876921,3877541,3878192,3879001,3879849,3880677,3881531,3882289,3882952,3883625,3884347,3885067,3885759,3886412,3887045,3887703,3888326,3889001,3889667,3890415,3891178,3891944,3892635,3893394,3894118,3894880,3895643,3896338,3897002,3897682,3898370,3899080,3899877,3900539,3901133,3901835,3902451,3903276,3904020,3904754,3905454,3906146,3906436,3906785,3907064,3907367,3907632,3908004,3908319,3908566,3908890,3909186,3909514,3909816,3910133,3910428,3910761,3911056,3911385,3911637,3912022,3912376,3912627,3912942,3913239,3913555,3913845,3914179,3914482,3914873,3915151,3915506,3915799,3916179,3916477,3916711,3917007,3917291,3917623,3917900,3918232,3918509,3918901,3919170,3919528,3919797,3920169,3920443,3920725,3921048,3921351,3921664,3921965,3922305,3922588,3922942,3923215,3923605,3923895,3924242,3924574,3924878,3925194,3925499,3925807,3926105,3926438,3926709,3927055,3927323,3927695,3927984,3928342,3928646,3928940,3929252,3929547,3929866,3930149,3930495,3930769,3931119,3931387,3931771,3932062,3932384,3932705,3932985,3933308,3933593,3933920,3934209,3934577,3934851,3935196,3935460,3935836,3936183,3936497,3936844,3937129,3937502,3937798,3938173,3938484,3938879,3939164,3939513,3939785,3940158,3940450,3940784,3941066,3941356,3941676,3941973,3942306,3942598,3942922,3943199,3943543,3943799,3944178,3944463,3944760,3945057,3945356,3945652,3945955,3946275,3946539,3946884,3947167,3947550,3947810,3948191,3948489,3948760,3949057,3949358,3949661,3949961,3950277,3950560,3950898,3951170,3951512,3951786,3952164,3952520,3952828,3953126,3953425,3953704,3953985,3954302,3954588,3954916,3955196,3955541,3955805,3956194,3956480,3956763,3957049,3957347,3957654,3957943,3958278,3958544,3958913,3959186,3959548,3959843,3960127,3960425,3960720,3961037,3961338,3961648,3961945,3962297,3962569,3962921,3963183,3963556,3963825,3964127,3964420,3964718,3965049,3965326,3965669,3965939,3966287,3966551,3966890,3967188,3967445,3967734,3968018,3968338,3968630,3968961,3969251,3969574,3969845,3970162,3970432,3970783,3971081,3971380,3971696,3972003,3972328,3972629,3972978,3973263,3973607,3973868,3974234,3974509,3974849,3975130,3975436,3975746,3976048,3976365,3976649,3977002,3977276,3977619,3977883,3978257,3978548,3978859,3979137,3979443,3979756,3980057,3980382,3980673,3981016,3981294,3981653,3981917,3982295,3982618,3982860,3983175,3983466,3983798,3984084,3984428,3984716,3985077,3985350,3985704,3985961,3986348,3986633,3986917,3987223,3987519,3987843,3988122,3988459,3988723,3989072,3989337,3989713,3989990,3990350,3990618,3990894,3991197,3991488,3991800,3992096,3992434,3992714,3993059,3993332,3993702,3994005,3994354,3994698,3995014,3995340,3995629,3995920,3996213,3996548,3996826,3997175,3997447,3997831,3998127,3998474,3998770,3999069,3999385,3999690,4000024,4000325,4000665,4000947,4001295,4001560,4001933,4002224,4002562,4002845,4003139,4003455,4003742,4004079,4004362,4004708,4004982,4005333,4005601,4005992,4006275,4006591,4006892,4007167,4007457,4007763,4008081,4008373,4008717,4008978,4009324,4009571,4009950,4010248,4010497,4010812,4011109,4011429,4011731,4012081,4012376,4012730,4013007,4013359,4013608,4013982,4014283,4014550,4014855,4015129,4015447,4015736,4016067,4016347,4016690,4016962,4017312,4017580,4017970,4018247,4018530,4018835,4019132,4019439,4019742,4020071,4020372,4020721,4021002,4021377,4021669,4022017,4022322,4022624,4022933,4023240,4023565,4023866,4024265,4024548,4024896,4025152,4025482,4025785,4026133,4026411,4026696,4027009,4027306,4027610,4027872,4028221,4028495,4028856,4029121,4029504,4029802,4030106,4030401,4030700,4031005,4031310,4031670,4031963,4032353,4032628,4032938,4033184,4033557,4033866,4034105,4034425,4034715,4035028,4035319,4035625,4035896,4036206,4036484,4036806,4037101,4037449,4037790,4038094,4038442,4038748,4039060,4039354,4039731,4040009,4040357,4040626,4040991,4041286,4041632,4041917,4042221,4042532,4042838,4043216,4043508,4043869,4044152,4044501,4044774,4045150,4045434,4045756,4046071,4046345,4046666,4046957,4047278,4047558,4047911,4048186,4048571,4048826,4049205,4049548,4049862,4050160,4050454,4050780,4051059,4051378,4051646,4051994,4052264,4052620,4052884,4053258,4053558,4053834,4054134,4054427,4054742,4055039,4055350,4055642,4055989,4056267,4056612,4056876,4057247,4057553,4057800,4058159,4058451,4058764,4059047,4059367,4059642,4059987,4060283,4060669,4060974,4061398,4061699,4061954,4062236,4062517,4062830,4063120,4063441,4063723,4064059,4064323,4064688,4064972,4065323,4065604,4065901,4066201,4066484,4066801,4067064,4067422,4067683,4068022,4068279,4068652,4068981,4069234,4069544,4069835,4070141,4070423,4070752,4071042,4071370,4071636,4072014,4072298,4072629,4072909,4073182,4073477,4073771,4074096,4074354,4074701,4074962,4075314,4075559,4075934,4076229,4076500,4076795,4077097,4077418,4077717,4078055,4078348,4078688,4078962,4079322,4079586,4079962,4080277,4080532,4080831,4081113,4081428,4081719,4082042,4082312,4082654,4082920,4083280,4083535,4083897,4084174,4084451,4084759,4085051,4085388,4085681,4086029,4086311,4086670,4086944,4087319,4087584,4087943,4088232,4088531,4088845,4089149,4089475,4089776,4090123,4090408,4090744,4091016,4091387,4091677,4092015,4092295,4092571,4092882,4093174,4093527,4093789,4094138,4094413,4094763,4095030,4095405,4095710,4095994],sizes:[2041,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2044,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2050,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2054,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2054,2048,2056,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2055,2048,2048,2048,2048,2042,2048,2048,2048,2048,2042,2048,2048,2052,2048,2048,2048,2048,2048,2011,2056,1842,2048,2048,2001,2024,2015,2048,1923,2048,2035,2044,1971,2048,2048,1993,1346,944,596,1391,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2055,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2052,2056,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2028,1814,1813,1860,1865,1742,1853,1794,1984,2048,2048,2048,2048,2043,2048,2048,2048,2048,2048,2048,2054,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,1969,1983,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2053,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2057,2048,2048,2044,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2054,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2043,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,1160,320,389,498,498,446,460,515,302,349,355,407,385,376,333,1157,2048,2048,2050,1623,1815,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,1813,689,434,524,472,500,426,521,501,480,462,521,566,394,453,438,475,490,778,701,655,711,736,692,766,656,750,769,567,696,468,521,530,722,334,395,333,466,535,468,657,603,468,563,634,471,486,532,584,538,471,470,790,2048,2048,2048,2048,2048,2048,2048,2048,1514,471,346,285,234,262,286,259,278,370,334,413,408,368,417,399,367,315,400,352,490,1769,2048,2048,2048,2048,2048,2048,2048,1278,470,512,474,476,479,519,519,480,514,522,518,483,478,525,494,497,446,451,509,299,301,345,333,349,366,586,291,261,305,266,300,266,361,404,391,367,355,491,447,425,394,382,465,401,371,294,361,363,426,351,465,433,365,318,309,313,297,766,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,1913,716,540,524,515,456,334,467,477,503,468,531,544,554,325,1980,2048,1757,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,907,476,485,508,506,420,559,519,438,551,519,504,427,444,455,483,682,718,669,723,690,754,736,765,767,485,552,713,302,291,289,591,657,619,648,723,613,639,607,645,492,462,1026,2048,2053,1534,1991,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,1058,461,377,558,635,249,252,307,468,408,545,514,540,533,388,560,517,642,504,496,454,1864,2056,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,876,554,582,730,636,719,762,741,692,577,611,633,552,628,717,534,646,656,606,543,555,657,536,576,652,627,728,661,675,702,678,661,719,427,749,555,549,608,521,664,614,652,750,654,662,633,675,722,618,649,596,642,614,670,638,507,586,531,612,591,612,486,542,684,653,665,723,762,626,653,642,636,729,665,707,650,560,619,737,754,602,524,579,485,426,572,549,645,557,651,564,492,560,505,553,577,552,498,619,571,609,456,588,656,644,600,585,554,596,657,574,458,662,655,692,723,702,797,643,537,520,546,589,698,745,665,776,776,757,692,718,721,710,770,567,578,757,711,780,476,588,558,681,648,680,694,516,572,473,585,748,789,691,736,767,663,606,882,901,864,855,846,835,671,713,732,754,741,923,953,864,859,835,763,625,750,700,913,766,677,629,696,690,734,656,806,952,755,709,859,760,806,726,769,843,794,785,904,844,633,466,528,539,470,627,469,470,639,466,481,627,468,547,526,470,631,467,472,651,465,476,689,614,874,573,1502,2048,2057,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2042,2055,2048,2056,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2056,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2043,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2046,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2038,709,751,896,896,870,902,795,730,743,979,976,556,876,804,697,610,593,606,702,657,693,648,677,646,705,693,694,737,818,970,804,875,865,749,596,953,1023,674,813,822,690,620,590,582,690,672,704,684,687,661,721,692,690,682,765,949,785,881,898,822,599,919,1027,814,657,917,747,654,572,592,641,686,686,643,685,695,737,702,690,687,752,957,904,891,909,860,778,647,952,999,795,701,933,758,735,677,628,610,693,741,716,765,694,714,751,685,743,723,721,710,765,921,1041,1090,864,357,426,1251,709,524,518,529,566,679,644,759,769,619,708,649,654,646,589,551,648,737,616,529,638,600,579,579,541,530,528,594,521,583,656,589,684,722,675,670,752,677,577,615,587,592,642,562,598,578,565,581,626,550,565,547,707,669,611,681,626,653,735,762,737,759,816,599,588,699,679,737,665,678,745,742,576,673,676,747,651,719,543,704,677,773,710,763,534,513,521,527,530,558,582,555,517,792,656,598,635,631,756,642,671,599,682,613,720,651,698,755,705,738,636,591,555,650,598,756,637,649,690,711,645,616,623,594,653,559,669,654,608,480,694,559,590,723,612,704,594,764,586,692,500,580,636,724,669,590,682,705,716,793,644,518,626,754,801,677,605,619,623,768,753,806,602,592,554,598,689,805,683,882,764,790,804,766,720,726,770,802,776,766,774,754,830,720,733,733,755,749,795,730,804,788,745,756,757,735,818,703,753,800,786,739,754,782,422,389,382,848,804,712,681,791,741,856,710,506,785,434,396,374,809,361,552,699,340,882,715,761,669,553,568,554,539,707,553,674,702,646,621,718,686,649,653,628,659,695,748,662,695,675,647,653,595,640,641,741,704,633,650,650,678,636,796,762,660,810,680,770,812,757,854,732,780,702,735,734,795,824,681,773,825,786,748,799,673,659,723,635,747,764,792,620,651,809,848,828,854,758,663,673,722,720,692,653,633,658,623,675,666,748,763,766,691,759,724,762,763,695,664,680,688,710,797,662,594,702,616,825,744,734,700,692,290,349,279,303,265,372,315,247,324,296,328,302,317,295,333,295,329,252,385,354,251,315,297,316,290,334,303,391,278,355,293,380,298,234,296,284,332,277,332,277,392,269,358,269,372,274,282,323,303,313,301,340,283,354,273,390,290,347,332,304,316,305,308,298,333,271,346,268,372,289,358,304,294,312,295,319,283,346,274,350,268,384,291,322,321,280,323,285,327,289,368,274,345,264,376,347,314,347,285,373,296,375,311,395,285,349,272,373,292,334,282,290,320,297,333,292,324,277,344,256,379,285,297,297,299,296,303,320,264,345,283,383,260,381,298,271,297,301,303,300,316,283,338,272,342,274,378,356,308,298,299,279,281,317,286,328,280,345,264,389,286,283,286,298,307,289,335,266,369,273,362,295,284,298,295,317,301,310,297,352,272,352,262,373,269,302,293,298,331,277,343,270,348,264,339,298,257,289,284,320,292,331,290,323,271,317,270,351,298,299,316,307,325,301,349,285,344,261,366,275,340,281,306,310,302,317,284,353,274,343,264,374,291,311,278,306,313,301,325,291,343,278,359,264,378,323,242,315,291,332,286,344,288,361,273,354,257,387,285,284,306,296,324,279,337,264,349,265,376,277,360,268,276,303,291,312,296,338,280,345,273,370,303,349,344,316,326,289,291,293,335,278,349,272,384,296,347,296,299,316,305,334,301,340,282,348,265,373,291,338,283,294,316,287,337,283,346,274,351,268,391,283,316,301,275,290,306,318,292,344,261,346,247,379,298,249,315,297,320,302,350,295,354,277,352,249,374,301,267,305,274,318,289,331,280,343,272,350,268,390,277,283,305,297,307,303,329,301,349,281,375,292,348,305,302,309,307,325,301,399,283,348,256,330,303,348,278,285,313,297,304,262,349,274,361,265,383,298,304,295,299,305,305,360,293,390,275,310,246,373,309,239,320,290,313,291,306,271,310,278,322,295,348,341,304,348,306,312,294,377,278,348,269,365,295,346,285,304,311,306,378,292,361,283,349,273,376,284,322,315,274,321,291,321,280,353,275,385,255,379,343,314,298,294,326,279,319,268,348,270,356,264,374,300,276,300,293,315,297,311,292,347,278,345,264,371,306,247,359,292,313,283,320,275,345,296,386,305,424,301,255,282,281,313,290,321,282,336,264,365,284,351,281,297,300,283,317,263,358,261,339,257,373,329,253,310,291,306,282,329,290,328,266,378,284,331,280,273,295,294,325,258,347,261,352,245,375,295,271,295,302,321,299,338,293,340,274,360,264,376,315,255,299,282,315,291,323,270,342,266,360,255,362,277,277,308,292,337,293,348,282,359,274,375,265,359,289,299,314,304,326,301,347,285,336,272,371,290,338,280,276,311,292,353,262,349,275,350,267,375,305,284,170],successes:[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,1,1,0,0,0,0,0,1,1,1,0,0,1,1,1,0,1,0,1,1,1,0,0,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,0,0,0,0,1,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]};o.data=a,r("object"==typeof eR,"LZ4 not present - was your app build with  -s LZ4=1  ?"),eR.loadPackage({metadata:t,compressedData:o}),e.removeRunDependency("datafile_webmscore.lib.data")}e.FS_createPath("/","fonts",!0,!0),e.FS_createPath("/fonts","musejazz",!0,!0),e.FS_createPath("/fonts","campania",!0,!0),e.FS_createPath("/fonts","edwin",!0,!0),e.FS_createPath("/fonts","leland",!0,!0),e.FS_createPath("/fonts","bravura",!0,!0),e.FS_createPath("/fonts","gootville",!0,!0),e.FS_createPath("/fonts","mscore",!0,!0),e.FS_createPath("/fonts","petaluma",!0,!0),e.FS_createPath("/fonts","finalemaestro",!0,!0),e.FS_createPath("/fonts","finalebroadway",!0,!0),e.FS_createPath("/fonts","smufl",!0,!0),e.FS_createPath("/","engraving",!0,!0),e.FS_createPath("/engraving","styles",!0,!0),e.FS_createPath("/","styles",!0,!0),e.FS_createPath("/","mpe",!0,!0),e.addRunDependency("datafile_webmscore.lib.data"),e.preloadResults||(e.preloadResults={}),e.preloadResults["webmscore.lib.data"]={fromCache:!1},l?(n(l),l=null):s=n}l||(r=function(e){s?(s(e),s=null):l=e},(n=new XMLHttpRequest).open("GET",o,!0),n.responseType="arraybuffer",n.onprogress=function(t){var r=i;if(t.total&&(r=t.total),t.loaded){n.addedTotal?e.dataFileDownloads[o].loaded=t.loaded:(n.addedTotal=!0,e.dataFileDownloads||(e.dataFileDownloads={}),e.dataFileDownloads[o]={loaded:t.loaded,total:r});var a=0,s=0,l=0;for(var u in e.dataFileDownloads){var c=e.dataFileDownloads[u];a+=c.total,s+=c.loaded,l++}a=Math.ceil(a*e.expectedDataFileDownloads/l),e.setStatus&&e.setStatus("Downloading data... ("+s+"/"+a+")")}else!e.dataFileDownloads&&e.setStatus&&e.setStatus("Downloading data...")},n.onerror=function(e){throw Error("NetworkError for: "+o)},n.onload=function(e){if(200==n.status||304==n.status||206==n.status||0==n.status&&n.response)r(n.response);else throw Error(n.statusText+" : "+n.responseURL)},n.send(null)),e.calledRun?u():(e.preRun||(e.preRun=[]),e.preRun.push(u))}({files:[{filename:"/fonts/musejazz/MuseJazzText.woff2",start:0,end:107796,audio:0},{filename:"/fonts/campania/Campania.woff2",start:107796,end:145484,audio:0},{filename:"/fonts/edwin/Edwin-Roman.woff2",start:145484,end:200512,audio:0},{filename:"/fonts/edwin/Edwin-Bold.woff2",start:200512,end:255796,audio:0},{filename:"/fonts/edwin/Edwin-Italic.woff2",start:255796,end:313016,audio:0},{filename:"/fonts/edwin/Edwin-BdIta.woff2",start:313016,end:371224,audio:0},{filename:"/fonts/mscoreTab.woff2",start:371224,end:381524,audio:0},{filename:"/fonts/mscore-BC.woff2",start:381524,end:385976,audio:0},{filename:"/fonts/leland/LelandText.woff2",start:385976,end:400628,audio:0},{filename:"/fonts/bravura/BravuraText.woff2",start:400628,end:794740,audio:0},{filename:"/fonts/gootville/GootvilleText.woff2",start:794740,end:810876,audio:0},{filename:"/fonts/mscore/MScoreText.woff2",start:810876,end:831088,audio:0},{filename:"/fonts/petaluma/PetalumaText.woff2",start:831088,end:1060180,audio:0},{filename:"/fonts/petaluma/PetalumaScript.woff2",start:1060180,end:1110288,audio:0},{filename:"/fonts/finalemaestro/FinaleMaestroText.woff2",start:1110288,end:1134316,audio:0},{filename:"/fonts/finalebroadway/FinaleBroadwayText.woff2",start:1134316,end:1163264,audio:0},{filename:"/fonts/leland/Leland.woff2",start:1163264,end:1200628,audio:0},{filename:"/fonts/leland/metadata.json",start:1200628,end:1232041,audio:0},{filename:"/fonts/bravura/Bravura.woff2",start:1232041,end:1478033,audio:0},{filename:"/fonts/bravura/metadata.json",start:1478033,end:1584714,audio:0},{filename:"/fonts/mscore/mscore.woff2",start:1584714,end:1602574,audio:0},{filename:"/fonts/mscore/metadata.json",start:1602574,end:1644933,audio:0},{filename:"/fonts/gootville/Gootville.woff2",start:1644933,end:1661561,audio:0},{filename:"/fonts/gootville/metadata.json",start:1661561,end:1781225,audio:0},{filename:"/fonts/musejazz/MuseJazz.woff2",start:1781225,end:1834617,audio:0},{filename:"/fonts/musejazz/metadata.json",start:1834617,end:1863839,audio:0},{filename:"/fonts/petaluma/Petaluma.woff2",start:1863839,end:2093211,audio:0},{filename:"/fonts/petaluma/metadata.json",start:2093211,end:2180394,audio:0},{filename:"/fonts/finalemaestro/FinaleMaestro.woff2",start:2180394,end:2320666,audio:0},{filename:"/fonts/finalemaestro/metadata.json",start:2320666,end:2363713,audio:0},{filename:"/fonts/finalebroadway/FinaleBroadway.woff2",start:2363713,end:2408417,audio:0},{filename:"/fonts/finalebroadway/metadata.json",start:2408417,end:2415949,audio:0},{filename:"/fonts/smufl/glyphnames.json",start:2415949,end:2717632,audio:0},{filename:"/fonts/smufl/ranges.json",start:2717632,end:2816428,audio:0},{filename:"/fonts/fonts_tablature.xml",start:2816428,end:2865736,audio:0},{filename:"/fonts/fonts_figuredbass.xml",start:2865736,end:2870098,audio:0},{filename:"/fonts/FreeSans.woff2",start:2870098,end:3138270,audio:0},{filename:"/fonts/FreeSerif.woff2",start:3138270,end:3762718,audio:0},{filename:"/fonts/FreeSerifBold.woff2",start:3762718,end:3966970,audio:0},{filename:"/fonts/FreeSerifItalic.woff2",start:3966970,end:4147954,audio:0},{filename:"/fonts/FreeSerifBoldItalic.woff2",start:4147954,end:4265822,audio:0},{filename:"/engraving/styles/migration-306-style-Edwin.mss",start:4265822,end:4270716,audio:0},{filename:"/engraving/styles/migration-306-style-Leland.mss",start:4270716,end:4271899,audio:0},{filename:"/engraving/styles/legacy-style-defaults-v2.mss",start:4271899,end:4325664,audio:0},{filename:"/engraving/styles/legacy-style-defaults-v3.mss",start:4325664,end:4379409,audio:0},{filename:"/engraving/styles/legacy-style-defaults-v1.mss",start:4379409,end:4433160,audio:0},{filename:"/engraving/styles/legacy-style-defaults-v302.mss",start:4433160,end:4495013,audio:0},{filename:"/engraving/styles/gp-style.mss",start:4495013,end:4496529,audio:0},{filename:"/styles/chords_std.xml",start:4496529,end:4507623,audio:0},{filename:"/instruments.xml",start:4507623,end:5186510,audio:0},{filename:"/mpe/general_strings_articulations_profile.json",start:5186510,end:5490517,audio:0},{filename:"/mpe/general_percussion_articulations_profile.json",start:5490517,end:5770927,audio:0},{filename:"/mpe/general_keyboard_articulations_profile.json",start:5770927,end:5964608,audio:0},{filename:"/mpe/general_winds_articulations_profile.json",start:5964608,end:6207560,audio:0},{filename:"/mpe/general_voice_articulations_profile.json",start:6207560,end:6442574,audio:0}],remote_package_size:4100260,package_uuid:"e8262ce2-e113-483a-89b5-22482ad0c526"});var j={};for(a in e)e.hasOwnProperty(a)&&(j[a]=e[a]);var D="./this.program",M=function(e,t){throw t},F=!1,P=!1,I=!1,L=!1;F=!0,P="function"==typeof importScripts,I="object"==typeof s&&"object"==typeof s.versions&&"string"==typeof s.versions.node,L=!F&&!I&&!P;var R="";function B(t){return e.locateFile?e.locateFile(t,R):R+t}I?(R=P?require("path").dirname(R)+"/":__dirname+"/",o=function(e,t){return c||(c=require("fs")),d||(d=require("path")),e=d.normalize(e),c.readFileSync(e,t?null:"utf8")},u=function(e){var t=o(e,!0);return t.buffer||(t=new Uint8Array(t)),H(t.buffer),t},s.argv.length>1&&(D=s.argv[1].replace(/\\/g,"/")),s.argv.slice(2),M=function(e){s.exit(e)},e.inspect=function(){return"[Emscripten Module object]"}):L?("u">typeof read&&(o=function(e){return read(e)}),u=function(e){var t;return"function"==typeof readbuffer?new Uint8Array(readbuffer(e)):(H("object"==typeof(t=read(e,"binary"))),t)},"u">typeof scriptArgs&&scriptArgs,"function"==typeof quit&&(M=function(e){quit(e)}),"u">typeof print&&("u"<typeof console&&(console={}),console.log=print,console.warn=console.error="u">typeof printErr?printErr:print)):(F||P)&&(P?R=self.location.href:document.currentScript&&(R=document.currentScript.src),t&&(R=t),R=0!==R.indexOf("blob:")?R.substr(0,R.lastIndexOf("/")+1):"",o=function(e){var t=new XMLHttpRequest;return t.open("GET",e,!1),t.send(null),t.responseText},P&&(u=function(e){var t=new XMLHttpRequest;return t.open("GET",e,!1),t.responseType="arraybuffer",t.send(null),new Uint8Array(t.response)}),i=function(e,t,r){var n=new XMLHttpRequest;n.open("GET",e,!0),n.responseType="arraybuffer",n.onload=function(){200==n.status||0==n.status&&n.response?t(n.response):r()},n.onerror=r,n.send(null)});var O=e.print||console.log.bind(console),U=e.printErr||console.warn.bind(console);for(a in j)j.hasOwnProperty(a)&&(e[a]=j[a]);function z(e){z.shown||(z.shown={}),z.shown[e]||(z.shown[e]=1,U(e))}j=null,e.arguments&&e.arguments,e.thisProgram&&(D=e.thisProgram),e.quit&&(M=e.quit);var X=0,$=function(e){X=e};e.wasmBinary&&(f=e.wasmBinary),e.noExitRuntime&&(p=e.noExitRuntime),"object"!=typeof WebAssembly&&ev("no native wasm support detected");var W=!1;function H(e,t){e||ev("Assertion failed: "+t)}function G(t){var r=e["_"+t];return H(r,"Cannot call unknown function "+t+", make sure it is exported"),r}function V(e,t,r,n,a){var o,i={string:function(e){var t=0;if(null!=e&&0!==e){var r=(e.length<<2)+1;Z(e,t=rr(r),r)}return t},array:function(e){var t,r,n=rr(e.length);return t=e,r=n,y.set(t,r),n}},s=G(e),l=[],u=0;if(n)for(var c=0;c<n.length;c++){var d=i[r[c]];d?(0===u&&(u=re()),l[c]=d(n[c])):l[c]=n[c]}var f=s.apply(null,l);return o=f,f="string"===t?K(o):"boolean"===t?!!o:o,0!==u&&rt(u),f}var q="u">typeof TextDecoder?new TextDecoder("utf8"):void 0;function Y(e,t,r){for(var n=t+r,a=t;e[a]&&!(a>=n);)++a;if(a-t>16&&e.subarray&&q)return q.decode(e.subarray(t,a));for(var o="";t<a;){var i=e[t++];if(!(128&i)){o+=String.fromCharCode(i);continue}var s=63&e[t++];if((224&i)==192){o+=String.fromCharCode((31&i)<<6|s);continue}var l=63&e[t++];if((i=(240&i)==224?(15&i)<<12|s<<6|l:(7&i)<<18|s<<12|l<<6|63&e[t++])<65536)o+=String.fromCharCode(i);else{var u=i-65536;o+=String.fromCharCode(55296|u>>10,56320|1023&u)}}return o}function K(e,t){return e?Y(b,e,t):""}function Q(e,t,r,n){if(!(n>0))return 0;for(var a=r,o=r+n-1,i=0;i<e.length;++i){var s=e.charCodeAt(i);if(s>=55296&&s<=57343&&(s=65536+((1023&s)<<10)|1023&e.charCodeAt(++i)),s<=127){if(r>=o)break;t[r++]=s}else if(s<=2047){if(r+1>=o)break;t[r++]=192|s>>6,t[r++]=128|63&s}else if(s<=65535){if(r+2>=o)break;t[r++]=224|s>>12,t[r++]=128|s>>6&63,t[r++]=128|63&s}else{if(r+3>=o)break;t[r++]=240|s>>18,t[r++]=128|s>>12&63,t[r++]=128|s>>6&63,t[r++]=128|63&s}}return t[r]=0,r-a}function Z(e,t,r){return Q(e,b,t,r)}function J(e){for(var t=0,r=0;r<e.length;++r){var n=e.charCodeAt(r);n>=55296&&n<=57343&&(n=65536+((1023&n)<<10)|1023&e.charCodeAt(++r)),n<=127?++t:n<=2047?t+=2:n<=65535?t+=3:t+=4}return t}var ee="u">typeof TextDecoder?new TextDecoder("utf-16le"):void 0;function et(e,t){for(var r=e,n=r>>1,a=n+t/2;!(n>=a)&&x[n];)++n;if((r=n<<1)-e>32&&ee)return ee.decode(b.subarray(e,r));for(var o=0,i="";;){var s=v[e+2*o>>1];if(0==s||o==t/2)return i;++o,i+=String.fromCharCode(s)}}function er(e,t,r){if(void 0===r&&(r=0x7fffffff),r<2)return 0;for(var n=t,a=(r-=2)<2*e.length?r/2:e.length,o=0;o<a;++o){var i=e.charCodeAt(o);v[t>>1]=i,t+=2}return v[t>>1]=0,t-n}function en(e){return 2*e.length}function ea(e,t){for(var r=0,n="";!(r>=t/4);){var a=w[e+4*r>>2];if(0==a)break;if(++r,a>=65536){var o=a-65536;n+=String.fromCharCode(55296|o>>10,56320|1023&o)}else n+=String.fromCharCode(a)}return n}function eo(e,t,r){if(void 0===r&&(r=0x7fffffff),r<4)return 0;for(var n=t,a=n+r-4,o=0;o<e.length;++o){var i=e.charCodeAt(o);if(i>=55296&&i<=57343&&(i=65536+((1023&i)<<10)|1023&e.charCodeAt(++o)),w[t>>2]=i,(t+=4)+4>a)break}return w[t>>2]=0,t-n}function ei(e){for(var t=0,r=0;r<e.length;++r){var n=e.charCodeAt(r);n>=55296&&n<=57343&&++r,t+=4}return t}function es(e){var t=J(e)+1,r=t2(t);return r&&Q(e,y,r,t),r}function el(e,t,r){for(var n=0;n<e.length;++n)y[0|t++]=e.charCodeAt(n);r||(y[0|t]=0)}function eu(t){g=t,e.HEAP8=y=new Int8Array(t),e.HEAP16=v=new Int16Array(t),e.HEAP32=w=new Int32Array(t),e.HEAPU8=b=new Uint8Array(t),e.HEAPU16=x=new Uint16Array(t),e.HEAPU32=k=new Uint32Array(t),e.HEAPF32=_=new Float32Array(t),e.HEAPF64=S=new Float64Array(t)}var ec=e.INITIAL_MEMORY||0x1000000;(m=e.wasmMemory?e.wasmMemory:new WebAssembly.Memory({initial:ec/65536,maximum:32768}))&&(g=m.buffer),ec=g.byteLength,eu(g);var ed=[],ef=[],ep=[],em=[],eh=0,eg=null;function ey(t){eh++,e.monitorRunDependencies&&e.monitorRunDependencies(eh)}function eb(t){if(eh--,e.monitorRunDependencies&&e.monitorRunDependencies(eh),0==eh&&eg){var r=eg;eg=null,r()}}function ev(t){e.onAbort&&e.onAbort(t),U(t+=""),W=!0,t="abort("+t+"). Build with -s ASSERTIONS=1 for more info.";var r=new WebAssembly.RuntimeError(t);throw n(r),r}e.preloadedImages={},e.preloadedAudios={};var ex="webmscore.lib.mem.wasm";function ew(e,t){return String.prototype.startsWith?e.startsWith(t):0===e.indexOf(t)}function ek(e){return ew(e,"data:application/octet-stream;base64,")}function e_(e){return ew(e,"file://")}var eS="webmscore.lib.wasm";function eE(){try{if(f)return new Uint8Array(f);if(u)return u(eS);throw"both async and sync fetching of the wasm failed"}catch(e){ev(e)}}function eT(t){for(;t.length>0;){var r=t.shift();if("function"==typeof r){r(e);continue}var n=r.func;"number"==typeof n?void 0===r.arg?h.get(n)():h.get(n)(r.arg):n(void 0===r.arg?null:r.arg)}}function eC(t){if(eC.recursionGuard=(0|eC.recursionGuard)+1,eC.recursionGuard>1)return t;var r=e.___cxa_demangle||e.__cxa_demangle;H(r);var n=re();try{var a=t;a.startsWith("__Z")&&(a=a.substr(1));var o=J(a)+1,i=rr(o);Z(a,i,o);var s=rr(4),l=r(i,0,0,s);if(0===w[s>>2]&&l)return K(l)}catch(e){}finally{t4(l),rt(n),eC.recursionGuard<2&&--eC.recursionGuard}return t}function eN(){var e=Error();if(!e.stack){try{throw Error()}catch(t){e=t}if(!e.stack)return"(no stack trace available)"}return e.stack.toString()}ek(eS)||(eS=B(eS));var eA=[];function ej(e){this.excPtr=e,this.ptr=e-16,this.set_type=function(e){w[this.ptr+8>>2]=e},this.get_type=function(){return w[this.ptr+8>>2]},this.set_destructor=function(e){w[this.ptr+0>>2]=e},this.get_destructor=function(){return w[this.ptr+0>>2]},this.set_refcount=function(e){w[this.ptr+4>>2]=e},this.set_caught=function(e){e=+!!e,y[this.ptr+12|0]=e},this.get_caught=function(){return 0!=y[this.ptr+12|0]},this.set_rethrown=function(e){e=+!!e,y[this.ptr+13|0]=e},this.get_rethrown=function(){return 0!=y[this.ptr+13|0]},this.init=function(e,t){this.set_type(e),this.set_destructor(t),this.set_refcount(0),this.set_caught(!1),this.set_rethrown(!1)},this.add_ref=function(){var e=w[this.ptr+4>>2];w[this.ptr+4>>2]=e+1},this.release_ref=function(){var e=w[this.ptr+4>>2];return w[this.ptr+4>>2]=e-1,1===e}}function eD(){if(!eD.called){eD.called=!0,w[t9()>>2]=60*(new Date).getTimezoneOffset();var e=(new Date).getFullYear(),t=new Date(e,0,1),r=new Date(e,6,1);w[t7()>>2]=Number(t.getTimezoneOffset()!=r.getTimezoneOffset());var n=s(t),a=s(r),o=es(n),i=es(a);r.getTimezoneOffset()<t.getTimezoneOffset()?(w[t6()>>2]=o,w[t6()+4>>2]=i):(w[t6()>>2]=i,w[t6()+4>>2]=o)}function s(e){var t=e.toTimeString().match(/\(([A-Za-z ]+)\)$/);return t?t[1]:"GMT"}}var eM={splitPath:function(e){return/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/.exec(e).slice(1)},normalizeArray:function(e,t){for(var r=0,n=e.length-1;n>=0;n--){var a=e[n];"."===a?e.splice(n,1):".."===a?(e.splice(n,1),r++):r&&(e.splice(n,1),r--)}if(t)for(;r;r--)e.unshift("..");return e},normalize:function(e){var t="/"===e.charAt(0),r="/"===e.substr(-1);return(e=eM.normalizeArray(e.split("/").filter(function(e){return!!e}),!t).join("/"))||t||(e="."),e&&r&&(e+="/"),(t?"/":"")+e},dirname:function(e){var t=eM.splitPath(e),r=t[0],n=t[1];return r||n?(n&&(n=n.substr(0,n.length-1)),r+n):"."},basename:function(e){if("/"===e)return"/";var t=(e=(e=eM.normalize(e)).replace(/\/$/,"")).lastIndexOf("/");return -1===t?e:e.substr(t+1)},extname:function(e){return eM.splitPath(e)[3]},join:function(){var e=Array.prototype.slice.call(arguments,0);return eM.normalize(e.join("/"))},join2:function(e,t){return eM.normalize(e+"/"+t)}};function eF(e){return w[t8()>>2]=e,e}var eP={resolve:function(){for(var e="",t=!1,r=arguments.length-1;r>=-1&&!t;r--){var n=r>=0?arguments[r]:eB.cwd();if("string"!=typeof n)throw TypeError("Arguments to path.resolve must be strings");if(!n)return"";e=n+"/"+e,t="/"===n.charAt(0)}return e=eM.normalizeArray(e.split("/").filter(function(e){return!!e}),!t).join("/"),(t?"/":"")+e||"."},relative:function(e,t){function r(e){for(var t=0;t<e.length&&""===e[t];t++);for(var r=e.length-1;r>=0&&""===e[r];r--);return t>r?[]:e.slice(t,r-t+1)}e=eP.resolve(e).substr(1),t=eP.resolve(t).substr(1);for(var n=r(e.split("/")),a=r(t.split("/")),o=Math.min(n.length,a.length),i=o,s=0;s<o;s++)if(n[s]!==a[s]){i=s;break}for(var l=[],s=i;s<n.length;s++)l.push("..");return(l=l.concat(a.slice(i))).join("/")}},eI={ttys:[],init:function(){},shutdown:function(){},register:function(e,t){eI.ttys[e]={input:[],output:[],ops:t},eB.registerDevice(e,eI.stream_ops)},stream_ops:{open:function(e){var t=eI.ttys[e.node.rdev];if(!t)throw new eB.ErrnoError(43);e.tty=t,e.seekable=!1},close:function(e){e.tty.ops.flush(e.tty)},flush:function(e){e.tty.ops.flush(e.tty)},read:function(e,t,r,n,a){if(!e.tty||!e.tty.ops.get_char)throw new eB.ErrnoError(60);for(var o,i=0,s=0;s<n;s++){try{o=e.tty.ops.get_char(e.tty)}catch(e){throw new eB.ErrnoError(29)}if(void 0===o&&0===i)throw new eB.ErrnoError(6);if(null==o)break;i++,t[r+s]=o}return i&&(e.node.timestamp=Date.now()),i},write:function(e,t,r,n,a){if(!e.tty||!e.tty.ops.put_char)throw new eB.ErrnoError(60);try{for(var o=0;o<n;o++)e.tty.ops.put_char(e.tty,t[r+o])}catch(e){throw new eB.ErrnoError(29)}return n&&(e.node.timestamp=Date.now()),o}},default_tty_ops:{get_char:function(e){if(!e.input.length){var t=null;if(I){var r=l.alloc?l.alloc(256):new l(256),n=0;try{n=c.readSync(s.stdin.fd,r,0,256,null)}catch(e){if(-1!=e.toString().indexOf("EOF"))n=0;else throw e}t=n>0?r.slice(0,n).toString("utf-8"):null}else"function"==typeof window.prompt?null!==(t=window.prompt("Input: "))&&(t+="\n"):"function"==typeof readline&&null!==(t=readline())&&(t+="\n");if(!t)return null;e.input=tQ(t,!0)}return e.input.shift()},put_char:function(e,t){null===t||10===t?(O(Y(e.output,0)),e.output=[]):0!=t&&e.output.push(t)},flush:function(e){e.output&&e.output.length>0&&(O(Y(e.output,0)),e.output=[])}},default_tty1_ops:{put_char:function(e,t){null===t||10===t?(U(Y(e.output,0)),e.output=[]):0!=t&&e.output.push(t)},flush:function(e){e.output&&e.output.length>0&&(U(Y(e.output,0)),e.output=[])}}},eL={ops_table:null,mount:function(e){return eL.createNode(null,"/",16895,0)},createNode:function(e,t,r,n){if(eB.isBlkdev(r)||eB.isFIFO(r))throw new eB.ErrnoError(63);eL.ops_table||(eL.ops_table={dir:{node:{getattr:eL.node_ops.getattr,setattr:eL.node_ops.setattr,lookup:eL.node_ops.lookup,mknod:eL.node_ops.mknod,rename:eL.node_ops.rename,unlink:eL.node_ops.unlink,rmdir:eL.node_ops.rmdir,readdir:eL.node_ops.readdir,symlink:eL.node_ops.symlink},stream:{llseek:eL.stream_ops.llseek}},file:{node:{getattr:eL.node_ops.getattr,setattr:eL.node_ops.setattr},stream:{llseek:eL.stream_ops.llseek,read:eL.stream_ops.read,write:eL.stream_ops.write,allocate:eL.stream_ops.allocate,mmap:eL.stream_ops.mmap,msync:eL.stream_ops.msync}},link:{node:{getattr:eL.node_ops.getattr,setattr:eL.node_ops.setattr,readlink:eL.node_ops.readlink},stream:{}},chrdev:{node:{getattr:eL.node_ops.getattr,setattr:eL.node_ops.setattr},stream:eB.chrdev_stream_ops}});var a=eB.createNode(e,t,r,n);return eB.isDir(a.mode)?(a.node_ops=eL.ops_table.dir.node,a.stream_ops=eL.ops_table.dir.stream,a.contents={}):eB.isFile(a.mode)?(a.node_ops=eL.ops_table.file.node,a.stream_ops=eL.ops_table.file.stream,a.usedBytes=0,a.contents=null):eB.isLink(a.mode)?(a.node_ops=eL.ops_table.link.node,a.stream_ops=eL.ops_table.link.stream):eB.isChrdev(a.mode)&&(a.node_ops=eL.ops_table.chrdev.node,a.stream_ops=eL.ops_table.chrdev.stream),a.timestamp=Date.now(),e&&(e.contents[t]=a),a},getFileDataAsRegularArray:function(e){if(e.contents&&e.contents.subarray){for(var t=[],r=0;r<e.usedBytes;++r)t.push(e.contents[r]);return t}return e.contents},getFileDataAsTypedArray:function(e){return e.contents?e.contents.subarray?e.contents.subarray(0,e.usedBytes):new Uint8Array(e.contents):new Uint8Array(0)},expandFileStorage:function(e,t){var r=e.contents?e.contents.length:0;if(!(r>=t)){t=Math.max(t,r*(r<1048576?2:1.125)>>>0),0!=r&&(t=Math.max(t,256));var n=e.contents;e.contents=new Uint8Array(t),e.usedBytes>0&&e.contents.set(n.subarray(0,e.usedBytes),0)}},resizeFileStorage:function(e,t){if(e.usedBytes!=t){if(0==t){e.contents=null,e.usedBytes=0;return}if(!e.contents||e.contents.subarray){var r=e.contents;e.contents=new Uint8Array(t),r&&e.contents.set(r.subarray(0,Math.min(t,e.usedBytes))),e.usedBytes=t;return}if(e.contents||(e.contents=[]),e.contents.length>t)e.contents.length=t;else for(;e.contents.length<t;)e.contents.push(0);e.usedBytes=t}},node_ops:{getattr:function(e){var t={};return t.dev=eB.isChrdev(e.mode)?e.id:1,t.ino=e.id,t.mode=e.mode,t.nlink=1,t.uid=0,t.gid=0,t.rdev=e.rdev,eB.isDir(e.mode)?t.size=4096:eB.isFile(e.mode)?t.size=e.usedBytes:eB.isLink(e.mode)?t.size=e.link.length:t.size=0,t.atime=new Date(e.timestamp),t.mtime=new Date(e.timestamp),t.ctime=new Date(e.timestamp),t.blksize=4096,t.blocks=Math.ceil(t.size/t.blksize),t},setattr:function(e,t){void 0!==t.mode&&(e.mode=t.mode),void 0!==t.timestamp&&(e.timestamp=t.timestamp),void 0!==t.size&&eL.resizeFileStorage(e,t.size)},lookup:function(e,t){throw eB.genericErrors[44]},mknod:function(e,t,r,n){return eL.createNode(e,t,r,n)},rename:function(e,t,r){if(eB.isDir(e.mode)){var n;try{n=eB.lookupNode(t,r)}catch(e){}if(n)for(var a in n.contents)throw new eB.ErrnoError(55)}delete e.parent.contents[e.name],e.name=r,t.contents[r]=e,e.parent=t},unlink:function(e,t){delete e.contents[t]},rmdir:function(e,t){var r=eB.lookupNode(e,t);for(var n in r.contents)throw new eB.ErrnoError(55);delete e.contents[t]},readdir:function(e){var t=[".",".."];for(var r in e.contents)e.contents.hasOwnProperty(r)&&t.push(r);return t},symlink:function(e,t,r){var n=eL.createNode(e,t,41471,0);return n.link=r,n},readlink:function(e){if(!eB.isLink(e.mode))throw new eB.ErrnoError(28);return e.link}},stream_ops:{read:function(e,t,r,n,a){var o=e.node.contents;if(a>=e.node.usedBytes)return 0;var i=Math.min(e.node.usedBytes-a,n);if(i>8&&o.subarray)t.set(o.subarray(a,a+i),r);else for(var s=0;s<i;s++)t[r+s]=o[a+s];return i},write:function(e,t,r,n,a,o){if(t.buffer===y.buffer&&(o=!1),!n)return 0;var i=e.node;if(i.timestamp=Date.now(),t.subarray&&(!i.contents||i.contents.subarray)){if(o)return i.contents=t.subarray(r,r+n),i.usedBytes=n,n;else if(0===i.usedBytes&&0===a)return i.contents=t.slice(r,r+n),i.usedBytes=n,n;else if(a+n<=i.usedBytes)return i.contents.set(t.subarray(r,r+n),a),n}if(eL.expandFileStorage(i,a+n),i.contents.subarray&&t.subarray)i.contents.set(t.subarray(r,r+n),a);else for(var s=0;s<n;s++)i.contents[a+s]=t[r+s];return i.usedBytes=Math.max(i.usedBytes,a+n),n},llseek:function(e,t,r){var n=t;if(1===r?n+=e.position:2===r&&eB.isFile(e.node.mode)&&(n+=e.node.usedBytes),n<0)throw new eB.ErrnoError(28);return n},allocate:function(e,t,r){eL.expandFileStorage(e.node,t+r),e.node.usedBytes=Math.max(e.node.usedBytes,t+r)},mmap:function(e,t,r,n,a,o){if(H(0===t),!eB.isFile(e.node.mode))throw new eB.ErrnoError(43);var i,s,l=e.node.contents;if(2&o||l.buffer!==g){if((n>0||n+r<l.length)&&(l=l.subarray?l.subarray(n,n+r):Array.prototype.slice.call(l,n,n+r)),s=!0,!(i=function(e){for(var t=16384*Math.ceil(e/16384),r=t2(t);e<t;)y[r+e++]=0;return r}(r)))throw new eB.ErrnoError(48);y.set(l,i)}else s=!1,i=l.byteOffset;return{ptr:i,allocated:s}},msync:function(e,t,r,n,a){if(!eB.isFile(e.node.mode))throw new eB.ErrnoError(43);return 2&a||eL.stream_ops.write(e,t,0,n,r,!1),0}}},eR={DIR_MODE:16895,FILE_MODE:33279,CHUNK_SIZE:-1,codec:null,init:function(){if(!eR.codec){var e,t,r;(e={}).uncompress=function(e,t,r,n){r=r||0,n=n||e.length-r;for(var a=r,o=n,i=0;a<o;){var s=e[a++],l=s>>4;if(l>0){for(var u=l+240;255===u;)l+=u=e[a++];for(var c=a+l;a<c;)t[i++]=e[a++];if(a===o)break}var d=e[a++]|e[a++]<<8;if(0===d)break;if(d>i)return-(a-2);for(var f=15&s,u=f+240;255===u;)f+=u=e[a++];for(var p=i-d,c=i+f+4;i<c;)t[i++]=t[p++]}return i},H(!0),t=new Int16Array(65536),r=new Int16Array(t.length),e.compressBound=function(e){return e>0x7e000000?0:e+e/255+16|0},e.compress=function(n,a,o,i){return t.set(r),function(r,n,a,o,i){var s=o,l=i-o,u=0;if(r.length>=0x7e000000)throw Error("input too large");if(r.length>12){var c=e.compressBound(r.length);if(l<c)throw Error("output too small: "+l+" < "+c);for(var d=1,f=67,p=r.length-12;a+4<p;){var m=r[a+1]<<8|r[a],h=r[a+3]<<8|r[a+2],g=Math.imul(m|h<<16,0x9e3779b1)>>>16,y=t[g]-1;if(t[g]=a+1,y<0||a-y>>>16>0||(r[y+3]<<8|r[y+2])!=h||(r[y+1]<<8|r[y])!=m){a+=f++>>6;continue}f=67;var b=a-u,v=a-y;y+=4;for(var x=a+=4;a<p&&r[a]==r[y];)a++,y++;var w=(x=a-x)<15?x:15;if(b>=15){n[s++]=240+w;for(var k=b-15;k>254;k-=255)n[s++]=255;n[s++]=k}else n[s++]=(b<<4)+w;for(var _=0;_<b;_++)n[s++]=r[u+_];if(n[s++]=v,n[s++]=v>>8,x>=15){for(x-=15;x>=255;)x-=255,n[s++]=255;n[s++]=x}u=a}}if(0==u)return 0;if((b=r.length-u)>=15){n[s++]=240;for(var S=b-15;S>254;S-=255)n[s++]=255;n[s++]=S}else n[s++]=b<<4;for(a=u;a<r.length;)n[s++]=r[a++];return s}(n,a,0,o||0,i||a.length)},e.CHUNK_SIZE=2048,e.compressPackage=function(t,r){if(r)var n=new Uint8Array(e.CHUNK_SIZE);H(t instanceof ArrayBuffer),console.log("compressing package of size "+(t=new Uint8Array(t)).length);for(var a=[],o=[],i=0,s=0;i<t.length;){var l=t.subarray(i,i+e.CHUNK_SIZE);i+=e.CHUNK_SIZE;var u=e.compressBound(l.length),c=new Uint8Array(u),d=e.compress(l,c);if(d>0){if(H(d<=u),c=c.subarray(0,d),a.push(c),s+=d,o.push(1),r){var f=e.uncompress(c,n);H(f===l.length,[f,l.length]);for(var p=0;p<l.length;p++)H(l[p]===n[p])}}else H(0===d),a.push(l),s+=l.length,o.push(0)}t=null;var m={data:new Uint8Array(s+2*e.CHUNK_SIZE),cachedOffset:s,cachedIndexes:[-1,-1],cachedChunks:[null,null],offsets:[],sizes:[],successes:o};i=0;for(var p=0;p<a.length;p++)m.data.set(a[p],i),m.offsets[p]=i,m.sizes[p]=a[p].length,i+=a[p].length;return console.log("compressed package into "+[m.data.length]),H(i===s),m},H(e.CHUNK_SIZE<32768),eR.codec=e,eR.CHUNK_SIZE=eR.codec.CHUNK_SIZE}},loadPackage:function(e){eR.init();var t=e.compressedData;t||(t=eR.codec.compressPackage(e.data)),H(t.cachedIndexes.length===t.cachedChunks.length);for(var r=0;r<t.cachedIndexes.length;r++)t.cachedIndexes[r]=-1,t.cachedChunks[r]=t.data.subarray(t.cachedOffset+r*eR.CHUNK_SIZE,t.cachedOffset+(r+1)*eR.CHUNK_SIZE),H(t.cachedChunks[r].length===eR.CHUNK_SIZE);e.metadata.files.forEach(function(e){var r=eM.dirname(e.filename),n=eM.basename(e.filename);eB.createPath("",r,!0,!0);var a=eB.analyzePath(r).object;eR.createNode(a,n,eR.FILE_MODE,0,{compressedData:t,start:e.start,end:e.end})})},createNode:function(e,t,r,n,a,o){var i=eB.createNode(e,t,r);return i.mode=r,i.node_ops=eR.node_ops,i.stream_ops=eR.stream_ops,i.timestamp=(o||new Date).getTime(),H(eR.FILE_MODE!==eR.DIR_MODE),r===eR.FILE_MODE?(i.size=a.end-a.start,i.contents=a):(i.size=4096,i.contents={}),e&&(e.contents[t]=i),i},node_ops:{getattr:function(e){return{dev:1,ino:e.id,mode:e.mode,nlink:1,uid:0,gid:0,rdev:void 0,size:e.size,atime:new Date(e.timestamp),mtime:new Date(e.timestamp),ctime:new Date(e.timestamp),blksize:4096,blocks:Math.ceil(e.size/4096)}},setattr:function(e,t){void 0!==t.mode&&(e.mode=t.mode),void 0!==t.timestamp&&(e.timestamp=t.timestamp)},lookup:function(e,t){throw new eB.ErrnoError(44)},mknod:function(e,t,r,n){throw new eB.ErrnoError(63)},rename:function(e,t,r){throw new eB.ErrnoError(63)},unlink:function(e,t){throw new eB.ErrnoError(63)},rmdir:function(e,t){throw new eB.ErrnoError(63)},readdir:function(e){throw new eB.ErrnoError(63)},symlink:function(e,t,r){throw new eB.ErrnoError(63)},readlink:function(e){throw new eB.ErrnoError(63)}},stream_ops:{read:function(t,r,n,a,o){if((a=Math.min(a,t.node.size-o))<=0)return 0;for(var i=t.node.contents,s=i.compressedData,l=0;l<a;){var u,c=i.start+o+l,d=a-l,f=Math.floor(c/eR.CHUNK_SIZE),p=s.offsets[f],m=s.sizes[f];if(s.successes[f]){var h=s.cachedIndexes.indexOf(f);if(h>=0)u=s.cachedChunks[h];else{s.cachedIndexes.pop(),s.cachedIndexes.unshift(f),u=s.cachedChunks.pop(),s.cachedChunks.unshift(u),s.debug&&(console.log("decompressing chunk "+f),e.decompressedChunks=(e.decompressedChunks||0)+1);var g=s.data.subarray(p,p+m),y=eR.codec.uncompress(g,u);f<s.successes.length-1&&H(y===eR.CHUNK_SIZE)}}else u=s.data.subarray(p,p+eR.CHUNK_SIZE);var b=c%eR.CHUNK_SIZE,v=Math.min(b+d,eR.CHUNK_SIZE);r.set(u.subarray(b,v),n+l),l+=v-b}return l},write:function(e,t,r,n,a){throw new eB.ErrnoError(29)},llseek:function(e,t,r){var n=t;if(1===r?n+=e.position:2===r&&eB.isFile(e.node.mode)&&(n+=e.node.size),n<0)throw new eB.ErrnoError(28);return n}}},eB={root:null,mounts:[],devices:{},streams:[],nextInode:1,nameTable:null,currentPath:"/",initialized:!1,ignorePermissions:!0,trackingDelegate:{},tracking:{openFlags:{READ:1,WRITE:2}},ErrnoError:null,genericErrors:{},filesystems:null,syncFSRequests:0,handleFSError:function(t){if(!(t instanceof eB.ErrnoError)){var r;throw t+" : "+(r=eN(),e.extraStackTrace&&(r+="\n"+e.extraStackTrace()),r.replace(/\b_Z[\w\d_]+/g,function(e){var t=eC(e);return e===t?e:t+" ["+e+"]"}))}return eF(t.errno)},lookupPath:function(e,t){if(e=eP.resolve(eB.cwd(),e),t=t||{},!e)return{path:"",node:null};var r={follow_mount:!0,recurse_count:0};for(var n in r)void 0===t[n]&&(t[n]=r[n]);if(t.recurse_count>8)throw new eB.ErrnoError(32);for(var a=eM.normalizeArray(e.split("/").filter(function(e){return!!e}),!1),o=eB.root,i="/",s=0;s<a.length;s++){var l=s===a.length-1;if(l&&t.parent)break;if(o=eB.lookupNode(o,a[s]),i=eM.join2(i,a[s]),eB.isMountpoint(o)&&(!l||l&&t.follow_mount)&&(o=o.mounted.root),!l||t.follow)for(var u=0;eB.isLink(o.mode);){var c=eB.readlink(i);if(i=eP.resolve(eM.dirname(i),c),o=eB.lookupPath(i,{recurse_count:t.recurse_count}).node,u++>40)throw new eB.ErrnoError(32)}}return{path:i,node:o}},getPath:function(e){for(var t;;){if(eB.isRoot(e)){var r=e.mount.mountpoint;if(!t)return r;return"/"!==r[r.length-1]?r+"/"+t:r+t}t=t?e.name+"/"+t:e.name,e=e.parent}},hashName:function(e,t){for(var r=0,n=0;n<t.length;n++)r=(r<<5)-r+t.charCodeAt(n)|0;return(e+r>>>0)%eB.nameTable.length},hashAddNode:function(e){var t=eB.hashName(e.parent.id,e.name);e.name_next=eB.nameTable[t],eB.nameTable[t]=e},hashRemoveNode:function(e){var t=eB.hashName(e.parent.id,e.name);if(eB.nameTable[t]===e)eB.nameTable[t]=e.name_next;else for(var r=eB.nameTable[t];r;){if(r.name_next===e){r.name_next=e.name_next;break}r=r.name_next}},lookupNode:function(e,t){var r=eB.mayLookup(e);if(r)throw new eB.ErrnoError(r,e);for(var n=eB.hashName(e.id,t),a=eB.nameTable[n];a;a=a.name_next){var o=a.name;if(a.parent.id===e.id&&o===t)return a}return eB.lookup(e,t)},createNode:function(e,t,r,n){var a=new eB.FSNode(e,t,r,n);return eB.hashAddNode(a),a},destroyNode:function(e){eB.hashRemoveNode(e)},isRoot:function(e){return e===e.parent},isMountpoint:function(e){return!!e.mounted},isFile:function(e){return(61440&e)==32768},isDir:function(e){return(61440&e)==16384},isLink:function(e){return(61440&e)==40960},isChrdev:function(e){return(61440&e)==8192},isBlkdev:function(e){return(61440&e)==24576},isFIFO:function(e){return(61440&e)==4096},isSocket:function(e){return(49152&e)==49152},flagModes:{r:0,rs:1052672,"r+":2,w:577,wx:705,xw:705,"w+":578,"wx+":706,"xw+":706,a:1089,ax:1217,xa:1217,"a+":1090,"ax+":1218,"xa+":1218},modeStringToFlags:function(e){var t=eB.flagModes[e];if(void 0===t)throw Error("Unknown file open mode: "+e);return t},flagsToPermissionString:function(e){var t=["r","w","rw"][3&e];return 512&e&&(t+="w"),t},nodePermissions:function(e,t){return eB.ignorePermissions?0:2*(-1!==t.indexOf("r")&&!(292&e.mode)||-1!==t.indexOf("w")&&!(146&e.mode)||-1!==t.indexOf("x")&&!(73&e.mode))},mayLookup:function(e){var t=eB.nodePermissions(e,"x");return t||2*!e.node_ops.lookup},mayCreate:function(e,t){try{return eB.lookupNode(e,t),20}catch(e){}return eB.nodePermissions(e,"wx")},mayDelete:function(e,t,r){try{n=eB.lookupNode(e,t)}catch(e){return e.errno}var n,a=eB.nodePermissions(e,"wx");if(a)return a;if(r){if(!eB.isDir(n.mode))return 54;if(eB.isRoot(n)||eB.getPath(n)===eB.cwd())return 10}else if(eB.isDir(n.mode))return 31;return 0},mayOpen:function(e,t){return e?eB.isLink(e.mode)?32:eB.isDir(e.mode)&&("r"!==eB.flagsToPermissionString(t)||512&t)?31:eB.nodePermissions(e,eB.flagsToPermissionString(t)):44},MAX_OPEN_FDS:4096,nextfd:function(e,t){e=e||0,t=t||eB.MAX_OPEN_FDS;for(var r=e;r<=t;r++)if(!eB.streams[r])return r;throw new eB.ErrnoError(33)},getStream:function(e){return eB.streams[e]},createStream:function(e,t,r){eB.FSStream||(eB.FSStream=function(){},eB.FSStream.prototype={object:{get:function(){return this.node},set:function(e){this.node=e}},isRead:{get:function(){return(2097155&this.flags)!=1}},isWrite:{get:function(){return(2097155&this.flags)!=0}},isAppend:{get:function(){return 1024&this.flags}}});var n=new eB.FSStream;for(var a in e)n[a]=e[a];e=n;var o=eB.nextfd(t,r);return e.fd=o,eB.streams[o]=e,e},closeStream:function(e){eB.streams[e]=null},chrdev_stream_ops:{open:function(e){var t=eB.getDevice(e.node.rdev);e.stream_ops=t.stream_ops,e.stream_ops.open&&e.stream_ops.open(e)},llseek:function(){throw new eB.ErrnoError(70)}},major:function(e){return e>>8},minor:function(e){return 255&e},makedev:function(e,t){return e<<8|t},registerDevice:function(e,t){eB.devices[e]={stream_ops:t}},getDevice:function(e){return eB.devices[e]},getMounts:function(e){for(var t=[],r=[e];r.length;){var n=r.pop();t.push(n),r.push.apply(r,n.mounts)}return t},syncfs:function(e,t){"function"==typeof e&&(t=e,e=!1),eB.syncFSRequests++,eB.syncFSRequests>1&&U("warning: "+eB.syncFSRequests+" FS.syncfs operations in flight at once, probably just doing extra work");var r=eB.getMounts(eB.root.mount),n=0;function a(e){return eB.syncFSRequests--,t(e)}function o(e){if(e)return o.errored?void 0:(o.errored=!0,a(e));++n>=r.length&&a(null)}r.forEach(function(t){if(!t.type.syncfs)return o(null);t.type.syncfs(t,e,o)})},mount:function(e,t,r){var n,a="/"===r,o=!r;if(a&&eB.root)throw new eB.ErrnoError(10);if(!a&&!o){var i=eB.lookupPath(r,{follow_mount:!1});if(r=i.path,n=i.node,eB.isMountpoint(n))throw new eB.ErrnoError(10);if(!eB.isDir(n.mode))throw new eB.ErrnoError(54)}var s={type:e,opts:t,mountpoint:r,mounts:[]},l=e.mount(s);return l.mount=s,s.root=l,a?eB.root=l:n&&(n.mounted=s,n.mount&&n.mount.mounts.push(s)),l},unmount:function(e){var t=eB.lookupPath(e,{follow_mount:!1});if(!eB.isMountpoint(t.node))throw new eB.ErrnoError(28);var r=t.node,n=r.mounted,a=eB.getMounts(n);Object.keys(eB.nameTable).forEach(function(e){for(var t=eB.nameTable[e];t;){var r=t.name_next;-1!==a.indexOf(t.mount)&&eB.destroyNode(t),t=r}}),r.mounted=null;var o=r.mount.mounts.indexOf(n);r.mount.mounts.splice(o,1)},lookup:function(e,t){return e.node_ops.lookup(e,t)},mknod:function(e,t,r){var n=eB.lookupPath(e,{parent:!0}).node,a=eM.basename(e);if(!a||"."===a||".."===a)throw new eB.ErrnoError(28);var o=eB.mayCreate(n,a);if(o)throw new eB.ErrnoError(o);if(!n.node_ops.mknod)throw new eB.ErrnoError(63);return n.node_ops.mknod(n,a,t,r)},create:function(e,t){return t=(void 0!==t?t:438)&4095|32768,eB.mknod(e,t,0)},mkdir:function(e,t){return t=(void 0!==t?t:511)&1023|16384,eB.mknod(e,t,0)},mkdirTree:function(e,t){for(var r=e.split("/"),n="",a=0;a<r.length;++a)if(r[a]){n+="/"+r[a];try{eB.mkdir(n,t)}catch(e){if(20!=e.errno)throw e}}},mkdev:function(e,t,r){return void 0===r&&(r=t,t=438),t|=8192,eB.mknod(e,t,r)},symlink:function(e,t){if(!eP.resolve(e))throw new eB.ErrnoError(44);var r=eB.lookupPath(t,{parent:!0}).node;if(!r)throw new eB.ErrnoError(44);var n=eM.basename(t),a=eB.mayCreate(r,n);if(a)throw new eB.ErrnoError(a);if(!r.node_ops.symlink)throw new eB.ErrnoError(63);return r.node_ops.symlink(r,n,e)},rename:function(e,t){var r,n,a,o=eM.dirname(e),i=eM.dirname(t),s=eM.basename(e),l=eM.basename(t);if(r=eB.lookupPath(e,{parent:!0}).node,n=eB.lookupPath(t,{parent:!0}).node,!r||!n)throw new eB.ErrnoError(44);if(r.mount!==n.mount)throw new eB.ErrnoError(75);var u=eB.lookupNode(r,s),c=eP.relative(e,i);if("."!==c.charAt(0))throw new eB.ErrnoError(28);if("."!==(c=eP.relative(t,o)).charAt(0))throw new eB.ErrnoError(55);try{a=eB.lookupNode(n,l)}catch(e){}if(u!==a){var d=eB.isDir(u.mode),f=eB.mayDelete(r,s,d);if(f||(f=a?eB.mayDelete(n,l,d):eB.mayCreate(n,l)))throw new eB.ErrnoError(f);if(!r.node_ops.rename)throw new eB.ErrnoError(63);if(eB.isMountpoint(u)||a&&eB.isMountpoint(a))throw new eB.ErrnoError(10);if(n!==r&&(f=eB.nodePermissions(r,"w")))throw new eB.ErrnoError(f);try{eB.trackingDelegate.willMovePath&&eB.trackingDelegate.willMovePath(e,t)}catch(r){U("FS.trackingDelegate['willMovePath']('"+e+"', '"+t+"') threw an exception: "+r.message)}eB.hashRemoveNode(u);try{r.node_ops.rename(u,n,l)}catch(e){throw e}finally{eB.hashAddNode(u)}try{eB.trackingDelegate.onMovePath&&eB.trackingDelegate.onMovePath(e,t)}catch(r){U("FS.trackingDelegate['onMovePath']('"+e+"', '"+t+"') threw an exception: "+r.message)}}},rmdir:function(e){var t=eB.lookupPath(e,{parent:!0}).node,r=eM.basename(e),n=eB.lookupNode(t,r),a=eB.mayDelete(t,r,!0);if(a)throw new eB.ErrnoError(a);if(!t.node_ops.rmdir)throw new eB.ErrnoError(63);if(eB.isMountpoint(n))throw new eB.ErrnoError(10);try{eB.trackingDelegate.willDeletePath&&eB.trackingDelegate.willDeletePath(e)}catch(t){U("FS.trackingDelegate['willDeletePath']('"+e+"') threw an exception: "+t.message)}t.node_ops.rmdir(t,r),eB.destroyNode(n);try{eB.trackingDelegate.onDeletePath&&eB.trackingDelegate.onDeletePath(e)}catch(t){U("FS.trackingDelegate['onDeletePath']('"+e+"') threw an exception: "+t.message)}},readdir:function(e){var t=eB.lookupPath(e,{follow:!0}).node;if(!t.node_ops.readdir)throw new eB.ErrnoError(54);return t.node_ops.readdir(t)},unlink:function(e){var t=eB.lookupPath(e,{parent:!0}).node,r=eM.basename(e),n=eB.lookupNode(t,r),a=eB.mayDelete(t,r,!1);if(a)throw new eB.ErrnoError(a);if(!t.node_ops.unlink)throw new eB.ErrnoError(63);if(eB.isMountpoint(n))throw new eB.ErrnoError(10);try{eB.trackingDelegate.willDeletePath&&eB.trackingDelegate.willDeletePath(e)}catch(t){U("FS.trackingDelegate['willDeletePath']('"+e+"') threw an exception: "+t.message)}t.node_ops.unlink(t,r),eB.destroyNode(n);try{eB.trackingDelegate.onDeletePath&&eB.trackingDelegate.onDeletePath(e)}catch(t){U("FS.trackingDelegate['onDeletePath']('"+e+"') threw an exception: "+t.message)}},readlink:function(e){var t=eB.lookupPath(e).node;if(!t)throw new eB.ErrnoError(44);if(!t.node_ops.readlink)throw new eB.ErrnoError(28);return eP.resolve(eB.getPath(t.parent),t.node_ops.readlink(t))},stat:function(e,t){var r=eB.lookupPath(e,{follow:!t}).node;if(!r)throw new eB.ErrnoError(44);if(!r.node_ops.getattr)throw new eB.ErrnoError(63);return r.node_ops.getattr(r)},lstat:function(e){return eB.stat(e,!0)},chmod:function(e,t,r){var n;if(!(n="string"==typeof e?eB.lookupPath(e,{follow:!r}).node:e).node_ops.setattr)throw new eB.ErrnoError(63);n.node_ops.setattr(n,{mode:4095&t|-4096&n.mode,timestamp:Date.now()})},lchmod:function(e,t){eB.chmod(e,t,!0)},fchmod:function(e,t){var r=eB.getStream(e);if(!r)throw new eB.ErrnoError(8);eB.chmod(r.node,t)},chown:function(e,t,r,n){var a;if(!(a="string"==typeof e?eB.lookupPath(e,{follow:!n}).node:e).node_ops.setattr)throw new eB.ErrnoError(63);a.node_ops.setattr(a,{timestamp:Date.now()})},lchown:function(e,t,r){eB.chown(e,t,r,!0)},fchown:function(e,t,r){var n=eB.getStream(e);if(!n)throw new eB.ErrnoError(8);eB.chown(n.node,t,r)},truncate:function(e,t){if(t<0)throw new eB.ErrnoError(28);if("string"==typeof e){var r;r=eB.lookupPath(e,{follow:!0}).node}else r=e;if(!r.node_ops.setattr)throw new eB.ErrnoError(63);if(eB.isDir(r.mode))throw new eB.ErrnoError(31);if(!eB.isFile(r.mode))throw new eB.ErrnoError(28);var n=eB.nodePermissions(r,"w");if(n)throw new eB.ErrnoError(n);r.node_ops.setattr(r,{size:t,timestamp:Date.now()})},ftruncate:function(e,t){var r=eB.getStream(e);if(!r)throw new eB.ErrnoError(8);if((2097155&r.flags)==0)throw new eB.ErrnoError(28);eB.truncate(r.node,t)},utime:function(e,t,r){var n=eB.lookupPath(e,{follow:!0}).node;n.node_ops.setattr(n,{timestamp:Math.max(t,r)})},open:function(t,r,n,a,o){if(""===t)throw new eB.ErrnoError(44);if(r="string"==typeof r?eB.modeStringToFlags(r):r,n=void 0===n?438:n,n=64&r?4095&n|32768:0,"object"==typeof t)i=t;else{t=eM.normalize(t);try{var i;i=eB.lookupPath(t,{follow:!(131072&r)}).node}catch(e){}}var s=!1;if(64&r)if(i){if(128&r)throw new eB.ErrnoError(20)}else i=eB.mknod(t,n,0),s=!0;if(!i)throw new eB.ErrnoError(44);if(eB.isChrdev(i.mode)&&(r&=-513),65536&r&&!eB.isDir(i.mode))throw new eB.ErrnoError(54);if(!s){var l=eB.mayOpen(i,r);if(l)throw new eB.ErrnoError(l)}512&r&&eB.truncate(i,0),r&=-131713;var u=eB.createStream({node:i,path:eB.getPath(i),flags:r,seekable:!0,position:0,stream_ops:i.stream_ops,ungotten:[],error:!1},a,o);u.stream_ops.open&&u.stream_ops.open(u),e.logReadFiles&&!(1&r)&&(eB.readFiles||(eB.readFiles={}),t in eB.readFiles||(eB.readFiles[t]=1,U("FS.trackingDelegate error on read file: "+t)));try{if(eB.trackingDelegate.onOpenFile){var c=0;(2097155&r)!=1&&(c|=eB.tracking.openFlags.READ),(2097155&r)!=0&&(c|=eB.tracking.openFlags.WRITE),eB.trackingDelegate.onOpenFile(t,c)}}catch(e){U("FS.trackingDelegate['onOpenFile']('"+t+"', flags) threw an exception: "+e.message)}return u},close:function(e){if(eB.isClosed(e))throw new eB.ErrnoError(8);e.getdents&&(e.getdents=null);try{e.stream_ops.close&&e.stream_ops.close(e)}catch(e){throw e}finally{eB.closeStream(e.fd)}e.fd=null},isClosed:function(e){return null===e.fd},llseek:function(e,t,r){if(eB.isClosed(e))throw new eB.ErrnoError(8);if(!e.seekable||!e.stream_ops.llseek)throw new eB.ErrnoError(70);if(0!=r&&1!=r&&2!=r)throw new eB.ErrnoError(28);return e.position=e.stream_ops.llseek(e,t,r),e.ungotten=[],e.position},read:function(e,t,r,n,a){if(n<0||a<0)throw new eB.ErrnoError(28);if(eB.isClosed(e)||(2097155&e.flags)==1)throw new eB.ErrnoError(8);if(eB.isDir(e.node.mode))throw new eB.ErrnoError(31);if(!e.stream_ops.read)throw new eB.ErrnoError(28);var o=void 0!==a;if(o){if(!e.seekable)throw new eB.ErrnoError(70)}else a=e.position;var i=e.stream_ops.read(e,t,r,n,a);return o||(e.position+=i),i},write:function(e,t,r,n,a,o){if(n<0||a<0)throw new eB.ErrnoError(28);if(eB.isClosed(e)||(2097155&e.flags)==0)throw new eB.ErrnoError(8);if(eB.isDir(e.node.mode))throw new eB.ErrnoError(31);if(!e.stream_ops.write)throw new eB.ErrnoError(28);e.seekable&&1024&e.flags&&eB.llseek(e,0,2);var i=void 0!==a;if(i){if(!e.seekable)throw new eB.ErrnoError(70)}else a=e.position;var s=e.stream_ops.write(e,t,r,n,a,o);i||(e.position+=s);try{e.path&&eB.trackingDelegate.onWriteToFile&&eB.trackingDelegate.onWriteToFile(e.path)}catch(t){U("FS.trackingDelegate['onWriteToFile']('"+e.path+"') threw an exception: "+t.message)}return s},allocate:function(e,t,r){if(eB.isClosed(e))throw new eB.ErrnoError(8);if(t<0||r<=0)throw new eB.ErrnoError(28);if((2097155&e.flags)==0)throw new eB.ErrnoError(8);if(!eB.isFile(e.node.mode)&&!eB.isDir(e.node.mode))throw new eB.ErrnoError(43);if(!e.stream_ops.allocate)throw new eB.ErrnoError(138);e.stream_ops.allocate(e,t,r)},mmap:function(e,t,r,n,a,o){if((2&a)!=0&&(2&o)==0&&(2097155&e.flags)!=2||(2097155&e.flags)==1)throw new eB.ErrnoError(2);if(!e.stream_ops.mmap)throw new eB.ErrnoError(43);return e.stream_ops.mmap(e,t,r,n,a,o)},msync:function(e,t,r,n,a){return e&&e.stream_ops.msync?e.stream_ops.msync(e,t,r,n,a):0},munmap:function(e){return 0},ioctl:function(e,t,r){if(!e.stream_ops.ioctl)throw new eB.ErrnoError(59);return e.stream_ops.ioctl(e,t,r)},readFile:function(e,t){if((t=t||{}).flags=t.flags||"r",t.encoding=t.encoding||"binary","utf8"!==t.encoding&&"binary"!==t.encoding)throw Error('Invalid encoding type "'+t.encoding+'"');var r,n=eB.open(e,t.flags),a=eB.stat(e).size,o=new Uint8Array(a);return eB.read(n,o,0,a,0),"utf8"===t.encoding?r=Y(o,0):"binary"===t.encoding&&(r=o),eB.close(n),r},writeFile:function(e,t,r){(r=r||{}).flags=r.flags||"w";var n=eB.open(e,r.flags,r.mode);if("string"==typeof t){var a=new Uint8Array(J(t)+1),o=Q(t,a,0,a.length);eB.write(n,a,0,o,void 0,r.canOwn)}else if(ArrayBuffer.isView(t))eB.write(n,t,0,t.byteLength,void 0,r.canOwn);else throw Error("Unsupported data type");eB.close(n)},cwd:function(){return eB.currentPath},chdir:function(e){var t=eB.lookupPath(e,{follow:!0});if(null===t.node)throw new eB.ErrnoError(44);if(!eB.isDir(t.node.mode))throw new eB.ErrnoError(54);var r=eB.nodePermissions(t.node,"x");if(r)throw new eB.ErrnoError(r);eB.currentPath=t.path},createDefaultDirectories:function(){eB.mkdir("/tmp"),eB.mkdir("/home"),eB.mkdir("/home/web_user")},createDefaultDevices:function(){eB.mkdir("/dev"),eB.registerDevice(eB.makedev(1,3),{read:function(){return 0},write:function(e,t,r,n,a){return n}}),eB.mkdev("/dev/null",eB.makedev(1,3)),eI.register(eB.makedev(5,0),eI.default_tty_ops),eI.register(eB.makedev(6,0),eI.default_tty1_ops),eB.mkdev("/dev/tty",eB.makedev(5,0)),eB.mkdev("/dev/tty1",eB.makedev(6,0));var e=function(){if("object"==typeof crypto&&"function"==typeof crypto.getRandomValues){var e=new Uint8Array(1);return function(){return crypto.getRandomValues(e),e[0]}}if(I)try{var t=require("crypto");return function(){return t.randomBytes(1)[0]}}catch(e){}return function(){ev("randomDevice")}}();eB.createDevice("/dev","random",e),eB.createDevice("/dev","urandom",e),eB.mkdir("/dev/shm"),eB.mkdir("/dev/shm/tmp")},createSpecialDirectories:function(){eB.mkdir("/proc"),eB.mkdir("/proc/self"),eB.mkdir("/proc/self/fd"),eB.mount({mount:function(){var e=eB.createNode("/proc/self","fd",16895,73);return e.node_ops={lookup:function(e,t){var r=eB.getStream(+t);if(!r)throw new eB.ErrnoError(8);var n={parent:null,mount:{mountpoint:"fake"},node_ops:{readlink:function(){return r.path}}};return n.parent=n,n}},e}},{},"/proc/self/fd")},createStandardStreams:function(){e.stdin?eB.createDevice("/dev","stdin",e.stdin):eB.symlink("/dev/tty","/dev/stdin"),e.stdout?eB.createDevice("/dev","stdout",null,e.stdout):eB.symlink("/dev/tty","/dev/stdout"),e.stderr?eB.createDevice("/dev","stderr",null,e.stderr):eB.symlink("/dev/tty1","/dev/stderr"),eB.open("/dev/stdin","r"),eB.open("/dev/stdout","w"),eB.open("/dev/stderr","w")},ensureErrnoError:function(){eB.ErrnoError||(eB.ErrnoError=function(e,t){this.node=t,this.setErrno=function(e){this.errno=e},this.setErrno(e),this.message="FS error"},eB.ErrnoError.prototype=Error(),eB.ErrnoError.prototype.constructor=eB.ErrnoError,[44].forEach(function(e){eB.genericErrors[e]=new eB.ErrnoError(e),eB.genericErrors[e].stack="<generic error, no stack>"}))},staticInit:function(){eB.ensureErrnoError(),eB.nameTable=Array(4096),eB.mount(eL,{},"/"),eB.createDefaultDirectories(),eB.createDefaultDevices(),eB.createSpecialDirectories(),eB.filesystems={MEMFS:eL}},init:function(t,r,n){eB.init.initialized=!0,eB.ensureErrnoError(),e.stdin=t||e.stdin,e.stdout=r||e.stdout,e.stderr=n||e.stderr,eB.createStandardStreams()},quit:function(){eB.init.initialized=!1;var t=e._fflush;t&&t(0);for(var r=0;r<eB.streams.length;r++){var n=eB.streams[r];n&&eB.close(n)}},getMode:function(e,t){var r=0;return e&&(r|=365),t&&(r|=146),r},findObject:function(e,t){var r=eB.analyzePath(e,t);return r.exists?r.object:(eF(r.error),null)},analyzePath:function(e,t){try{var r=eB.lookupPath(e,{follow:!t});e=r.path}catch(e){}var n={isRoot:!1,exists:!1,error:0,name:null,path:null,object:null,parentExists:!1,parentPath:null,parentObject:null};try{var r=eB.lookupPath(e,{parent:!0});n.parentExists=!0,n.parentPath=r.path,n.parentObject=r.node,n.name=eM.basename(e),r=eB.lookupPath(e,{follow:!t}),n.exists=!0,n.path=r.path,n.object=r.node,n.name=r.node.name,n.isRoot="/"===r.path}catch(e){n.error=e.errno}return n},createPath:function(e,t,r,n){e="string"==typeof e?e:eB.getPath(e);for(var a=t.split("/").reverse();a.length;){var o=a.pop();if(o){var i=eM.join2(e,o);try{eB.mkdir(i)}catch(e){}e=i}}return i},createFile:function(e,t,r,n,a){var o=eM.join2("string"==typeof e?e:eB.getPath(e),t),i=eB.getMode(n,a);return eB.create(o,i)},createDataFile:function(e,t,r,n,a,o){var i=t?eM.join2("string"==typeof e?e:eB.getPath(e),t):e,s=eB.getMode(n,a),l=eB.create(i,s);if(r){if("string"==typeof r){for(var u=Array(r.length),c=0,d=r.length;c<d;++c)u[c]=r.charCodeAt(c);r=u}eB.chmod(l,146|s);var f=eB.open(l,"w");eB.write(f,r,0,r.length,0,o),eB.close(f),eB.chmod(l,s)}return l},createDevice:function(e,t,r,n){var a=eM.join2("string"==typeof e?e:eB.getPath(e),t),o=eB.getMode(!!r,!!n);eB.createDevice.major||(eB.createDevice.major=64);var i=eB.makedev(eB.createDevice.major++,0);return eB.registerDevice(i,{open:function(e){e.seekable=!1},close:function(e){n&&n.buffer&&n.buffer.length&&n(10)},read:function(e,t,n,a,o){for(var i,s=0,l=0;l<a;l++){try{i=r()}catch(e){throw new eB.ErrnoError(29)}if(void 0===i&&0===s)throw new eB.ErrnoError(6);if(null==i)break;s++,t[n+l]=i}return s&&(e.node.timestamp=Date.now()),s},write:function(e,t,r,a,o){for(var i=0;i<a;i++)try{n(t[r+i])}catch(e){throw new eB.ErrnoError(29)}return a&&(e.node.timestamp=Date.now()),i}}),eB.mkdev(a,o,i)},forceLoadFile:function(e){if(e.isDevice||e.isFolder||e.link||e.contents)return!0;var t=!0;if("u">typeof XMLHttpRequest)throw Error("Lazy loading should have been performed (contents set) in createLazyFile, but it was not. Lazy loading only works in web workers. Use --embed-file or --preload-file in emcc on the main thread.");if(o)try{e.contents=tQ(o(e.url),!0),e.usedBytes=e.contents.length}catch(e){t=!1}else throw Error("Cannot load without read() or XMLHttpRequest.");return t||eF(29),t},createLazyFile:function(e,t,r,n,a){function o(){this.lengthKnown=!1,this.chunks=[]}if(o.prototype.get=function(e){if(!(e>this.length-1)&&!(e<0)){var t=e%this.chunkSize,r=e/this.chunkSize|0;return this.getter(r)[t]}},o.prototype.setDataGetter=function(e){this.getter=e},o.prototype.cacheLength=function(){var e,t=new XMLHttpRequest;if(t.open("HEAD",r,!1),t.send(null),!(t.status>=200&&t.status<300||304===t.status))throw Error("Couldn't load "+r+". Status: "+t.status);var n=Number(t.getResponseHeader("Content-length")),a=(e=t.getResponseHeader("Accept-Ranges"))&&"bytes"===e,o=(e=t.getResponseHeader("Content-Encoding"))&&"gzip"===e,i=1048576;a||(i=n);var s=function(e,t){if(e>t)throw Error("invalid range ("+e+", "+t+") or no bytes requested!");if(t>n-1)throw Error("only "+n+" bytes available! programmer error!");var a=new XMLHttpRequest;if(a.open("GET",r,!1),n!==i&&a.setRequestHeader("Range","bytes="+e+"-"+t),"u">typeof Uint8Array&&(a.responseType="arraybuffer"),a.overrideMimeType&&a.overrideMimeType("text/plain; charset=x-user-defined"),a.send(null),!(a.status>=200&&a.status<300||304===a.status))throw Error("Couldn't load "+r+". Status: "+a.status);return void 0!==a.response?new Uint8Array(a.response||[]):tQ(a.responseText||"",!0)},l=this;l.setDataGetter(function(e){var t=e*i,r=(e+1)*i-1;if(r=Math.min(r,n-1),void 0===l.chunks[e]&&(l.chunks[e]=s(t,r)),void 0===l.chunks[e])throw Error("doXHR failed!");return l.chunks[e]}),(o||!n)&&(i=n=1,i=n=this.getter(0).length,O("LazyFiles on gzip forces download of the whole file when length is accessed")),this._length=n,this._chunkSize=i,this.lengthKnown=!0},"u">typeof XMLHttpRequest){if(!P)throw"Cannot do synchronous binary XHRs outside webworkers in modern browsers. Use --embed-file or --preload-file in emcc";var i=new o;Object.defineProperties(i,{length:{get:function(){return this.lengthKnown||this.cacheLength(),this._length}},chunkSize:{get:function(){return this.lengthKnown||this.cacheLength(),this._chunkSize}}});var s={isDevice:!1,contents:i}}else var s={isDevice:!1,url:r};var l=eB.createFile(e,t,s,n,a);s.contents?l.contents=s.contents:s.url&&(l.contents=null,l.url=s.url),Object.defineProperties(l,{usedBytes:{get:function(){return this.contents.length}}});var u={};return Object.keys(l.stream_ops).forEach(function(e){var t=l.stream_ops[e];u[e]=function(){if(!eB.forceLoadFile(l))throw new eB.ErrnoError(29);return t.apply(null,arguments)}}),u.read=function(e,t,r,n,a){if(!eB.forceLoadFile(l))throw new eB.ErrnoError(29);var o=e.node.contents;if(a>=o.length)return 0;var i=Math.min(o.length-a,n);if(o.slice)for(var s=0;s<i;s++)t[r+s]=o[a+s];else for(var s=0;s<i;s++)t[r+s]=o.get(a+s);return i},l.stream_ops=u,l},createPreloadedFile:function(t,r,n,a,o,i,s,l,u,c){tc.init();var d=r?eP.resolve(eM.join2(t,r)):t;function f(n){function f(e){c&&c(),l||eB.createDataFile(t,r,e,a,o,u),i&&i(),eb()}var p=!1;e.preloadPlugins.forEach(function(e){!p&&e.canHandle(d)&&(e.handle(n,d,f,function(){s&&s(),eb()}),p=!0)}),p||f(n)}ey(),"string"==typeof n?tc.asyncLoad(n,function(e){f(e)},s):f(n)},indexedDB:function(){return window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB},DB_NAME:function(){return"EM_FS_"+window.location.pathname},DB_VERSION:20,DB_STORE_NAME:"FILE_DATA",saveFilesToDB:function(e,t,r){t=t||function(){},r=r||function(){};var n=eB.indexedDB();try{var a=n.open(eB.DB_NAME(),eB.DB_VERSION)}catch(e){return r(e)}a.onupgradeneeded=function(){O("creating db"),a.result.createObjectStore(eB.DB_STORE_NAME)},a.onsuccess=function(){var n=a.result.transaction([eB.DB_STORE_NAME],"readwrite"),o=n.objectStore(eB.DB_STORE_NAME),i=0,s=0,l=e.length;function u(){0==s?t():r()}e.forEach(function(e){var t=o.put(eB.analyzePath(e).object.contents,e);t.onsuccess=function(){++i+s==l&&u()},t.onerror=function(){s++,i+s==l&&u()}}),n.onerror=r},a.onerror=r},loadFilesFromDB:function(e,t,r){t=t||function(){},r=r||function(){};var n=eB.indexedDB();try{var a=n.open(eB.DB_NAME(),eB.DB_VERSION)}catch(e){return r(e)}a.onupgradeneeded=r,a.onsuccess=function(){var n=a.result;try{var o=n.transaction([eB.DB_STORE_NAME],"readonly")}catch(e){r(e);return}var i=o.objectStore(eB.DB_STORE_NAME),s=0,l=0,u=e.length;function c(){0==l?t():r()}e.forEach(function(e){var t=i.get(e);t.onsuccess=function(){eB.analyzePath(e).exists&&eB.unlink(e),eB.createDataFile(eM.dirname(e),eM.basename(e),t.result,!0,!0,!0),++s+l==u&&c()},t.onerror=function(){l++,s+l==u&&c()}}),o.onerror=r},a.onerror=r}},eO={mappings:{},DEFAULT_POLLMASK:5,umask:511,calculateAt:function(e,t){if("/"!==t[0]){var r;if(-100===e)r=eB.cwd();else{var n=eB.getStream(e);if(!n)throw new eB.ErrnoError(8);r=n.path}t=eM.join2(r,t)}return t},doStat:function(e,t,r){try{var n=e(t)}catch(e){if(e&&e.node&&eM.normalize(t)!==eM.normalize(eB.getPath(e.node)))return -54;throw e}return w[r>>2]=n.dev,w[r+4>>2]=0,w[r+8>>2]=n.ino,w[r+12>>2]=n.mode,w[r+16>>2]=n.nlink,w[r+20>>2]=n.uid,w[r+24>>2]=n.gid,w[r+28>>2]=n.rdev,w[r+32>>2]=0,T=[n.size>>>0,+Math.abs(E=n.size)>=1?E>0?Math.min(+Math.floor(E/0x100000000),0xffffffff)>>>0:~~Math.ceil((E-(~~E>>>0))/0x100000000)>>>0:0],w[r+40>>2]=T[0],w[r+44>>2]=T[1],w[r+48>>2]=4096,w[r+52>>2]=n.blocks,w[r+56>>2]=n.atime.getTime()/1e3|0,w[r+60>>2]=0,w[r+64>>2]=n.mtime.getTime()/1e3|0,w[r+68>>2]=0,w[r+72>>2]=n.ctime.getTime()/1e3|0,w[r+76>>2]=0,T=[n.ino>>>0,+Math.abs(E=n.ino)>=1?E>0?Math.min(+Math.floor(E/0x100000000),0xffffffff)>>>0:~~Math.ceil((E-(~~E>>>0))/0x100000000)>>>0:0],w[r+80>>2]=T[0],w[r+84>>2]=T[1],0},doMsync:function(e,t,r,n,a){var o=b.slice(e,e+r);eB.msync(t,o,a,r,n)},doMkdir:function(e,t){return"/"===(e=eM.normalize(e))[e.length-1]&&(e=e.substr(0,e.length-1)),eB.mkdir(e,t,0),0},doMknod:function(e,t,r){switch(61440&t){case 32768:case 8192:case 24576:case 4096:case 49152:break;default:return -28}return eB.mknod(e,t,r),0},doReadlink:function(e,t,r){if(r<=0)return -28;var n=eB.readlink(e),a=Math.min(r,J(n)),o=y[t+a];return Z(n,t,r+1),y[t+a]=o,a},doAccess:function(e,t){if(-8&t)return -28;if(!(r=eB.lookupPath(e,{follow:!0}).node))return -44;var r,n="";return(4&t&&(n+="r"),2&t&&(n+="w"),1&t&&(n+="x"),n&&eB.nodePermissions(r,n))?-2:0},doDup:function(e,t,r){var n=eB.getStream(r);return n&&eB.close(n),eB.open(e,t,0,r,r).fd},doReadv:function(e,t,r,n){for(var a=0,o=0;o<r;o++){var i=w[t+8*o>>2],s=w[t+(8*o+4)>>2],l=eB.read(e,y,i,s,n);if(l<0)return -1;if(a+=l,l<s)break}return a},doWritev:function(e,t,r,n){for(var a=0,o=0;o<r;o++){var i=w[t+8*o>>2],s=w[t+(8*o+4)>>2],l=eB.write(e,y,i,s,n);if(l<0)return -1;a+=l}return a},varargs:void 0,get:function(){return eO.varargs+=4,w[eO.varargs-4>>2]},getStr:function(e){return K(e)},getStreamFromFD:function(e){var t=eB.getStream(e);if(!t)throw new eB.ErrnoError(8);return t},get64:function(e,t){return e}};function eU(e){switch(e){case 1:return 0;case 2:return 1;case 4:return 2;case 8:return 3;default:throw TypeError("Unknown type size: "+e)}}var ez=void 0;function eX(e){for(var t="",r=e;b[r];)t+=ez[b[r++]];return t}var e$={},eW={},eH={};function eG(e){if(void 0===e)return"_unknown";var t=(e=e.replace(/[^a-zA-Z0-9_]/g,"$")).charCodeAt(0);return t>=48&&t<=57?"_"+e:e}function eV(e,t){return Function("body","return function "+(e=eG(e))+'() {\n    "use strict";    return body.apply(this, arguments);\n};\n')(t)}function eq(e,t){var r=eV(t,function(e){this.name=t,this.message=e;var r=Error(e).stack;void 0!==r&&(this.stack=this.toString()+"\n"+r.replace(/^Error(:[^\n]*)?\n/,""))});return r.prototype=Object.create(e.prototype),r.prototype.constructor=r,r.prototype.toString=function(){return void 0===this.message?this.name:this.name+": "+this.message},r}var eY=void 0;function eK(e){throw new eY(e)}var eQ=void 0;function eZ(e){throw new eQ(e)}function eJ(e,t,r){if(r=r||{},!("argPackAdvance"in t))throw TypeError("registerType registeredInstance requires argPackAdvance");var n=t.name;if(e||eK('type "'+n+'" must have a positive integer typeid pointer'),eW.hasOwnProperty(e))if(r.ignoreDuplicateRegistrations)return;else eK("Cannot register type '"+n+"' twice");if(eW[e]=t,delete eH[e],e$.hasOwnProperty(e)){var a=e$[e];delete e$[e],a.forEach(function(e){e()})}}var e0=[],e1=[{},{value:void 0},{value:null},{value:!0},{value:!1}];function e2(e){e>4&&0==--e1[e].refcount&&(e1[e]=void 0,e0.push(e))}function e4(e){switch(e){case void 0:return 1;case null:return 2;case!0:return 3;case!1:return 4;default:var t=e0.length?e0.pop():e1.length;return e1[t]={refcount:1,value:e},t}}function e8(e){return this.fromWireType(k[e>>2])}function e3(e){if(null===e)return"null";var t=typeof e;return"object"===t||"array"===t||"function"===t?e.toString():""+e}function e5(e,t){if(!(e instanceof Function))throw TypeError("new_ called with constructor type "+typeof e+" which is not a function");var r=eV(e.name||"unknownFunctionName",function(){});r.prototype=e.prototype;var n=new r,a=e.apply(n,t);return a instanceof Object?a:n}function e6(e){for(;e.length;){var t=e.pop();e.pop()(t)}}var e7=void 0;function e9(e){var t=t3(e),r=eX(t);return t4(t),r}function te(e){return e||eK("Cannot use deleted val. handle = "+e),e1[e].value}function tt(e,t){var r=eW[e];return void 0===r&&eK(t+" has unknown type "+e9(e)),r}function tr(e,t){for(var r=Array(e),n=0;n<e;++n)r[n]=tt(w[(t>>2)+n],"parameter "+n);return r}var tn={};function ta(e){var t=tn[e];return void 0===t?eX(e):t}var to=[];function ti(){return"object"==typeof globalThis?globalThis:Function("return this")()}var ts={};function tl(t,r){if(tc.mainLoop.timingMode=t,tc.mainLoop.timingValue=r,!tc.mainLoop.func)return 1;if(0==t)tc.mainLoop.scheduler=function(){var e=0|Math.max(0,tc.mainLoop.tickStartTime+r-C());setTimeout(tc.mainLoop.runner,e)},tc.mainLoop.method="timeout";else if(1==t)tc.mainLoop.scheduler=function(){tc.requestAnimationFrame(tc.mainLoop.runner)},tc.mainLoop.method="rAF";else if(2==t){if("u"<typeof setImmediate){var n=[],a="setimmediate";addEventListener("message",function(e){(e.data===a||e.data.target===a)&&(e.stopPropagation(),n.shift()())},!0),setImmediate=function(t){n.push(t),P?(void 0===e.setImmediates&&(e.setImmediates=[]),e.setImmediates.push(t),postMessage({target:a})):postMessage(a,"*")}}tc.mainLoop.scheduler=function(){setImmediate(tc.mainLoop.runner)},tc.mainLoop.method="immediate"}return 0}function tu(e,t,r,n,a){p=!0,H(!tc.mainLoop.func,"emscripten_set_main_loop: there can only be one main loop function at once: call emscripten_cancel_main_loop to cancel the previous one before setting a new one with different parameters."),tc.mainLoop.func=e,tc.mainLoop.arg=n;var o=tc.mainLoop.currentlyRunningMainloop;if(tc.mainLoop.runner=function(){if(!W){if(tc.mainLoop.queue.length>0){var t=Date.now(),r=tc.mainLoop.queue.shift();if(r.func(r.arg),tc.mainLoop.remainingBlockers){var n=tc.mainLoop.remainingBlockers,a=n%1==0?n-1:Math.floor(n);r.counted?tc.mainLoop.remainingBlockers=a:(a+=.5,tc.mainLoop.remainingBlockers=(8*n+a)/9)}if(console.log('main loop blocker "'+r.name+'" took '+(Date.now()-t)+" ms"),tc.mainLoop.updateStatus(),o<tc.mainLoop.currentlyRunningMainloop)return;setTimeout(tc.mainLoop.runner,0);return}if(!(o<tc.mainLoop.currentlyRunningMainloop)){if(tc.mainLoop.currentFrameNumber=tc.mainLoop.currentFrameNumber+1|0,1==tc.mainLoop.timingMode&&tc.mainLoop.timingValue>1&&tc.mainLoop.currentFrameNumber%tc.mainLoop.timingValue!=0)return void tc.mainLoop.scheduler();0==tc.mainLoop.timingMode&&(tc.mainLoop.tickStartTime=C()),tc.mainLoop.runIter(e),o<tc.mainLoop.currentlyRunningMainloop||("object"==typeof SDL&&SDL.audio&&SDL.audio.queueNewAudioData&&SDL.audio.queueNewAudioData(),tc.mainLoop.scheduler())}}},a||(t&&t>0?tl(0,1e3/t):tl(1,1),tc.mainLoop.scheduler()),r)throw"unwind"}C=I?function(){var e=s.hrtime();return 1e3*e[0]+e[1]/1e6}:"u">typeof dateNow?dateNow:function(){return performance.now()};var tc={mainLoop:{scheduler:null,method:"",currentlyRunningMainloop:0,func:null,arg:0,timingMode:0,timingValue:0,currentFrameNumber:0,queue:[],pause:function(){tc.mainLoop.scheduler=null,tc.mainLoop.currentlyRunningMainloop++},resume:function(){tc.mainLoop.currentlyRunningMainloop++;var e=tc.mainLoop.timingMode,t=tc.mainLoop.timingValue,r=tc.mainLoop.func;tc.mainLoop.func=null,tu(r,0,!1,tc.mainLoop.arg,!0),tl(e,t),tc.mainLoop.scheduler()},updateStatus:function(){if(e.setStatus){var t=e.statusMessage||"Please wait...",r=tc.mainLoop.remainingBlockers,n=tc.mainLoop.expectedBlockers;r?r<n?e.setStatus(t+" ("+(n-r)+"/"+n+")"):e.setStatus(t):e.setStatus("")}},runIter:function(t){if(!W&&(!e.preMainLoop||!1!==e.preMainLoop())){try{t()}catch(e){if(e instanceof rf||"unwind"==e)return;throw e&&"object"==typeof e&&e.stack&&U("exception thrown: "+[e,e.stack]),e}e.postMainLoop&&e.postMainLoop()}}},isFullscreen:!1,pointerLock:!1,moduleContextCreatedCallbacks:[],workers:[],init:function(){if(e.preloadPlugins||(e.preloadPlugins=[]),!tc.initted){tc.initted=!0;try{new Blob,tc.hasBlobConstructor=!0}catch(e){tc.hasBlobConstructor=!1,console.log("warning: no blob constructor, cannot create blobs with mimetypes")}tc.BlobBuilder="u">typeof MozBlobBuilder?MozBlobBuilder:"u">typeof WebKitBlobBuilder?WebKitBlobBuilder:tc.hasBlobConstructor?null:console.log("warning: no BlobBuilder"),tc.URLObject=window.URL?window.URL:window.webkitURL,e.noImageDecoding||void 0!==tc.URLObject||(console.log("warning: Browser does not support creating object URLs. Built-in browser image decoding will not be available."),e.noImageDecoding=!0);var t={};t.canHandle=function(t){return!e.noImageDecoding&&/\.(jpg|jpeg|png|bmp)$/i.test(t)},t.handle=function(t,r,n,a){var o=null;if(tc.hasBlobConstructor)try{(o=new Blob([t],{type:tc.getMimetype(r)})).size!==t.length&&(o=new Blob([new Uint8Array(t).buffer],{type:tc.getMimetype(r)}))}catch(e){z("Blob constructor present but fails: "+e+"; falling back to blob builder")}if(!o){var i=new tc.BlobBuilder;i.append(new Uint8Array(t).buffer),o=i.getBlob()}var s=tc.URLObject.createObjectURL(o),l=new Image;l.onload=function(){H(l.complete,"Image "+r+" could not be decoded");var a=document.createElement("canvas");a.width=l.width,a.height=l.height,a.getContext("2d").drawImage(l,0,0),e.preloadedImages[r]=a,tc.URLObject.revokeObjectURL(s),n&&n(t)},l.onerror=function(e){console.log("Image "+s+" could not be decoded"),a&&a()},l.src=s},e.preloadPlugins.push(t);var r={};r.canHandle=function(t){return!e.noAudioDecoding&&t.substr(-4)in{".ogg":1,".wav":1,".mp3":1}},r.handle=function(t,r,n,a){var o=!1;function i(a){!o&&(o=!0,e.preloadedAudios[r]=a,n&&n(t))}function s(){!o&&(o=!0,e.preloadedAudios[r]=new Audio,a&&a())}if(!tc.hasBlobConstructor)return s();try{var l=new Blob([t],{type:tc.getMimetype(r)})}catch(e){return s()}var u=tc.URLObject.createObjectURL(l),c=new Audio;c.addEventListener("canplaythrough",function(){i(c)},!1),c.onerror=function(e){o||(console.log("warning: browser could not fully decode audio "+r+", trying slower base64 approach"),c.src="data:audio/x-"+r.substr(-3)+";base64,"+function(e){for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",r="",n=0,a=0,o=0;o<e.length;o++)for(n=n<<8|e[o],a+=8;a>=6;){var i=n>>a-6&63;a-=6,r+=t[i]}return 2==a?(r+=t[(3&n)<<4],r+="=="):4==a&&(r+=t[(15&n)<<2],r+="="),r}(t),i(c))},c.src=u,tc.safeSetTimeout(function(){i(c)},1e4)},e.preloadPlugins.push(r);var n=e.canvas;n&&(n.requestPointerLock=n.requestPointerLock||n.mozRequestPointerLock||n.webkitRequestPointerLock||n.msRequestPointerLock||function(){},n.exitPointerLock=document.exitPointerLock||document.mozExitPointerLock||document.webkitExitPointerLock||document.msExitPointerLock||function(){},n.exitPointerLock=n.exitPointerLock.bind(document),document.addEventListener("pointerlockchange",a,!1),document.addEventListener("mozpointerlockchange",a,!1),document.addEventListener("webkitpointerlockchange",a,!1),document.addEventListener("mspointerlockchange",a,!1),e.elementPointerLock&&n.addEventListener("click",function(t){!tc.pointerLock&&e.canvas.requestPointerLock&&(e.canvas.requestPointerLock(),t.preventDefault())},!1))}function a(){tc.pointerLock=document.pointerLockElement===e.canvas||document.mozPointerLockElement===e.canvas||document.webkitPointerLockElement===e.canvas||document.msPointerLockElement===e.canvas}},createContext:function(t,r,n,a){if(r&&e.ctx&&t==e.canvas)return e.ctx;if(r){var o,i,s={antialias:!1,alpha:!1,majorVersion:1};if(a)for(var l in a)s[l]=a[l];void 0!==th&&(i=th.createContext(t,s))&&(o=th.getContext(i).GLctx)}else o=t.getContext("2d");return o?(n&&(r||H(void 0===N,"cannot set in module if GLctx is used, but we are a non-GL context that would replace it"),e.ctx=o,r&&th.makeContextCurrent(i),e.useWebGL=r,tc.moduleContextCreatedCallbacks.forEach(function(e){e()}),tc.init()),o):null},destroyContext:function(e,t,r){},fullscreenHandlersInstalled:!1,lockPointer:void 0,resizeCanvas:void 0,requestFullscreen:function(t,r){tc.lockPointer=t,tc.resizeCanvas=r,void 0===tc.lockPointer&&(tc.lockPointer=!0),void 0===tc.resizeCanvas&&(tc.resizeCanvas=!1);var n=e.canvas;function a(){tc.isFullscreen=!1;var t=n.parentNode;(document.fullscreenElement||document.mozFullScreenElement||document.msFullscreenElement||document.webkitFullscreenElement||document.webkitCurrentFullScreenElement)===t?(n.exitFullscreen=tc.exitFullscreen,tc.lockPointer&&n.requestPointerLock(),tc.isFullscreen=!0,tc.resizeCanvas?tc.setFullscreenCanvasSize():tc.updateCanvasDimensions(n)):(t.parentNode.insertBefore(n,t),t.parentNode.removeChild(t),tc.resizeCanvas?tc.setWindowedCanvasSize():tc.updateCanvasDimensions(n)),e.onFullScreen&&e.onFullScreen(tc.isFullscreen),e.onFullscreen&&e.onFullscreen(tc.isFullscreen)}tc.fullscreenHandlersInstalled||(tc.fullscreenHandlersInstalled=!0,document.addEventListener("fullscreenchange",a,!1),document.addEventListener("mozfullscreenchange",a,!1),document.addEventListener("webkitfullscreenchange",a,!1),document.addEventListener("MSFullscreenChange",a,!1));var o=document.createElement("div");n.parentNode.insertBefore(o,n),o.appendChild(n),o.requestFullscreen=o.requestFullscreen||o.mozRequestFullScreen||o.msRequestFullscreen||(o.webkitRequestFullscreen?function(){o.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT)}:null)||(o.webkitRequestFullScreen?function(){o.webkitRequestFullScreen(Element.ALLOW_KEYBOARD_INPUT)}:null),o.requestFullscreen()},exitFullscreen:function(){return!!tc.isFullscreen&&((document.exitFullscreen||document.cancelFullScreen||document.mozCancelFullScreen||document.msExitFullscreen||document.webkitCancelFullScreen||function(){}).apply(document,[]),!0)},nextRAF:0,fakeRequestAnimationFrame:function(e){var t=Date.now();if(0===tc.nextRAF)tc.nextRAF=t+1e3/60;else for(;t+2>=tc.nextRAF;)tc.nextRAF+=1e3/60;setTimeout(e,Math.max(tc.nextRAF-t,0))},requestAnimationFrame:function(e){"function"==typeof requestAnimationFrame?requestAnimationFrame(e):(0,tc.fakeRequestAnimationFrame)(e)},safeCallback:function(e){return function(){if(!W)return e.apply(null,arguments)}},allowAsyncCallbacks:!0,queuedAsyncCallbacks:[],pauseAsyncCallbacks:function(){tc.allowAsyncCallbacks=!1},resumeAsyncCallbacks:function(){if(tc.allowAsyncCallbacks=!0,tc.queuedAsyncCallbacks.length>0){var e=tc.queuedAsyncCallbacks;tc.queuedAsyncCallbacks=[],e.forEach(function(e){e()})}},safeRequestAnimationFrame:function(e){return tc.requestAnimationFrame(function(){W||(tc.allowAsyncCallbacks?e():tc.queuedAsyncCallbacks.push(e))})},safeSetTimeout:function(e,t){return p=!0,setTimeout(function(){W||(tc.allowAsyncCallbacks?e():tc.queuedAsyncCallbacks.push(e))},t)},safeSetInterval:function(e,t){return p=!0,setInterval(function(){!W&&tc.allowAsyncCallbacks&&e()},t)},getMimetype:function(e){return({jpg:"image/jpeg",jpeg:"image/jpeg",png:"image/png",bmp:"image/bmp",ogg:"audio/ogg",wav:"audio/wav",mp3:"audio/mpeg"})[e.substr(e.lastIndexOf(".")+1)]},getUserMedia:function(e){window.getUserMedia||(window.getUserMedia=navigator.getUserMedia||navigator.mozGetUserMedia),window.getUserMedia(e)},getMovementX:function(e){return e.movementX||e.mozMovementX||e.webkitMovementX||0},getMovementY:function(e){return e.movementY||e.mozMovementY||e.webkitMovementY||0},getMouseWheelDelta:function(e){var t=0;switch(e.type){case"DOMMouseScroll":t=e.detail/3;break;case"mousewheel":t=e.wheelDelta/120;break;case"wheel":switch(t=e.deltaY,e.deltaMode){case 0:t/=100;break;case 1:t/=3;break;case 2:t*=80;break;default:throw"unrecognized mouse wheel delta mode: "+e.deltaMode}break;default:throw"unrecognized mouse wheel event: "+e.type}return t},mouseX:0,mouseY:0,mouseMovementX:0,mouseMovementY:0,touches:{},lastTouches:{},calculateMouseEvent:function(t){if(tc.pointerLock)"mousemove"!=t.type&&"mozMovementX"in t?tc.mouseMovementX=tc.mouseMovementY=0:(tc.mouseMovementX=tc.getMovementX(t),tc.mouseMovementY=tc.getMovementY(t)),"u">typeof SDL?(tc.mouseX=SDL.mouseX+tc.mouseMovementX,tc.mouseY=SDL.mouseY+tc.mouseMovementY):(tc.mouseX+=tc.mouseMovementX,tc.mouseY+=tc.mouseMovementY);else{var r=e.canvas.getBoundingClientRect(),n=e.canvas.width,a=e.canvas.height,o=void 0!==window.scrollX?window.scrollX:window.pageXOffset,i=void 0!==window.scrollY?window.scrollY:window.pageYOffset;if("touchstart"===t.type||"touchend"===t.type||"touchmove"===t.type){var s=t.touch;if(void 0===s)return;var l=s.pageX-(o+r.left),u=s.pageY-(i+r.top),c={x:l*=n/r.width,y:u*=a/r.height};if("touchstart"===t.type)tc.lastTouches[s.identifier]=c,tc.touches[s.identifier]=c;else if("touchend"===t.type||"touchmove"===t.type){var d=tc.touches[s.identifier];d||(d=c),tc.lastTouches[s.identifier]=d,tc.touches[s.identifier]=c}return}var f=t.pageX-(o+r.left),p=t.pageY-(i+r.top);f*=n/r.width,p*=a/r.height,tc.mouseMovementX=f-tc.mouseX,tc.mouseMovementY=p-tc.mouseY,tc.mouseX=f,tc.mouseY=p}},asyncLoad:function(e,t,r,n){var a=n?"":"al "+e;i(e,function(r){H(r,'Loading data file "'+e+'" failed (no arrayBuffer).'),t(new Uint8Array(r)),a&&eb()},function(t){if(r)r();else throw'Loading data file "'+e+'" failed.'}),a&&ey()},resizeListeners:[],updateResizeListeners:function(){var t=e.canvas;tc.resizeListeners.forEach(function(e){e(t.width,t.height)})},setCanvasSize:function(t,r,n){var a=e.canvas;tc.updateCanvasDimensions(a,t,r),n||tc.updateResizeListeners()},windowedWidth:0,windowedHeight:0,setFullscreenCanvasSize:function(){if("u">typeof SDL){var t=k[SDL.screen>>2];t|=8388608,w[SDL.screen>>2]=t}tc.updateCanvasDimensions(e.canvas),tc.updateResizeListeners()},setWindowedCanvasSize:function(){if("u">typeof SDL){var t=k[SDL.screen>>2];t&=-8388609,w[SDL.screen>>2]=t}tc.updateCanvasDimensions(e.canvas),tc.updateResizeListeners()},updateCanvasDimensions:function(t,r,n){r&&n?(t.widthNative=r,t.heightNative=n):(r=t.widthNative,n=t.heightNative);var a=r,o=n;if(e.forcedAspectRatio&&e.forcedAspectRatio>0&&(a/o<e.forcedAspectRatio?a=Math.round(o*e.forcedAspectRatio):o=Math.round(a/e.forcedAspectRatio)),(document.fullscreenElement||document.mozFullScreenElement||document.msFullscreenElement||document.webkitFullscreenElement||document.webkitCurrentFullScreenElement)===t.parentNode&&"u">typeof screen){var i=Math.min(screen.width/a,screen.height/o);a=Math.round(a*i),o=Math.round(o*i)}tc.resizeCanvas?(t.width!=a&&(t.width=a),t.height!=o&&(t.height=o),void 0!==t.style&&(t.style.removeProperty("width"),t.style.removeProperty("height"))):(t.width!=r&&(t.width=r),t.height!=n&&(t.height=n),void 0!==t.style&&(a!=r||o!=n?(t.style.setProperty("width",a+"px","important"),t.style.setProperty("height",o+"px","important")):(t.style.removeProperty("width"),t.style.removeProperty("height"))))},wgetRequests:{},nextWgetRequestHandle:0,getNextWgetRequestHandle:function(){var e=tc.nextWgetRequestHandle;return tc.nextWgetRequestHandle++,e}},td={inEventHandler:0,removeAllEventListeners:function(){for(var e=td.eventHandlers.length-1;e>=0;--e)td._removeHandler(e);td.eventHandlers=[],td.deferredCalls=[]},registerRemoveEventListeners:function(){td.removeEventListenersRegistered||(td.removeEventListenersRegistered=!0)},deferredCalls:[],deferCall:function(e,t,r){for(var n in td.deferredCalls){var a=td.deferredCalls[n];if(a.targetFunction==e&&function(e,t){if(e.length!=t.length)return!1;for(var r in e)if(e[r]!=t[r])return!1;return!0}(a.argsList,r))return}td.deferredCalls.push({targetFunction:e,precedence:t,argsList:r}),td.deferredCalls.sort(function(e,t){return e.precedence<t.precedence})},removeDeferredCalls:function(e){for(var t=0;t<td.deferredCalls.length;++t)td.deferredCalls[t].targetFunction==e&&(td.deferredCalls.splice(t,1),--t)},canPerformEventHandlerRequests:function(){return td.inEventHandler&&td.currentEventHandler.allowsDeferredCalls},runDeferredCalls:function(){if(td.canPerformEventHandlerRequests())for(var e=0;e<td.deferredCalls.length;++e){var t=td.deferredCalls[e];td.deferredCalls.splice(e,1),--e,t.targetFunction.apply(null,t.argsList)}},eventHandlers:[],removeAllHandlersOnTarget:function(e,t){for(var r=0;r<td.eventHandlers.length;++r)td.eventHandlers[r].target!=e||t&&t!=td.eventHandlers[r].eventTypeString||td._removeHandler(r--)},_removeHandler:function(e){var t=td.eventHandlers[e];t.target.removeEventListener(t.eventTypeString,t.eventListenerFunc,t.useCapture),td.eventHandlers.splice(e,1)},registerOrRemoveHandler:function(e){var t=function(t){++td.inEventHandler,td.currentEventHandler=e,td.runDeferredCalls(),e.handlerFunc(t),td.runDeferredCalls(),--td.inEventHandler};if(e.callbackfunc)e.eventListenerFunc=t,e.target.addEventListener(e.eventTypeString,t,e.useCapture),td.eventHandlers.push(e),td.registerRemoveEventListeners();else for(var r=0;r<td.eventHandlers.length;++r)td.eventHandlers[r].target==e.target&&td.eventHandlers[r].eventTypeString==e.eventTypeString&&td._removeHandler(r--)},getNodeNameForTarget:function(e){return e?e==window?"#window":e==screen?"#screen":e&&e.nodeName?e.nodeName:"":""},fullscreenEnabled:function(){return document.fullscreenEnabled||document.webkitFullscreenEnabled}},tf=[0,"u">typeof document?document:0,window];function tp(e){var t;return tf[e=(t=e)>2?K(t):t]||("u">typeof document?document.querySelector(e):void 0)}function tm(e){return 0>tf.indexOf(e)?e.getBoundingClientRect():{left:0,top:0}}var th={counter:1,buffers:[],programs:[],framebuffers:[],renderbuffers:[],textures:[],uniforms:[],shaders:[],vaos:[],contexts:[],offscreenCanvases:{},timerQueriesEXT:[],programInfos:{},stringCache:{},unpackAlignment:4,recordError:function(e){th.lastError||(th.lastError=e)},getNewId:function(e){for(var t=th.counter++,r=e.length;r<t;r++)e[r]=null;return t},getSource:function(e,t,r,n){for(var a="",o=0;o<t;++o){var i=n?w[n+4*o>>2]:-1;a+=K(w[r+4*o>>2],i<0?void 0:i)}return a},createContext:function(e,t){var r=e.getContext("webgl",t);return r?th.registerContext(r,t):0},registerContext:function(e,t){var r=th.getNewId(th.contexts),n={handle:r,attributes:t,version:t.majorVersion,GLctx:e};return e.canvas&&(e.canvas.GLctxObject=n),th.contexts[r]=n,(void 0===t.enableExtensionsByDefault||t.enableExtensionsByDefault)&&th.initExtensions(n),r},makeContextCurrent:function(t){return th.currentContext=th.contexts[t],e.ctx=N=th.currentContext&&th.currentContext.GLctx,!(t&&!N)},getContext:function(e){return th.contexts[e]},deleteContext:function(e){th.currentContext===th.contexts[e]&&(th.currentContext=null),"object"==typeof td&&td.removeAllHandlersOnTarget(th.contexts[e].GLctx.canvas),th.contexts[e]&&th.contexts[e].GLctx.canvas&&(th.contexts[e].GLctx.canvas.GLctxObject=void 0),th.contexts[e]=null},initExtensions:function(e){if(e||(e=th.currentContext),!e.initExtensionsDone){e.initExtensionsDone=!0;var t,r,n,a,o,i,s=e.GLctx;(r=(t=s).getExtension("ANGLE_instanced_arrays"))&&(t.vertexAttribDivisor=function(e,t){r.vertexAttribDivisorANGLE(e,t)},t.drawArraysInstanced=function(e,t,n,a){r.drawArraysInstancedANGLE(e,t,n,a)},t.drawElementsInstanced=function(e,t,n,a,o){r.drawElementsInstancedANGLE(e,t,n,a,o)}),(a=(n=s).getExtension("OES_vertex_array_object"))&&(n.createVertexArray=function(){return a.createVertexArrayOES()},n.deleteVertexArray=function(e){a.deleteVertexArrayOES(e)},n.bindVertexArray=function(e){a.bindVertexArrayOES(e)},n.isVertexArray=function(e){return a.isVertexArrayOES(e)}),(i=(o=s).getExtension("WEBGL_draw_buffers"))&&(o.drawBuffers=function(e,t){i.drawBuffersWEBGL(e,t)}),s.disjointTimerQueryExt=s.getExtension("EXT_disjoint_timer_query"),s.multiDrawWebgl=s.getExtension("WEBGL_multi_draw");var l=["OES_texture_float","OES_texture_half_float","OES_standard_derivatives","OES_vertex_array_object","WEBGL_compressed_texture_s3tc","WEBGL_depth_texture","OES_element_index_uint","EXT_texture_filter_anisotropic","EXT_frag_depth","WEBGL_draw_buffers","ANGLE_instanced_arrays","OES_texture_float_linear","OES_texture_half_float_linear","EXT_blend_minmax","EXT_shader_texture_lod","EXT_texture_norm16","WEBGL_compressed_texture_pvrtc","EXT_color_buffer_half_float","WEBGL_color_buffer_float","EXT_sRGB","WEBGL_compressed_texture_etc1","EXT_disjoint_timer_query","WEBGL_compressed_texture_etc","WEBGL_compressed_texture_astc","EXT_color_buffer_float","WEBGL_compressed_texture_s3tc_srgb","EXT_disjoint_timer_query_webgl2","WEBKIT_WEBGL_compressed_texture_pvrtc"];(s.getSupportedExtensions()||[]).forEach(function(e){-1!=l.indexOf(e)&&s.getExtension(e)})}},populateUniformTable:function(e){for(var t=th.programs[e],r=th.programInfos[e]={uniforms:{},maxUniformLength:0,maxAttributeLength:-1,maxUniformBlockNameLength:-1},n=r.uniforms,a=N.getProgramParameter(t,35718),o=0;o<a;++o){var i=N.getActiveUniform(t,o),s=i.name;r.maxUniformLength=Math.max(r.maxUniformLength,s.length+1),"]"==s.slice(-1)&&(s=s.slice(0,s.lastIndexOf("[")));var l=N.getUniformLocation(t,s);if(l){var u=th.getNewId(th.uniforms);n[s]=[i.size,u],th.uniforms[u]=l;for(var c=1;c<i.size;++c){var d=s+"["+c+"]";l=N.getUniformLocation(t,d),u=th.getNewId(th.uniforms),th.uniforms[u]=l}}}}},tg=[];function ty(e,t,r,n){for(var a=0;a<e;a++){var o=N[r](),i=o&&th.getNewId(n);o?(o.name=i,n[i]=o):th.recordError(1282),w[t+4*a>>2]=i}}function tb(e,t,r,n,a,o,i,s){t=th.programs[t];var l=N[e](t,r);if(l){var u=s&&Z(l.name,s,n);a&&(w[a>>2]=u),o&&(w[o>>2]=l.size),i&&(w[i>>2]=l.type)}}function tv(e,t){k[e>>2]=t,k[e+4>>2]=(t-k[e>>2])/0x100000000}function tx(e,t,r){if(!t)return void th.recordError(1281);var n=void 0;switch(e){case 36346:n=1;break;case 36344:0!=r&&1!=r&&th.recordError(1280);return;case 36345:n=0;break;case 34466:var a=N.getParameter(34467);n=a?a.length:0}if(void 0===n){var o=N.getParameter(e);switch(typeof o){case"number":n=o;break;case"boolean":n=+!!o;break;case"string":th.recordError(1280);return;case"object":if(null===o)switch(e){case 34964:case 35725:case 34965:case 36006:case 36007:case 32873:case 34229:case 34068:n=0;break;default:return void th.recordError(1280)}else if(o instanceof Float32Array||o instanceof Uint32Array||o instanceof Int32Array||o instanceof Array){for(var i=0;i<o.length;++i)switch(r){case 0:w[t+4*i>>2]=o[i];break;case 2:_[t+4*i>>2]=o[i];break;case 4:y[t+i|0]=+!!o[i]}return}else try{n=0|o.name}catch(t){th.recordError(1280),U("GL_INVALID_ENUM in glGet"+r+"v: Unknown object returned from WebGL getParameter("+e+")! (error: "+t+")");return}break;default:th.recordError(1280),U("GL_INVALID_ENUM in glGet"+r+"v: Native code calling glGet"+r+"v("+e+") and it returns "+o+" of type "+typeof o+"!");return}}switch(r){case 1:tv(t,n);break;case 0:w[t>>2]=n;break;case 2:_[t>>2]=n;break;case 4:y[0|t]=+!!n}}function tw(e){var t=J(e)+1,r=t2(t);return Z(e,r,t),r}function tk(e,t,r,n){if(!r)return void th.recordError(1281);var a=N.getUniform(th.programs[e],th.uniforms[t]);if("number"==typeof a||"boolean"==typeof a)switch(n){case 0:w[r>>2]=a;break;case 2:_[r>>2]=a}else for(var o=0;o<a.length;o++)switch(n){case 0:w[r+4*o>>2]=a[o];break;case 2:_[r+4*o>>2]=a[o]}}function t_(e,t,r,n){if(!r)return void th.recordError(1281);var a=N.getVertexAttrib(e,t);if(34975==t)w[r>>2]=a&&a.name;else if("number"==typeof a||"boolean"==typeof a)switch(n){case 0:w[r>>2]=a;break;case 2:_[r>>2]=a;break;case 5:w[r>>2]=Math.fround(a)}else for(var o=0;o<a.length;o++)switch(n){case 0:w[r+4*o>>2]=a[o];break;case 2:_[r+4*o>>2]=a[o];break;case 5:w[r+4*o>>2]=Math.fround(a[o])}}function tS(e,t,r,n,a,o){var i,s,l=1==(i=e-5120)?b:4==i?w:6==i?_:5==i||28922==i?k:x,u=31-Math.clz32(l.BYTES_PER_ELEMENT),c=n*((({5:3,6:4,8:2,29502:3,29504:4})[t-6402]||1)*(1<<u)*r+(s=th.unpackAlignment)-1&-s);return l.subarray(a>>u,a+c>>u)}var tE=[],tT=[],tC={indexedDB:function(){if("u">typeof indexedDB)return indexedDB;var e=null;return H(e=window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB,"IDBStore used, but indexedDB not supported"),e},DB_VERSION:22,DB_STORE_NAME:"FILE_DATA",dbs:{},blobs:[0],getDB:function(e,t){var r,n=tC.dbs[e];if(n)return t(null,n);try{r=tC.indexedDB().open(e,tC.DB_VERSION)}catch(e){return t(e)}r.onupgradeneeded=function(e){var t=e.target.result,r=e.target.transaction;t.objectStoreNames.contains(tC.DB_STORE_NAME)?r.objectStore(tC.DB_STORE_NAME):t.createObjectStore(tC.DB_STORE_NAME)},r.onsuccess=function(){n=r.result,tC.dbs[e]=n,t(null,n)},r.onerror=function(e){t(this.error),e.preventDefault()}},getStore:function(e,t,r){tC.getDB(e,function(e,n){if(e)return r(e);var a=n.transaction([tC.DB_STORE_NAME],t);a.onerror=function(e){r(this.error||"unknown error"),e.preventDefault()},r(null,a.objectStore(tC.DB_STORE_NAME))})},getFile:function(e,t,r){tC.getStore(e,"readonly",function(e,n){if(e)return r(e);var a=n.get(t);a.onsuccess=function(e){var n=e.target.result;return n?r(null,n):r("file "+t+" not found")},a.onerror=function(e){r(e)}})},setFile:function(e,t,r,n){tC.getStore(e,"readwrite",function(e,a){if(e)return n(e);var o=a.put(r,t);o.onsuccess=function(e){n()},o.onerror=function(e){n(e)}})},deleteFile:function(e,t,r){tC.getStore(e,"readwrite",function(e,n){if(e)return r(e);var a=n.delete(t);a.onsuccess=function(e){r()},a.onerror=function(e){r(e)}})},existsFile:function(e,t,r){tC.getStore(e,"readonly",function(e,n){if(e)return r(e);var a=n.count(t);a.onsuccess=function(e){r(null,e.target.result>0)},a.onerror=function(e){r(e)}})}};function tN(e,t){if(e<=0)return e;var r=t<=32?Math.abs(1<<t-1):Math.pow(2,t-1);return e>=r&&(t<=32||e>r)&&(e=-2*r+e),e}function tA(e,t){return e>=0?e:t<=32?2*Math.abs(1<<t-1)+e:Math.pow(2,t)+e}function tj(e){if(!e||!e.callee||!e.callee.name)return[null,"",""];e.callee.toString();var t=e.callee.name,r="(",n=!0;for(var a in e){var o=e[a];n||(r+=", "),n=!1,"number"==typeof o||"string"==typeof o?r+=o:r+="("+typeof o+")"}r+=")";var i=e.callee.caller;return e=i?i.arguments:[],n&&(r=""),[e,t,r]}function tD(e,t,r,n,a,o,i){td.keyEvent||(td.keyEvent=t2(164));var s={target:tp(e),allowsDeferredCalls:!0,eventTypeString:o,callbackfunc:n,handlerFunc:function(e){var r=td.keyEvent,o=r>>2;w[o+0]=e.location,w[o+1]=e.ctrlKey,w[o+2]=e.shiftKey,w[o+3]=e.altKey,w[o+4]=e.metaKey,w[o+5]=e.repeat,w[o+6]=e.charCode,w[o+7]=e.keyCode,w[o+8]=e.which,Z(e.key||"",r+36,32),Z(e.code||"",r+68,32),Z(e.char||"",r+100,32),Z(e.locale||"",r+132,32),h.get(n)(a,r,t)&&e.preventDefault()},useCapture:r};td.registerOrRemoveHandler(s)}function tM(e,t,r){var n=e>>2;w[n+0]=t.screenX,w[n+1]=t.screenY,w[n+2]=t.clientX,w[n+3]=t.clientY,w[n+4]=t.ctrlKey,w[n+5]=t.shiftKey,w[n+6]=t.altKey,w[n+7]=t.metaKey,v[2*n+16]=t.button,v[2*n+17]=t.buttons,w[n+9]=t.movementX,w[n+10]=t.movementY;var a=tm(r);w[n+11]=t.clientX-a.left,w[n+12]=t.clientY-a.top}function tF(e,t,r,n,a,o,i){td.mouseEvent||(td.mouseEvent=t2(64));var s={target:e=tp(e),allowsDeferredCalls:"mousemove"!=o&&"mouseenter"!=o&&"mouseleave"!=o,eventTypeString:o,callbackfunc:n,handlerFunc:function(r){var o=r||event;tM(td.mouseEvent,o,e),h.get(n)(a,td.mouseEvent,t)&&o.preventDefault()},useCapture:r};td.registerOrRemoveHandler(s)}function tP(e,t,r,n,a,o,i){td.touchEvent||(td.touchEvent=t2(1684));var s={target:e=tp(e),allowsDeferredCalls:"touchstart"==o||"touchend"==o,eventTypeString:o,callbackfunc:n,handlerFunc:function(r){for(var o={},i=r.touches,s=0;s<i.length;++s){var l=i[s];o[l.identifier]=l}i=r.changedTouches;for(var s=0;s<i.length;++s){var l=i[s];l.isChanged=1,o[l.identifier]=l}i=r.targetTouches;for(var s=0;s<i.length;++s)o[i[s].identifier].onTarget=1;var u=td.touchEvent,c=u>>2;w[c+1]=r.ctrlKey,w[c+2]=r.shiftKey,w[c+3]=r.altKey,w[c+4]=r.metaKey,c+=5;var d=tm(e),f=0;for(var s in o){var p=o[s];if(w[c+0]=p.identifier,w[c+1]=p.screenX,w[c+2]=p.screenY,w[c+3]=p.clientX,w[c+4]=p.clientY,w[c+5]=p.pageX,w[c+6]=p.pageY,w[c+7]=p.isChanged,w[c+8]=p.onTarget,w[c+9]=p.clientX-d.left,w[c+10]=p.clientY-d.top,c+=13,++f>31)break}w[u>>2]=f,h.get(n)(a,u,t)&&r.preventDefault()},useCapture:r};td.registerOrRemoveHandler(s)}var tI=["default","low-power","high-performance"];function tL(e){return th.makeContextCurrent(e)?0:-5}e._emscripten_webgl_get_current_context=function(){return th.currentContext?th.currentContext.handle:0},e._emscripten_webgl_make_context_current=tL;var tR={};function tB(){if(!tB.strings){var e={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:("object"==typeof navigator&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",_:D||"./this.program"};for(var t in tR)e[t]=tR[t];var r=[];for(var t in e)r.push(t+"="+e[t]);tB.strings=r}return tB.strings}function tO(e){return e%4==0&&(e%100!=0||e%400==0)}function tU(e,t){for(var r=0,n=0;n<=t;r+=e[n++]);return r}var tz=[31,29,31,30,31,30,31,31,30,31,30,31],tX=[31,28,31,30,31,30,31,31,30,31,30,31];function t$(e,t){for(var r=new Date(e.getTime());t>0;){var n=tO(r.getFullYear()),a=r.getMonth(),o=(n?tz:tX)[a];if(t>o-r.getDate())t-=o-r.getDate()+1,r.setDate(1),a<11?r.setMonth(a+1):(r.setMonth(0),r.setFullYear(r.getFullYear()+1));else{r.setDate(r.getDate()+t);break}}return r}function tW(e,t,r,n){var a=w[n+40>>2],o={tm_sec:w[n>>2],tm_min:w[n+4>>2],tm_hour:w[n+8>>2],tm_mday:w[n+12>>2],tm_mon:w[n+16>>2],tm_year:w[n+20>>2],tm_wday:w[n+24>>2],tm_yday:w[n+28>>2],tm_isdst:w[n+32>>2],tm_gmtoff:w[n+36>>2],tm_zone:a?K(a):""},i=K(r),s={"%c":"%a %b %d %H:%M:%S %Y","%D":"%m/%d/%y","%F":"%Y-%m-%d","%h":"%b","%r":"%I:%M:%S %p","%R":"%H:%M","%T":"%H:%M:%S","%x":"%m/%d/%y","%X":"%H:%M:%S","%Ec":"%c","%EC":"%C","%Ex":"%m/%d/%y","%EX":"%H:%M:%S","%Ey":"%y","%EY":"%Y","%Od":"%d","%Oe":"%e","%OH":"%H","%OI":"%I","%Om":"%m","%OM":"%M","%OS":"%S","%Ou":"%u","%OU":"%U","%OV":"%V","%Ow":"%w","%OW":"%W","%Oy":"%y"};for(var l in s)i=i.replace(RegExp(l,"g"),s[l]);var u=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],c=["January","February","March","April","May","June","July","August","September","October","November","December"];function d(e,t,r){for(var n="number"==typeof e?e.toString():e||"";n.length<t;)n=r[0]+n;return n}function f(e,t){return d(e,t,"0")}function p(e,t){var r;function n(e){return e<0?-1:+(e>0)}return 0===(r=n(e.getFullYear()-t.getFullYear()))&&0===(r=n(e.getMonth()-t.getMonth()))&&(r=n(e.getDate()-t.getDate())),r}function m(e){switch(e.getDay()){case 0:return new Date(e.getFullYear()-1,11,29);case 1:return e;case 2:return new Date(e.getFullYear(),0,3);case 3:return new Date(e.getFullYear(),0,2);case 4:return new Date(e.getFullYear(),0,1);case 5:return new Date(e.getFullYear()-1,11,31);case 6:return new Date(e.getFullYear()-1,11,30)}}function h(e){var t=t$(new Date(e.tm_year+1900,0,1),e.tm_yday),r=new Date(t.getFullYear(),0,4),n=new Date(t.getFullYear()+1,0,4),a=m(r),o=m(n);return 0>=p(a,t)?0>=p(o,t)?t.getFullYear()+1:t.getFullYear():t.getFullYear()-1}var g={"%a":function(e){return u[e.tm_wday].substring(0,3)},"%A":function(e){return u[e.tm_wday]},"%b":function(e){return c[e.tm_mon].substring(0,3)},"%B":function(e){return c[e.tm_mon]},"%C":function(e){return f((e.tm_year+1900)/100|0,2)},"%d":function(e){return f(e.tm_mday,2)},"%e":function(e){return d(e.tm_mday,2," ")},"%g":function(e){return h(e).toString().substring(2)},"%G":function(e){return h(e)},"%H":function(e){return f(e.tm_hour,2)},"%I":function(e){var t=e.tm_hour;return 0==t?t=12:t>12&&(t-=12),f(t,2)},"%j":function(e){return f(e.tm_mday+tU(tO(e.tm_year+1900)?tz:tX,e.tm_mon-1),3)},"%m":function(e){return f(e.tm_mon+1,2)},"%M":function(e){return f(e.tm_min,2)},"%n":function(){return"\n"},"%p":function(e){return e.tm_hour>=0&&e.tm_hour<12?"AM":"PM"},"%S":function(e){return f(e.tm_sec,2)},"%t":function(){return"	"},"%u":function(e){return e.tm_wday||7},"%U":function(e){var t=new Date(e.tm_year+1900,0,1),r=0===t.getDay()?t:t$(t,7-t.getDay()),n=new Date(e.tm_year+1900,e.tm_mon,e.tm_mday);if(0>p(r,n)){var a=tU(tO(n.getFullYear())?tz:tX,n.getMonth()-1)-31;return f(Math.ceil((31-r.getDate()+a+n.getDate())/7),2)}return 0===p(r,t)?"01":"00"},"%V":function(e){var t=new Date(e.tm_year+1900,0,4),r=new Date(e.tm_year+1901,0,4),n=m(t),a=m(r),o=t$(new Date(e.tm_year+1900,0,1),e.tm_yday);return 0>p(o,n)?"53":0>=p(a,o)?"01":f(Math.ceil((n.getFullYear()<e.tm_year+1900?e.tm_yday+32-n.getDate():e.tm_yday+1-n.getDate())/7),2)},"%w":function(e){return e.tm_wday},"%W":function(e){var t=new Date(e.tm_year,0,1),r=1===t.getDay()?t:t$(t,0===t.getDay()?1:7-t.getDay()+1),n=new Date(e.tm_year+1900,e.tm_mon,e.tm_mday);if(0>p(r,n)){var a=tU(tO(n.getFullYear())?tz:tX,n.getMonth()-1)-31;return f(Math.ceil((31-r.getDate()+a+n.getDate())/7),2)}return 0===p(r,t)?"01":"00"},"%y":function(e){return(e.tm_year+1900).toString().substring(2)},"%Y":function(e){return e.tm_year+1900},"%z":function(e){var t=e.tm_gmtoff;return(t>=0?"+":"-")+String("0000"+(t=(t=Math.abs(t)/60)/60*100+t%60)).slice(-4)},"%Z":function(e){return e.tm_zone},"%%":function(){return"%"}};for(var l in g)i.indexOf(l)>=0&&(i=i.replace(RegExp(l,"g"),g[l](o)));var b=tQ(i,!1);return b.length>t?0:(y.set(b,e),b.length-1)}var tH=function(e,t,r,n){e||(e=this),this.parent=e,this.mount=e.mount,this.mounted=null,this.id=eB.nextInode++,this.name=t,this.mode=r,this.node_ops={},this.stream_ops={},this.rdev=n};Object.defineProperties(tH.prototype,{read:{get:function(){return(365&this.mode)==365},set:function(e){e?this.mode|=365:this.mode&=-366}},write:{get:function(){return(146&this.mode)==146},set:function(e){e?this.mode|=146:this.mode&=-147}},isFolder:{get:function(){return eB.isDir(this.mode)}},isDevice:{get:function(){return eB.isChrdev(this.mode)}}}),eB.FSNode=tH,eB.staticInit(),e.FS_createPath=eB.createPath,e.FS_createDataFile=eB.createDataFile,e.FS_createPreloadedFile=eB.createPreloadedFile,e.FS_createLazyFile=eB.createLazyFile,e.FS_createDevice=eB.createDevice,e.FS_unlink=eB.unlink;for(var tG=Array(256),tV=0;tV<256;++tV)tG[tV]=String.fromCharCode(tV);ez=tG,eY=e.BindingError=eq(Error,"BindingError"),eQ=e.InternalError=eq(Error,"InternalError"),e.count_emval_handles=function(){for(var e=0,t=5;t<e1.length;++t)void 0!==e1[t]&&++e;return e},e.get_first_emval=function(){for(var e=5;e<e1.length;++e)if(void 0!==e1[e])return e1[e];return null},e7=e.UnboundTypeError=eq(Error,"UnboundTypeError"),e.requestFullscreen=function(e,t){tc.requestFullscreen(e,t)},e.requestAnimationFrame=function(e){tc.requestAnimationFrame(e)},e.setCanvasSize=function(e,t,r){tc.setCanvasSize(e,t,r)},e.pauseMainLoop=function(){tc.mainLoop.pause()},e.resumeMainLoop=function(){tc.mainLoop.resume()},e.getUserMedia=function(){tc.getUserMedia()},e.createContext=function(e,t,r,n){return tc.createContext(e,t,r,n)};for(var tq=0;tq<32;++tq)tg.push(Array(tq));for(var tY=new Float32Array(288),tq=0;tq<288;++tq)tE[tq]=tY.subarray(0,tq+1);for(var tK=new Int32Array(288),tq=0;tq<288;++tq)tT[tq]=tK.subarray(0,tq+1);function tQ(e,t,r){var n=Array(r>0?r:J(e)+1),a=Q(e,n,0,n.length);return t&&(n.length=a),n}ef.push({func:function(){tJ()}});var tZ={d:function(e,t,r,n){ev("Assertion failed: "+K(e)+", at: "+[t?K(t):"unknown filename",r,n?K(n):"unknown function"])},l:function(e){return t2(e+16)+16},Ue:function(){var e=eA.pop(),t=e.get_exception_info(),r=e.get_base_ptr();throw t.get_rethrown()?e.free():(eA.push(e),t.set_rethrown(!0)),r},V:function(e,t){},k:function(e,t,r){throw new ej(e).init(t,r),"uncaught_exception"in ra?ra.uncaught_exceptions++:ra.uncaught_exceptions=1,e},Te:function(e,t){var r,n,a,o,i,s,l;return eD(),r=new Date(1e3*w[e>>2]),w[t>>2]=r.getSeconds(),w[t+4>>2]=r.getMinutes(),w[t+8>>2]=r.getHours(),w[t+12>>2]=r.getDate(),w[t+16>>2]=r.getMonth(),w[t+20>>2]=r.getFullYear()-1900,w[t+24>>2]=r.getDay(),n=new Date(r.getFullYear(),0,1),a=(r.getTime()-n.getTime())/864e5|0,w[t+28>>2]=a,w[t+36>>2]=-(60*r.getTimezoneOffset()),s=0|((o=new Date(r.getFullYear(),6,1).getTimezoneOffset())!=(i=n.getTimezoneOffset())&&r.getTimezoneOffset()==Math.min(i,o)),w[t+32>>2]=s,l=w[t6()+4*!!s>>2],w[t+40>>2]=l,t},Fe:function(e,t){try{return e=eO.getStr(e),eO.doAccess(e,t)}catch(e){return void 0!==eB&&e instanceof eB.ErrnoError||ev(e),-e.errno}},wa:function(e,t){try{return e=eO.getStr(e),eB.chmod(e,t),0}catch(e){return void 0!==eB&&e instanceof eB.ErrnoError||ev(e),-e.errno}},we:function(e,t){try{return eB.fchmod(e,t),0}catch(e){return void 0!==eB&&e instanceof eB.ErrnoError||ev(e),-e.errno}},D:function(e,t,r){eO.varargs=r;try{var n=eO.getStreamFromFD(e);switch(t){case 0:var a=eO.get();if(a<0)return -28;return eB.open(n.path,n.flags,0,a).fd;case 1:case 2:case 13:case 14:return 0;case 3:return n.flags;case 4:var a=eO.get();return n.flags|=a,0;case 12:var a=eO.get();return v[a+0>>1]=2,0;case 16:case 8:default:return -28;case 9:return eF(28),-1}}catch(e){return void 0!==eB&&e instanceof eB.ErrnoError||ev(e),-e.errno}},Ke:function(e,t){try{var r=eO.getStreamFromFD(e);return eO.doStat(eB.stat,r.path,t)}catch(e){return void 0!==eB&&e instanceof eB.ErrnoError||ev(e),-e.errno}},Me:function(e,t,r,n){try{var a=eO.get64(r,n);return eB.ftruncate(e,a),0}catch(e){return void 0!==eB&&e instanceof eB.ErrnoError||ev(e),-e.errno}},Pe:function(e,t){try{if(0===t)return -28;var r=eB.cwd(),n=J(r);if(t<n+1)return -68;return Z(r,e,t),e}catch(e){return void 0!==eB&&e instanceof eB.ErrnoError||ev(e),-e.errno}},Ie:function(e,t,r){try{var n=eO.getStreamFromFD(e);n.getdents||(n.getdents=eB.readdir(n.path));for(var a=0,o=eB.llseek(n,0,1),i=Math.floor(o/280);i<n.getdents.length&&a+280<=r;){var s,l,u=n.getdents[i];if("."===u[0])s=1,l=4;else{var c=eB.lookupNode(n.node,u);s=c.id,l=eB.isChrdev(c.mode)?2:eB.isDir(c.mode)?4:eB.isLink(c.mode)?10:8}T=[s>>>0,(E=s,+Math.abs(E)>=1?E>0?Math.min(+Math.floor(E/0x100000000),0xffffffff)>>>0:~~Math.ceil((E-(~~E>>>0))/0x100000000)>>>0:0)],w[t+a>>2]=T[0],w[t+a+4>>2]=T[1],T=[(i+1)*280>>>0,(E=(i+1)*280,+Math.abs(E)>=1?E>0?Math.min(+Math.floor(E/0x100000000),0xffffffff)>>>0:~~Math.ceil((E-(~~E>>>0))/0x100000000)>>>0:0)],w[t+a+8>>2]=T[0],w[t+a+12>>2]=T[1],v[t+a+16>>1]=280,y[t+a+18|0]=l,Z(u,t+a+19,256),a+=280,i+=1}return eB.llseek(n,280*i,0),a}catch(e){return void 0!==eB&&e instanceof eB.ErrnoError||ev(e),-e.errno}},U:function(){return 0},ua:function(){return 42},Je:function(){return 0},Be:function(e,t,r){eO.varargs=r;try{var n=eO.getStreamFromFD(e);switch(t){case 21509:case 21505:case 21510:case 21511:case 21512:case 21506:case 21507:case 21508:case 21523:case 21524:if(!n.tty)return -59;return 0;case 21519:if(!n.tty)return -59;var a=eO.get();return w[a>>2]=0,0;case 21520:if(!n.tty)return -59;return -28;case 21531:var a=eO.get();return eB.ioctl(n,t,a);default:ev("bad ioctl syscall "+t)}}catch(e){return void 0!==eB&&e instanceof eB.ErrnoError||ev(e),-e.errno}},ye:function(e,t){return -34},Le:function(e,t){try{return e=eO.getStr(e),eO.doStat(eB.lstat,e,t)}catch(e){return void 0!==eB&&e instanceof eB.ErrnoError||ev(e),-e.errno}},De:function(e,t){try{return e=eO.getStr(e),eO.doMkdir(e,t)}catch(e){return void 0!==eB&&e instanceof eB.ErrnoError||ev(e),-e.errno}},Oe:function(e,t,r,n,a,o){try{var i=o;i<<=12;var s,l=!1;if((16&n)!=0&&e%16384!=0)return -28;if((32&n)!=0){if(!(s=ro(16384,t)))return -48;t1(s,0,t),l=!0}else{var u=eB.getStream(a);if(!u)return -8;var c=eB.mmap(u,e,t,i,r,n);s=c.ptr,l=c.allocated}return eO.mappings[s]={malloc:s,len:t,allocated:l,fd:a,prot:r,flags:n,offset:i},s}catch(e){return void 0!==eB&&e instanceof eB.ErrnoError||ev(e),-e.errno}},xe:function(e,t){try{if((0|e)==-1||0===t)return -28;var r=eO.mappings[e];if(!r)return 0;if(t===r.len){var n=eB.getStream(r.fd);2&r.prot&&eO.doMsync(e,n,t,r.flags,r.offset),eO.mappings[e]=null,r.allocated&&t4(r.malloc)}return 0}catch(e){return void 0!==eB&&e instanceof eB.ErrnoError||ev(e),-e.errno}},T:function(e,t,r){eO.varargs=r;try{var n=eO.getStr(e),a=eO.get();return eB.open(n,t,a).fd}catch(e){return void 0!==eB&&e instanceof eB.ErrnoError||ev(e),-e.errno}},Qe:function(e,t,r){try{for(var n=0,a=0;a<t;a++){var o=e+8*a,i=w[o>>2],s=v[o+4>>1],l=32,u=eB.getStream(i);u&&(l=eO.DEFAULT_POLLMASK,u.stream_ops.poll&&(l=u.stream_ops.poll(u))),(l&=8|s|16)&&n++,v[o+6>>1]=l}return n}catch(e){return void 0!==eB&&e instanceof eB.ErrnoError||ev(e),-e.errno}},He:function(e,t,r){try{var n=eO.getStreamFromFD(e);return eB.read(n,y,t,r)}catch(e){return void 0!==eB&&e instanceof eB.ErrnoError||ev(e),-e.errno}},ze:function(e,t,r){try{return e=eO.getStr(e),eO.doReadlink(e,t,r)}catch(e){return void 0!==eB&&e instanceof eB.ErrnoError||ev(e),-e.errno}},Ee:function(e,t){try{return e=eO.getStr(e),t=eO.getStr(t),eB.rename(e,t),0}catch(e){return void 0!==eB&&e instanceof eB.ErrnoError||ev(e),-e.errno}},Ce:function(e){try{return e=eO.getStr(e),eB.rmdir(e),0}catch(e){return void 0!==eB&&e instanceof eB.ErrnoError||ev(e),-e.errno}},va:function(e,t){try{return e=eO.getStr(e),eO.doStat(eB.stat,e,t)}catch(e){return void 0!==eB&&e instanceof eB.ErrnoError||ev(e),-e.errno}},Ae:function(e,t){try{return e=eO.getStr(e),t=eO.getStr(t),eB.symlink(e,t),0}catch(e){return void 0!==eB&&e instanceof eB.ErrnoError||ev(e),-e.errno}},Ne:function(e,t,r,n){try{e=eO.getStr(e);var a=eO.get64(r,n);return eB.truncate(e,a),0}catch(e){return void 0!==eB&&e instanceof eB.ErrnoError||ev(e),-e.errno}},Re:function(e){try{if(!e)return -21;var t={__size__:390,sysname:0,nodename:65,release:130,version:195,machine:260,domainname:325},r=function(r,n){var a=t[r];el(n,e+a)};return r("sysname","Emscripten"),r("nodename","emscripten"),r("release","1.0"),r("version","#1"),r("machine","x86-JS"),0}catch(e){return void 0!==eB&&e instanceof eB.ErrnoError||ev(e),-e.errno}},Se:function(e){try{return e=eO.getStr(e),eB.unlink(e),0}catch(e){return void 0!==eB&&e instanceof eB.ErrnoError||ev(e),-e.errno}},Ge:function(e,t,r,n){try{t=eO.getStr(t),t=eO.calculateAt(e,t);var a=w[r>>2],o=w[r+4>>2],i=1e3*a+o/1e6;r+=8,a=w[r>>2],o=w[r+4>>2];var s=1e3*a+o/1e6;return eB.utime(t,i,s),0}catch(e){return void 0!==eB&&e instanceof eB.ErrnoError||ev(e),-e.errno}},re:function(e,t,r,n,a){var o=eU(r);eJ(e,{name:t=eX(t),fromWireType:function(e){return!!e},toWireType:function(e,t){return t?n:a},argPackAdvance:8,readValueFromPointer:function(e){var n;if(1===r)n=y;else if(2===r)n=v;else if(4===r)n=w;else throw TypeError("Unknown boolean type size: "+t);return this.fromWireType(n[e>>o])},destructorFunction:null})},qe:function(e,t){eJ(e,{name:t=eX(t),fromWireType:function(e){var t=e1[e].value;return e2(e),t},toWireType:function(e,t){return e4(t)},argPackAdvance:8,readValueFromPointer:e8,destructorFunction:null})},sa:function(e,t,r){var n=eU(r);eJ(e,{name:t=eX(t),fromWireType:function(e){return e},toWireType:function(e,t){if("number"!=typeof t&&"boolean"!=typeof t)throw TypeError('Cannot convert "'+e3(t)+'" to '+this.name);return t},argPackAdvance:8,readValueFromPointer:function(e,t){switch(t){case 2:return function(e){return this.fromWireType(_[e>>2])};case 3:return function(e){return this.fromWireType(S[e>>3])};default:throw TypeError("Unknown float type: "+e)}}(t,n),destructorFunction:null})},w:function(t,r,n,a,o,i){var s,l,u,c=function(e,t){for(var r=[],n=0;n<e;n++)r.push(w[(t>>2)+n]);return r}(r,n);t=eX(t),s=a,l=o,s=eX(s),"function"!=typeof(u=function(){if(-1!=s.indexOf("j")){var t,r;return H((t=s).indexOf("j")>=0,"getDynCaller should only be called with i64 sigs"),r=[],function(){r.length=arguments.length;for(var n=0;n<arguments.length;n++)r[n]=arguments[n];return -1!=t.indexOf("j")?r&&r.length?e["dynCall_"+t].apply(null,[l].concat(r)):e["dynCall_"+t].call(null,l):h.get(l).apply(null,r)}}return h.get(l)}())&&eK("unknown function pointer with signature "+s+": "+l),o=u,function(t,r,n){if(e.hasOwnProperty(t)){(void 0===n||void 0!==e[t].overloadTable&&void 0!==e[t].overloadTable[n])&&eK("Cannot register public name '"+t+"' twice");var a=e;if(void 0===a[t].overloadTable){var o=a[t];a[t]=function(){return a[t].overloadTable.hasOwnProperty(arguments.length)||eK("Function '"+t+"' called with an invalid number of arguments ("+arguments.length+") - expects one of ("+a[t].overloadTable+")!"),a[t].overloadTable[arguments.length].apply(this,arguments)},a[t].overloadTable=[],a[t].overloadTable[o.argCount]=o}e.hasOwnProperty(n)&&eK("Cannot register multiple overloads of a function with the same number of arguments ("+n+")!"),e[t].overloadTable[n]=r}else e[t]=r,void 0!==n&&(e[t].numArguments=n)}(t,function(){var e="Cannot call "+t+" due to unbound types",r=[],n={};throw c.forEach(function e(t){if(!n[t]&&!eW[t]){if(eH[t])return void eH[t].forEach(e);r.push(t),n[t]=!0}}),new e7(e+": "+r.map(e9).join([", "]))},r-1),function(e,t,r){function n(t){var n=r(t);n.length!==e.length&&eZ("Mismatched type converter count");for(var a=0;a<e.length;++a)eJ(e[a],n[a])}e.forEach(function(e){eH[e]=t});var a=Array(t.length),o=[],i=0;t.forEach(function(e,t){eW.hasOwnProperty(e)?a[t]=eW[e]:(o.push(e),e$.hasOwnProperty(e)||(e$[e]=[]),e$[e].push(function(){a[t]=eW[e],++i===o.length&&n(a)}))}),0===o.length&&n(a)}([],c,function(n){var a,s,l,u=[n[0],null].concat(n.slice(1));return a=t,s=function(e,t,r,n,a){var o=t.length;o<2&&eK("argTypes array size mismatch! Must at least get return value and 'this' types!");for(var i=null!==t[1]&&!1,s=!1,l=1;l<t.length;++l)if(null!==t[l]&&void 0===t[l].destructorFunction){s=!0;break}for(var u="void"!==t[0].name,c="",d="",l=0;l<o-2;++l)c+=(0!==l?", ":"")+"arg"+l,d+=(0!==l?", ":"")+"arg"+l+"Wired";var f="return function "+eG(e)+"("+c+") {\nif (arguments.length !== "+(o-2)+") {\nthrowBindingError('function "+e+" called with ' + arguments.length + ' arguments, expected "+(o-2)+" args!');\n}\n";s&&(f+="var destructors = [];\n");var p=s?"destructors":"null",m=["throwBindingError","invoker","fn","runDestructors","retType","classParam"],h=[eK,n,a,e6,t[0],t[1]];i&&(f+="var thisWired = classParam.toWireType("+p+", this);\n");for(var l=0;l<o-2;++l)f+="var arg"+l+"Wired = argType"+l+".toWireType("+p+", arg"+l+"); // "+t[l+2].name+"\n",m.push("argType"+l),h.push(t[l+2]);if(i&&(d="thisWired"+(d.length>0?", ":"")+d),f+=(u?"var rv = ":"")+"invoker(fn"+(d.length>0?", ":"")+d+");\n",s)f+="runDestructors(destructors);\n";else for(var l=i?1:2;l<t.length;++l){var g=1===l?"thisWired":"arg"+(l-2)+"Wired";null!==t[l].destructorFunction&&(f+=g+"_dtor("+g+"); // "+t[l].name+"\n",m.push(g+"_dtor"),h.push(t[l].destructorFunction))}return u&&(f+="var ret = retType.fromWireType(rv);\nreturn ret;\n"),f+="}\n",m.push(f),e5(Function,m).apply(null,h)}(t,u,0,o,i),l=r-1,e.hasOwnProperty(a)||eZ("Replacing nonexistant public symbol"),void 0!==e[a].overloadTable&&void 0!==l?e[a].overloadTable[l]=s:(e[a]=s,e[a].argCount=l),[]})},F:function(e,t,r,n,a){t=eX(t),-1===a&&(a=0xffffffff);var o=eU(r),i=function(e){return e};if(0===n){var s=32-8*r;i=function(e){return e<<s>>>s}}var l=-1!=t.indexOf("unsigned");eJ(e,{name:t,fromWireType:i,toWireType:function(e,r){if("number"!=typeof r&&"boolean"!=typeof r)throw TypeError('Cannot convert "'+e3(r)+'" to '+this.name);if(r<n||r>a)throw TypeError('Passing a number "'+e3(r)+'" from JS side to C/C++ side to an argument of type "'+t+'", which is outside the valid range ['+n+", "+a+"]!");return l?r>>>0:0|r},argPackAdvance:8,readValueFromPointer:function(e,t,r){switch(t){case 0:return r?function(e){return y[e]}:function(e){return b[e]};case 1:return r?function(e){return v[e>>1]}:function(e){return x[e>>1]};case 2:return r?function(e){return w[e>>2]}:function(e){return k[e>>2]};default:throw TypeError("Unknown integer type: "+e)}}(t,o,0!==n),destructorFunction:null})},B:function(e,t,r){var n=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array][t];function a(e){e>>=2;var t=k,r=t[e],a=t[e+1];return new n(g,a,r)}eJ(e,{name:r=eX(r),fromWireType:a,argPackAdvance:8,readValueFromPointer:a},{ignoreDuplicateRegistrations:!0})},ra:function(e,t){var r="std::string"===(t=eX(t));eJ(e,{name:t,fromWireType:function(e){var t,n=k[e>>2];if(r)for(var a=e+4,o=0;o<=n;++o){var i=e+4+o;if(o==n||0==b[i]){var s=i-a,l=K(a,s);void 0===t?t=l:(t+="\0",t+=l),a=i+1}}else{for(var u=Array(n),o=0;o<n;++o)u[o]=String.fromCharCode(b[e+4+o]);t=u.join("")}return t4(e),t},toWireType:function(e,t){t instanceof ArrayBuffer&&(t=new Uint8Array(t));var n="string"==typeof t;n||t instanceof Uint8Array||t instanceof Uint8ClampedArray||t instanceof Int8Array||eK("Cannot pass non-string to std::string");var a=(r&&n?function(){return J(t)}:function(){return t.length})(),o=t2(4+a+1);if(k[o>>2]=a,r&&n)Z(t,o+4,a+1);else if(n)for(var i=0;i<a;++i){var s=t.charCodeAt(i);s>255&&(t4(o),eK("String has UTF-16 code units that do not fit in 8 bits")),b[o+4+i]=s}else for(var i=0;i<a;++i)b[o+4+i]=t[i];return null!==e&&e.push(t4,o),o},argPackAdvance:8,readValueFromPointer:e8,destructorFunction:function(e){t4(e)}})},R:function(e,t,r){var n,a,o,i,s;r=eX(r),2===t?(n=et,a=er,i=en,o=function(){return x},s=1):4===t&&(n=ea,a=eo,i=ei,o=function(){return k},s=2),eJ(e,{name:r,fromWireType:function(e){for(var r,a=k[e>>2],i=o(),l=e+4,u=0;u<=a;++u){var c=e+4+u*t;if(u==a||0==i[c>>s]){var d=c-l,f=n(l,d);void 0===r?r=f:(r+="\0",r+=f),l=c+t}}return t4(e),r},toWireType:function(e,n){"string"!=typeof n&&eK("Cannot pass non-string to C++ string type "+r);var o=i(n),l=t2(4+o+t);return k[l>>2]=o>>s,a(n,l+4,o+t),null!==e&&e.push(t4,l),l},argPackAdvance:8,readValueFromPointer:e8,destructorFunction:function(e){t4(e)}})},pe:function(e,t){eJ(e,{isVoid:!0,name:t=eX(t),argPackAdvance:0,fromWireType:function(){},toWireType:function(e,t){}})},v:function(e,t,r){e=te(e),t=tt(t,"emval::as");var n=[],a=e4(n);return w[r>>2]=a,t.toWireType(n,e)},qa:function(e,t,r,n){e=te(e);for(var a=tr(t,r),o=Array(t),i=0;i<t;++i){var s=a[i];o[i]=s.readValueFromPointer(n),n+=s.argPackAdvance}return e4(e.apply(void 0,o))},z:function(e,t,r,n,a){var o;return e=to[e],e(t=te(t),r=ta(r),(o=[],w[n>>2]=e4(o),o),a)},G:function(e,t,r,n){e=to[e],e(t=te(t),r=ta(r),null,n)},e:e2,O:function(e,t){return(e=te(e))==(t=te(t))},q:function(e){return 0===e?e4(ti()):(e=ta(e),e4(ti()[e]))},t:function(e,t){for(var r,n,a=tr(e,t),o=a[0],i=o.name+"_$"+a.slice(1).map(function(e){return e.name}).join("_")+"$",s=["retType"],l=[o],u="",c=0;c<e-1;++c)u+=(0!==c?", ":"")+"arg"+c,s.push("argType"+c),l.push(a[1+c]);for(var d="return function "+eG("methodCaller_"+i)+"(handle, name, destructors, args) {\n",f=0,c=0;c<e-1;++c)d+="    var arg"+c+" = argType"+c+".readValueFromPointer(args"+(f?"+"+f:"")+");\n",f+=a[c+1].argPackAdvance;d+="    var rv = handle[name]("+u+");\n";for(var c=0;c<e-1;++c)a[c+1].deleteObject&&(d+="    argType"+c+".deleteObject(arg"+c+");\n");return o.isVoid||(d+="    return retType.toWireType(destructors, rv);\n"),d+="};\n",s.push(d),r=e5(Function,s).apply(null,l),n=to.length,to.push(r),n},A:function(t){return e4(e[t=ta(t)])},m:function(e,t){return e4((e=te(e))[t=te(t)])},p:function(e){e>4&&(e1[e].refcount+=1)},oe:function(e){return"string"==typeof(e=te(e))},ne:function(t,r,n,a){t=te(t);var o=ts[r];return o||(o=function(t){for(var r="",n=0;n<t;++n)r+=(0!==n?", ":"")+"arg"+n;for(var a="return function emval_allocator_"+t+"(constructor, argTypes, args) {\n",n=0;n<t;++n)a+="var argType"+n+" = requireRegisteredType(Module['HEAP32'][(argTypes >>> 2) + "+n+'], "parameter '+n+'");\nvar arg'+n+" = argType"+n+".readValueFromPointer(args);\nargs += argType"+n+"['argPackAdvance'];\n";return Function("requireRegisteredType","Module","__emval_register",a+="var obj = new constructor("+r+");\nreturn __emval_register(obj);\n}\n")(tt,e,e4)}(r),ts[r]=o),o(t,n,a)},h:function(e){return e4(ta(e))},pa:function(){return e4({})},o:function(e){e6(e1[e].value),e2(e)},C:function(e,t,r){e=te(e),t=te(t),r=te(r),e[t]=r},E:function(e,t){return e4((e=tt(e,"_emval_take_value")).readValueFromPointer(t))},s:function(){ev()},M:function(e,t){var r;if(0===e)r=Date.now();else{if(1!==e&&4!==e)return eF(28),-1;r=C()}return w[t>>2]=r/1e3|0,w[t+4>>2]=r%1e3*1e6|0,0},me:function(e){ev("To use dlopen, you need to use Emscripten's linking support, see https://github.com/emscripten-core/emscripten/wiki/Linking")},le:function(){ev("To use dlopen, you need to use Emscripten's linking support, see https://github.com/emscripten-core/emscripten/wiki/Linking")},ke:function(e,t){ev("To use dlopen, you need to use Emscripten's linking support, see https://github.com/emscripten-core/emscripten/wiki/Linking")},je:function(e,t){ev("To use dlopen, you need to use Emscripten's linking support, see https://github.com/emscripten-core/emscripten/wiki/Linking")},ie:function(e){return t5(e)},oa:function(e,t,r){function n(){h.get(e)(t)}p=!0,r>=0?tc.safeSetTimeout(n,r):tc.safeRequestAnimationFrame(n)},na:function(){return Date.now()},L:function(e){p=!1,rm(e)},he:function(e,t,r){if(!(e=tp(e)))return -4;var n=tm(e);return S[t>>3]=n.width,S[r>>3]=n.height,0},ge:function(e){N.activeTexture(e)},fe:function(e,t){N.attachShader(th.programs[e],th.shaders[t])},ee:function(e,t){N.disjointTimerQueryExt.beginQueryEXT(e,th.timerQueriesEXT[t])},de:function(e,t,r){N.bindAttribLocation(th.programs[e],t,K(r))},ce:function(e,t){N.bindBuffer(e,th.buffers[t])},be:function(e,t){N.bindFramebuffer(e,th.framebuffers[t])},ae:function(e,t){N.bindRenderbuffer(e,th.renderbuffers[t])},$d:function(e,t){N.bindTexture(e,th.textures[t])},_d:function(e){N.bindVertexArray(th.vaos[e])},Zd:function(e,t,r,n){N.blendColor(e,t,r,n)},Yd:function(e){N.blendEquation(e)},Xd:function(e,t){N.blendEquationSeparate(e,t)},Wd:function(e,t){N.blendFunc(e,t)},Vd:function(e,t,r,n){N.blendFuncSeparate(e,t,r,n)},Ud:function(e,t,r,n){N.bufferData(e,r?b.subarray(r,r+t):t,n)},Td:function(e,t,r,n){N.bufferSubData(e,t,b.subarray(n,n+r))},Sd:function(e){return N.checkFramebufferStatus(e)},Rd:function(e){N.clear(e)},Qd:function(e,t,r,n){N.clearColor(e,t,r,n)},Pd:function(e){N.clearDepth(e)},Od:function(e){N.clearStencil(e)},Nd:function(e,t,r,n){N.colorMask(!!e,!!t,!!r,!!n)},Md:function(e){N.compileShader(th.shaders[e])},Ld:function(e,t,r,n,a,o,i,s){N.compressedTexImage2D(e,t,r,n,a,o,s?b.subarray(s,s+i):null)},Kd:function(e,t,r,n,a,o,i,s,l){N.compressedTexSubImage2D(e,t,r,n,a,o,i,l?b.subarray(l,l+s):null)},Jd:function(e,t,r,n,a,o,i,s){N.copyTexImage2D(e,t,r,n,a,o,i,s)},Id:function(e,t,r,n,a,o,i,s){N.copyTexSubImage2D(e,t,r,n,a,o,i,s)},Hd:function(){var e=th.getNewId(th.programs),t=N.createProgram();return t.name=e,th.programs[e]=t,e},Gd:function(e){var t=th.getNewId(th.shaders);return th.shaders[t]=N.createShader(e),t},Fd:function(e){N.cullFace(e)},Ed:function(e,t){for(var r=0;r<e;r++){var n=w[t+4*r>>2],a=th.buffers[n];a&&(N.deleteBuffer(a),a.name=0,th.buffers[n]=null)}},Dd:function(e,t){for(var r=0;r<e;++r){var n=w[t+4*r>>2],a=th.framebuffers[n];a&&(N.deleteFramebuffer(a),a.name=0,th.framebuffers[n]=null)}},Cd:function(e){if(e){var t=th.programs[e];if(!t)return void th.recordError(1281);N.deleteProgram(t),t.name=0,th.programs[e]=null,th.programInfos[e]=null}},Bd:function(e,t){for(var r=0;r<e;r++){var n=w[t+4*r>>2],a=th.timerQueriesEXT[n];a&&(N.disjointTimerQueryExt.deleteQueryEXT(a),th.timerQueriesEXT[n]=null)}},Ad:function(e,t){for(var r=0;r<e;r++){var n=w[t+4*r>>2],a=th.renderbuffers[n];a&&(N.deleteRenderbuffer(a),a.name=0,th.renderbuffers[n]=null)}},zd:function(e){if(e){var t=th.shaders[e];if(!t)return void th.recordError(1281);N.deleteShader(t),th.shaders[e]=null}},yd:function(e,t){for(var r=0;r<e;r++){var n=w[t+4*r>>2],a=th.textures[n];a&&(N.deleteTexture(a),a.name=0,th.textures[n]=null)}},xd:function(e,t){for(var r=0;r<e;r++){var n=w[t+4*r>>2];N.deleteVertexArray(th.vaos[n]),th.vaos[n]=null}},wd:function(e){N.depthFunc(e)},vd:function(e){N.depthMask(!!e)},ud:function(e,t){N.depthRange(e,t)},td:function(e,t){N.detachShader(th.programs[e],th.shaders[t])},sd:function(e){N.disable(e)},rd:function(e){N.disableVertexAttribArray(e)},qd:function(e,t,r){N.drawArrays(e,t,r)},pd:function(e,t,r,n){N.drawArraysInstanced(e,t,r,n)},od:function(e,t){for(var r=tg[e],n=0;n<e;n++)r[n]=w[t+4*n>>2];N.drawBuffers(r)},nd:function(e,t,r,n){N.drawElements(e,t,r,n)},md:function(e,t,r,n,a){N.drawElementsInstanced(e,t,r,n,a)},ld:function(e){N.enable(e)},kd:function(e){N.enableVertexAttribArray(e)},jd:function(e){N.disjointTimerQueryExt.endQueryEXT(e)},id:function(){N.finish()},hd:function(){N.flush()},gd:function(e,t,r,n){N.framebufferRenderbuffer(e,t,r,th.renderbuffers[n])},fd:function(e,t,r,n,a){N.framebufferTexture2D(e,t,r,th.textures[n],a)},ed:function(e){N.frontFace(e)},dd:function(e,t){ty(e,t,"createBuffer",th.buffers)},cd:function(e,t){ty(e,t,"createFramebuffer",th.framebuffers)},bd:function(e,t){for(var r=0;r<e;r++){var n=N.disjointTimerQueryExt.createQueryEXT();if(!n){for(th.recordError(1282);r<e;)w[t+4*r++>>2]=0;return}var a=th.getNewId(th.timerQueriesEXT);n.name=a,th.timerQueriesEXT[a]=n,w[t+4*r>>2]=a}},ad:function(e,t){ty(e,t,"createRenderbuffer",th.renderbuffers)},$c:function(e,t){ty(e,t,"createTexture",th.textures)},_c:function(e,t){ty(e,t,"createVertexArray",th.vaos)},Zc:function(e){N.generateMipmap(e)},Yc:function(e,t,r,n,a,o,i){tb("getActiveAttrib",e,t,r,n,a,o,i)},Xc:function(e,t,r,n,a,o,i){tb("getActiveUniform",e,t,r,n,a,o,i)},Wc:function(e,t,r,n){var a=N.getAttachedShaders(th.programs[e]),o=a.length;o>t&&(o=t),w[r>>2]=o;for(var i=0;i<o;++i){var s=th.shaders.indexOf(a[i]);w[n+4*i>>2]=s}},Vc:function(e,t){return N.getAttribLocation(th.programs[e],K(t))},Uc:function(e,t){tx(e,t,4)},Tc:function(e,t,r){r?w[r>>2]=N.getBufferParameter(e,t):th.recordError(1281)},Sc:function(){var e=N.getError()||th.lastError;return th.lastError=0,e},Rc:function(e,t){tx(e,t,2)},Qc:function(e,t,r,n){var a=N.getFramebufferAttachmentParameter(e,t,r);(a instanceof WebGLRenderbuffer||a instanceof WebGLTexture)&&(a=0|a.name),w[n>>2]=a},Pc:function(e,t){tx(e,t,0)},Oc:function(e,t,r,n){var a=N.getProgramInfoLog(th.programs[e]);null===a&&(a="(unknown error)");var o=t>0&&n?Z(a,n,t):0;r&&(w[r>>2]=o)},Nc:function(e,t,r){if(!r||e>=th.counter)return void th.recordError(1281);var n=th.programInfos[e];if(!n)return void th.recordError(1282);if(35716==t){var a=N.getProgramInfoLog(th.programs[e]);null===a&&(a="(unknown error)"),w[r>>2]=a.length+1}else if(35719==t)w[r>>2]=n.maxUniformLength;else if(35722==t){if(-1==n.maxAttributeLength){e=th.programs[e];var o=N.getProgramParameter(e,35721);n.maxAttributeLength=0;for(var i=0;i<o;++i){var s=N.getActiveAttrib(e,i);n.maxAttributeLength=Math.max(n.maxAttributeLength,s.name.length+1)}}w[r>>2]=n.maxAttributeLength}else if(35381==t){if(-1==n.maxUniformBlockNameLength){e=th.programs[e];var l=N.getProgramParameter(e,35382);n.maxUniformBlockNameLength=0;for(var i=0;i<l;++i){var u=N.getActiveUniformBlockName(e,i);n.maxUniformBlockNameLength=Math.max(n.maxUniformBlockNameLength,u.length+1)}}w[r>>2]=n.maxUniformBlockNameLength}else w[r>>2]=N.getProgramParameter(th.programs[e],t)},Mc:function(e,t,r){if(!r)return void th.recordError(1281);var n=th.timerQueriesEXT[e],a=N.disjointTimerQueryExt.getQueryObjectEXT(n,t);tv(r,"boolean"==typeof a?+!!a:a)},Lc:function(e,t,r){if(!r)return void th.recordError(1281);var n=th.timerQueriesEXT[e],a=N.disjointTimerQueryExt.getQueryObjectEXT(n,t);w[r>>2]="boolean"==typeof a?+!!a:a},Kc:function(e,t,r){if(!r)return void th.recordError(1281);var n=th.timerQueriesEXT[e],a=N.disjointTimerQueryExt.getQueryObjectEXT(n,t);tv(r,"boolean"==typeof a?+!!a:a)},Jc:function(e,t,r){if(!r)return void th.recordError(1281);var n=th.timerQueriesEXT[e],a=N.disjointTimerQueryExt.getQueryObjectEXT(n,t);w[r>>2]="boolean"==typeof a?+!!a:a},Ic:function(e,t,r){r?w[r>>2]=N.disjointTimerQueryExt.getQueryEXT(e,t):th.recordError(1281)},Hc:function(e,t,r){r?w[r>>2]=N.getRenderbufferParameter(e,t):th.recordError(1281)},Gc:function(e,t,r,n){var a=N.getShaderInfoLog(th.shaders[e]);null===a&&(a="(unknown error)");var o=t>0&&n?Z(a,n,t):0;r&&(w[r>>2]=o)},Fc:function(e,t,r,n){var a=N.getShaderPrecisionFormat(e,t);w[r>>2]=a.rangeMin,w[r+4>>2]=a.rangeMax,w[n>>2]=a.precision},Ec:function(e,t,r,n){var a=N.getShaderSource(th.shaders[e]);if(a){var o=t>0&&n?Z(a,n,t):0;r&&(w[r>>2]=o)}},Dc:function(e,t,r){if(!r)return void th.recordError(1281);if(35716==t){var n=N.getShaderInfoLog(th.shaders[e]);null===n&&(n="(unknown error)");var a=n?n.length+1:0;w[r>>2]=a}else if(35720==t){var o=N.getShaderSource(th.shaders[e]),i=o?o.length+1:0;w[r>>2]=i}else w[r>>2]=N.getShaderParameter(th.shaders[e],t)},Cc:function(e){if(th.stringCache[e])return th.stringCache[e];switch(e){case 7939:var t,r=N.getSupportedExtensions()||[];t=tw((r=r.concat(r.map(function(e){return"GL_"+e}))).join(" "));break;case 7936:case 7937:case 37445:case 37446:var n=N.getParameter(e);n||th.recordError(1280),t=tw(n);break;case 7938:var a=N.getParameter(7938);t=tw(a="OpenGL ES 2.0 ("+a+")");break;case 35724:var o=N.getParameter(35724),i=o.match(/^WebGL GLSL ES ([0-9]\.[0-9][0-9]?)(?:$| .*)/);null!==i&&(3==i[1].length&&(i[1]=i[1]+"0"),o="OpenGL ES GLSL ES "+i[1]+" ("+o+")"),t=tw(o);break;default:return th.recordError(1280),0}return th.stringCache[e]=t,t},Bc:function(e,t,r){r?_[r>>2]=N.getTexParameter(e,t):th.recordError(1281)},Ac:function(e,t,r){r?w[r>>2]=N.getTexParameter(e,t):th.recordError(1281)},zc:function(e,t){t=K(t);var r=0;if("]"==t[t.length-1]){var n=t.lastIndexOf("[");r="]"!=t[n+1]?parseInt(t.slice(n+1)):0,t=t.slice(0,n)}var a=th.programInfos[e]&&th.programInfos[e].uniforms[t];return a&&r>=0&&r<a[0]?a[1]+r:-1},yc:function(e,t,r){tk(e,t,r,2)},xc:function(e,t,r){tk(e,t,r,0)},wc:function(e,t,r){r?w[r>>2]=N.getVertexAttribOffset(e,t):th.recordError(1281)},vc:function(e,t,r){t_(e,t,r,2)},uc:function(e,t,r){t_(e,t,r,5)},tc:function(e,t){N.hint(e,t)},sc:function(e){var t=th.buffers[e];return t?N.isBuffer(t):0},rc:function(e){return N.isEnabled(e)},qc:function(e){var t=th.framebuffers[e];return t?N.isFramebuffer(t):0},pc:function(e){return(e=th.programs[e])?N.isProgram(e):0},oc:function(e){var t=th.timerQueriesEXT[e];return t?N.disjointTimerQueryExt.isQueryEXT(t):0},nc:function(e){var t=th.renderbuffers[e];return t?N.isRenderbuffer(t):0},mc:function(e){var t=th.shaders[e];return t?N.isShader(t):0},lc:function(e){var t=th.textures[e];return t?N.isTexture(t):0},kc:function(e){var t=th.vaos[e];return t?N.isVertexArray(t):0},jc:function(e){N.lineWidth(e)},ic:function(e){N.linkProgram(th.programs[e]),th.populateUniformTable(e)},hc:function(e,t){3317==e&&(th.unpackAlignment=t),N.pixelStorei(e,t)},gc:function(e,t){N.polygonOffset(e,t)},fc:function(e,t){N.disjointTimerQueryExt.queryCounterEXT(th.timerQueriesEXT[e],t)},ec:function(e,t,r,n,a,o,i){var s=tS(o,a,r,n,i);s?N.readPixels(e,t,r,n,a,o,s):th.recordError(1280)},dc:function(){},cc:function(e,t,r,n){N.renderbufferStorage(e,t,r,n)},bc:function(e,t){N.sampleCoverage(e,!!t)},ac:function(e,t,r,n){N.scissor(e,t,r,n)},$b:function(){th.recordError(1280)},_b:function(e,t,r,n){var a=th.getSource(e,t,r,n);N.shaderSource(th.shaders[e],a)},Zb:function(e,t,r){N.stencilFunc(e,t,r)},Yb:function(e,t,r,n){N.stencilFuncSeparate(e,t,r,n)},Xb:function(e){N.stencilMask(e)},Wb:function(e,t){N.stencilMaskSeparate(e,t)},Vb:function(e,t,r){N.stencilOp(e,t,r)},Ub:function(e,t,r,n){N.stencilOpSeparate(e,t,r,n)},Tb:function(e,t,r,n,a,o,i,s,l){N.texImage2D(e,t,r,n,a,o,i,s,l?tS(s,i,n,a,l):null)},Sb:function(e,t,r){N.texParameterf(e,t,r)},Rb:function(e,t,r){var n=_[r>>2];N.texParameterf(e,t,n)},Qb:function(e,t,r){N.texParameteri(e,t,r)},Pb:function(e,t,r){var n=w[r>>2];N.texParameteri(e,t,n)},Ob:function(e,t,r,n,a,o,i,s,l){var u=null;l&&(u=tS(s,i,a,o,l)),N.texSubImage2D(e,t,r,n,a,o,i,s,u)},Nb:function(e,t){N.uniform1f(th.uniforms[e],t)},Mb:function(e,t,r){if(t<=288)for(var n=tE[t-1],a=0;a<t;++a)n[a]=_[r+4*a>>2];else var n=_.subarray(r>>2,r+4*t>>2);N.uniform1fv(th.uniforms[e],n)},Lb:function(e,t){N.uniform1i(th.uniforms[e],t)},Kb:function(e,t,r){if(t<=288)for(var n=tT[t-1],a=0;a<t;++a)n[a]=w[r+4*a>>2];else var n=w.subarray(r>>2,r+4*t>>2);N.uniform1iv(th.uniforms[e],n)},Jb:function(e,t,r){N.uniform2f(th.uniforms[e],t,r)},Ib:function(e,t,r){if(t<=144)for(var n=tE[2*t-1],a=0;a<2*t;a+=2)n[a]=_[r+4*a>>2],n[a+1]=_[r+(4*a+4)>>2];else var n=_.subarray(r>>2,r+8*t>>2);N.uniform2fv(th.uniforms[e],n)},Hb:function(e,t,r){N.uniform2i(th.uniforms[e],t,r)},Gb:function(e,t,r){if(t<=144)for(var n=tT[2*t-1],a=0;a<2*t;a+=2)n[a]=w[r+4*a>>2],n[a+1]=w[r+(4*a+4)>>2];else var n=w.subarray(r>>2,r+8*t>>2);N.uniform2iv(th.uniforms[e],n)},Fb:function(e,t,r,n){N.uniform3f(th.uniforms[e],t,r,n)},Eb:function(e,t,r){if(t<=96)for(var n=tE[3*t-1],a=0;a<3*t;a+=3)n[a]=_[r+4*a>>2],n[a+1]=_[r+(4*a+4)>>2],n[a+2]=_[r+(4*a+8)>>2];else var n=_.subarray(r>>2,r+12*t>>2);N.uniform3fv(th.uniforms[e],n)},Db:function(e,t,r,n){N.uniform3i(th.uniforms[e],t,r,n)},Cb:function(e,t,r){if(t<=96)for(var n=tT[3*t-1],a=0;a<3*t;a+=3)n[a]=w[r+4*a>>2],n[a+1]=w[r+(4*a+4)>>2],n[a+2]=w[r+(4*a+8)>>2];else var n=w.subarray(r>>2,r+12*t>>2);N.uniform3iv(th.uniforms[e],n)},Bb:function(e,t,r,n,a){N.uniform4f(th.uniforms[e],t,r,n,a)},Ab:function(e,t,r){if(t<=72){var n=tE[4*t-1],a=_;r>>=2;for(var o=0;o<4*t;o+=4){var i=r+o;n[o]=a[i],n[o+1]=a[i+1],n[o+2]=a[i+2],n[o+3]=a[i+3]}}else var n=_.subarray(r>>2,r+16*t>>2);N.uniform4fv(th.uniforms[e],n)},zb:function(e,t,r,n,a){N.uniform4i(th.uniforms[e],t,r,n,a)},yb:function(e,t,r){if(t<=72)for(var n=tT[4*t-1],a=0;a<4*t;a+=4)n[a]=w[r+4*a>>2],n[a+1]=w[r+(4*a+4)>>2],n[a+2]=w[r+(4*a+8)>>2],n[a+3]=w[r+(4*a+12)>>2];else var n=w.subarray(r>>2,r+16*t>>2);N.uniform4iv(th.uniforms[e],n)},xb:function(e,t,r,n){if(t<=72)for(var a=tE[4*t-1],o=0;o<4*t;o+=4)a[o]=_[n+4*o>>2],a[o+1]=_[n+(4*o+4)>>2],a[o+2]=_[n+(4*o+8)>>2],a[o+3]=_[n+(4*o+12)>>2];else var a=_.subarray(n>>2,n+16*t>>2);N.uniformMatrix2fv(th.uniforms[e],!!r,a)},wb:function(e,t,r,n){if(t<=32)for(var a=tE[9*t-1],o=0;o<9*t;o+=9)a[o]=_[n+4*o>>2],a[o+1]=_[n+(4*o+4)>>2],a[o+2]=_[n+(4*o+8)>>2],a[o+3]=_[n+(4*o+12)>>2],a[o+4]=_[n+(4*o+16)>>2],a[o+5]=_[n+(4*o+20)>>2],a[o+6]=_[n+(4*o+24)>>2],a[o+7]=_[n+(4*o+28)>>2],a[o+8]=_[n+(4*o+32)>>2];else var a=_.subarray(n>>2,n+36*t>>2);N.uniformMatrix3fv(th.uniforms[e],!!r,a)},vb:function(e,t,r,n){if(t<=18){var a=tE[16*t-1],o=_;n>>=2;for(var i=0;i<16*t;i+=16){var s=n+i;a[i]=o[s],a[i+1]=o[s+1],a[i+2]=o[s+2],a[i+3]=o[s+3],a[i+4]=o[s+4],a[i+5]=o[s+5],a[i+6]=o[s+6],a[i+7]=o[s+7],a[i+8]=o[s+8],a[i+9]=o[s+9],a[i+10]=o[s+10],a[i+11]=o[s+11],a[i+12]=o[s+12],a[i+13]=o[s+13],a[i+14]=o[s+14],a[i+15]=o[s+15]}}else var a=_.subarray(n>>2,n+64*t>>2);N.uniformMatrix4fv(th.uniforms[e],!!r,a)},ub:function(e){N.useProgram(th.programs[e])},tb:function(e){N.validateProgram(th.programs[e])},sb:function(e,t){N.vertexAttrib1f(e,t)},rb:function(e,t){N.vertexAttrib1f(e,_[t>>2])},qb:function(e,t,r){N.vertexAttrib2f(e,t,r)},pb:function(e,t){N.vertexAttrib2f(e,_[t>>2],_[t+4>>2])},ob:function(e,t,r,n){N.vertexAttrib3f(e,t,r,n)},nb:function(e,t){N.vertexAttrib3f(e,_[t>>2],_[t+4>>2],_[t+8>>2])},mb:function(e,t,r,n,a){N.vertexAttrib4f(e,t,r,n,a)},lb:function(e,t){N.vertexAttrib4f(e,_[t>>2],_[t+4>>2],_[t+8>>2],_[t+12>>2])},kb:function(e,t){N.vertexAttribDivisor(e,t)},jb:function(e,t,r,n,a,o){N.vertexAttribPointer(e,t,r,!!n,a,o)},ib:function(e,t,r,n){N.viewport(e,t,r,n)},hb:function(e,t,r,n,a){tC.deleteFile(K(e),K(t),function(e){if(e){a&&h.get(a)(r);return}n&&h.get(n)(r)})},gb:function(e,t,r,n,a){tC.existsFile(K(e),K(t),function(e,t){if(e){a&&h.get(a)(r);return}n&&h.get(n)(r,t)})},fb:function(e,t,r,n,a){tC.getFile(K(e),K(t),function(e,t){if(e){a&&h.get(a)(r);return}var o=t2(t.length);b.set(t,o),h.get(n)(r,o,t.length),t4(o)})},eb:function(e,t,r,n,a,o,i){tC.setFile(K(e),K(t),new Uint8Array(b.subarray(r,r+n)),function(e){if(e){i&&h.get(i)(a);return}o&&h.get(o)(a)})},db:function(e){return!th.contexts[e]||th.contexts[e].GLctx.isContextLost()},cb:function(e,t,r){var n;n=Y(function(e,t){var r=e,n=t;function a(e){var t,r,a;return r=n,("double"===(a=e)||"i64"===a)&&7&r&&(r+=4),n=r,"double"===e?(t=S[n>>3],n+=8):"i64"==e?(t=[w[n>>2],w[n+4>>2]],n+=8):(e="i32",t=w[n>>2],n+=4),t}for(var o=[];;){var i=r;if(0===(k=y[0|r]))break;if(_=y[r+1|0],37==k){var s=!1,l=!1,u=!1,c=!1,d=!1;e:for(;;){switch(_){case 43:s=!0;break;case 45:l=!0;break;case 35:u=!0;break;case 48:if(c)break e;c=!0;break;case 32:d=!0;break;default:break e}_=y[++r+1|0]}var f=0;if(42==_)f=a("i32"),_=y[++r+1|0];else for(;_>=48&&_<=57;)f=10*f+(_-48),_=y[++r+1|0];var p=!1,m=-1;if(46==_){if(m=0,p=!0,42==(_=y[++r+1|0]))m=a("i32"),r++;else for(;;){var h=y[r+1|0];if(h<48||h>57)break;m=10*m+(h-48),r++}_=y[r+1|0]}switch(m<0&&(m=6,p=!1),String.fromCharCode(_)){case"h":var g=y[r+2|0];104==g?(r++,T=1):T=2;break;case"l":var g=y[r+2|0];108==g?(r++,T=8):T=4;break;case"L":case"q":case"j":T=8;break;case"z":case"t":case"I":T=4;break;default:T=null}switch(T&&r++,String.fromCharCode(_=y[r+1|0])){case"d":case"i":case"u":case"o":case"x":case"X":case"p":var v,x,k,_,E,T,C,N=100==_||105==_;E=a("i"+8*(T=T||4)),8==T&&(E=117==_?((v=E[0])>>>0)+(E[1]>>>0)*0x100000000:((x=E[0])>>>0)+0x100000000*E[1]),T<=4&&(E=(N?tN:tA)(E&Math.pow(256,T)-1,8*T));var A=Math.abs(E),j="";if(100==_||105==_)C=tN(E,8*T).toString(10);else if(117==_)C=tA(E,8*T).toString(10),E=Math.abs(E);else if(111==_)C=(u?"0":"")+A.toString(8);else if(120==_||88==_){if(j=u&&0!=E?"0x":"",E<0){E=-E,C=(A-1).toString(16);for(var D=[],M=0;M<C.length;M++)D.push((15-parseInt(C[M],16)).toString(16));for(C=D.join("");C.length<2*T;)C="f"+C}else C=A.toString(16);88==_&&(j=j.toUpperCase(),C=C.toUpperCase())}else 112==_&&(0===A?C="(nil)":(j="0x",C=A.toString(16)));if(p)for(;C.length<m;)C="0"+C;for(E>=0&&(s?j="+"+j:d&&(j=" "+j)),"-"==C.charAt(0)&&(j="-"+j,C=C.substr(1));j.length+C.length<f;)l?C+=" ":c?C="0"+C:j=" "+j;(C=j+C).split("").forEach(function(e){o.push(e.charCodeAt(0))});break;case"f":case"F":case"e":case"E":case"g":case"G":if(isNaN(E=a("double")))C="nan",c=!1;else if(isFinite(E)){var F,C,P=!1,I=Math.min(m,20);if(103==_||71==_){P=!0,m=m||1;var L=parseInt(E.toExponential(I).split("e")[1],10);m>L&&L>=-4?(_=(103==_?"f":"F").charCodeAt(0),m-=L+1):(_=(103==_?"e":"E").charCodeAt(0),m--),I=Math.min(m,20)}101==_||69==_?(C=E.toExponential(I),/[eE][-+]\d$/.test(C)&&(C=C.slice(0,-1)+"0"+C.slice(-1))):(102==_||70==_)&&(C=E.toFixed(I),0===E&&((F=E)<0||0===F&&1/F==-1/0)&&(C="-"+C));var R=C.split("e");if(P&&!u)for(;R[0].length>1&&-1!=R[0].indexOf(".")&&("0"==R[0].slice(-1)||"."==R[0].slice(-1));)R[0]=R[0].slice(0,-1);else for(u&&-1==C.indexOf(".")&&(R[0]+=".");m>I++;)R[0]+="0";C=R[0]+(R.length>1?"e"+R[1]:""),69==_&&(C=C.toUpperCase()),E>=0&&(s?C="+"+C:d&&(C=" "+C))}else C=(E<0?"-":"")+"inf",c=!1;for(;C.length<f;)l?C+=" ":C=c&&("-"==C[0]||"+"==C[0])?C[0]+"0"+C.slice(1):(c?"0":" ")+C;_<97&&(C=C.toUpperCase()),C.split("").forEach(function(e){o.push(e.charCodeAt(0))});break;case"s":var B=a("i8*"),O=B?t0(B):6;if(p&&(O=Math.min(O,m)),!l)for(;O<f--;)o.push(32);if(B)for(var M=0;M<O;M++)o.push(b[0|B++]);else o=o.concat(tQ("(null)".substr(0,O),!0));if(l)for(;O<f--;)o.push(32);break;case"c":for(l&&o.push(a("i8"));--f>0;)o.push(32);l||o.push(a("i8"));break;case"n":w[a("i32*")>>2]=o.length;break;case"%":o.push(k);break;default:for(var M=i;M<r+2;M++)o.push(y[0|M])}r+=2}else o.push(k),r+=1}return o}(t,r),0),24&e&&(n=n.replace(/\s+$/,""),n+=(n.length>0?"\n":"")+function(e){var t=eN(),r=t.lastIndexOf("_emscripten_log"),n=t.lastIndexOf("_emscripten_get_callstack"),a=t.indexOf("\n",Math.max(r,n))+1;t=t.slice(a),8&e&&"u"<typeof emscripten_source_map&&(z('Source map information is not available, emscripten_log with EM_LOG_C_STACK will be ignored. Build with "--pre-js $EMSCRIPTEN/src/emscripten-source-map.min.js" linker flag to add source map loading to code.'),e^=8,e|=16);var o=null;if(128&e)for(o=tj(arguments);o[1].indexOf("_emscripten_")>=0;)o=tj(o[0]);var i=t.split("\n");t="";var s=RegExp("\\s*(.*?)@(.*?):([0-9]+):([0-9]+)"),l=RegExp("\\s*(.*?)@(.*):(.*)(:(.*))?"),u=RegExp("\\s*at (.*?) \\((.*):(.*):(.*)\\)");for(var c in i){var d=i[c],f="",p="",m=0,h=0,g=u.exec(d);if(g&&5==g.length)f=g[1],p=g[2],m=g[3],h=g[4];else if((g=s.exec(d))||(g=l.exec(d)),g&&g.length>=4)f=g[1],p=g[2],m=g[3],h=0|g[4];else{t+=d+"\n";continue}var y=32&e?eC(f):f;y||(y=f);var b=!1;if(8&e){var v=emscripten_source_map.originalPositionFor({line:m,column:h});(b=v&&v.source)&&(64&e&&(v.source=v.source.substring(v.source.replace(/\\/g,"/").lastIndexOf("/")+1)),t+="    at "+y+" ("+v.source+":"+v.line+":"+v.column+")\n")}(16&e||!b)&&(64&e&&(p=p.substring(p.replace(/\\/g,"/").lastIndexOf("/")+1)),t+=(b?"     = "+f:"    at "+y)+" ("+p+":"+m+":"+h+")\n"),128&e&&o[0]&&(o[1]==f&&o[2].length>0&&(t=t.replace(/\s+$/,"")+(" with values: "+o[1]+o[2])+"\n"),o=tj(o[0]))}return t.replace(/\s+$/,"")}(e)),1&e?4&e?console.error(n):2&e?console.warn(n):512&e?console.info(n):256&e?console.debug(n):console.log(n):6&e?U(n):O(n)},g:function(e,t){throw rn(e,t||1),"longjmp"},bb:function(e,t,r){b.copyWithin(e,t,t+r)},ab:function(){tc.mainLoop.pause()},$a:function(e){e>>>=0;var t=b.length;if(e>0x80000000)return!1;for(var r=1;r<=4;r*=2){var n,a=t*(1+.2/r);if(a=Math.min(a,e+0x6000000),function(e){try{return m.grow(e-g.byteLength+65535>>>16),eu(m.buffer),1}catch(e){}}(Math.min(0x80000000,((n=Math.max(0x1000000,e,a))%65536>0&&(n+=65536-n%65536),n))))return!0}return!1},_a:function(){tc.mainLoop.resume()},ma:function(e,t,r,n,a){var o;return td.focusEvent||(td.focusEvent=t2(256)),o={target:tp(e),eventTypeString:"focus",callbackfunc:n,handlerFunc:function(e){var r=e||event,a=td.getNodeNameForTarget(r.target),o=r.target.id?r.target.id:"",i=td.focusEvent;Z(a,i+0,128),Z(o,i+128,128),h.get(n)(13,i,t)&&r.preventDefault()},useCapture:r},td.registerOrRemoveHandler(o),0},la:function(e,t,r,n,a){return tD(e,t,r,n,2,"keydown"),0},ka:function(e,t,r,n,a){return tD(e,t,r,n,3,"keyup"),0},Za:function(e,t,r,n){tu(function(){h.get(e)(t)},r,n,t)},ja:function(e,t,r,n,a){return tF(e,t,r,n,5,"mousedown"),0},ia:function(e,t,r,n,a){return tF(e,t,r,n,8,"mousemove"),0},ha:function(e,t,r,n,a){return tF(e,t,r,n,6,"mouseup"),0},Ya:function(e,t,r,n,a){var o,i;return o=e,td.uiEvent||(td.uiEvent=t2(36)),i={target:o=tp(o),eventTypeString:"resize",callbackfunc:n,handlerFunc:function(e){var r=e||event;if(r.target==o){var a=td.uiEvent,i=document.body;w[a>>2]=r.detail,w[a+4>>2]=i.clientWidth,w[a+8>>2]=i.clientHeight,w[a+12>>2]=innerWidth,w[a+16>>2]=innerHeight,w[a+20>>2]=outerWidth,w[a+24>>2]=outerHeight,w[a+28>>2]=pageXOffset,w[a+32>>2]=pageYOffset,h.get(n)(10,a,t)&&r.preventDefault()}},useCapture:r},td.registerOrRemoveHandler(i),0},ga:function(e,t,r,n,a){return tP(e,t,r,n,25,"touchcancel"),0},fa:function(e,t,r,n,a){return tP(e,t,r,n,23,"touchend"),0},ea:function(e,t,r,n,a){return tP(e,t,r,n,24,"touchmove"),0},da:function(e,t,r,n,a){return tP(e,t,r,n,22,"touchstart"),0},ca:function(e,t,r,n,a){var o;return void 0===(e=tp(e)).onwheel?-1:(o=e,td.wheelEvent||(td.wheelEvent=t2(96)),td.registerOrRemoveHandler({target:o,allowsDeferredCalls:!0,eventTypeString:"wheel",callbackfunc:n,handlerFunc:function(e){var r=e||event,a=td.wheelEvent;tM(a,r,o),S[a+64>>3]=r.deltaX,S[a+72>>3]=r.deltaY,S[a+80>>3]=r.deltaZ,w[a+88>>2]=r.deltaMode,h.get(n)(9,a,t)&&r.preventDefault()},useCapture:r}),0)},Xa:function(){throw"Please compile your program with async support in order to use asynchronous operations like emscripten_sleep"},Wa:function(e,t){var r={},n=t>>2;r.alpha=!!w[n+0],r.depth=!!w[n+1],r.stencil=!!w[n+2],r.antialias=!!w[n+3],r.premultipliedAlpha=!!w[n+4],r.preserveDrawingBuffer=!!w[n+5],r.powerPreference=tI[w[n+6]],r.failIfMajorPerformanceCaveat=!!w[n+7],r.majorVersion=w[n+8],r.minorVersion=w[n+9],r.enableExtensionsByDefault=w[n+10],r.explicitSwapControl=w[n+11],r.proxyContextToMainThread=w[n+12],r.renderViaOffscreenBackBuffer=w[n+13];var a=tp(e);return!a||r.explicitSwapControl?0:th.createContext(a,r)},Va:function(e){th.currentContext==e&&(th.currentContext=0),th.deleteContext(e)},Ua:function(e){for(var t=e>>2,r=0;r<14;++r)w[t+r]=0;w[t+0]=w[t+1]=w[t+3]=w[t+4]=w[t+8]=w[t+10]=1},Ta:tL,ve:function(e,t){var r=0;return tB().forEach(function(n,a){var o=t+r;w[e+4*a>>2]=o,el(n,o),r+=n.length+1}),0},ue:function(e,t){var r=tB();w[e>>2]=r.length;var n=0;return r.forEach(function(e){n+=e.length+1}),w[t>>2]=n,0},J:function(e){rm(e)},H:function(e){try{var t=eO.getStreamFromFD(e);return eB.close(t),0}catch(e){return void 0!==eB&&e instanceof eB.ErrnoError||ev(e),e.errno}},ta:function(e,t){try{var r=eO.getStreamFromFD(e),n=r.tty?2:eB.isDir(r.mode)?3:eB.isLink(r.mode)?7:4;return y[0|t]=n,0}catch(e){return void 0!==eB&&e instanceof eB.ErrnoError||ev(e),e.errno}},te:function(e,t,r,n){try{var a=eO.getStreamFromFD(e),o=eO.doReadv(a,t,r);return w[n>>2]=o,0}catch(e){return void 0!==eB&&e instanceof eB.ErrnoError||ev(e),e.errno}},Ga:function(e,t,r,n,a){try{var o=eO.getStreamFromFD(e),i=0x100000000*r+(t>>>0);if(i<=-0x20000000000000||i>=0x20000000000000)return -61;return eB.llseek(o,i,n),T=[o.position>>>0,(E=o.position,+Math.abs(E)>=1?E>0?Math.min(+Math.floor(E/0x100000000),0xffffffff)>>>0:~~Math.ceil((E-(~~E>>>0))/0x100000000)>>>0:0)],w[a>>2]=T[0],w[a+4>>2]=T[1],o.getdents&&0===i&&0===n&&(o.getdents=null),0}catch(e){return void 0!==eB&&e instanceof eB.ErrnoError||ev(e),e.errno}},se:function(e){try{var t=eO.getStreamFromFD(e);if(t.stream_ops&&t.stream_ops.fsync)return-t.stream_ops.fsync(t);return 0}catch(e){return void 0!==eB&&e instanceof eB.ErrnoError||ev(e),e.errno}},S:function(e,t,r,n){try{var a=eO.getStreamFromFD(e),o=eO.doWritev(a,t,r);return w[n>>2]=o,0}catch(e){return void 0!==eB&&e instanceof eB.ErrnoError||ev(e),e.errno}},ba:function(e,t){return 0},c:function(){return 0|X},K:function(e){var t=Date.now();return w[e>>2]=t/1e3|0,w[e+4>>2]=t%1e3*1e3|0,0},Sa:function(e){N.activeTexture(e)},Ra:function(e,t,r,n,a,o,i,s){N.compressedTexImage2D(e,t,r,n,a,o,s?b.subarray(s,s+i):null)},Qa:function(e,t,r,n,a,o,i,s,l){N.compressedTexSubImage2D(e,t,r,n,a,o,i,l?b.subarray(l,l+s):null)},Pa:function(e){N.generateMipmap(e)},Q:function(e,t,r,n,a,o,i,s,l){var u=null;l&&(u=tS(s,i,a,o,l)),N.texSubImage2D(e,t,r,n,a,o,i,s,u)},Oa:function(e,t,r,n){N.viewport(e,t,r,n)},f:function(e,t){var r=re();try{return h.get(e)(t)}catch(e){if(rt(r),e!==e+0&&"longjmp"!==e)throw e;rn(1,0)}},n:function(e,t,r){var n=re();try{return h.get(e)(t,r)}catch(e){if(rt(n),e!==e+0&&"longjmp"!==e)throw e;rn(1,0)}},r:function(e,t,r,n){var a=re();try{return h.get(e)(t,r,n)}catch(e){if(rt(a),e!==e+0&&"longjmp"!==e)throw e;rn(1,0)}},Na:function(e,t,r,n,a){var o=re();try{return h.get(e)(t,r,n,a)}catch(e){if(rt(o),e!==e+0&&"longjmp"!==e)throw e;rn(1,0)}},y:function(e,t,r,n,a){var o=re();try{return h.get(e)(t,r,n,a)}catch(e){if(rt(o),e!==e+0&&"longjmp"!==e)throw e;rn(1,0)}},Ma:function(e,t,r,n,a,o,i,s){var l=re();try{return h.get(e)(t,r,n,a,o,i,s)}catch(e){if(rt(l),e!==e+0&&"longjmp"!==e)throw e;rn(1,0)}},N:function(e,t,r,n,a,o,i,s,l,u){var c=re();try{return h.get(e)(t,r,n,a,o,i,s,l,u)}catch(e){if(rt(c),e!==e+0&&"longjmp"!==e)throw e;rn(1,0)}},Fa:function(e,t,r,n){var a=re();try{return ri(e,t,r,n)}catch(e){if(rt(a),e!==e+0&&"longjmp"!==e)throw e;rn(1,0)}},Ea:function(e,t){var r=re();try{return rs(e,t)}catch(e){if(rt(r),e!==e+0&&"longjmp"!==e)throw e;rn(1,0)}},aa:function(e){var t=re();try{h.get(e)()}catch(e){if(rt(t),e!==e+0&&"longjmp"!==e)throw e;rn(1,0)}},u:function(e,t){var r=re();try{h.get(e)(t)}catch(e){if(rt(r),e!==e+0&&"longjmp"!==e)throw e;rn(1,0)}},La:function(e,t,r,n){var a=re();try{h.get(e)(t,r,n)}catch(e){if(rt(a),e!==e+0&&"longjmp"!==e)throw e;rn(1,0)}},i:function(e,t,r){var n=re();try{h.get(e)(t,r)}catch(e){if(rt(n),e!==e+0&&"longjmp"!==e)throw e;rn(1,0)}},Ka:function(e,t,r,n){var a=re();try{h.get(e)(t,r,n)}catch(e){if(rt(a),e!==e+0&&"longjmp"!==e)throw e;rn(1,0)}},j:function(e,t,r,n){var a=re();try{h.get(e)(t,r,n)}catch(e){if(rt(a),e!==e+0&&"longjmp"!==e)throw e;rn(1,0)}},$:function(e,t,r,n,a){var o=re();try{h.get(e)(t,r,n,a)}catch(e){if(rt(o),e!==e+0&&"longjmp"!==e)throw e;rn(1,0)}},x:function(e,t,r,n,a){var o=re();try{h.get(e)(t,r,n,a)}catch(e){if(rt(o),e!==e+0&&"longjmp"!==e)throw e;rn(1,0)}},I:function(e,t,r,n,a,o){var i=re();try{h.get(e)(t,r,n,a,o)}catch(e){if(rt(i),e!==e+0&&"longjmp"!==e)throw e;rn(1,0)}},Ja:function(e,t,r,n,a,o,i){var s=re();try{h.get(e)(t,r,n,a,o,i)}catch(e){if(rt(s),e!==e+0&&"longjmp"!==e)throw e;rn(1,0)}},_:function(e,t,r,n,a,o,i,s){var l=re();try{h.get(e)(t,r,n,a,o,i,s)}catch(e){if(rt(l),e!==e+0&&"longjmp"!==e)throw e;rn(1,0)}},Ia:function(e,t,r,n,a,o,i,s,l,u){var c=re();try{h.get(e)(t,r,n,a,o,i,s,l,u)}catch(e){if(rt(c),e!==e+0&&"longjmp"!==e)throw e;rn(1,0)}},Ha:function(e,t){return eF(63),-1},a:m,Da:function(e){eD();var t=new Date(w[e+20>>2]+1900,w[e+16>>2],w[e+12>>2],w[e+8>>2],w[e+4>>2],w[e>>2],0),r=w[e+32>>2],n=t.getTimezoneOffset(),a=new Date(t.getFullYear(),0,1),o=new Date(t.getFullYear(),6,1).getTimezoneOffset(),i=a.getTimezoneOffset(),s=Math.min(i,o);if(r<0)w[e+32>>2]=Number(o!=i&&s==n);else if(r>0!=(s==n)){var l=Math.max(i,o);t.setTime(t.getTime()+((r>0?s:l)-n)*6e4)}w[e+24>>2]=t.getDay();var u=(t.getTime()-a.getTime())/864e5|0;return w[e+28>>2]=u,t.getTime()/1e3|0},Z:function(e,t){if(0===e)return eF(28),-1;var r=w[e>>2],n=w[e+4>>2];if(n<0||n>0x3b9ac9ff||r<0)return eF(28),-1;0!==t&&(w[t>>2]=0,w[t+4>>2]=0);for(var a=1e6*r+n/1e3,o=C();C()-o<a/1e3;);},Ca:function(){return 6},Ba:function(){},Y:function(){},Aa:function(){},za:function(){},b:function(e){$(0|e)},X:tW,ya:function(e,t,r,n){return tW(e,t,r,n)},xa:function(e){switch(e){case 30:case 75:return 16384;case 85:return 131072;case 132:case 133:case 12:case 137:case 138:case 15:case 235:case 16:case 17:case 18:case 19:case 20:case 149:case 13:case 10:case 236:case 153:case 9:case 21:case 22:case 159:case 154:case 14:case 77:case 78:case 139:case 80:case 81:case 82:case 68:case 67:case 164:case 11:case 29:case 47:case 48:case 95:case 52:case 51:case 46:case 79:return 200809;case 27:case 246:case 127:case 128:case 23:case 24:case 160:case 161:case 181:case 182:case 242:case 183:case 184:case 243:case 244:case 245:case 165:case 178:case 179:case 49:case 50:case 168:case 169:case 175:case 170:case 171:case 172:case 97:case 76:case 32:case 173:case 35:return -1;case 176:case 177:case 7:case 155:case 8:case 157:case 125:case 126:case 92:case 93:case 129:case 130:case 131:case 94:case 91:return 1;case 74:case 60:case 69:case 70:case 4:return 1024;case 31:case 42:case 72:return 32;case 87:case 26:case 33:return 0x7fffffff;case 34:case 1:return 47839;case 38:case 36:return 99;case 43:case 37:return 2048;case 0:return 2097152;case 3:return 65536;case 28:return 32768;case 44:return 32767;case 39:return 1e3;case 89:return 700;case 71:return 256;case 40:return 255;case 2:return 100;case 180:return 64;case 25:return 20;case 5:return 16;case 6:return 6;case 73:return 4;case 84:if("object"==typeof navigator)return navigator.hardwareConcurrency||1;return 1}return eF(28),-1},W:function(e){var t=Date.now()/1e3|0;return e&&(w[e>>2]=t),t},P:eD};!function(){var t={a:tZ};function r(t,r){var n=t.exports;e.asm=n,h=e.asm.Ve,eb()}function n(e){r(e.instance)}function a(e){return(!f&&(F||P)&&"function"==typeof fetch&&!e_(eS)?fetch(eS,{credentials:"same-origin"}).then(function(e){if(!e.ok)throw"failed to load wasm binary file at '"+eS+"'";return e.arrayBuffer()}).catch(function(){return eE()}):Promise.resolve().then(eE)).then(function(e){return WebAssembly.instantiate(e,t)}).then(e,function(e){U("failed to asynchronously prepare wasm: "+e),ev(e)})}if(ey(),e.instantiateWasm)try{return e.instantiateWasm(t,r)}catch(e){return U("Module.instantiateWasm callback failed with error: "+e),!1}!function(){if(f||"function"!=typeof WebAssembly.instantiateStreaming||ek(eS)||e_(eS)||"function"!=typeof fetch)return a(n);fetch(eS,{credentials:"same-origin"}).then(function(e){return WebAssembly.instantiateStreaming(e,t).then(n,function(e){return U("wasm streaming compile failed: "+e),U("falling back to ArrayBuffer instantiation"),a(n)})})}()}();var tJ=e.___wasm_call_ctors=function(){return(tJ=e.___wasm_call_ctors=e.asm.We).apply(null,arguments)},t0=e._strlen=function(){return(t0=e._strlen=e.asm.Xe).apply(null,arguments)},t1=e._memset=function(){return(t1=e._memset=e.asm.Ye).apply(null,arguments)};e._version=function(){return(e._version=e.asm.Ze).apply(null,arguments)},e._setLogLevel=function(){return(e._setLogLevel=e.asm._e).apply(null,arguments)},e._init=function(){return(e._init=e.asm.$e).apply(null,arguments)},e._addFont=function(){return(e._addFont=e.asm.af).apply(null,arguments)},e._load=function(){return(e._load=e.asm.bf).apply(null,arguments)},e._generateExcerpts=function(){return(e._generateExcerpts=e.asm.cf).apply(null,arguments)},e._title=function(){return(e._title=e.asm.df).apply(null,arguments)},e._subtitle=function(){return(e._subtitle=e.asm.ef).apply(null,arguments)},e._setTitleText=function(){return(e._setTitleText=e.asm.ff).apply(null,arguments)},e._setSubtitleText=function(){return(e._setSubtitleText=e.asm.gf).apply(null,arguments)},e._setComposerText=function(){return(e._setComposerText=e.asm.hf).apply(null,arguments)},e._setLyricistText=function(){return(e._setLyricistText=e.asm.jf).apply(null,arguments)},e._setSelectedText=function(){return(e._setSelectedText=e.asm.kf).apply(null,arguments)},e._appendPart=function(){return(e._appendPart=e.asm.lf).apply(null,arguments)},e._appendPartByMusicXmlId=function(){return(e._appendPartByMusicXmlId=e.asm.mf).apply(null,arguments)},e._removePart=function(){return(e._removePart=e.asm.nf).apply(null,arguments)},e._setPartVisible=function(){return(e._setPartVisible=e.asm.of).apply(null,arguments)},e._listInstrumentTemplates=function(){return(e._listInstrumentTemplates=e.asm.pf).apply(null,arguments)},e._addNoteFromRest=function(){return(e._addNoteFromRest=e.asm.qf).apply(null,arguments)},e._toggleRepeatStart=function(){return(e._toggleRepeatStart=e.asm.rf).apply(null,arguments)},e._toggleRepeatEnd=function(){return(e._toggleRepeatEnd=e.asm.sf).apply(null,arguments)},e._setRepeatCount=function(){return(e._setRepeatCount=e.asm.tf).apply(null,arguments)},e._setBarLineType=function(){return(e._setBarLineType=e.asm.uf).apply(null,arguments)},e._addVolta=function(){return(e._addVolta=e.asm.vf).apply(null,arguments)},e._insertMeasures=function(){return(e._insertMeasures=e.asm.wf).apply(null,arguments)},e._removeTrailingEmptyMeasures=function(){return(e._removeTrailingEmptyMeasures=e.asm.xf).apply(null,arguments)},e._npages=function(){return(e._npages=e.asm.yf).apply(null,arguments)},e._saveXml=function(){return(e._saveXml=e.asm.zf).apply(null,arguments)},e._saveMxl=function(){return(e._saveMxl=e.asm.Af).apply(null,arguments)},e._saveMsc=function(){return(e._saveMsc=e.asm.Bf).apply(null,arguments)},e._saveSvg=function(){return(e._saveSvg=e.asm.Cf).apply(null,arguments)},e._savePng=function(){return(e._savePng=e.asm.Df).apply(null,arguments)},e._savePdf=function(){return(e._savePdf=e.asm.Ef).apply(null,arguments)},e._saveMidi=function(){return(e._saveMidi=e.asm.Ff).apply(null,arguments)},e._saveAudio=function(){return(e._saveAudio=e.asm.Gf).apply(null,arguments)},e._selectElementAtPoint=function(){return(e._selectElementAtPoint=e.asm.Hf).apply(null,arguments)},e._selectTextElementAtPoint=function(){return(e._selectTextElementAtPoint=e.asm.If).apply(null,arguments)},e._clearSelection=function(){return(e._clearSelection=e.asm.Jf).apply(null,arguments)},e._selectionMimeType=function(){return(e._selectionMimeType=e.asm.Kf).apply(null,arguments)},e._selectionMimeData=function(){return(e._selectionMimeData=e.asm.Lf).apply(null,arguments)},e._pasteSelection=function(){return(e._pasteSelection=e.asm.Mf).apply(null,arguments)},e._selectElementAtPointWithMode=function(){return(e._selectElementAtPointWithMode=e.asm.Nf).apply(null,arguments)},e._selectNextChord=function(){return(e._selectNextChord=e.asm.Of).apply(null,arguments)},e._selectPrevChord=function(){return(e._selectPrevChord=e.asm.Pf).apply(null,arguments)},e._extendSelectionNextChord=function(){return(e._extendSelectionNextChord=e.asm.Qf).apply(null,arguments)},e._extendSelectionPrevChord=function(){return(e._extendSelectionPrevChord=e.asm.Rf).apply(null,arguments)},e._getSelectionBoundingBox=function(){return(e._getSelectionBoundingBox=e.asm.Sf).apply(null,arguments)},e._getSelectionBoundingBoxes=function(){return(e._getSelectionBoundingBoxes=e.asm.Tf).apply(null,arguments)},e._deleteSelection=function(){return(e._deleteSelection=e.asm.Uf).apply(null,arguments)},e._pitchUp=function(){return(e._pitchUp=e.asm.Vf).apply(null,arguments)},e._pitchDown=function(){return(e._pitchDown=e.asm.Wf).apply(null,arguments)},e._flipStem=function(){return(e._flipStem=e.asm.Xf).apply(null,arguments)},e._transpose=function(){return(e._transpose=e.asm.Yf).apply(null,arguments)},e._setAccidental=function(){return(e._setAccidental=e.asm.Zf).apply(null,arguments)},e._doubleDuration=function(){return(e._doubleDuration=e.asm._f).apply(null,arguments)},e._halfDuration=function(){return(e._halfDuration=e.asm.$f).apply(null,arguments)},e._undo=function(){return(e._undo=e.asm.ag).apply(null,arguments)},e._redo=function(){return(e._redo=e.asm.bg).apply(null,arguments)},e._relayout=function(){return(e._relayout=e.asm.cg).apply(null,arguments)},e._toggleDot=function(){return(e._toggleDot=e.asm.dg).apply(null,arguments)},e._toggleDoubleDot=function(){return(e._toggleDoubleDot=e.asm.eg).apply(null,arguments)},e._setNoteEntryMode=function(){return(e._setNoteEntryMode=e.asm.fg).apply(null,arguments)},e._setNoteEntryMethod=function(){return(e._setNoteEntryMethod=e.asm.gg).apply(null,arguments)},e._setInputStateFromSelection=function(){return(e._setInputStateFromSelection=e.asm.hg).apply(null,arguments)},e._setInputAccidentalType=function(){return(e._setInputAccidentalType=e.asm.ig).apply(null,arguments)},e._setInputDurationType=function(){return(e._setInputDurationType=e.asm.jg).apply(null,arguments)},e._toggleInputDot=function(){return(e._toggleInputDot=e.asm.kg).apply(null,arguments)},e._addPitchByStep=function(){return(e._addPitchByStep=e.asm.lg).apply(null,arguments)},e._enterRest=function(){return(e._enterRest=e.asm.mg).apply(null,arguments)},e._setDurationType=function(){return(e._setDurationType=e.asm.ng).apply(null,arguments)},e._toggleLineBreak=function(){return(e._toggleLineBreak=e.asm.og).apply(null,arguments)},e._togglePageBreak=function(){return(e._togglePageBreak=e.asm.pg).apply(null,arguments)},e._setVoice=function(){return(e._setVoice=e.asm.qg).apply(null,arguments)},e._changeSelectedElementsVoice=function(){return(e._changeSelectedElementsVoice=e.asm.rg).apply(null,arguments)},e._addDynamic=function(){return(e._addDynamic=e.asm.sg).apply(null,arguments)},e._addHairpin=function(){return(e._addHairpin=e.asm.tg).apply(null,arguments)},e._addPedal=function(){return(e._addPedal=e.asm.ug).apply(null,arguments)},e._addSostenutoPedal=function(){return(e._addSostenutoPedal=e.asm.vg).apply(null,arguments)},e._addUnaCorda=function(){return(e._addUnaCorda=e.asm.wg).apply(null,arguments)},e._splitPedal=function(){return(e._splitPedal=e.asm.xg).apply(null,arguments)},e._addRehearsalMark=function(){return(e._addRehearsalMark=e.asm.yg).apply(null,arguments)},e._addTempoText=function(){return(e._addTempoText=e.asm.zg).apply(null,arguments)},e._addArticulation=function(){return(e._addArticulation=e.asm.Ag).apply(null,arguments)},e._addSlur=function(){return(e._addSlur=e.asm.Bg).apply(null,arguments)},e._addTie=function(){return(e._addTie=e.asm.Cg).apply(null,arguments)},e._addGraceNote=function(){return(e._addGraceNote=e.asm.Dg).apply(null,arguments)},e._addTuplet=function(){return(e._addTuplet=e.asm.Eg).apply(null,arguments)},e._addStaffText=function(){return(e._addStaffText=e.asm.Fg).apply(null,arguments)},e._addSystemText=function(){return(e._addSystemText=e.asm.Gg).apply(null,arguments)},e._addExpressionText=function(){return(e._addExpressionText=e.asm.Hg).apply(null,arguments)},e._addLyricText=function(){return(e._addLyricText=e.asm.Ig).apply(null,arguments)},e._addHarmonyText=function(){return(e._addHarmonyText=e.asm.Jg).apply(null,arguments)},e._addFingeringText=function(){return(e._addFingeringText=e.asm.Kg).apply(null,arguments)},e._addLeftHandGuitarFingeringText=function(){return(e._addLeftHandGuitarFingeringText=e.asm.Lg).apply(null,arguments)},e._addRightHandGuitarFingeringText=function(){return(e._addRightHandGuitarFingeringText=e.asm.Mg).apply(null,arguments)},e._addStringNumberText=function(){return(e._addStringNumberText=e.asm.Ng).apply(null,arguments)},e._addInstrumentChangeText=function(){return(e._addInstrumentChangeText=e.asm.Og).apply(null,arguments)},e._addStickingText=function(){return(e._addStickingText=e.asm.Pg).apply(null,arguments)},e._addFiguredBassText=function(){return(e._addFiguredBassText=e.asm.Qg).apply(null,arguments)},e._setTimeSignature=function(){return(e._setTimeSignature=e.asm.Rg).apply(null,arguments)},e._setTimeSignatureWithType=function(){return(e._setTimeSignatureWithType=e.asm.Sg).apply(null,arguments)},e._setKeySignature=function(){return(e._setKeySignature=e.asm.Tg).apply(null,arguments)},e._getKeySignature=function(){return(e._getKeySignature=e.asm.Ug).apply(null,arguments)},e._setClef=function(){return(e._setClef=e.asm.Vg).apply(null,arguments)},e._synthAudio=function(){return(e._synthAudio=e.asm.Wg).apply(null,arguments)},e._processSynth=function(){return(e._processSynth=e.asm.Xg).apply(null,arguments)},e._processSynthBatch=function(){return(e._processSynthBatch=e.asm.Yg).apply(null,arguments)},e._savePositions=function(){return(e._savePositions=e.asm.Zg).apply(null,arguments)},e._saveMetadata=function(){return(e._saveMetadata=e.asm._g).apply(null,arguments)},e._destroy=function(){return(e._destroy=e.asm.$g).apply(null,arguments)};var t2=e._malloc=function(){return(t2=e._malloc=e.asm.ah).apply(null,arguments)},t4=e._free=function(){return(t4=e._free=e.asm.bh).apply(null,arguments)},t8=e.___errno_location=function(){return(t8=e.___errno_location=e.asm.ch).apply(null,arguments)},t3=e.___getTypeName=function(){return(t3=e.___getTypeName=e.asm.dh).apply(null,arguments)};e.___embind_register_native_and_builtin_types=function(){return(e.___embind_register_native_and_builtin_types=e.asm.eh).apply(null,arguments)};var t5=e._emscripten_GetProcAddress=function(){return(t5=e._emscripten_GetProcAddress=e.asm.fh).apply(null,arguments)},t6=e.__get_tzname=function(){return(t6=e.__get_tzname=e.asm.gh).apply(null,arguments)},t7=e.__get_daylight=function(){return(t7=e.__get_daylight=e.asm.hh).apply(null,arguments)},t9=e.__get_timezone=function(){return(t9=e.__get_timezone=e.asm.ih).apply(null,arguments)},re=e.stackSave=function(){return(re=e.stackSave=e.asm.jh).apply(null,arguments)},rt=e.stackRestore=function(){return(rt=e.stackRestore=e.asm.kh).apply(null,arguments)},rr=e.stackAlloc=function(){return(rr=e.stackAlloc=e.asm.lh).apply(null,arguments)},rn=e._setThrew=function(){return(rn=e._setThrew=e.asm.mh).apply(null,arguments)},ra=e.__ZSt18uncaught_exceptionv=function(){return(ra=e.__ZSt18uncaught_exceptionv=e.asm.nh).apply(null,arguments)};e.___cxa_demangle=function(){return(e.___cxa_demangle=e.asm.oh).apply(null,arguments)};var ro=e._memalign=function(){return(ro=e._memalign=e.asm.ph).apply(null,arguments)},ri=e.dynCall_iij=function(){return(ri=e.dynCall_iij=e.asm.qh).apply(null,arguments)};e.dynCall_viij=function(){return(e.dynCall_viij=e.asm.rh).apply(null,arguments)},e.dynCall_viijii=function(){return(e.dynCall_viijii=e.asm.sh).apply(null,arguments)},e.dynCall_vij=function(){return(e.dynCall_vij=e.asm.th).apply(null,arguments)};var rs=e.dynCall_ji=function(){return(rs=e.dynCall_ji=e.asm.uh).apply(null,arguments)};if(e.dynCall_jiij=function(){return(e.dynCall_jiij=e.asm.vh).apply(null,arguments)},e.dynCall_jij=function(){return(e.dynCall_jij=e.asm.wh).apply(null,arguments)},e.dynCall_viiji=function(){return(e.dynCall_viiji=e.asm.xh).apply(null,arguments)},e.dynCall_jiii=function(){return(e.dynCall_jiii=e.asm.yh).apply(null,arguments)},e.dynCall_viijj=function(){return(e.dynCall_viijj=e.asm.zh).apply(null,arguments)},e.dynCall_viiijj=function(){return(e.dynCall_viiijj=e.asm.Ah).apply(null,arguments)},e.dynCall_iiiij=function(){return(e.dynCall_iiiij=e.asm.Bh).apply(null,arguments)},e.dynCall_iiji=function(){return(e.dynCall_iiji=e.asm.Ch).apply(null,arguments)},e.dynCall_vijjii=function(){return(e.dynCall_vijjii=e.asm.Dh).apply(null,arguments)},e.dynCall_vijjiii=function(){return(e.dynCall_vijjiii=e.asm.Eh).apply(null,arguments)},e.dynCall_jjii=function(){return(e.dynCall_jjii=e.asm.Fh).apply(null,arguments)},e.dynCall_jiji=function(){return(e.dynCall_jiji=e.asm.Gh).apply(null,arguments)},e.dynCall_iiiiij=function(){return(e.dynCall_iiiiij=e.asm.Hh).apply(null,arguments)},e.dynCall_iiiiijj=function(){return(e.dynCall_iiiiijj=e.asm.Ih).apply(null,arguments)},e.dynCall_iiiiiijj=function(){return(e.dynCall_iiiiiijj=e.asm.Jh).apply(null,arguments)},e.ccall=V,e.cwrap=function(e,t,r,n){var a=(r=r||[]).every(function(e){return"number"===e});return"string"!==t&&a&&!n?G(e):function(){return V(e,t,r,arguments)}},e.setValue=function(e,t,r,n){switch("*"===(r=r||"i8").charAt(r.length-1)&&(r="i32"),r){case"i1":case"i8":y[0|e]=t;break;case"i16":v[e>>1]=t;break;case"i32":w[e>>2]=t;break;case"i64":T=[t>>>0,+Math.abs(E=t)>=1?E>0?Math.min(+Math.floor(E/0x100000000),0xffffffff)>>>0:~~Math.ceil((E-(~~E>>>0))/0x100000000)>>>0:0],w[e>>2]=T[0],w[e+4>>2]=T[1];break;case"float":_[e>>2]=t;break;case"double":S[e>>3]=t;break;default:ev("invalid type for setValue: "+r)}},e.getValue=function(e,t,r){switch("*"===(t=t||"i8").charAt(t.length-1)&&(t="i32"),t){case"i1":case"i8":return y[0|e];case"i16":return v[e>>1];case"i32":case"i64":return w[e>>2];case"float":return _[e>>2];case"double":return S[e>>3];default:ev("invalid type for getValue: "+t)}return null},e.UTF8ToString=K,e.stringToUTF8=Z,e.addRunDependency=ey,e.removeRunDependency=eb,e.FS_createPath=eB.createPath,e.FS_createDataFile=eB.createDataFile,e.FS_createPreloadedFile=eB.createPreloadedFile,e.FS_createLazyFile=eB.createLazyFile,e.FS_createDevice=eB.createDevice,e.FS_unlink=eB.unlink,ex)if(ek(ex)||(ex=B(ex)),I||L){var rl=u(ex);b.set(rl,1024)}else{ey();var ru=function(t){t.byteLength&&(t=new Uint8Array(t)),b.set(t,1024),e.memoryInitializerRequest&&delete e.memoryInitializerRequest.response,eb()},rc=function(){i(ex,ru,function(){var e=Error("could not load memory initializer "+ex);n(e)})};if(e.memoryInitializerRequest){var rd=function(){var t=e.memoryInitializerRequest,r=t.response;if(200!==t.status&&0!==t.status){console.warn("a problem seems to have happened with Module.memoryInitializerRequest, status: "+t.status+", retrying "+ex),rc();return}ru(r)};e.memoryInitializerRequest.response?setTimeout(rd,0):e.memoryInitializerRequest.addEventListener("load",rd)}else rc()}function rf(e){this.name="ExitStatus",this.message="Program terminated with exit("+e+")",this.status=e}function rp(t){if(!(eh>0)){if(e.preRun)for("function"==typeof e.preRun&&(e.preRun=[e.preRun]);e.preRun.length;){var n;n=e.preRun.shift(),ed.unshift(n)}eT(ed),eh>0||(e.setStatus?(e.setStatus("Running..."),setTimeout(function(){setTimeout(function(){e.setStatus("")},1),a()},1)):a())}function a(){if(!A&&(A=!0,e.calledRun=!0,!W)){if(e.noFSInit||eB.init.initialized||eB.init(),eT(ef),eB.ignorePermissions=!1,eT(ep),r(e),e.onRuntimeInitialized&&e.onRuntimeInitialized(),e.postRun)for("function"==typeof e.postRun&&(e.postRun=[e.postRun]);e.postRun.length;){var t;t=e.postRun.shift(),em.unshift(t)}eT(em)}}}function rm(t,r){r&&p&&0===t||(p||(e.onExit&&e.onExit(t),W=!0),M(t,new rf(t)))}if(eg=function e(){A||rp(),A||(eg=e)},e.run=rp,e.preInit)for("function"==typeof e.preInit&&(e.preInit=[e.preInit]);e.preInit.length>0;)e.preInit.pop()();return p=!0,rp(),e.ready});let n="object"==typeof s&&"object"==typeof s.versions&&"string"==typeof s.versions.node?{locateFile(e){let{join:t}=require("path");return t(__dirname,e)},getPreloadedPackage:e=>require("fs").readFileSync(e).buffer}:{locateFile(e){if(e.endsWith("webmscore.lib.mem.wasm"))return new URL(MSCORE_LIB_MEM,MSCORE_BASEURL).href;if(e.endsWith(".wasm"))return new URL(MSCORE_LIB_WASM,MSCORE_BASEURL).href;if(e.endsWith(".data"))return new URL(MSCORE_LIB_DATA,MSCORE_BASEURL).href;if(e.endsWith(".wasm.js"))throw Error("WebAssembly is not supported in your browser");return new URL(e,"/score-editor/").href}};n.getArguments=n.getArguments||(()=>["-platform","wasm"]),n.arguments=n.arguments||n.getArguments(),n.ENV=n.ENV||{},n.ENV.QT_QPA_PLATFORM=n.ENV.QT_QPA_PLATFORM||"wasm",n.INITIAL_MEMORY=n.INITIAL_MEMORY||0x10000000,n.__cxa_atexit=n.__cxa_atexit||function(){return 0},n.___cxa_atexit=n.___cxa_atexit||n.__cxa_atexit;let a=n,o=r(n),i=e=>{let t=4*e.length+1,r=a._malloc(t);return a.stringToUTF8(e,r,t),r},u=e=>{let t=e.length*e.BYTES_PER_ELEMENT,r=a._malloc(t);return a.HEAPU8.set(e,r),r};class c{constructor(e){this._ptr=e,this._size=c._getUint32(this._sizePtr),this._checkRet()}get _retCodePtr(){return this._ptr}get _sizePtr(){return this._retCodePtr+4}get _dataPtr(){return this._sizePtr+4}_checkRet(){let e=c._getUint32(this._retCodePtr);if(e!==p.CODE_OK){let t=this.text();throw this.free(),new p(e,t)}}data(){return new Uint8Array(a.HEAPU8.subarray(this._dataPtr,this._dataPtr+this._size))}text(){return a.UTF8ToString(this._dataPtr)}number(){return c._getUint32(this._dataPtr)}free(){return d(this._ptr)}static _getUint32(e){return new DataView(new Uint8Array(a.HEAPU8.subarray(e,e+4)).buffer).getUint32(0,!0)}static _readAndFree(e,t){let r=new c(e),n=r[t]();return r.free(),n}static readData(e){return c._readAndFree(e,"data")}static readText(e){return c._readAndFree(e,"text")}static readNum(e){return c._readAndFree(e,"number")}}let d=e=>{a._free(e)},f=new Promise(e=>{o.then(t=>{(a=t).ccall("init"),e(void 0)})});class p extends Error{constructor(e,t){super(),this.name="WasmError",this.errorCode=e,this.errorName=t,this.message=`WebMscore Err${this.errorName}`}}p.CODE_OK=0;let m=!1,h=!1;class g{static get ready(){return f}static async version(){return await g.ready,a.ccall("version","number")}static async setLogLevel(e){return h=!0,await g.ready,a.ccall("setLogLevel",null,["number"],[e])}static set stdout(e){a.stdout=e}static get stdout(){return a.stdout}static set stderr(e){a.stderr=e}static get stderr(){return a.stderr}static async load(e,t,r=[],n=!0){let[o]=await Promise.all([r,g.ready]);for(let e of o)await g.addFont(e);let s=i(e),l=u(t),f=a.ccall("load","number",["number","number","number","boolean"],[s,l,t.byteLength,n]);d(s),d(l);let p=c.readNum(f);return h||await g.setLogLevel(0),new g(p)}static async addFont(e){if("string"!=typeof e){let t=""+Math.random();a.FS_createDataFile("/fonts/",t,e,!0,!0),e="/fonts/"+t}let t=i(e),r=a.ccall("addFont","number",["number"],[t]);return d(t),!!r}static get hasSoundfont(){return m}static set hasSoundfont(e){m=e}static async setSoundFont(e){g.hasSoundfont&&a.FS_unlink("/MuseScore_General.sf3"),a.FS_createDataFile("/","MuseScore_General.sf3",e,!0,!0),g.hasSoundfont=!0}constructor(e){this.scoreptr=e,this.excerptId=-1}async setExcerptId(e){this.excerptId=e}async getExcerptId(){return this.excerptId}async generateExcerpts(){return a.ccall("generateExcerpts",null,["number"],[this.scoreptr])}async title(){let e=a.ccall("title","number",["number"],[this.scoreptr]);return c.readText(e)}async subtitle(){let e=a.ccall("subtitle","number",["number"],[this.scoreptr]);return c.readText(e)}async titleFilenameSafe(){return(await this.title()).replace(/[\s<>:{}"/\\|?*~.\0\cA-\cZ]+/g,"_")}async setTitleText(e){let t=i(null==e?"":String(e));try{return a.ccall("setTitleText","boolean",["number","number","number"],[this.scoreptr,t,this.excerptId])}finally{d(t)}}async setSubtitleText(e){let t=i(null==e?"":String(e));try{return a.ccall("setSubtitleText","boolean",["number","number","number"],[this.scoreptr,t,this.excerptId])}finally{d(t)}}async setComposerText(e){let t=i(null==e?"":String(e));try{return a.ccall("setComposerText","boolean",["number","number","number"],[this.scoreptr,t,this.excerptId])}finally{d(t)}}async setLyricistText(e){let t=i(null==e?"":String(e));try{return a.ccall("setLyricistText","boolean",["number","number","number"],[this.scoreptr,t,this.excerptId])}finally{d(t)}}async setSelectedText(e){let t=i(null==e?"":String(e));try{return a.ccall("setSelectedText","boolean",["number","number","number"],[this.scoreptr,t,this.excerptId])}finally{d(t)}}async appendPart(e){let t=i(null==e?"":String(e));try{return a.ccall("appendPart","boolean",["number","number","number"],[this.scoreptr,t,this.excerptId])}finally{d(t)}}async appendPartByMusicXmlId(e){let t=i(null==e?"":String(e));try{return a.ccall("appendPartByMusicXmlId","boolean",["number","number","number"],[this.scoreptr,t,this.excerptId])}finally{d(t)}}async removePart(e){return a.ccall("removePart","boolean",["number","number","number"],[this.scoreptr,e,this.excerptId])}async setPartVisible(e,t){return a.ccall("setPartVisible","boolean",["number","number","number","number"],[this.scoreptr,e,+!!t,this.excerptId])}async listInstrumentTemplates(){let e=a.ccall("listInstrumentTemplates","number",["number"],[this.scoreptr]);return JSON.parse(c.readText(e))}async npages(){let e=a.ccall("npages","number",["number","number"],[this.scoreptr,this.excerptId]);return c.readNum(e)}async metadata(){return JSON.parse(await this.saveMetadata())}async measurePositions(){return JSON.parse(await this.savePositions(!1))}async segmentPositions(){return JSON.parse(await this.savePositions(!0))}async saveXml(){let e=a.ccall("saveXml","number",["number","number"],[this.scoreptr,this.excerptId]);return c.readText(e)}async saveMxl(){let e=a.ccall("saveMxl","number",["number","number"],[this.scoreptr,this.excerptId]);return c.readData(e)}async saveMsc(e="mscz"){let t=a.ccall("saveMsc","number",["number","boolean","number"],[this.scoreptr,"mscz"==e,this.excerptId]);return c.readData(t)}async saveSvg(e=0,t=!1,r=!1){let n=a.ccall("saveSvg","number",["number","number","boolean","boolean","number"],[this.scoreptr,e,t,r,this.excerptId]);return c.readText(n)}async savePng(e=0,t=!1,r=!0){let n=a.ccall("savePng","number",["number","number","boolean","boolean","number"],[this.scoreptr,e,t,r,this.excerptId]);return c.readData(n)}async savePdf(){let e=a.ccall("savePdf","number",["number","number"],[this.scoreptr,this.excerptId]);return c.readData(e)}async saveMidi(e=!0,t=!0){let r=a.ccall("saveMidi","number",["number","boolean","boolean","number"],[this.scoreptr,e,t,this.excerptId]);return c.readData(r)}async setSoundFont(e){return g.setSoundFont(e)}async saveAudio(e){if(!g.hasSoundfont)throw Error("The soundfont is not set.");let t=i(e),r=a.ccall("saveAudio","number",["number","number","number"],[this.scoreptr,t,this.excerptId]);return d(t),c.readData(r)}async synthAudio(e){let t=await this._synthAudio(e);return e=>this.processSynth(t,e)}async synthAudioBatch(e,t){let r=await this._synthAudio(e);return e=>this.processSynthBatch(r,t,e)}async _synthAudio(e=0){if(!g.hasSoundfont)throw Error("The soundfont is not set.");let t=a.ccall("synthAudio","number",["number","number","number"],[this.scoreptr,e,this.excerptId]);if(0===t)throw Error("synthAudio: Internal Error.");return t}_parseSynthRes(e){let t=a.getValue(e+0,"i8"),r=+a.getValue(e+4,"float"),n=+a.getValue(e+8,"float"),o=a.getValue(e+12,"i32"),i=e+16,s=new Uint8Array(a.HEAPU8.subarray(i,i+o));return d(e),{done:!!t,startTime:r,endTime:n,chunk:s}}async processSynth(e,t=!1){let r=a.ccall("processSynth","number",["number","boolean"],[e,t]);return this._parseSynthRes(r)}async processSynthBatch(e,t,r=!1){let n=a.ccall("processSynthBatch","number",["number","number","boolean"],[e,t,r]),o=[];for(let e=0;e<t;e++){let t=a.getValue(n+4*e,"*"),r=this._parseSynthRes(t);o.push(r)}return d(n),o}async savePositions(e){let t=a.ccall("savePositions","number",["number","boolean","number"],[this.scoreptr,e,this.excerptId]);return c.readText(t)}async saveMetadata(){let e=a.ccall("saveMetadata","number",["number"],[this.scoreptr]);return c.readText(e)}async selectElementAtPoint(e,t,r){return a.ccall("selectElementAtPoint","boolean",["number","number","number","number","number"],[this.scoreptr,e,t,r,this.excerptId])}async selectTextElementAtPoint(e,t,r){return a.ccall("selectTextElementAtPoint","boolean",["number","number","number","number","number"],[this.scoreptr,e,t,r,this.excerptId])}async clearSelection(){return a.ccall("clearSelection","boolean",["number","number"],[this.scoreptr,this.excerptId])}async selectNextChord(){return a.ccall("selectNextChord","boolean",["number","number"],[this.scoreptr,this.excerptId])}async selectPrevChord(){return a.ccall("selectPrevChord","boolean",["number","number"],[this.scoreptr,this.excerptId])}async extendSelectionNextChord(){return a.ccall("extendSelectionNextChord","boolean",["number","number"],[this.scoreptr,this.excerptId])}async extendSelectionPrevChord(){return a.ccall("extendSelectionPrevChord","boolean",["number","number"],[this.scoreptr,this.excerptId])}async getSelectionBoundingBox(){let e=a.ccall("getSelectionBoundingBox","number",["number","number"],[this.scoreptr,this.excerptId]),t=c.readText(e);if(!t)return null;try{return JSON.parse(t)}catch(e){return null}}async getSelectionBoundingBoxes(){let e=a.ccall("getSelectionBoundingBoxes","number",["number","number"],[this.scoreptr,this.excerptId]),t=c.readText(e);if(!t)return[];try{return JSON.parse(t)}catch(e){return[]}}async selectionMimeType(){let e=a.ccall("selectionMimeType","number",["number","number"],[this.scoreptr,this.excerptId]);return c.readText(e)}async selectionMimeData(){let e=a.ccall("selectionMimeData","number",["number","number"],[this.scoreptr,this.excerptId]);return c.readData(e)}async pasteSelection(e,t){let r=i(e),n=u(t),o=a.ccall("pasteSelection","boolean",["number","number","number","number","number"],[this.scoreptr,r,n,t.byteLength,this.excerptId]);return d(r),d(n),o}async selectElementAtPointWithMode(e,t,r,n){return a.ccall("selectElementAtPointWithMode","boolean",["number","number","number","number","number","number"],[this.scoreptr,e,t,r,n,this.excerptId])}async deleteSelection(){return a.ccall("deleteSelection","boolean",["number","number"],[this.scoreptr,this.excerptId])}async pitchUp(){return a.ccall("pitchUp","boolean",["number","number"],[this.scoreptr,this.excerptId])}async pitchDown(){return a.ccall("pitchDown","boolean",["number","number"],[this.scoreptr,this.excerptId])}async transpose(e){return a.ccall("transpose","boolean",["number","number","number"],[this.scoreptr,e,this.excerptId])}async setAccidental(e){return a.ccall("setAccidental","boolean",["number","number","number"],[this.scoreptr,e,this.excerptId])}async doubleDuration(){return a.ccall("doubleDuration","boolean",["number","number"],[this.scoreptr,this.excerptId])}async halfDuration(){return a.ccall("halfDuration","boolean",["number","number"],[this.scoreptr,this.excerptId])}async toggleDot(){return a.ccall("toggleDot","boolean",["number","number"],[this.scoreptr,this.excerptId])}async toggleDoubleDot(){return a.ccall("toggleDoubleDot","boolean",["number","number"],[this.scoreptr,this.excerptId])}async setNoteEntryMode(e){return a.ccall("setNoteEntryMode","boolean",["number","number","number"],[this.scoreptr,+!!e,this.excerptId])}async setNoteEntryMethod(e){return a.ccall("setNoteEntryMethod","boolean",["number","number","number"],[this.scoreptr,e,this.excerptId])}async setInputStateFromSelection(){return a.ccall("setInputStateFromSelection","boolean",["number","number"],[this.scoreptr,this.excerptId])}async setInputAccidentalType(e){return a.ccall("setInputAccidentalType","boolean",["number","number","number"],[this.scoreptr,e,this.excerptId])}async setInputDurationType(e){return a.ccall("setInputDurationType","boolean",["number","number","number"],[this.scoreptr,e,this.excerptId])}async toggleInputDot(){return a.ccall("toggleInputDot","boolean",["number","number"],[this.scoreptr,this.excerptId])}async addPitchByStep(e,t=!1,r=!1){return a.ccall("addPitchByStep","boolean",["number","number","number","number","number"],[this.scoreptr,e,+!!t,+!!r,this.excerptId])}async enterRest(){return a.ccall("enterRest","boolean",["number","number"],[this.scoreptr,this.excerptId])}async setDurationType(e){return a.ccall("setDurationType","boolean",["number","number","number"],[this.scoreptr,e,this.excerptId])}async toggleLineBreak(){return a.ccall("toggleLineBreak","boolean",["number","number"],[this.scoreptr,this.excerptId])}async togglePageBreak(){return a.ccall("togglePageBreak","boolean",["number","number"],[this.scoreptr,this.excerptId])}async setVoice(e){return a.ccall("setVoice","boolean",["number","number","number"],[this.scoreptr,e,this.excerptId])}async changeSelectedElementsVoice(e){return a.ccall("changeSelectedElementsVoice","boolean",["number","number","number"],[this.scoreptr,e,this.excerptId])}async undo(){return a.ccall("undo","boolean",["number","number"],[this.scoreptr,this.excerptId])}async redo(){return a.ccall("redo","boolean",["number","number"],[this.scoreptr,this.excerptId])}async relayout(){return a.ccall("relayout","boolean",["number","number"],[this.scoreptr,this.excerptId])}async addDynamic(e){return a.ccall("addDynamic","boolean",["number","number","number"],[this.scoreptr,e,this.excerptId])}async addHairpin(e){return a.ccall("addHairpin","boolean",["number","number","number"],[this.scoreptr,e,this.excerptId])}async addPedal(e){return a.ccall("addPedal","boolean",["number","number","number"],[this.scoreptr,e,this.excerptId])}async addSostenutoPedal(){return a.ccall("addSostenutoPedal","boolean",["number","number"],[this.scoreptr,this.excerptId])}async addUnaCorda(){return a.ccall("addUnaCorda","boolean",["number","number"],[this.scoreptr,this.excerptId])}async splitPedal(){return a.ccall("splitPedal","boolean",["number","number"],[this.scoreptr,this.excerptId])}async addRehearsalMark(){return a.ccall("addRehearsalMark","boolean",["number","number"],[this.scoreptr,this.excerptId])}async addTempoText(e){return a.ccall("addTempoText","boolean",["number","number","number"],[this.scoreptr,e,this.excerptId])}async addStaffText(e){let t=i(null==e?"":String(e));try{return a.ccall("addStaffText","boolean",["number","number","number"],[this.scoreptr,t,this.excerptId])}finally{d(t)}}async addSystemText(e){let t=i(null==e?"":String(e));try{return a.ccall("addSystemText","boolean",["number","number","number"],[this.scoreptr,t,this.excerptId])}finally{d(t)}}async addExpressionText(e){let t=i(null==e?"":String(e));try{return a.ccall("addExpressionText","boolean",["number","number","number"],[this.scoreptr,t,this.excerptId])}finally{d(t)}}async addLyricText(e){let t=i(null==e?"":String(e));try{return a.ccall("addLyricText","boolean",["number","number","number"],[this.scoreptr,t,this.excerptId])}finally{d(t)}}async addHarmonyText(e,t){let r=i(null==t?"":String(t));try{return a.ccall("addHarmonyText","boolean",["number","number","number","number"],[this.scoreptr,e,r,this.excerptId])}finally{d(r)}}async addFingeringText(e){let t=i(null==e?"":String(e));try{return a.ccall("addFingeringText","boolean",["number","number","number"],[this.scoreptr,t,this.excerptId])}finally{d(t)}}async addLeftHandGuitarFingeringText(e){let t=i(null==e?"":String(e));try{return a.ccall("addLeftHandGuitarFingeringText","boolean",["number","number","number"],[this.scoreptr,t,this.excerptId])}finally{d(t)}}async addRightHandGuitarFingeringText(e){let t=i(null==e?"":String(e));try{return a.ccall("addRightHandGuitarFingeringText","boolean",["number","number","number"],[this.scoreptr,t,this.excerptId])}finally{d(t)}}async addStringNumberText(e){let t=i(null==e?"":String(e));try{return a.ccall("addStringNumberText","boolean",["number","number","number"],[this.scoreptr,t,this.excerptId])}finally{d(t)}}async addInstrumentChangeText(e){let t=i(null==e?"":String(e));try{return a.ccall("addInstrumentChangeText","boolean",["number","number","number"],[this.scoreptr,t,this.excerptId])}finally{d(t)}}async addStickingText(e){let t=i(null==e?"":String(e));try{return a.ccall("addStickingText","boolean",["number","number","number"],[this.scoreptr,t,this.excerptId])}finally{d(t)}}async addFiguredBassText(e){let t=i(null==e?"":String(e));try{return a.ccall("addFiguredBassText","boolean",["number","number","number"],[this.scoreptr,t,this.excerptId])}finally{d(t)}}async addArticulation(e){let t=i(e);try{return a.ccall("addArticulation","boolean",["number","number","number"],[this.scoreptr,t,this.excerptId])}finally{d(t)}}async addSlur(){return a.ccall("addSlur","boolean",["number","number"],[this.scoreptr,this.excerptId])}async addTie(){return a.ccall("addTie","boolean",["number","number"],[this.scoreptr,this.excerptId])}async addGraceNote(e){return a.ccall("addGraceNote","boolean",["number","number","number"],[this.scoreptr,e,this.excerptId])}async addTuplet(e){return a.ccall("addTuplet","boolean",["number","number","number"],[this.scoreptr,e,this.excerptId])}async addNoteFromRest(){return a.ccall("addNoteFromRest","boolean",["number","number"],[this.scoreptr,this.excerptId])}async toggleRepeatStart(){return a.ccall("toggleRepeatStart","boolean",["number","number"],[this.scoreptr,this.excerptId])}async toggleRepeatEnd(){return a.ccall("toggleRepeatEnd","boolean",["number","number"],[this.scoreptr,this.excerptId])}async setRepeatCount(e){return a.ccall("setRepeatCount","boolean",["number","number","number"],[this.scoreptr,e,this.excerptId])}async setBarLineType(e){return a.ccall("setBarLineType","boolean",["number","number","number"],[this.scoreptr,e,this.excerptId])}async addVolta(e){return a.ccall("addVolta","boolean",["number","number","number"],[this.scoreptr,e,this.excerptId])}async insertMeasures(e,t){return a.ccall("insertMeasures","boolean",["number","number","number","number"],[this.scoreptr,e,t,this.excerptId])}async removeTrailingEmptyMeasures(){return a.ccall("removeTrailingEmptyMeasures","boolean",["number","number"],[this.scoreptr,this.excerptId])}async setTimeSignature(e,t){return a.ccall("setTimeSignature","boolean",["number","number","number","number"],[this.scoreptr,e,t,this.excerptId])}async setTimeSignatureWithType(e,t,r){return a.ccall("setTimeSignatureWithType","boolean",["number","number","number","number","number"],[this.scoreptr,e,t,r,this.excerptId])}async setKeySignature(e){return a.ccall("setKeySignature","boolean",["number","number","number"],[this.scoreptr,e,this.excerptId])}async getKeySignature(){return a.ccall("getKeySignature","number",["number","number"],[this.scoreptr,this.excerptId])}async setClef(e){return a.ccall("setClef","boolean",["number","number","number"],[this.scoreptr,e,this.excerptId])}destroy(e=!0){if(!e)throw Error("unimplemented");a.ccall("destroy","void",["number"],[this.scoreptr]),d(this.scoreptr)}}let y=(e,t,r)=>{self.postMessage({id:e,result:t},r)},b=(e,t)=>{let r={id:e,error:{name:t.name,message:t.message,stack:t.stack}};self.postMessage(r)},v=e=>{if(e){if(Array.isArray(e))return e.reduce((e,t)=>e.concat(v(t)),[]).filter(Boolean);else if(e instanceof Uint8Array)return[e.buffer];else if(e.chunk instanceof Uint8Array)return[e.chunk.buffer]}};self.onmessage=async t=>{let{id:r,method:n,params:a}=t.data;try{switch(n){case"ready":await g.ready,y(r,"done");break;case"load":await g.ready,e=await g.load.apply(void 0,a),y(r,"done");break;case"setLogLevel":await g.setLogLevel.apply(void 0,a),y(r,"done");break;default:e||b(r,Error("Score not loaded"));let t=await e[n].apply(e,a);y(r,t,v(t))}}catch(e){b(r,e)}}}()};"object"==typeof s&&"object"==typeof s.versions&&s.versions.node;var c=function(){var e="u">typeof self?self:window;if(e.window||("function"==typeof importScripts?e.window=e:e.window={addEventListener:function(){},location:new URL("file:///"),encodeURIComponent:encodeURIComponent}),!e.navigator)try{e.navigator={}}catch(e){}};function d(e,t){if(e){if("string"==typeof e)return f(e,t);var r=({}).toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?f(e,t):void 0}}function f(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function p(){var e,t,r="function"==typeof Symbol?Symbol:{},n=r.iterator||"@@iterator",a=r.toStringTag||"@@toStringTag";function o(r,n,a,o){var l=Object.create((n&&n.prototype instanceof s?n:s).prototype);return m(l,"_invoke",function(r,n,a){var o,s,l,u=0,c=a||[],d=!1,f={p:0,n:0,v:e,a:p,f:p.bind(e,4),d:function(t,r){return o=t,s=0,l=e,f.n=r,i}};function p(r,n){for(s=r,l=n,t=0;!d&&u&&!a&&t<c.length;t++){var a,o=c[t],p=f.p,m=o[2];r>3?(a=m===n)&&(l=o[(s=o[4])?5:(s=3,3)],o[4]=o[5]=e):o[0]<=p&&((a=r<2&&p<o[1])?(s=0,f.v=n,f.n=o[1]):p<m&&(a=r<3||o[0]>n||n>m)&&(o[4]=r,o[5]=n,f.n=m,s=0))}if(a||r>1)return i;throw d=!0,n}return function(a,c,m){if(u>1)throw TypeError("Generator is already running");for(d&&1===c&&p(c,m),s=c,l=m;(t=s<2?e:l)||!d;){o||(s?s<3?(s>1&&(f.n=-1),p(s,l)):f.n=l:f.v=l);try{if(u=2,o){if(s||(a="next"),t=o[a]){if(!(t=t.call(o,l)))throw TypeError("iterator result is not an object");if(!t.done)return t;l=t.value,s<2&&(s=0)}else 1===s&&(t=o.return)&&t.call(o),s<2&&(l=TypeError("The iterator does not provide a '"+a+"' method"),s=1);o=e}else if((t=(d=f.n<0)?l:r.call(n,f))!==i)break}catch(t){o=e,s=1,l=t}finally{u=1}}return{value:t,done:d}}}(r,a,o),!0),l}var i={};function s(){}function l(){}function u(){}t=Object.getPrototypeOf;var c=u.prototype=s.prototype=Object.create([][n]?t(t([][n]())):(m(t={},n,function(){return this}),t));function d(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,u):(e.__proto__=u,m(e,a,"GeneratorFunction")),e.prototype=Object.create(c),e}return l.prototype=u,m(c,"constructor",u),m(u,"constructor",l),l.displayName="GeneratorFunction",m(u,a,"GeneratorFunction"),m(c),m(c,a,"Generator"),m(c,n,function(){return this}),m(c,"toString",function(){return"[object Generator]"}),(p=function(){return{w:o,m:d}})()}function m(e,t,r,n){var a=Object.defineProperty;try{a({},"",{})}catch(e){a=0}(m=function(e,t,r,n){function o(t,r){m(e,t,function(e){return this._invoke(t,r,e)})}t?a?a(e,t,{value:r,enumerable:!n,configurable:!n,writable:!n}):e[t]=r:(o("next",0),o("throw",1),o("return",2))})(e,t,r,n)}function h(e,t,r,n,a,o,i){try{var s=e[o](i),l=s.value}catch(e){return void r(e)}s.done?t(l):Promise.resolve(l).then(n,a)}function g(e){return function(){var t=this,r=arguments;return new Promise(function(n,a){var o=e.apply(t,r);function i(e){h(o,n,a,i,s,"next",e)}function s(e){h(o,n,a,i,s,"throw",e)}i(void 0)})}}function y(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(n.key),n)}}function b(e,t,r){return t&&y(e.prototype,t),r&&y(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function v(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}function x(e){var t="function"==typeof Map?new Map:void 0;return(x=function(e){if(null===e||!function(e){try{return -1!==Function.toString.call(e).indexOf("[native code]")}catch(t){return"function"==typeof e}}(e))return e;if("function"!=typeof e)throw TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,r)}function r(){return function(e,t,r){if(w())return Reflect.construct.apply(null,arguments);var n=[null];n.push.apply(n,t);var a=new(e.bind.apply(e,n));return r&&k(a,r.prototype),a}(e,arguments,_(this).constructor)}return r.prototype=Object.create(e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),k(r,e)})(e)}function w(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(w=function(){return!!e})()}function k(e,t){return(k=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function _(e){return(_=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var S=(n="","u">typeof document?n=document.currentScript&&document.currentScript.src||document.baseURI:"u">typeof location&&(n=location.href),n),E=function(e){function t(e){var r,n;return v(this,t),n=_(n=t),(r=function(e,t){if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw TypeError("Derived constructors may only return object or undefined");var r=e;if(void 0===r)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return r}(this,w()?Reflect.construct(n,[],_(this).constructor):n.apply(this,void 0))).name=e.name,r.message=e.message,r.originalStack=e.stack,r}if("function"!=typeof e&&null!==e)throw TypeError("Super expression must either be null or a function");return t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&k(t,e),b(t)}(x(Error)),T=0,C=function(){var e,t,r,n,a,o;function i(){v(this,i);var e=URL.createObjectURL(new Blob(['(function () { var MSCORE_SCRIPT_URL = "'.concat(S,'";')+"var $RefreshSig$ = () => (type) => type; var $RefreshReg$ = () => {};("+c.toString()+")();"+'var MSCORE_LIB_WASM = "'.concat("webmscore.lib.wasm",'", MSCORE_LIB_DATA = "').concat("webmscore.lib.data",'", MSCORE_LIB_MEM = "').concat("webmscore.lib.mem.wasm",'", MSCORE_BASEURL = "').concat(document.baseURI,'";')+"("+u.toString()+")()})()"]));this.worker=new Worker(e),this.workerURL=e}return b(i,[{key:"rpc",value:(e=g(p().m(function e(t){var r,n,a,o=this,i=arguments;return p().w(function(e){for(;;)if(0===e.n)return r=i.length>1&&void 0!==i[1]?i[1]:[],n=i.length>2&&void 0!==i[2]?i[2]:[],a=Math.random(),e.a(2,new Promise(function(e,i){var s=function(t){var r=t.data;r.id===a&&(r.error&&i(new E(r.error)),o.worker.removeEventListener("message",s),e(r.result))};o.worker.addEventListener("message",s),o.worker.postMessage({id:a,method:t,params:r},n)}))},e)})),function(t){return e.apply(this,arguments)})},{key:"setExcerptId",value:function(e){return this.rpc("setExcerptId",[e])}},{key:"getExcerptId",value:function(){return this.rpc("getExcerptId")}},{key:"generateExcerpts",value:function(){return this.rpc("generateExcerpts")}},{key:"title",value:function(){return this.rpc("title")}},{key:"subtitle",value:function(){return this.rpc("subtitle")}},{key:"titleFilenameSafe",value:function(){return this.rpc("titleFilenameSafe")}},{key:"setTitleText",value:function(e){return this.rpc("setTitleText",[e])}},{key:"setSubtitleText",value:function(e){return this.rpc("setSubtitleText",[e])}},{key:"setComposerText",value:function(e){return this.rpc("setComposerText",[e])}},{key:"setLyricistText",value:function(e){return this.rpc("setLyricistText",[e])}},{key:"setSelectedText",value:function(e){return this.rpc("setSelectedText",[e])}},{key:"appendPart",value:function(e){return this.rpc("appendPart",[e])}},{key:"appendPartByMusicXmlId",value:function(e){return this.rpc("appendPartByMusicXmlId",[e])}},{key:"removePart",value:function(e){return this.rpc("removePart",[e])}},{key:"setPartVisible",value:function(e,t){return this.rpc("setPartVisible",[e,t])}},{key:"listInstrumentTemplates",value:function(){return this.rpc("listInstrumentTemplates")}},{key:"npages",value:function(){return this.rpc("npages")}},{key:"metadata",value:function(){return this.rpc("metadata")}},{key:"measurePositions",value:function(){return this.rpc("measurePositions")}},{key:"segmentPositions",value:function(){return this.rpc("segmentPositions")}},{key:"saveXml",value:function(){return this.rpc("saveXml")}},{key:"saveMxl",value:function(){return this.rpc("saveMxl")}},{key:"saveMsc",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"mscz";return this.rpc("saveMsc",[e])}},{key:"saveSvg",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return this.rpc("saveSvg",[e,t,r])}},{key:"savePng",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=!(arguments.length>2)||void 0===arguments[2]||arguments[2];return this.rpc("savePng",[e,t,r])}},{key:"savePdf",value:function(){return this.rpc("savePdf")}},{key:"saveMidi",value:function(){var e=!(arguments.length>0)||void 0===arguments[0]||arguments[0],t=!(arguments.length>1)||void 0===arguments[1]||arguments[1];return this.rpc("saveMidi",[e,t])}},{key:"setSoundFont",value:function(e){return this.rpc("setSoundFont",[e],[e.buffer])}},{key:"saveAudio",value:function(e){return this.rpc("saveAudio",[e])}},{key:"savePositions",value:function(e){return this.rpc("savePositions",[e])}},{key:"synthAudio",value:(t=g(p().m(function e(){var t,r,n=this,a=arguments;return p().w(function(e){for(;;)switch(e.n){case 0:return t=a.length>0&&void 0!==a[0]?a[0]:0,e.n=1,this.rpc("_synthAudio",[t]);case 1:return r=e.v,e.a(2,function(e){return n.rpc("processSynth",[r,e])})}},e,this)})),function(){return t.apply(this,arguments)})},{key:"synthAudioBatch",value:(r=g(p().m(function e(t,r){var n,a=this;return p().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,this.rpc("_synthAudio",[t]);case 1:return n=e.v,e.a(2,function(e){return a.rpc("processSynthBatch",[n,r,e])})}},e,this)})),function(e,t){return r.apply(this,arguments)})},{key:"saveMetadata",value:function(){return this.rpc("saveMetadata")}},{key:"selectElementAtPoint",value:function(e,t,r){return this.rpc("selectElementAtPoint",[e,t,r])}},{key:"selectTextElementAtPoint",value:function(e,t,r){return this.rpc("selectTextElementAtPoint",[e,t,r])}},{key:"clearSelection",value:function(){return this.rpc("clearSelection")}},{key:"selectNextChord",value:function(){return this.rpc("selectNextChord")}},{key:"selectPrevChord",value:function(){return this.rpc("selectPrevChord")}},{key:"extendSelectionNextChord",value:function(){return this.rpc("extendSelectionNextChord")}},{key:"extendSelectionPrevChord",value:function(){return this.rpc("extendSelectionPrevChord")}},{key:"getSelectionBoundingBox",value:function(){return this.rpc("getSelectionBoundingBox")}},{key:"getSelectionBoundingBoxes",value:function(){return this.rpc("getSelectionBoundingBoxes")}},{key:"selectionMimeType",value:function(){return this.rpc("selectionMimeType")}},{key:"selectionMimeData",value:function(){return this.rpc("selectionMimeData")}},{key:"pasteSelection",value:function(e,t){return this.rpc("pasteSelection",[e,t])}},{key:"selectElementAtPointWithMode",value:function(e,t,r,n){return this.rpc("selectElementAtPointWithMode",[e,t,r,n])}},{key:"deleteSelection",value:function(){return this.rpc("deleteSelection")}},{key:"pitchUp",value:function(){return this.rpc("pitchUp")}},{key:"pitchDown",value:function(){return this.rpc("pitchDown")}},{key:"transpose",value:function(e){return this.rpc("transpose",[e])}},{key:"setAccidental",value:function(e){return this.rpc("setAccidental",[e])}},{key:"doubleDuration",value:function(){return this.rpc("doubleDuration")}},{key:"halfDuration",value:function(){return this.rpc("halfDuration")}},{key:"toggleDot",value:function(){return this.rpc("toggleDot")}},{key:"toggleDoubleDot",value:function(){return this.rpc("toggleDoubleDot")}},{key:"setNoteEntryMode",value:function(e){return this.rpc("setNoteEntryMode",[+!!e])}},{key:"setNoteEntryMethod",value:function(e){return this.rpc("setNoteEntryMethod",[e])}},{key:"setInputStateFromSelection",value:function(){return this.rpc("setInputStateFromSelection")}},{key:"setInputAccidentalType",value:function(e){return this.rpc("setInputAccidentalType",[e])}},{key:"setInputDurationType",value:function(e){return this.rpc("setInputDurationType",[e])}},{key:"toggleInputDot",value:function(){return this.rpc("toggleInputDot")}},{key:"addPitchByStep",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return this.rpc("addPitchByStep",[e,+!!t,+!!r])}},{key:"enterRest",value:function(){return this.rpc("enterRest")}},{key:"setDurationType",value:function(e){return this.rpc("setDurationType",[e])}},{key:"toggleLineBreak",value:function(){return this.rpc("toggleLineBreak")}},{key:"togglePageBreak",value:function(){return this.rpc("togglePageBreak")}},{key:"setVoice",value:function(e){return this.rpc("setVoice",[e])}},{key:"changeSelectedElementsVoice",value:function(e){return this.rpc("changeSelectedElementsVoice",[e])}},{key:"addDynamic",value:function(e){return this.rpc("addDynamic",[e])}},{key:"addHairpin",value:function(e){return this.rpc("addHairpin",[e])}},{key:"addPedal",value:function(e){return this.rpc("addPedal",[e])}},{key:"addSostenutoPedal",value:function(){return this.rpc("addSostenutoPedal")}},{key:"addUnaCorda",value:function(){return this.rpc("addUnaCorda")}},{key:"splitPedal",value:function(){return this.rpc("splitPedal")}},{key:"addRehearsalMark",value:function(){return this.rpc("addRehearsalMark")}},{key:"addTempoText",value:function(e){return this.rpc("addTempoText",[e])}},{key:"addStaffText",value:function(e){return this.rpc("addStaffText",[e])}},{key:"addSystemText",value:function(e){return this.rpc("addSystemText",[e])}},{key:"addExpressionText",value:function(e){return this.rpc("addExpressionText",[e])}},{key:"addLyricText",value:function(e){return this.rpc("addLyricText",[e])}},{key:"addHarmonyText",value:function(e,t){return this.rpc("addHarmonyText",[e,t])}},{key:"addFingeringText",value:function(e){return this.rpc("addFingeringText",[e])}},{key:"addLeftHandGuitarFingeringText",value:function(e){return this.rpc("addLeftHandGuitarFingeringText",[e])}},{key:"addRightHandGuitarFingeringText",value:function(e){return this.rpc("addRightHandGuitarFingeringText",[e])}},{key:"addStringNumberText",value:function(e){return this.rpc("addStringNumberText",[e])}},{key:"addInstrumentChangeText",value:function(e){return this.rpc("addInstrumentChangeText",[e])}},{key:"addStickingText",value:function(e){return this.rpc("addStickingText",[e])}},{key:"addFiguredBassText",value:function(e){return this.rpc("addFiguredBassText",[e])}},{key:"addArticulation",value:function(e){return this.rpc("addArticulation",[e])}},{key:"addSlur",value:function(){return this.rpc("addSlur")}},{key:"addTie",value:function(){return this.rpc("addTie")}},{key:"addGraceNote",value:function(e){return this.rpc("addGraceNote",[e])}},{key:"addTuplet",value:function(e){return this.rpc("addTuplet",[e])}},{key:"addNoteFromRest",value:function(){return this.rpc("addNoteFromRest")}},{key:"toggleRepeatStart",value:function(){return this.rpc("toggleRepeatStart")}},{key:"toggleRepeatEnd",value:function(){return this.rpc("toggleRepeatEnd")}},{key:"setRepeatCount",value:function(e){return this.rpc("setRepeatCount",[e])}},{key:"setBarLineType",value:function(e){return this.rpc("setBarLineType",[e])}},{key:"addVolta",value:function(e){return this.rpc("addVolta",[e])}},{key:"insertMeasures",value:function(e,t){return this.rpc("insertMeasures",[e,t])}},{key:"removeTrailingEmptyMeasures",value:function(){return this.rpc("removeTrailingEmptyMeasures")}},{key:"undo",value:function(){return this.rpc("undo")}},{key:"redo",value:function(){return this.rpc("redo")}},{key:"relayout",value:function(){return this.rpc("relayout")}},{key:"setTimeSignature",value:function(e,t){return this.rpc("setTimeSignature",[e,t])}},{key:"setTimeSignatureWithType",value:function(e,t,r){return this.rpc("setTimeSignatureWithType",[e,t,r])}},{key:"setKeySignature",value:function(e){return this.rpc("setKeySignature",[e])}},{key:"getKeySignature",value:function(){return this.rpc("getKeySignature")}},{key:"setClef",value:function(e){return this.rpc("setClef",[e])}},{key:"destroy",value:function(){var e=!(arguments.length>0)||void 0===arguments[0]||arguments[0];e?this.rpc("destroy",[e]):(this.worker.terminate(),URL.revokeObjectURL(this.workerURL))}}],[{key:"ready",get:function(){return Promise.resolve()}},{key:"version",value:(n=g(p().m(function e(){return p().w(function(e){for(;;)if(0===e.n)return e.a(2,-1)},e)})),function(){return n.apply(this,arguments)})},{key:"setLogLevel",value:(a=g(p().m(function e(t){return p().w(function(e){for(;;)switch(e.n){case 0:T=t;case 1:return e.a(2)}},e)})),function(e){return a.apply(this,arguments)})},{key:"load",value:(o=g(p().m(function e(t,r){var n,a,o,s,l=arguments;return p().w(function(e){for(var u,c;;)switch(e.n){case 0:return n=l.length>2&&void 0!==l[2]?l[2]:[],a=!(l.length>3)||void 0===l[3]||l[3],o=new i,e.n=1,Promise.all([n,o.rpc("ready")]);case 1:return s=(function(e){if(Array.isArray(e))return e}(u=e.v)||function(e,t){var r=null==e?null:"u">typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,a,o,i,s=[],l=!0,u=!1;try{o=(r=r.call(e)).next,!1;for(;!(l=(n=o.call(r)).done)&&(s.push(n.value),1!==s.length);l=!0);}catch(e){u=!0,a=e}finally{try{if(!l&&null!=r.return&&(i=r.return(),Object(i)!==i))return}finally{if(u)throw a}}return s}}(u,1)||d(u,1)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}())[0],e.n=2,o.rpc("setLogLevel",[T]);case 2:return e.n=3,o.rpc("load",[t,r,s,a],[r.buffer].concat(function(e){if(Array.isArray(e))return f(e)}(c=s.map(function(e){return e.buffer}))||function(e){if("u">typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(c)||d(c)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()));case 3:return e.a(2,o)}},e)})),function(e,t){return o.apply(this,arguments)})}])}();let N=!1,A=async()=>(N||(await C.ready,N=!0),C),j="checkpoints",D=()=>new Promise((e,t)=>{if(!("u">typeof indexedDB))return void t(Error("IndexedDB is not available in this environment."));let r=indexedDB.open("ots-web",2);r.onupgradeneeded=()=>{let e,t=r.result;(e=t.objectStoreNames.contains(j)?r.transaction?.objectStore(j):t.createObjectStore(j,{keyPath:"id",autoIncrement:!0})).indexNames.contains("createdAt")||e.createIndex("createdAt","createdAt"),e.indexNames.contains("scoreId")||e.createIndex("scoreId","scoreId")},r.onsuccess=()=>e(r.result),r.onerror=()=>t(r.error??Error("Failed to open IndexedDB."))}),M=async e=>{let t=await D();return new Promise((r,n)=>{let a=t.transaction(j,"readwrite"),o=a.objectStore(j).add(e);o.onsuccess=()=>r(o.result),o.onerror=()=>n(o.error??Error("Failed to save checkpoint.")),a.oncomplete=()=>t.close(),a.onerror=()=>t.close(),a.onabort=()=>t.close()})},F=async e=>{let t=await D();return new Promise((r,n)=>{let a=t.transaction(j,e?"readwrite":"readonly"),o=a.objectStore(j),i=o.getAll();i.onsuccess=()=>{let t=i.result.filter(Boolean);e&&t.filter(e=>!e.scoreId).forEach(t=>{o.put({...t,scoreId:e})});let n=(e?t.filter(t=>(t.scoreId??e)===e):t).map(e=>({id:e.id,scoreId:e.scoreId,title:e.title,createdAt:e.createdAt,format:e.format,size:e.size}));n.sort((e,t)=>t.createdAt-e.createdAt),r(n)},i.onerror=()=>n(i.error??Error("Failed to read checkpoints.")),a.oncomplete=()=>t.close(),a.onerror=()=>t.close(),a.onabort=()=>t.close()})},P=async e=>{let t=await D();return new Promise((r,n)=>{let a=t.transaction(j,"readonly"),o=a.objectStore(j).get(e);o.onsuccess=()=>r(o.result??null),o.onerror=()=>n(o.error??Error("Failed to load checkpoint.")),a.oncomplete=()=>t.close(),a.onerror=()=>t.close(),a.onabort=()=>t.close()})},I=async e=>{let t=await D();return new Promise((r,n)=>{let a=t.transaction(j,"readwrite"),o=a.objectStore(j).delete(e);o.onsuccess=()=>r(),o.onerror=()=>n(o.error??Error("Failed to delete checkpoint.")),a.oncomplete=()=>t.close(),a.onerror=()=>t.close(),a.onabort=()=>t.close()})},L=async()=>{let e=await D();return new Promise((t,r)=>{let n=e.transaction(j,"readonly"),a=n.objectStore(j).getAll();a.onsuccess=()=>{let e=a.result.filter(Boolean),r=new Map;for(let t of e){let e=t.scoreId??"legacy",n=r.get(e);n?(n.count+=1,t.createdAt>n.lastUpdated&&(n.lastUpdated=t.createdAt,n.title=t.title)):r.set(e,{scoreId:e,title:t.title,lastUpdated:t.createdAt,count:1})}t(Array.from(r.values()).sort((e,t)=>t.lastUpdated-e.lastUpdated))},a.onerror=()=>r(a.error??Error("Failed to read score summaries.")),n.oncomplete=()=>e.close(),n.onerror=()=>e.close(),n.onabort=()=>e.close()})};var R=r(9561),B=r(7071),O=r(6732),U=r(9873),z=r(6655),X=r(6252);let $=R.Lz.theme({"&":{height:"80vh",backgroundColor:"#ffffff"},"&.cm-editor.cm-focused":{outline:"1px solid #3b82f6"},".cm-scroller":{fontFamily:'ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace',fontSize:"12px",overflowX:"auto"}}),W=R.Lz.theme({"&":{backgroundColor:"#f3f4f6"},".cm-content":{color:"#9ca3af"}}),H=(0,U.bu)(e=>(e=>{if("u"<typeof DOMParser)return[];let t=[],r=new DOMParser().parseFromString(e,"application/xml"),n=r.querySelector("parsererror");if(n){let r=n.textContent?.trim()||"Invalid XML.";return t.push({from:0,to:Math.min(1,e.length),severity:"error",message:r}),t}let a=r.documentElement;if(!a)return t.push({from:0,to:Math.min(1,e.length),severity:"error",message:"XML document is empty."}),t;let o=a.localName||a.nodeName;return"score-partwise"!==o&&"score-timewise"!==o?t.push({from:0,to:Math.min(1,e.length),severity:"warning",message:"Root element is not a MusicXML score."}):(r.querySelector("part-list")||t.push({from:0,to:Math.min(1,e.length),severity:"warning",message:"Missing <part-list> element."}),r.querySelector("part")||t.push({from:0,to:Math.min(1,e.length),severity:"warning",message:"No <part> elements found."})),t})(e.state.doc.toString())),G=({value:e,onChange:t,readOnly:r=!1,placeholderText:n,testId:i,className:s})=>{let l=(0,o.useRef)(null),u=(0,o.useRef)(null),c=(0,o.useRef)(t),d=(0,o.useRef)(new B.xx),f=(0,o.useRef)(!1);(0,o.useEffect)(()=>{c.current=t},[t]);let p=()=>{let e=[B.$t.readOnly.of(r),R.Lz.editable.of(!r)];return n&&e.push((0,R.qf)(n)),r&&e.push(W),e};return(0,o.useEffect)(()=>{if(!l.current||u.current)return;let t=B.$t.create({doc:e,extensions:[X.oQ,(0,z._n)(),H,(0,U.pJ)(),(0,O.Lv)(),R.w4.of(O.f7),(0,O.y9)(O.Zt,{fallback:!0}),$,R.Lz.updateListener.of(e=>{if(e.docChanged){if(f.current)return;let t=e.state.doc.toString();c.current(t)}}),d.current.of(p())]});return u.current=new R.Lz({state:t,parent:l.current}),()=>{u.current?.destroy(),u.current=null}},[]),(0,o.useEffect)(()=>{let t=u.current;if(!t)return;let r=t.state.doc.toString();e!==r&&(f.current=!0,t.dispatch({changes:{from:0,to:r.length,insert:e}}),f.current=!1)},[e]),(0,o.useEffect)(()=>{let e=u.current;e&&e.dispatch({effects:d.current.reconfigure(p())})},[r,n]),(0,a.jsx)("div",{ref:l,"data-testid":i,className:`w-full rounded border border-gray-300 ${s??""}`})},V="dropdown-item px-3 py-1 text-left rounded hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",q="text-xs uppercase tracking-wide text-gray-500 px-2 py-1",Y=({label:e,disabled:t=!1,children:r,testId:n,summaryClassName:i})=>{let[s,l]=(0,o.useState)(!1);return(0,o.useEffect)(()=>{t&&l(!1)},[t]),(0,a.jsxs)("div",{className:"relative overflow-visible","data-testid":n,children:[(0,a.jsx)("button",{type:"button",className:`${i??"px-3 py-1 bg-white border border-gray-300 rounded cursor-pointer hover:bg-gray-50 list-none"} ${t?"opacity-50 cursor-not-allowed pointer-events-none":""}`,onClick:()=>{t||l(e=>!e)},disabled:t,"aria-expanded":s,children:e}),!t&&s&&(0,a.jsx)("div",{className:"absolute mt-2 w-56 bg-white border border-gray-200 rounded shadow-lg p-2 flex flex-col gap-1",style:{zIndex:110},onClick:e=>{let t=e.target;t?.closest('.dropdown-item, [data-dropdown-close="true"]')&&l(!1)},children:r})]})},K=({onNewScore:e,onFileUpload:t,scoreTitle:r,scoreSubtitle:n,scoreComposer:i,scoreLyricist:s,onScoreTitleChange:l,onScoreSubtitleChange:u,onScoreComposerChange:c,onScoreLyricistChange:d,onSetTitleText:f,onSetSubtitleText:p,onSetComposerText:m,onSetLyricistText:h,headerTextAvailable:g=!1,onZoomIn:y,onZoomOut:b,onFitWidth:v,onFitHeight:x,zoomLevel:w,onDeleteSelection:k,onUndo:_,onRedo:S,onPitchUp:E,onPitchDown:T,onDurationLonger:C,onDurationShorter:N,onTranspose:A,onSetAccidental:j,mutationsEnabled:D=!1,selectionActive:M=!1,selectedTextActive:F=!1,selectedTextValue:P="",onSelectedTextChange:I,onApplySelectedText:L,selectedTextDisabled:R=!1,onExportSvg:B,onExportPdf:O,onExportPng:U,onExportMxl:z,onExportMscz:X,onExportMidi:$,onExportAudio:W,onSoundFontUpload:H,exportsEnabled:G=!1,pngAvailable:K=!1,audioAvailable:Q=!1,onPlayAudio:Z,onStopAudio:J,isPlaying:ee=!1,audioBusy:et=!1,onSetTimeSignature:er,timeSignatureOptions:en,onSetTimeSignature44:ea,onSetTimeSignature34:eo,onSetKeySignature:ei,keySignatureOptions:es,onSetClef:el,clefOptions:eu,onToggleDot:ec,onToggleDoubleDot:ed,onSetDurationType:ef,onToggleLineBreak:ep,onTogglePageBreak:em,onSetVoice:eh,onAddDynamic:eg,onAddHairpin:ey,onAddPedal:eb,onAddSostenutoPedal:ev,onAddUnaCorda:ex,onSplitPedal:ew,onAddTempoText:ek,onAddStaffText:e_,onAddSystemText:eS,onAddExpressionText:eE,onAddLyricText:eT,onAddHarmonyText:eC,onAddFingeringText:eN,onAddLeftHandGuitarFingeringText:eA,onAddRightHandGuitarFingeringText:ej,onAddStringNumberText:eD,onAddInstrumentChangeText:eM,onAddStickingText:eF,onAddFiguredBassText:eP,onAddArticulation:eI,onAddSlur:eL,onAddTie:eR,onAddGraceNote:eB,onAddTuplet:eO,onAddNoteFromRest:eU,onToggleRepeatStart:ez,onToggleRepeatEnd:eX,onSetRepeatCount:e$,onSetBarLineType:eW,onAddVolta:eH,onInsertMeasures:eG,onRemoveTrailingEmptyMeasures:eV,insertMeasuresDisabled:eq=!1,parts:eY=[],instrumentGroups:eK=[],onAddPart:eQ,onRemovePart:eZ,onTogglePartVisible:eJ})=>{let[e0,e1]=(0,o.useState)(""),[e2,e4]=(0,o.useState)("4"),[e8,e3]=(0,o.useState)(1),[e5,e6]=(0,o.useState)("after-selection"),[e7,e9]=(0,o.useState)("120"),te=()=>{if(!ek)return;let e=e7.trim();if(!e)return;let t=Number(e),r=Number.isFinite(t)?Math.max(1,Math.floor(t)):120;e9(String(r)),ek(r)},[tt,tr]=(0,o.useState)("4"),tn=!D,ta=eq||!eG||tn,to=tn||!G||!g,ti=eK.flatMap(e=>e.instruments.map(t=>({...t,groupName:t.groupName??e.name,groupId:t.groupId??e.id}))),ts=(0,o.useMemo)(()=>[{key:"piano",ids:["piano"]},{key:"violin",ids:["violin"]},{key:"viola",ids:["viola"]},{key:"cello",ids:["violoncello","cello"]},{key:"double-bass",ids:["double-bass","contrabass"],label:"Double Bass"},{key:"flute",ids:["flute"]},{key:"oboe",ids:["oboe"]},{key:"clarinet",ids:["clarinet"],label:"Clarinet"},{key:"bassoon",ids:["bassoon"]},{key:"trumpet",ids:["trumpet"],label:"Trumpet"},{key:"horn",ids:["horn"]},{key:"trombone",ids:["trombone"]},{key:"tuba",ids:["tuba"]},{key:"alto-saxophone",ids:["alto-saxophone"]},{key:"tenor-saxophone",ids:["tenor-saxophone"]},{key:"bass-guitar",ids:["bass-guitar"]},{key:"guitar",ids:["guitar-nylon","guitar-steel"]},{key:"voice",ids:["voice"]},{key:"drumset",ids:["drumset"]}],[]),tl=(0,o.useMemo)(()=>{let e=[],t=new Set;for(let r of ts){let n=r.ids.map(e=>ti.find(t=>t.id===e)).find(Boolean);n&&!t.has(n.id)&&(t.add(n.id),e.push({instrument:n,label:r.label??n.name}))}return e},[ts,ti]),tu=ti.length>0,tc=e0||(tu?ti[0].id:""),td=!tn&&!!eQ&&tu,tf=!tn&&!!eJ,tp=!tn&&!!eZ,tm=!tn&&!!er,th=Number.parseInt(e2,10),tg=Number.parseInt(tt,10),ty=Number.isInteger(th)&&Number.isInteger(tg)&&th>0&&tg>0;return(0,a.jsxs)("div",{className:"relative flex flex-wrap items-center justify-between gap-4 p-4 bg-gray-100 border-b border-gray-300 overflow-visible",style:{zIndex:100},children:[(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,a.jsx)("button",{type:"button",onClick:e,className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed",disabled:!e,children:"New Score"}),(0,a.jsxs)("label",{className:"px-4 py-2 bg-blue-600 text-white rounded cursor-pointer hover:bg-blue-700",children:["Open Score",(0,a.jsx)("input",{"data-testid":"open-score-input",type:"file",accept:".mscz,.xml,.musicxml",onChange:e=>{let r=e.target.files?.[0];r&&t(r)},className:"hidden"})]}),(0,a.jsxs)(Y,{label:"Export",disabled:!G,testId:"dropdown-export",summaryClassName:"px-3 py-2 bg-blue-600 text-white rounded cursor-pointer hover:bg-blue-700 list-none",children:[(0,a.jsx)("button",{"data-testid":"btn-export-svg",type:"button",onClick:B,disabled:!G||!B,className:V,children:"SVG"}),(0,a.jsx)("button",{"data-testid":"btn-export-pdf",type:"button",onClick:O,disabled:!G||!O,className:V,children:"PDF"}),(0,a.jsx)("button",{"data-testid":"btn-export-png",type:"button",onClick:U,disabled:!G||!U||!K,className:V,children:"PNG"}),(0,a.jsx)("button",{"data-testid":"btn-export-mxl",type:"button",onClick:z,disabled:!G||!z,className:V,children:"MXL"}),(0,a.jsx)("button",{"data-testid":"btn-export-mscz",type:"button",onClick:X,disabled:!G||!X,className:V,children:"MSCZ"}),(0,a.jsx)("button",{"data-testid":"btn-export-midi",type:"button",onClick:$,disabled:!G||!$,className:V,children:"MIDI"}),(0,a.jsx)("button",{"data-testid":"btn-export-audio",type:"button",onClick:W,disabled:!G||!W||!Q||et,className:V,children:et?"Exporting":"WAV"})]}),(0,a.jsxs)("label",{className:"px-3 py-1 bg-white border border-gray-300 rounded cursor-pointer hover:bg-gray-50",children:["Load SoundFont",(0,a.jsx)("input",{"data-testid":"soundfont-input",type:"file",accept:".sf2,.sf3",onChange:e=>{let t=e.target.files?.[0];t&&H&&H(t)},className:"hidden"})]}),(0,a.jsxs)("div",{className:"flex flex-wrap items-center gap-2 text-sm",children:[(0,a.jsx)("input",{"data-testid":"input-title",type:"text",value:r??"",onChange:e=>l?.(e.target.value),onKeyDown:e=>{"Enter"===e.key&&f&&!to&&(e.preventDefault(),f())},placeholder:"Title",disabled:to||!l,className:"px-2 py-1 bg-white border border-gray-300 rounded disabled:opacity-50 disabled:cursor-not-allowed"}),(0,a.jsx)("button",{"data-testid":"btn-set-title",type:"button",onClick:f,disabled:to||!f,className:"px-3 py-1 bg-white border border-gray-300 rounded hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"Set Title"}),(0,a.jsx)("input",{"data-testid":"input-subtitle",type:"text",value:n??"",onChange:e=>u?.(e.target.value),onKeyDown:e=>{"Enter"===e.key&&p&&!to&&(e.preventDefault(),p())},placeholder:"Subtitle",disabled:to||!u,className:"px-2 py-1 bg-white border border-gray-300 rounded disabled:opacity-50 disabled:cursor-not-allowed"}),(0,a.jsx)("button",{"data-testid":"btn-set-subtitle",type:"button",onClick:p,disabled:to||!p,className:"px-3 py-1 bg-white border border-gray-300 rounded hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"Set Subtitle"}),(0,a.jsx)("input",{"data-testid":"input-composer",type:"text",value:i??"",onChange:e=>c?.(e.target.value),onKeyDown:e=>{"Enter"===e.key&&m&&!to&&(e.preventDefault(),m())},placeholder:"Composer",disabled:to||!c,className:"px-2 py-1 bg-white border border-gray-300 rounded disabled:opacity-50 disabled:cursor-not-allowed"}),(0,a.jsx)("button",{"data-testid":"btn-set-composer",type:"button",onClick:m,disabled:to||!m,className:"px-3 py-1 bg-white border border-gray-300 rounded hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"Set Composer"}),(0,a.jsx)("input",{"data-testid":"input-lyricist",type:"text",value:s??"",onChange:e=>d?.(e.target.value),onKeyDown:e=>{"Enter"===e.key&&h&&!to&&(e.preventDefault(),h())},placeholder:"Lyricist",disabled:to||!d,className:"px-2 py-1 bg-white border border-gray-300 rounded disabled:opacity-50 disabled:cursor-not-allowed"}),(0,a.jsx)("button",{"data-testid":"btn-set-lyricist",type:"button",onClick:h,disabled:to||!h,className:"px-3 py-1 bg-white border border-gray-300 rounded hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"Set Lyricist"}),F&&(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("input",{"data-testid":"input-selected-text",type:"text",value:P,onChange:e=>I?.(e.target.value),onKeyDown:e=>{"Enter"===e.key&&(e.preventDefault(),L?.())},placeholder:"Edit selected text",disabled:R,className:"min-w-[160px] flex-1 px-2 py-1 bg-white border border-gray-300 rounded disabled:opacity-50 disabled:cursor-not-allowed"}),(0,a.jsx)("button",{"data-testid":"btn-apply-selected-text",type:"button",onClick:()=>L?.(),disabled:R||!L,className:"px-3 py-1 bg-white border border-gray-300 rounded hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"Apply"})]})]})]}),(0,a.jsxs)("div",{className:"flex items-center flex-wrap gap-2 text-sm",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("button",{"data-testid":"btn-delete",type:"button",title:"Shortcut: Delete / Backspace",onClick:k,disabled:tn||!k||!M,className:"px-3 py-1 bg-white border border-gray-300 rounded hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"Delete"}),(0,a.jsx)("button",{"data-testid":"btn-undo",type:"button",title:"Shortcut: Ctrl/Cmd + Z",onClick:_,disabled:tn||!_,className:"px-3 py-1 bg-white border border-gray-300 rounded hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"Undo"}),(0,a.jsx)("button",{"data-testid":"btn-redo",type:"button",title:"Shortcut: Ctrl + Y, Cmd + Shift + Z",onClick:S,disabled:tn||!S,className:"px-3 py-1 bg-white border border-gray-300 rounded hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"Redo"})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("span",{className:"inline-flex",title:tn||!M?"Select a note or rest to split the bar.":void 0,children:(0,a.jsx)("button",{"data-testid":"btn-new-line",type:"button",onClick:ep,disabled:tn||!M||!ep,className:"px-3 py-1 bg-white border border-gray-300 rounded hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"New Line"})}),(0,a.jsx)("span",{className:"inline-flex",title:tn||!M?"Select a note or rest to split the bar.":void 0,children:(0,a.jsx)("button",{"data-testid":"btn-new-page",type:"button",onClick:em,disabled:tn||!M||!em,className:"px-3 py-1 bg-white border border-gray-300 rounded hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"New Page"})})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("button",{"data-testid":"btn-add-note-top",type:"button",onClick:eU,disabled:tn||!M||!eU,className:"px-3 py-1 bg-white border border-gray-300 rounded hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"Add Note"}),(0,a.jsx)("button",{"data-testid":"btn-pitch-down",type:"button",title:"Shortcut: Arrow Down (Pitch Down)",onClick:T,disabled:tn||!T||!M,className:"px-3 py-1 bg-white border border-gray-300 rounded hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"Pitch "}),(0,a.jsx)("button",{"data-testid":"btn-pitch-up",type:"button",title:"Shortcut: Arrow Up (Pitch Up)",onClick:E,disabled:tn||!E||!M,className:"px-3 py-1 bg-white border border-gray-300 rounded hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"Pitch "}),(0,a.jsx)("button",{"data-testid":"btn-transpose--12",type:"button",onClick:()=>A?.(-12),title:"Shortcut: Ctrl/Cmd + Arrow Down (Octave Down)",disabled:tn||!M||!A,className:"px-3 py-1 bg-white border border-gray-300 rounded hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"Octave "}),(0,a.jsx)("button",{"data-testid":"btn-transpose-12",type:"button",title:"Shortcut: Ctrl/Cmd + Arrow Up (Octave Up)",onClick:()=>A?.(12),disabled:tn||!M||!A,className:"px-3 py-1 bg-white border border-gray-300 rounded hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"Octave "})]}),(0,a.jsx)(Y,{label:"Accidental",disabled:tn||!M||!j,testId:"dropdown-accidental",children:[{label:"",value:3},{label:"",value:1},{label:"",value:2},{label:"x",value:4},{label:"",value:5},{label:"Clear",value:0}].map(e=>(0,a.jsx)("button",{"data-testid":`btn-acc-${e.value}`,type:"button",onClick:()=>j?.(e.value),disabled:tn||!M||!j,className:V,children:e.label},e.label))}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("button",{"data-testid":"btn-duration-shorter",type:"button",onClick:N,disabled:tn||!N||!M,className:"px-3 py-1 bg-white border border-gray-300 rounded hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"Shorter"}),(0,a.jsx)("button",{"data-testid":"btn-duration-longer",type:"button",onClick:C,disabled:tn||!C||!M,className:"px-3 py-1 bg-white border border-gray-300 rounded hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"Longer"})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2 text-sm",children:[(0,a.jsx)("span",{className:"text-xs font-semibold uppercase tracking-wide text-gray-500",children:"Tempo"}),(0,a.jsx)("input",{"data-testid":"input-tempo-bpm",type:"number",min:1,value:e7,onChange:e=>e9(e.currentTarget.value),onKeyDown:e=>{"Enter"===e.key&&(e.preventDefault(),te())},className:"w-20 px-2 py-1 border border-gray-300 rounded bg-white text-sm focus:outline-none focus:ring-2 focus:ring-blue-500"}),(0,a.jsx)("button",{"data-testid":"btn-tempo-apply",type:"button",onClick:te,disabled:tn||!ek,className:"px-3 py-1 bg-white border border-gray-300 rounded hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"Tempo"})]}),(0,a.jsxs)("div",{className:"flex flex-wrap items-center gap-2 text-sm",children:[(0,a.jsx)("span",{className:"text-xs font-semibold uppercase tracking-wide text-gray-500",children:"Add measures"}),(0,a.jsx)("input",{"data-testid":"input-measure-count",type:"number",min:1,value:e8,onChange:e=>e3(Number(e.currentTarget.value)||1),className:"w-16 px-2 py-1 border border-gray-300 rounded bg-white text-sm focus:outline-none focus:ring-2 focus:ring-blue-500"}),(0,a.jsxs)("select",{value:e5,onChange:e=>e6(e.currentTarget.value),className:"px-2 py-1 border border-gray-300 rounded bg-white text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,a.jsx)("option",{value:"beginning",children:"Beginning"}),(0,a.jsx)("option",{value:"after-selection",children:"After Selection"}),(0,a.jsx)("option",{value:"end",children:"End"})]}),(0,a.jsx)("button",{"data-testid":"btn-insert-measures",type:"button",onClick:()=>{if(!eG)return;let e=Math.max(1,Math.floor(e8));e3(e),eG(e,e5)},disabled:ta,className:"px-3 py-1 bg-white border border-gray-300 rounded hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"Apply"}),(0,a.jsx)("button",{"data-testid":"btn-remove-trailing-empty",type:"button",onClick:eV,disabled:tn||!eV,className:"px-3 py-1 bg-white border border-gray-300 rounded hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"Remove Trailing Empty"})]})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2 text-sm",children:[(0,a.jsx)("button",{"data-testid":"btn-fit-width",type:"button",onClick:v,disabled:!v,className:"px-3 py-1 bg-white border border-gray-300 rounded hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"Fit W"}),(0,a.jsx)("button",{"data-testid":"btn-fit-height",type:"button",onClick:x,disabled:!x,className:"px-3 py-1 bg-white border border-gray-300 rounded hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"Fit H"}),(0,a.jsx)("button",{"data-testid":"btn-zoom-out",type:"button",onClick:b,className:"px-3 py-1 bg-white border border-gray-300 rounded hover:bg-gray-50",children:"-"}),(0,a.jsxs)("span",{className:"w-16 text-center",children:[(100*w).toFixed(0),"%"]}),(0,a.jsx)("button",{"data-testid":"btn-zoom-in",onClick:y,className:"px-3 py-1 bg-white border border-gray-300 rounded hover:bg-gray-50",children:"+"})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2 text-sm",children:[(0,a.jsx)("span",{className:"text-gray-600",children:"Playback:"}),(0,a.jsx)("button",{"data-testid":"btn-play",type:"button",onClick:Z,disabled:!Q||!Z||et,className:"px-3 py-1 bg-white border border-gray-300 rounded hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:et?"Working":ee?"Replay":"Play"}),(0,a.jsx)("button",{"data-testid":"btn-stop",type:"button",onClick:J,disabled:!Q||!J||et,className:"px-3 py-1 bg-white border border-gray-300 rounded hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"Stop"})]}),(0,a.jsxs)(Y,{label:"Instruments",disabled:!G,testId:"dropdown-instruments",children:[(0,a.jsx)("div",{className:q,children:"Add"}),tu?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("select",{value:tc,onChange:e=>e1(e.target.value),disabled:tn,className:"w-full px-2 py-1 border border-gray-300 rounded bg-white text-sm",children:[tl.length>0&&(0,a.jsx)("optgroup",{label:"Common",children:tl.map((e,t)=>(0,a.jsx)("option",{value:e.instrument.id,children:e.label},`common-${e.instrument.id}-${t}`))}),eK.map(e=>(0,a.jsx)("optgroup",{label:e.name,children:e.instruments.map(e=>(0,a.jsx)("option",{value:e.id,children:e.name},e.id))},e.id))]}),(0,a.jsx)("button",{type:"button",onClick:()=>{tc&&eQ&&eQ(tc)},disabled:!td||!tc,className:V,children:"Add Instrument"})]}):(0,a.jsx)("div",{className:"px-2 py-1 text-xs text-gray-500",children:"Instrument list unavailable."}),(0,a.jsx)("div",{className:q,children:"On Score"}),eY.length?eY.map(e=>(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("span",{className:"flex-1 text-sm truncate",children:e.name||e.instrumentName||e.instrumentId}),(0,a.jsx)("button",{"data-testid":`btn-part-visible-${e.index}`,type:"button",onClick:()=>eJ?.(e.index,!e.isVisible),disabled:!tf,className:V,children:e.isVisible?"Hide":"Show"}),(0,a.jsx)("button",{"data-testid":`btn-part-remove-${e.index}`,type:"button",onClick:()=>{if(!eZ)return;let t=e.name||e.instrumentName||"this part";window.confirm(`Remove ${t}?`)&&eZ(e.index)},disabled:!tp,className:V,children:"Remove"})]},`${e.index}-${e.instrumentId}`)):(0,a.jsx)("div",{className:"px-2 py-1 text-xs text-gray-500",children:"No parts loaded."})]}),(0,a.jsx)(Y,{label:"Time Signature",disabled:tn,testId:"dropdown-signature",children:(en??[{label:"Common time",numerator:4,denominator:4,timeSigType:1},{label:"Cut time",numerator:2,denominator:2,timeSigType:2}]).map(e=>{let t=er?()=>er(e.numerator,e.denominator,e.timeSigType):"Common time"===e.label?ea:"Cut time"===e.label?eo:void 0;return(0,a.jsx)("button",{"data-testid":`btn-timesig-${e.numerator}-${e.denominator}`,type:"button",onClick:t,disabled:tn||!t,className:V,children:e.label},e.label)})}),(0,a.jsxs)("div",{className:"flex items-center gap-2 text-sm",children:[(0,a.jsx)("span",{className:"text-gray-600",children:"Custom Time:"}),(0,a.jsx)("input",{"data-testid":"input-timesig-numerator",type:"number",min:1,value:e2,onChange:e=>e4(e.target.value),disabled:!tm,className:"w-16 px-2 py-1 border border-gray-300 rounded bg-white text-sm disabled:opacity-50 disabled:cursor-not-allowed"}),(0,a.jsx)("span",{className:"text-gray-500",children:"/"}),(0,a.jsx)("input",{"data-testid":"input-timesig-denominator",type:"number",min:1,value:tt,onChange:e=>tr(e.target.value),disabled:!tm,className:"w-16 px-2 py-1 border border-gray-300 rounded bg-white text-sm disabled:opacity-50 disabled:cursor-not-allowed"}),(0,a.jsx)("button",{"data-testid":"btn-timesig-custom",type:"button",onClick:()=>{er&&ty&&er(th,tg)},disabled:!tm||!ty,className:"px-2 py-1 text-sm border border-gray-300 rounded bg-white hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"Apply"})]}),(0,a.jsxs)(Y,{label:"Key",disabled:tn||!ei,testId:"dropdown-key",children:[(0,a.jsx)("div",{className:q,children:"Major"}),(es??[{label:"C",fifths:0},{label:"G",fifths:1},{label:"D",fifths:2},{label:"A",fifths:3},{label:"E",fifths:4},{label:"B",fifths:5},{label:"F#",fifths:6},{label:"C#",fifths:7},{label:"F",fifths:-1},{label:"Bb",fifths:-2},{label:"Eb",fifths:-3},{label:"Ab",fifths:-4},{label:"Db",fifths:-5},{label:"Gb",fifths:-6},{label:"Cb",fifths:-7}]).map(e=>(0,a.jsx)("button",{"data-testid":`btn-keysig-${e.fifths}`,type:"button",onClick:()=>ei?.(e.fifths),disabled:tn||!ei,className:V,children:e.label},e.fifths))]}),(0,a.jsxs)(Y,{label:"Clef",disabled:tn||!el,testId:"dropdown-clef",children:[(0,a.jsx)("div",{className:q,children:"Common"}),(eu??[{label:"Treble",value:0},{label:"Bass",value:20},{label:"French Violin",value:7},{label:"Treble 15mb",value:1},{label:"Treble 8vb",value:2},{label:"Treble 8va",value:3},{label:"Treble 15ma",value:4},{label:"Treble 8vb (O)",value:5},{label:"Treble 8vb (P)",value:6},{label:"Soprano",value:8},{label:"Mezzo",value:9},{label:"Alto",value:10},{label:"Tenor",value:11},{label:"Baritone",value:12},{label:"C (19c)",value:13},{label:"C1 (F18c)",value:14},{label:"C3 (F18c)",value:15},{label:"C4 (F18c)",value:16},{label:"C1 (F20c)",value:17},{label:"C3 (F20c)",value:18},{label:"C4 (F20c)",value:19},{label:"Bass 15mb",value:21},{label:"Bass 8vb",value:22},{label:"Bass 8va",value:23},{label:"Bass 15ma",value:24},{label:"F (B)",value:25},{label:"F (C)",value:26},{label:"F (F18c)",value:27},{label:"F (19c)",value:28},{label:"Perc",value:29},{label:"Perc 2",value:30},{label:"TAB",value:31},{label:"TAB4",value:32},{label:"TAB Serif",value:33},{label:"TAB4 Serif",value:34}]).map(e=>(0,a.jsx)("button",{"data-testid":`btn-clef-${e.value}`,type:"button",onClick:()=>el?.(e.value),disabled:tn||!el,className:V,children:e.label},e.value))]}),(0,a.jsxs)(Y,{label:"Repeats/Barlines",disabled:tn||!M,testId:"dropdown-repeats",children:[(0,a.jsx)("div",{className:q,children:"Repeats"}),(0,a.jsx)("button",{"data-testid":"btn-repeat-start",type:"button",onClick:ez,disabled:tn||!M||!ez,className:V,children:"Start Repeat"}),(0,a.jsx)("button",{"data-testid":"btn-repeat-end",type:"button",onClick:eX,disabled:tn||!M||!eX,className:V,children:"End Repeat"}),(0,a.jsx)("div",{className:q,children:"Repeat Count"}),[{label:"2x",count:2},{label:"3x",count:3},{label:"4x",count:4}].map(e=>(0,a.jsx)("button",{"data-testid":`btn-repeat-count-${e.count}`,type:"button",onClick:()=>e$?.(e.count),disabled:tn||!M||!e$,className:V,children:e.label},e.count)),(0,a.jsx)("div",{className:q,children:"Barlines"}),[{label:"Normal",value:1},{label:"Double",value:2},{label:"Final",value:32},{label:"Heavy",value:512},{label:"Heavy-Heavy",value:1024},{label:"Dashed",value:16},{label:"Dotted",value:128},{label:"Reverse Final",value:256}].map(e=>(0,a.jsx)("button",{"data-testid":`btn-barline-${e.value}`,type:"button",onClick:()=>eW?.(e.value),disabled:tn||!M||!eW,className:V,children:e.label},e.value)),(0,a.jsx)("div",{className:q,children:"Voltas"}),[{label:"1st Ending",ending:1},{label:"2nd Ending",ending:2}].map(e=>(0,a.jsx)("button",{"data-testid":`btn-volta-${e.ending}`,type:"button",onClick:()=>eH?.(e.ending),disabled:tn||!M||!eH,className:V,children:e.label},e.ending))]}),(0,a.jsx)(Y,{label:"Grace Notes",disabled:tn,testId:"dropdown-grace-notes",children:[{label:"Acciaccatura",value:1,testId:"btn-grace-acciaccatura"},{label:"Appoggiatura",value:2,testId:"btn-grace-appoggiatura"},{label:"Grace 16th",value:8,testId:"btn-grace-16"},{label:"Grace 32nd",value:16,testId:"btn-grace-32"},{label:"Grace 8th After",value:32,testId:"btn-grace-8-after"},{label:"Grace 16th After",value:64,testId:"btn-grace-16-after"},{label:"Grace 32nd After",value:128,testId:"btn-grace-32-after"}].map(e=>(0,a.jsx)("button",{"data-testid":e.testId,type:"button",onClick:()=>eB?.(e.value),disabled:tn||!M||!eB,className:V,children:e.label},e.value))}),(0,a.jsxs)(Y,{label:"Rhythm",disabled:tn,testId:"dropdown-rhythm",children:[(0,a.jsx)("div",{className:q,children:"Notes"}),(0,a.jsx)("button",{"data-testid":"btn-add-note-dropdown",type:"button",onClick:eU,disabled:tn||!M||!eU,className:V,children:"Add Note"}),(0,a.jsx)("div",{className:q,children:"Duration"}),[{label:"32nd",value:7,shortcut:"2",testId:"btn-duration-32"},{label:"16th",value:6,shortcut:"3",testId:"btn-duration-16"},{label:"8th",value:5,shortcut:"4",testId:"btn-duration-8"},{label:"Quarter",value:4,shortcut:"5",testId:"btn-duration-4"},{label:"Half",value:3,shortcut:"6",testId:"btn-duration-2"},{label:"Whole",value:2,shortcut:"7",testId:"btn-duration-1"}].map(e=>(0,a.jsx)("button",{"data-testid":e.testId,type:"button",onClick:()=>ef?.(e.value),disabled:tn||!M||!ef,className:V,title:`Shortcut: press ${e.shortcut} for ${e.label}`,children:e.label},e.value)),(0,a.jsx)("div",{className:q,children:"Dots"}),(0,a.jsx)("button",{"data-testid":"btn-dot",type:"button",onClick:ec,disabled:tn||!M||!ec,className:V,children:"Dot"}),(0,a.jsx)("button",{"data-testid":"btn-double-dot",type:"button",onClick:ed,disabled:tn||!M||!ed,className:V,children:"Double Dot"}),(0,a.jsx)("div",{className:q,children:"Tuplets"}),[{label:"Duplet",count:2},{label:"Triplet",count:3},{label:"Quintuplet",count:5},{label:"Sextuplet",count:6},{label:"Septuplet",count:7},{label:"Octuplet",count:8}].map(e=>(0,a.jsx)("button",{"data-testid":`btn-tuplet-${e.count}`,type:"button",onClick:()=>eO?.(e.count),disabled:tn||!M||!eO,className:V,children:e.label},e.count))]}),(0,a.jsx)(Y,{label:"Voice",disabled:tn,testId:"dropdown-voice",children:[1,2,3,4].map(e=>(0,a.jsxs)("button",{"data-testid":`btn-voice-${e}`,type:"button",onClick:()=>eh?.(e-1),disabled:tn||!eh,className:V,children:["Voice ",e]},e))}),(0,a.jsxs)(Y,{label:"Slur/Tie",disabled:tn||!M,testId:"dropdown-slur-tie",children:[(0,a.jsx)("button",{"data-testid":"btn-slur",type:"button",onClick:eL,disabled:tn||!M||!eL,className:V,children:"Slur"}),(0,a.jsx)("button",{"data-testid":"btn-tie",type:"button",onClick:eR,disabled:tn||!M||!eR,className:V,children:"Tie"})]}),(0,a.jsxs)(Y,{label:"Markings",disabled:tn,testId:"dropdown-markings",children:[(0,a.jsx)("div",{className:q,children:"Dynamics"}),[{label:"p",value:6},{label:"mp",value:7},{label:"mf",value:8},{label:"f",value:9},{label:"pp",value:5},{label:"ff",value:10},{label:"ppp",value:4},{label:"fff",value:11},{label:"pppp",value:3},{label:"ffff",value:12},{label:"ppppp",value:2},{label:"fffff",value:13},{label:"pppppp",value:1},{label:"ffffff",value:14},{label:"fp",value:15},{label:"pf",value:16},{label:"sf",value:17},{label:"sfz",value:18},{label:"sff",value:19},{label:"sffz",value:20},{label:"sfp",value:21},{label:"sfpp",value:22},{label:"rfz",value:23},{label:"rf",value:24},{label:"fz",value:25},{label:"m",value:26},{label:"r",value:27},{label:"s",value:28},{label:"z",value:29},{label:"n",value:30}].map(e=>(0,a.jsx)("button",{"data-testid":`btn-dynamic-${e.value}`,type:"button",onClick:()=>eg?.(e.value),disabled:tn||!M||!eg,className:V,children:e.label},e.label)),(0,a.jsx)("div",{className:q,children:"Hairpins"}),[{label:"Crescendo",value:0,testId:"btn-hairpin-cresc"},{label:"Decrescendo",value:1,testId:"btn-hairpin-decresc"}].map(e=>(0,a.jsx)("button",{"data-testid":e.testId,type:"button",onClick:()=>ey?.(e.value),disabled:tn||!M||!ey,className:V,children:e.label},e.label))]}),(0,a.jsxs)(Y,{label:"Pedal",disabled:tn,testId:"dropdown-pedal",children:[[{label:"Pedal Line",value:0,testId:"btn-pedal-line"},{label:"Ped. *",value:1,testId:"btn-pedal-text"}].map(e=>(0,a.jsx)("button",{"data-testid":e.testId,type:"button",onClick:()=>eb?.(e.value),disabled:tn||!M||!eb,className:V,children:e.label},e.label)),(0,a.jsx)("div",{className:q,children:"Special"}),(0,a.jsx)("button",{"data-testid":"btn-pedal-sostenuto",type:"button",onClick:ev,disabled:tn||!M||!ev,className:V,children:"Sostenuto Pedal"}),(0,a.jsx)("button",{"data-testid":"btn-pedal-una-corda",type:"button",onClick:ex,disabled:tn||!M||!ex,className:V,children:"Una Corda"}),(0,a.jsx)("div",{className:q,children:"Variants"}),(0,a.jsx)("button",{"data-testid":"btn-pedal-split",type:"button",onClick:ew,disabled:tn||!M||!ew,className:V,children:"Pedal Change"})]}),(0,a.jsxs)(Y,{label:"Text",disabled:tn||!M,testId:"dropdown-text",children:[(0,a.jsx)("button",{"data-testid":"btn-text-staff",type:"button",onClick:e_,disabled:tn||!M||!e_,className:V,children:"Staff Text"}),(0,a.jsx)("button",{"data-testid":"btn-text-system",type:"button",onClick:eS,disabled:tn||!M||!eS,className:V,children:"System Text"}),(0,a.jsx)("button",{"data-testid":"btn-text-expression",type:"button",onClick:eE,disabled:tn||!M||!eE,className:V,children:"Expression Text"}),(0,a.jsx)("button",{"data-testid":"btn-text-lyrics",type:"button",onClick:eT,disabled:tn||!M||!eT,className:V,children:"Lyrics"}),(0,a.jsx)("div",{className:q,children:"Harmony"}),(0,a.jsx)("button",{"data-testid":"btn-text-harmony-standard",type:"button",onClick:()=>eC?.(0),disabled:tn||!M||!eC,className:V,children:"Chord Symbol"}),(0,a.jsx)("button",{"data-testid":"btn-text-harmony-roman",type:"button",onClick:()=>eC?.(1),disabled:tn||!M||!eC,className:V,children:"Roman Numeral"}),(0,a.jsx)("button",{"data-testid":"btn-text-harmony-nashville",type:"button",onClick:()=>eC?.(2),disabled:tn||!M||!eC,className:V,children:"Nashville Number"}),(0,a.jsx)("div",{className:q,children:"Figured Bass"}),(0,a.jsx)("button",{"data-testid":"btn-text-figured-bass",type:"button",onClick:eP,disabled:tn||!M||!eP,className:V,children:"Figured Bass"}),(0,a.jsx)("div",{className:q,children:"Fingering"}),(0,a.jsx)("button",{"data-testid":"btn-text-fingering",type:"button",onClick:eN,disabled:tn||!M||!eN,className:V,children:"Fingering"}),(0,a.jsx)("button",{"data-testid":"btn-text-fingering-lh",type:"button",onClick:eA,disabled:tn||!M||!eA,className:V,children:"LH Guitar Fingering"}),(0,a.jsx)("button",{"data-testid":"btn-text-fingering-rh",type:"button",onClick:ej,disabled:tn||!M||!ej,className:V,children:"RH Guitar Fingering"}),(0,a.jsx)("button",{"data-testid":"btn-text-string-number",type:"button",onClick:eD,disabled:tn||!M||!eD,className:V,children:"String Number"}),(0,a.jsx)("div",{className:q,children:"Sticking"}),(0,a.jsx)("button",{"data-testid":"btn-text-sticking",type:"button",onClick:eF,disabled:tn||!M||!eF,className:V,children:"Sticking"}),(0,a.jsx)("div",{className:q,children:"Instrument"}),(0,a.jsx)("button",{"data-testid":"btn-text-instrument-change",type:"button",onClick:eM,disabled:tn||!M||!eM,className:V,children:"Instrument Change"})]}),(0,a.jsx)(Y,{label:"Articulations",disabled:tn||!M,testId:"dropdown-articulations",children:[{label:"Staccato",symbol:"articStaccatoAbove"},{label:"Tenuto",symbol:"articTenutoAbove"},{label:"Marcato",symbol:"articMarcatoAbove"},{label:"Accent",symbol:"articAccentAbove"}].map(e=>(0,a.jsx)("button",{"data-testid":`btn-artic-${e.symbol}`,type:"button",onClick:()=>eI?.(e.symbol),disabled:tn||!M||!eI,className:V,children:e.label},e.symbol))}),(0,a.jsx)(Y,{label:"Shortcuts",testId:"dropdown-shortcuts",children:[{label:"Delete: Delete / Backspace",title:"Shortcut: Delete / Backspace"},{label:"Undo: Ctrl/Cmd + Z",title:"Shortcut: Ctrl/Cmd + Z"},{label:"Redo: Ctrl + Y, Cmd + Shift + Z",title:"Shortcut: Ctrl + Y, Cmd + Shift + Z"},{label:"Pitch: Arrow Up/Down",title:"Shortcut: Arrow Up/Down"},{label:"Octave: Ctrl/Cmd + Arrow Up/Down",title:"Shortcut: Ctrl/Cmd + Arrow Up/Down"},{label:"Duration numbers: 1=64th, 2=32nd, 3=16th, 4=8th, 5=Quarter, 6=Half, 7=Whole, 8=Breve",title:"Shortcut: Press 1-8 to respell the selected note's duration"},{label:"Pitch letters: A-G (Shift to add to chord)",title:"Shortcut: Press A-G to respell pitch, hold Shift to add another pitch to the chord"},{label:"Rest: 0 (insert rest)",title:"Shortcut: Press 0 to insert a rest instead of a note"},{label:"Copy: Ctrl/Cmd + C",title:"Shortcut: Ctrl/Cmd + C"},{label:"Paste: Ctrl/Cmd + V",title:"Shortcut: Ctrl/Cmd + V"}].map(e=>(0,a.jsx)("div",{className:"px-3 py-1 text-sm text-gray-700",title:e.title,children:e.label},e.label))})]})};var Q=r(1463);let Z={beginning:2,"after-selection":0,end:3},J=["Text","RehearsalMark","StaffText","SystemText","ExpressionText","LyricText","HarmonyText","FingeringText","LeftHandGuitarFingeringText","RightHandGuitarFingeringText","StringNumberText","InstrumentChangeText","StickingText","FiguredBassText","TempoText"],ee=[".Note",".Rest",".Chord",".LayoutBreak",".Pedal",".PedalSegment",J.map(e=>`.${e}`).join(", ")].filter(Boolean).join(", "),et=new Set(["Note","Rest","Chord","LayoutBreak","Pedal","PedalSegment",...J]),er=new Set(J),en=e=>!!e&&e.split(/\s+/).some(e=>et.has(e)),ea=e=>!!e&&e.split(/\s+/).some(e=>er.has(e)),eo=e=>{if(!e)return!1;if(ea(e.getAttribute("class")))return!0;let t=e.tagName?.toLowerCase();return"text"===t||"tspan"===t||!!e.closest?.("text")},ei=(e,t)=>{if(!eo(e))return t;let r=t.split(/\s+/).filter(Boolean);return r.includes("Text")?t:[...r,"Text"].join(" ").trim()||"Text"},es=e=>"tspan"===e.tagName?.toLowerCase()?e.closest?.("text")??e:e,el=e=>!!e&&!!(e.deleteSelection||e.undo||e.redo||e.pitchUp||e.pitchDown||e.doubleDuration||e.halfDuration);function eu(){let e=(0,i.useSearchParams)(),[t,r]=(0,o.useState)(null),n=(0,o.useRef)(null),[s,l]=(0,o.useState)(1),u=(0,o.useRef)(null),c=(0,o.useRef)(null),d=(0,o.useRef)(null),f=e=>Math.min(Math.max(e,.5),3),[p,m]=(0,o.useState)(!1),[h,g]=(0,o.useState)(null),[y,b]=(0,o.useState)(null),[v,x]=(0,o.useState)(null),[w,k]=(0,o.useState)([]),[_,S]=(0,o.useState)(!1),[E,T]=(0,o.useState)(""),[C,N]=(0,o.useState)(""),[j,D]=(0,o.useState)(null),[R,B]=(0,o.useState)(null),[O,U]=(0,o.useState)(null),z=(0,o.useRef)(!1),X=(0,o.useRef)(null),$=(0,o.useRef)(null),W=(0,o.useRef)(null),H=(0,o.useRef)(null),V=(0,o.useRef)(!1),q=(0,o.useRef)(!1),Y=(0,o.useRef)(!1),J=(0,o.useRef)(!1),et=(0,o.useRef)(0),[er,eu]=(0,o.useState)(!1),[ec,ed]=(0,o.useState)(!1),[ef,ep]=(0,o.useState)(!1),[em,eh]=(0,o.useState)(""),[eg,ey]=(0,o.useState)(""),[eb,ev]=(0,o.useState)(""),[ex,ew]=(0,o.useState)(""),[ek,e_]=(0,o.useState)([]),[eS,eE]=(0,o.useState)([]),[eT,eC]=(0,o.useState)([]),[eN,eA]=(0,o.useState)(""),[ej,eD]=(0,o.useState)(!1),[eM,eF]=(0,o.useState)(!1),[eP,eI]=(0,o.useState)(null),[eL,eR]=(0,o.useState)(null),[eB,eO]=(0,o.useState)(!1),[eU,ez]=(0,o.useState)("checkpoints"),[eX,e$]=(0,o.useState)([]),[eW,eH]=(0,o.useState)(!1),[eG,eV]=(0,o.useState)(null),[eq,eY]=(0,o.useState)(!1),[eK,eQ]=(0,o.useState)(!1),[eZ,eJ]=(0,o.useState)("closed"),[e0,e1]=(0,o.useState)("xml"),[e2,e4]=(0,o.useState)(""),[e8,e3]=(0,o.useState)(!1),[e5,e6]=(0,o.useState)(!1),[e7,e9]=(0,o.useState)(null),[te,tt]=(0,o.useState)(""),[tr,tn]=(0,o.useState)(""),[ta,to]=(0,o.useState)(""),[ti,ts]=(0,o.useState)(!0),[tl,tu]=(0,o.useState)("auto"),[tc,td]=(0,o.useState)(4096),[tf,tp]=(0,o.useState)(""),[tm,th]=(0,o.useState)(null),[tg,ty]=(0,o.useState)(null),[tb,tv]=(0,o.useState)(""),[tx,tw]=(0,o.useState)(!1),[tk,t_]=(0,o.useState)(null),[tS,tE]=(0,o.useState)([]),[tT,tC]=(0,o.useState)(!1),[tN,tA]=(0,o.useState)(null),[tj,tD]=(0,o.useState)(0),[tM,tF]=(0,o.useState)(1),[tP,tI]=(0,o.useState)(""),[tL,tR]=(0,o.useState)(!1),[tB,tO]=(0,o.useState)(""),[tU,tz]=(0,o.useState)(""),[tX,t$]=(0,o.useState)([]),[tW,tH]=(0,o.useState)(""),[tG,tV]=(0,o.useState)(4),[tq,tY]=(0,o.useState)(0),[tK,tQ]=(0,o.useState)(4),[tZ,tJ]=(0,o.useState)(4),[t0,t1]=(0,o.useState)(null),[t2,t4]=(0,o.useState)(null),[t8,t3]=(0,o.useState)([]),[t5,t6]=(0,o.useState)(null),t7=(0,o.useRef)(null),[t9,re]=(0,o.useState)(!1),[rt,rr]=(0,o.useState)(!1),rn=(0,o.useRef)(null),ra=(0,o.useRef)(null),ro=(0,o.useRef)([]),ri=(0,o.useRef)(null),rs=(0,o.useRef)(null),rl=(0,o.useRef)(tj),ru="ots_openai_api_key",rc=(0,o.useRef)(!0);(0,o.useEffect)(()=>{n.current=t},[t]),(0,o.useEffect)(()=>{rl.current=tj},[tj]),(0,o.useEffect)(()=>{let e=window.localStorage.getItem(ru);e&&tn(e)},[]),(0,o.useEffect)(()=>{tr.trim()?window.localStorage.setItem(ru,tr):window.localStorage.removeItem(ru)},[tr]),(0,o.useEffect)(()=>{let e=!1;return t&&E.includes("LayoutBreak")?((async()=>{let r,n=await t.selectionMimeData?.();if(e)return;if(!n)return D(null);try{r=new TextDecoder().decode(n)}catch(e){console.warn("Failed to decode selection MIME data",e),D(null);return}let a=r.match(/<subtype>([^<]+)<\/subtype>/);a&&("line"===a[1]||"page"===a[1])?D(a[1]):D(null)})(),()=>{e=!0}):void D(null)},[t,E]),(0,o.useEffect)(()=>{let e=ea(E)||!!R;if(!t||!e)return void N("");let r=!1,n=new TextDecoder,a="u">typeof DOMParser?new DOMParser:null;return(async()=>{let e;if(!t.selectionMimeData||!a)return N("");let o=await t.selectionMimeData?.();if(r)return;if(!o)return N("");try{e=n.decode(o)}catch(e){console.warn("Failed to decode text selection MIME data",e),N("");return}let i=a.parseFromString(e,"application/xml").querySelector("text");N((i?.textContent??"").trim())})(),()=>{r=!0}},[t,E,R]);let rd=e=>new Date(e).toLocaleString(),rf=(e,t)=>{let r=e.trim();if(r)return r;let n=t.trim()||"Untitled Score";return`${n} ${rd(Date.now())}`},rp=e=>{let t=e.replace(/[\\/:*?"<>|]+/g,"_").trim();return t.length>0?t.slice(0,64):"checkpoint"},rm=e=>{let t=new URL(window.location.href);t.searchParams.set("scoreId",e),t.searchParams.delete("score"),window.history.replaceState({},"",t.toString())},rh=e=>{if(tP)return tP;let t=`${e}:${crypto.randomUUID()}`;return tI(t),rm(t),t},rg=e=>e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;"),ry=eS.length>0?eS:t8,rb=(0,o.useMemo)(()=>ry.length?ry.flatMap(e=>e.instruments.map(t=>({id:t.id,name:t.name,label:e.name?`${t.name} (${e.name})`:t.name}))):[{id:"piano",name:"Piano",label:"Piano"},{id:"violin",name:"Violin",label:"Violin"},{id:"flute",name:"Flute",label:"Flute"},{id:"guitar",name:"Guitar",label:"Guitar"},{id:"voice",name:"Voice",label:"Voice"}],[ry]),rv=(0,o.useMemo)(()=>[{key:"piano",ids:["piano"]},{key:"violin",ids:["violin"]},{key:"viola",ids:["viola"]},{key:"cello",ids:["violoncello","cello"]},{key:"double-bass",ids:["double-bass","contrabass"],label:"Double Bass"},{key:"flute",ids:["flute"]},{key:"oboe",ids:["oboe"]},{key:"clarinet",ids:["clarinet"],label:"Clarinet"},{key:"bassoon",ids:["bassoon"]},{key:"trumpet",ids:["trumpet"],label:"Trumpet"},{key:"horn",ids:["horn"]},{key:"trombone",ids:["trombone"]},{key:"tuba",ids:["tuba"]},{key:"alto-saxophone",ids:["alto-saxophone"]},{key:"tenor-saxophone",ids:["tenor-saxophone"]},{key:"bass-guitar",ids:["bass-guitar"]},{key:"guitar",ids:["guitar-nylon","guitar-steel"]},{key:"voice",ids:["voice"]},{key:"drumset",ids:["drumset"]}],[]),rx=(0,o.useMemo)(()=>{let e=[],t=new Set;for(let r of rv){let n=r.ids.map(e=>rb.find(t=>t.id===e)).find(Boolean);n&&!t.has(n.id)&&(t.add(n.id),e.push({instrument:n,label:r.label??n.name}))}return e},[rv,rb]),rw={G:{sign:"G",line:2},G8va:{sign:"G",line:2,octave:1},G8vb:{sign:"G",line:2,octave:-1},G15ma:{sign:"G",line:2,octave:2},F:{sign:"F",line:4},F8va:{sign:"F",line:4,octave:1},F8vb:{sign:"F",line:4,octave:-1},F15ma:{sign:"F",line:4,octave:2},C1:{sign:"C",line:1},C2:{sign:"C",line:2},C3:{sign:"C",line:3},C4:{sign:"C",line:4},C5:{sign:"C",line:5},PERC:{sign:"percussion",line:2}},rk=async e=>e?e instanceof Uint8Array?e:e instanceof ArrayBuffer?new Uint8Array(e):ArrayBuffer.isView(e)?new Uint8Array(e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength)):"string"==typeof e?new TextEncoder().encode(e):e instanceof Blob?new Uint8Array(await e.arrayBuffer()):(console.warn("Unexpected saveXml response type",e),null):null,r_=(0,o.useCallback)(async()=>{let e=n.current??t;if(!e?.saveXml)return alert('This build of webmscore does not expose "saveXml".'),null;let r=await e.saveXml();return await rk(r)},[t]),rS=(0,o.useCallback)(async()=>{if(!t){e4(""),e3(!1),eQ(!1);return}e6(!0),e9(null);try{let e=await r_();if(!e)return;let t=new TextDecoder().decode(e);e4(t),e3(!1),eQ(!1)}catch(e){console.error("Failed to load MusicXML",e),e9("Unable to load MusicXML from the current score.")}finally{e6(!1)}},[t,r_]),rE=(0,o.useCallback)(async()=>{if(e2.trim())return e2;let e=await r_();if(!e)return"";let t=new TextDecoder().decode(e);return e4(t),e3(!1),eQ(!1),t},[e2,r_]),rT=async()=>{if(!("u">typeof indexedDB))return alert("IndexedDB is not available; cannot verify checkpoint status."),{ok:!1,currentXml:""};let e=await r_();if(!e)return alert("Unable to read MusicXML for checkpointing."),{ok:!1,currentXml:""};let t=rh("score"),r=new TextDecoder,n=r.decode(e),a=eT[0],o=!0;if(a){let e=await P(a.id);e&&(o=n!==r.decode(new Uint8Array(e.data)))}if(o){let r=e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength),n=rf("","Auto checkpoint");await M({title:n,createdAt:Date.now(),format:"musicxml",data:r,size:e.byteLength,scoreId:t}),eY(!1),await rA()}return{ok:!0,currentXml:n}},rC=async e=>{if(!t)return void alert("Load a score before applying XML edits.");if(!e.trim())return void alert("XML content is empty.");let r=await rT();if(!r.ok)return;let n=r.currentXml.trim()!==e.trim(),a=new TextEncoder().encode(e),o=em?rp(em):"score",i=new File([a],`${o}.musicxml`,{type:"application/xml"});e3(!1),await rM(i,{preserveScoreId:!0,updateUrl:!1}),eY(n),eQ(!1)},rN=(0,o.useCallback)(async()=>{if(!("u">typeof indexedDB)){e$([]),eV("IndexedDB is not available in this browser.");return}eH(!0);try{let e=await L(),t=e;tP&&!e.some(e=>e.scoreId===tP)&&(t=[{scoreId:tP,title:em||"Current score",lastUpdated:Date.now(),count:0},...e]),e$(t),eV(null)}catch(e){console.warn("Failed to load score summaries",e),e$([]),eV("Unable to load scores from browser storage.")}finally{eH(!1)}},[tP,em]),rA=(0,o.useCallback)(async()=>{if(!("u">typeof indexedDB))return void eI("IndexedDB is not available in this browser.");if(!tP)return void eC([]);eF(!0);try{let e=await F(tP);eC(e),eI(null)}catch(e){console.warn("Failed to load checkpoints",e),eI("Unable to load checkpoints from browser storage.")}finally{eF(!1),rN()}},[tP,rN]),rj=e=>{window.__webmscore=e};(0,o.useEffect)(()=>{rA()},[rA]),(0,o.useEffect)(()=>{rN()},[rN]),(0,o.useEffect)(()=>{let t=e.get("scoreId"),r=e.get("score"),n=t||(r?`url:${r}`:"");n&&n!==tP&&tI(n)},[e,tP]),(0,o.useEffect)(()=>{if(!t){e4(""),e3(!1);return}e8||rS()},[t,e8,rS]),(0,o.useEffect)(()=>{"assistant"===e0&&ti&&!e2.trim()&&rS()},[e0,ti,e2,rS]),(0,o.useEffect)(()=>{let e=tr.trim();if(!e){tE([]),tA(null);return}let t=!1;return tC(!0),tA(null),(async()=>{try{let r=await fetch("https://api.openai.com/v1/models",{headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"}});if(!r.ok){let e=await r.text();throw Error(e||"Failed to load models.")}let n=await r.json(),a=Array.isArray(n?.data)?n.data.map(e=>e?.id).filter(e=>"string"==typeof e):[];if(t)return;let o=a.filter(e=>/^gpt-|^o/.test(e)),i=[...new Set(o.length?o:a)].sort();if(tE(i),!te||!i.includes(te)){let e=i.find(e=>"gpt-5.2"===e)||i[0]||"";tt(e)}}catch(e){t||(console.error("Failed to load OpenAI models",e),tE([]),tA("Failed to load models. Check your API key."))}finally{t||tC(!1)}})(),()=>{t=!0}},[tr,te]),(0,o.useEffect)(()=>{if(!tL||0===rb.length)return;let e=rb[0].id;tW&&rb.some(e=>e.id===tW)||tH(e),0===tX.length&&t$([e])},[tL,tX.length,rb,tW]),(0,o.useEffect)(()=>{tL&&t&&(eS.length>0||rL(t))},[tL,eS.length,t]),(0,o.useEffect)(()=>{if(!tL||t0)return;let e=!1;return(async()=>{try{let t=await fetch("/score-editor/data/clefs.json");if(!t.ok)throw Error("Failed to load clef map.");let r=await t.json();e||(t1(r?.map??null),t4(null))}catch(t){e||(console.warn("Failed to load instrument clefs",t),t1(null),t4("Unable to load clef defaults. Using treble clef."))}})(),()=>{e=!0}},[tL,t0]),(0,o.useEffect)(()=>{if(!tL||eS.length>0||t8.length>0)return;let e=!1;return(async()=>{try{let t=await fetch("/score-editor/data/templates.json");if(!t.ok)throw Error("Failed to load instrument templates.");let r=await t.json();if(!e){let e=Array.isArray(r?.groups)?r.groups:[];t3(e),t6(e.length>0?null:"No instruments found.")}}catch(t){e||(console.warn("Failed to load fallback instruments",t),t3([]),t6("Unable to load instrument list."))}})(),()=>{e=!0}},[tL,eS.length,t8.length]),(0,o.useEffect)(()=>{let t=new AbortController;return(async()=>{try{if(await A(),t.signal.aborted)return;console.log("webmscore initialized");let r=e.get("score");r&&await rD(r,t.signal)}catch(e){t.signal.aborted||console.error("Failed to initialize webmscore",e)}})(),()=>t.abort()},[e]);let rD=async(n,a)=>{if(a?.aborted)return;let o=e.get("scoreId")||`url:${n}`;o!==tP&&tI(o),m(!0),g(null),k([]),b(null),x(null),T(""),D(null),eu(!1),ed(!1),ep(!1),eY(!1),eQ(!1),e4(""),e3(!1),e9(null),eh(""),ey(""),ev(""),ew(""),e_([]),eE([]),tD(0),tF(1),rc.current=!0;try{let e=await fetch(n,a?{signal:a}:void 0);if(!e.ok)throw Error("Failed to fetch score");let o=await e.arrayBuffer(),i=new Uint8Array(o),s=await A(),l="mscz";(n.endsWith(".xml")||n.endsWith(".musicxml"))&&(l="musicxml"),t&&t.destroy();let u=await s.load(l,i);if(a?.aborted)return void u.destroy();r(u),rj(u),el(u)||console.warn("Mutation APIs not detected on loaded score; enabling toolbar anyway."),eu(!0);let c=await rF(u,0);await rP(u,c),rc.current&&1?window.requestAnimationFrame(()=>{window.requestAnimationFrame(()=>{nB(),rc.current=!1})}):(nB(),rc.current=!1),await rI(u),await rL(u),u.saveAudio&&await rR(u)}catch(e){console.error("Error auto-loading file:",e)}finally{a?.aborted||m(!1)}},rM=async(e,n)=>{m(!0);let a=n?.updateUrl??!0,o=tP;n?.scoreIdOverride?o=n.scoreIdOverride:n?.preserveScoreId||(o=`file:${e.name}:${e.lastModified}`),o&&o!==tP&&(tI(o),a&&rm(o)),g(null),k([]),b(null),x(null),T(""),D(null),eu(!1),ed(!1),ep(!1),eY(!1),eQ(!1),e4(""),e3(!1),e9(null),eh(""),ey(""),ev(""),ew(""),e_([]),eE([]),rc.current=!0;try{let n=await e.arrayBuffer(),a=new Uint8Array(n),o=await A(),i=e.name.toLowerCase(),s="mscz";(i.endsWith(".xml")||i.endsWith(".musicxml"))&&(s="musicxml"),t&&t.destroy();let l=await o.load(s,a);r(l),rj(l),el(l)||console.warn("Mutation APIs not detected on loaded score; enabling toolbar anyway."),eu(!0);let u=await rF(l,0);await rP(l,u),rc.current&&1?window.requestAnimationFrame(()=>{window.requestAnimationFrame(()=>{nB(),rc.current=!1})}):(nB(),rc.current=!1),await rI(l),await rL(l),l.saveAudio&&await rR(l)}catch(e){console.error("Error loading file:",e),alert("Failed to load score. See console for details.")}finally{m(!1)}},rF=async(e,t=rl.current)=>{if(!e?.npages)return tF(1),tD(0),0;try{let r=Math.max(1,await e.npages()),n=Math.max(0,Math.min(t,r-1));return tF(r),tD(n),n}catch(e){return console.warn("Failed to read page count:",e),tF(1),tD(0),0}},rP=async(e,t)=>{if(e&&u.current)try{let r="number"==typeof t?t:tj,n=await e.saveSvg(r,!0,!0);n&&(u.current.innerHTML=n)}catch(e){console.error("Error rendering score:",e)}},rI=async e=>{try{let t=await e.metadata();eh("string"==typeof t.title?t.title:""),ey("string"==typeof t.subtitle?t.subtitle:""),ev("string"==typeof t.composer?t.composer:"");let r="string"==typeof t.lyricist?t.lyricist:"string"==typeof t.poet?t.poet:"";ew(r);let n=(Array.isArray(t.parts)?t.parts:[]).map((e,t)=>({index:t,name:"string"==typeof e?.name?e.name:"",instrumentName:"string"==typeof e?.instrumentName?e.instrumentName:"",instrumentId:"string"==typeof e?.instrumentId?e.instrumentId:"",isVisible:"true"===String(e?.isVisible??"").toLowerCase()}));e_(n)}catch(e){console.warn("Failed to read score metadata",e),ey(""),ew(""),e_([])}},rL=async e=>{if(!e.listInstrumentTemplates)return void eE([]);try{let t=await e.listInstrumentTemplates();eE(Array.isArray(t)?t:[])}catch(e){console.warn("Failed to read instrument templates",e),eE([])}},rR=async e=>{if(ec)return!0;let r=e??t;if(!r||!r.setSoundFont||ef)return!1;ep(!0);let n=Q.env.NEXT_PUBLIC_SOUNDFONT_CDN_URL;for(let e of n?[`${n}/MuseScore_General.sf3`,`${n}/default.sf3`,`${n}/MuseScore_General.sf2`,`${n}/default.sf2`,"soundfonts/default.sf3","soundfonts/default.sf2"]:["soundfonts/default.sf3","soundfonts/default.sf2"])try{let t=await fetch(e);if(!t.ok)continue;let n=new Uint8Array(await t.arrayBuffer());return await r.setSoundFont(n),ed(!0),!0}catch(t){console.warn("Default soundfont load failed for",e,t)}return!1},rB=async e=>{if(!t||!t.setSoundFont)return void alert("SoundFont loading is not available in this build.");try{let r=await e.arrayBuffer(),n=new Uint8Array(r);await t.setSoundFont(n),ed(!0),ep(!0)}catch(e){console.error("Failed to load soundfont",e),alert("Failed to load soundfont. See console for details.")}},rO=async()=>{var e;let t,r,n,a,o,i,s,l,u=Math.max(1,Math.floor(tG)),c=tX.length>0?tX:rb.slice(0,1).map(e=>e.id);if(0===c.length)return void alert("Select at least one instrument.");let d=(t=rg((e={title:tB,composer:tU,instruments:c.map(e=>{let t=rb.find(t=>t.id===e);return{id:e,name:t?.name||e||"Instrument"}}),measures:u,keyFifths:tq,timeNumerator:tK,timeDenominator:tZ}).title.trim()),r=rg(e.composer.trim()),n=Math.round(64*e.timeNumerator/e.timeDenominator),a=e.instruments.map((t,r)=>{let a=`P${r+1}`,o=t.name.trim()||"Instrument",i=rg(o),s=((e,t)=>{let r=t0?.[e];if(r)return r;let n=t.toLowerCase();return n.includes("piano")||n.includes("organ")||n.includes("harp")?{staves:2,clefs:[{staff:1,clef:"G"},{staff:2,clef:"F"}]}:n.includes("viola")?{staves:1,clefs:[{staff:1,clef:"C3"}]}:n.includes("cello")||n.includes("contrabass")||n.includes("double bass")||n.includes("tuba")||n.includes("bassoon")?{staves:1,clefs:[{staff:1,clef:"F"}]}:n.includes("percussion")||n.includes("drum")?{staves:1,clefs:[{staff:1,clef:"PERC"}]}:{staves:1,clefs:[{staff:1,clef:"G"}]}})(t.id,o),l=Math.max(s.staves||1,s.clefs.length||1),u=s.clefs.map(e=>{let t=rw[e.clef]??rw.G,r=l>1?` number="${e.staff}"`:"",n=t.octave?`
        <clef-octave-change>${t.octave}</clef-octave-change>`:"";return`        <clef${r}>
          <sign>${t.sign}</sign>
          <line>${t.line}</line>${n}
        </clef>`}).join("\n"),c=Array.from({length:e.measures},(t,r)=>{let a=0===r?`
      <attributes>
        <divisions>16</divisions>
        <key><fifths>${e.keyFifths}</fifths></key>
        <time><beats>${e.timeNumerator}</beats><beat-type>${e.timeDenominator}</beat-type></time>
        ${l>1?`<staves>${l}</staves>`:""}
${u}
      </attributes>`:"",o=Array.from({length:l},(e,t)=>`      <note>
        <rest measure="yes"/>
        <duration>${n}</duration>
        <voice>1</voice>
        ${l>1?`<staff>${t+1}</staff>`:""}
      </note>`).join("\n");return`    <measure number="${r+1}">
${a}
${o}
    </measure>`}).join("\n");return{partList:`    <score-part id="${a}">
      <part-name>${i}</part-name>
      <score-instrument id="${a}-I1">
        <instrument-name>${i}</instrument-name>
      </score-instrument>
    </score-part>`,part:`  <part id="${a}">
${c}
  </part>`}}),o=t?`  <work><work-title>${t}</work-title></work>
`:"",i=r?`  <identification><creator type="composer">${r}</creator></identification>
`:"",s=a.map(e=>e.partList).join("\n"),l=a.map(e=>e.part).join("\n"),`<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE score-partwise PUBLIC "-//Recordare//DTD MusicXML 3.1 Partwise//EN" "http://www.musicxml.org/dtds/partwise.dtd">
<score-partwise version="3.1">
${o}${i}  <part-list>
${s}
  </part-list>
${l}
</score-partwise>
`),f=tB.trim()?rp(tB):"new_score",p=new File([new TextEncoder().encode(d)],`${f}.musicxml`,{type:"application/xml"});tR(!1);let m=`new:${crypto.randomUUID()}`;tI(m),rm(m),await rM(p,{scoreIdOverride:m,updateUrl:!1})},rU=async()=>{if(!t)return void alert("Load a score before saving a checkpoint.");if(!("u">typeof indexedDB))return void alert("IndexedDB is not available in this browser.");eD(!0);try{let e=await r_();if(!e)return;let t=rh("score"),r=e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength),n=rf(eN,em);await M({title:n,createdAt:Date.now(),format:"musicxml",data:r,size:e.byteLength,scoreId:t}),eY(!1),eA(""),await rA()}catch(e){console.error("Failed to save checkpoint",e),alert("Failed to save checkpoint. See console for details.")}finally{eD(!1)}},rz=async e=>{if(!("u">typeof indexedDB))return void alert("IndexedDB is not available in this browser.");if(window.confirm(`Restore checkpoint "${e.title}"? Unsaved changes will be lost.`)){eD(!0);try{let t=await P(e.id);if(!t)return void alert("Checkpoint not found.");let r=`${rp(e.title)}.musicxml`,n=new File([new Uint8Array(t.data)],r,{type:"application/xml"});await rM(n,{preserveScoreId:!0,updateUrl:!1})}catch(e){console.error("Failed to restore checkpoint",e),alert("Failed to restore checkpoint. See console for details.")}finally{eD(!1)}}},rX=async e=>{if(!t)return void alert("Load a score before comparing checkpoints.");if(!("u">typeof indexedDB))return void alert("IndexedDB is not available in this browser.");eD(!0);try{let t=await P(e.id);if(!t)return void alert("Checkpoint not found.");let r=await r_();if(!r)return;let n=new TextDecoder,a=n.decode(r),o=n.decode(new Uint8Array(t.data));eR({title:e.title,currentXml:a,checkpointXml:o})}catch(e){console.error("Failed to compare checkpoint",e),alert("Failed to compare checkpoint. See console for details.")}finally{eD(!1)}},r$=async()=>{t?(!e8||window.confirm("Discard local MusicXML edits and reload from the score?"))&&await rS():alert("Load a score before refreshing MusicXML.")},rW=async()=>{e6(!0),e9(null);try{await rC(e2)}catch(e){console.error("Failed to apply MusicXML edits",e),alert("Failed to apply MusicXML edits. See console for details.")}finally{e6(!1)}},rH=async e=>{if(!("u">typeof indexedDB))return void alert("IndexedDB is not available in this browser.");if(window.confirm(`Delete checkpoint "${e.title}"?`)){eD(!0);try{await I(e.id),await rA()}catch(e){console.error("Failed to delete checkpoint",e),alert("Failed to delete checkpoint. See console for details.")}finally{eD(!1)}}},rG=async()=>{if(!tr.trim())return void alert("Enter your OpenAI API key.");if(!ta.trim())return void alert("Enter an instruction for the assistant.");if(!te.trim())return void alert("Select a model.");if("custom"===tl&&tc<=0)return void alert("Enter a max output token limit.");tw(!0),t_(null),tp(""),th(null),ty(null),tv("");try{var e;let t,r=ti?await rE():"";if(ti&&!r.trim())return void alert("Unable to load MusicXML for context.");let n=ti?r:await rE(),a=`Return ONLY valid JSON in the following format:
{
  "format": "musicxml-patch@1",
  "ops": [
    { "op": "replace", "path": "/score-partwise/part[@id='P1']/measure[@number='1']/note[1]", "value": "<note>...</note>" },
    { "op": "setText", "path": "/score-partwise/part[@id='P1']/measure[@number='1']/note[1]/duration", "value": "2" },
    { "op": "setAttr", "path": "/score-partwise/part[@id='P1']/measure[@number='1']/note[1]", "name": "default-x", "value": "123.45" },
    { "op": "insertAfter", "path": "/score-partwise/part[@id='P1']/measure[@number='1']/note[1]", "value": "<note>...</note>" },
    { "op": "delete", "path": "/score-partwise/part[@id='P1']/measure[@number='1']/note[2]" }
  ]
}
Use ONLY these ops: replace, setText, setAttr, insertBefore, insertAfter, delete.
Each XPath must match exactly one node.`,o="You are a MusicXML editor. Return only a JSON patch payload (musicxml-patch@1), no markdown or commentary.",i=ti&&r.trim()?`${ta}

Current MusicXML:
${r}

${a}`:`${ta}

${a}`,s={model:te,instructions:o,input:i,temperature:0};"custom"===tl&&(s.max_output_tokens=tc);let l=await fetch("https://api.openai.com/v1/responses",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${tr}`},body:JSON.stringify(s)}),u="";if(l.ok){let e=await l.json();if("string"==typeof e?.output_text)u=e.output_text;else for(let t of Array.isArray(e?.output)?e.output:[])if(t?.type==="message"){u=(Array.isArray(t?.content)?t.content:[]).map(e=>e?.text||"").join("");break}}else{let e={model:te,messages:[{role:"system",content:o},{role:"user",content:i}],temperature:0};if("custom"===tl&&(e.max_tokens=tc),!(l=await fetch("https://api.openai.com/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${tr}`},body:JSON.stringify(e)})).ok){let e=await l.text();throw Error(e||"OpenAI request failed.")}let t=await l.json();u=t?.choices?.[0]?.message?.content??""}let c=(t=(e=u).match(/```(?:json)?\s*([\s\S]*?)```/i))?t[1].trim():e.trim();if(!c)return void t_("No patch was returned by the model.");tp(c);let d=(e=>{let t;if(!e.trim())return{patch:null,error:"AI response is empty."};try{t=JSON.parse(e)}catch(e){return{patch:null,error:"AI response is not valid JSON."}}if(!t||"musicxml-patch@1"!==t.format||!Array.isArray(t.ops))return{patch:null,error:"AI response is not a musicxml-patch@1 payload."};let r=[],n=new Set(["replace","setText","setAttr","insertBefore","insertAfter","delete"]);for(let e=0;e<t.ops.length;e+=1){let a=t.ops[e];if(!a||"object"!=typeof a)return{patch:null,error:`Patch op ${e+1} is not an object.`};let o=String(a.op||"");if(!n.has(o))return{patch:null,error:`Patch op ${e+1} has unsupported op "${o}".`};let i="string"==typeof a.path?a.path.trim():"";if(!i)return{patch:null,error:`Patch op ${e+1} is missing a valid path.`};let s={op:o,path:i};if("setText"===o||"replace"===o||"insertBefore"===o||"insertAfter"===o){if("string"!=typeof a.value)return{patch:null,error:`Patch op ${e+1} requires a string value.`};s.value=a.value}if("setAttr"===o){if("string"!=typeof a.name||!a.name.trim())return{patch:null,error:`Patch op ${e+1} requires an attribute name.`};if("string"!=typeof a.value)return{patch:null,error:`Patch op ${e+1} requires a string value.`};s.name=a.name,s.value=a.value}r.push(s)}return{patch:{format:"musicxml-patch@1",ops:r},error:""}})(c);if(d.error||!d.patch)return void ty(d.error||"Invalid patch payload.");if(th(d.patch),!n.trim())return void ty("Unable to apply patch without MusicXML.");let f=((e,t)=>{if(!e.trim())return{xml:"",error:"Base MusicXML is empty."};if("u"<typeof DOMParser)return{xml:"",error:"XML parsing is unavailable in this environment."};let r=new DOMParser,n=r.parseFromString(e,"application/xml");if(n.querySelector("parsererror"))return{xml:"",error:"Base MusicXML is not valid XML."};let a=n.createNSResolver(n.documentElement),o=e=>{let t=r.parseFromString(`<wrapper>${e}</wrapper>`,"application/xml");if(t.querySelector("parsererror"))return{node:null,error:"Patch value is not valid XML."};let a=t.documentElement,o=Array.from(a.childNodes).filter(e=>e.nodeType===Node.ELEMENT_NODE),i=Array.from(a.childNodes).filter(e=>e.nodeType===Node.TEXT_NODE&&(e.textContent??"").trim());return 1!==o.length||i.length>0?{node:null,error:"Patch value must contain exactly one element."}:{node:n.importNode(o[0],!0),error:""}},i=e=>{try{let t=n.evaluate(e,n,a,XPathResult.ORDERED_NODE_SNAPSHOT_TYPE,null);if(1!==t.snapshotLength)return{node:null,error:`XPath "${e}" matched ${t.snapshotLength} nodes.`};return{node:t.snapshotItem(0),error:""}}catch(t){return{node:null,error:`XPath "${e}" could not be evaluated.`}}};for(let e=0;e<t.ops.length;e+=1){let r=t.ops[e],{node:n,error:a}=i(r.path);if(a||!n)return{xml:"",error:`Patch op ${e+1} failed: ${a||"Target not found."}`};if("setText"===r.op){n.textContent=r.value??"";continue}if("setAttr"===r.op){if(n.nodeType!==Node.ELEMENT_NODE)return{xml:"",error:`Patch op ${e+1} targets a non-element node.`};n.setAttribute(r.name??"",r.value??"");continue}if("delete"===r.op){if(!n.parentNode)return{xml:"",error:`Patch op ${e+1} target has no parent.`};n.parentNode.removeChild(n);continue}let s=o(r.value??"");if(s.error||!s.node)return{xml:"",error:`Patch op ${e+1} failed: ${s.error||"Invalid value."}`};if(!n.parentNode)return{xml:"",error:`Patch op ${e+1} target has no parent.`};if("replace"===r.op){n.parentNode.replaceChild(s.node,n);continue}if("insertBefore"===r.op){n.parentNode.insertBefore(s.node,n);continue}if("insertAfter"===r.op){n.parentNode.insertBefore(s.node,n.nextSibling);continue}}return{xml:new XMLSerializer().serializeToString(n),error:""}})(n,d.patch);if(f.error||!f.xml.trim())return void ty(f.error||"Failed to apply patch to MusicXML.");ty(null),tv(f.xml)}catch(e){console.error("AI request failed",e),t_("AI request failed. See console for details.")}finally{tw(!1)}},rV=async()=>{if(!tb.trim())return void alert(tg||"AI patch has not produced valid MusicXML.");e6(!0),e9(null);try{await rC(tb)}catch(e){console.error("Failed to apply AI XML",e),alert("Failed to apply AI XML. See console for details.")}finally{e6(!1)}},rq=async()=>{if(!(w.length>1)&&t&&y)try{let{page:e,x:r,y:n}=y;if((ea(E)||R)&&t.selectTextElementAtPoint)return void await t.selectTextElementAtPoint(e,r,n);if(!t.selectElementAtPoint)return;await t.selectElementAtPoint(e,r,n)}catch(e){console.warn("Re-select in WASM failed; continuing anyway",e)}},rY=(e,t,r)=>{if(console.log("[refreshSelectionOverlay] Called with fallbackIndex:",e,"fallbackPoint:",t),!u.current)return void console.log("[refreshSelectionOverlay] No containerRef, returning");if(void 0!==r&&r!==et.current||J.current)return;let n=void 0!==e?e:v,a=void 0!==t?t:y;console.log("[refreshSelectionOverlay] useIndex:",n,"usePoint:",a);let o=u.current.getBoundingClientRect(),i=Array.from(new Set([".selected",".note-selected",".ms-selection"].flatMap(e=>Array.from(u.current.querySelectorAll(e))))),l=Array.from(u.current.querySelectorAll(ee));console.log("[refreshSelectionOverlay] candidates.length:",i.length);let c=[];if(i.length>0)c=i.map(e=>{let t=e.getBoundingClientRect(),r=(t.left-o.left)/s,n=(t.top-o.top)/s,a=t.width/s,i=t.height/s;if(!(a>0&&i>0))return null;let c=nO(e)??0,d=ei(e,e.getAttribute("class")??""),f=l.indexOf(e);if(f<0){let t=e;for(;t&&t!==u.current&&!((f=l.indexOf(t))>=0);)t=t.parentElement}return{index:f>=0?f:null,page:c,x:r,y:n,w:a,h:i,centerX:r+a/2,centerY:n+i/2,classes:d}}).filter(e=>!!e).sort((e,t)=>e.page-t.page||e.y-t.y||e.x-t.x||(e.index??Number.MAX_SAFE_INTEGER)-(t.index??Number.MAX_SAFE_INTEGER));else if(null!==n){console.log("[refreshSelectionOverlay] Using index fallback"),console.log("[refreshSelectionOverlay] Found",l.length,"Note/Rest/Chord/LayoutBreak elements");let e=l[n]??null;if(e){console.log("[refreshSelectionOverlay] Selected element at index",n);let t=e.getBoundingClientRect(),r=(t.left-o.left)/s,a=(t.top-o.top)/s,i=t.width/s,l=t.height/s;i>0&&l>0&&(c=[{index:n,page:nO(e)??0,x:r,y:a,w:i,h:l,centerX:r+i/2,centerY:a+l/2,classes:e.getAttribute("class")??""}])}else console.log("[refreshSelectionOverlay] No element at index",n)}if(0===c.length){console.log("[refreshSelectionOverlay] No element found, clearing selection state"),k([]),g(null),b(null),x(null),T(""),D(null);return}k(c);let d=null;if(a){let e=a.page??0,t=c.filter(t=>t.page===e);d=(t.length>0?t:c).reduce((e,t)=>{if(!e)return t;let r=Math.hypot(e.centerX-a.x,e.centerY-a.y);return Math.hypot(t.centerX-a.x,t.centerY-a.y)<r?t:e},null)}else d=null!==n?c.find(e=>e.index===n)??c[0]:c[0];d?(console.log("[refreshSelectionOverlay] Setting selectedElement"),g({x:d.x,y:d.y,w:d.w,h:d.h}),b({page:d.page,x:d.centerX,y:d.centerY}),x(d.index),T(d.classes),console.log("[refreshSelectionOverlay] Done updating selection")):console.log("[refreshSelectionOverlay] No primary box found, returning")},rK=async e=>{if(t&&!(e<0)&&!(e>=tM)){tD(e);try{await rP(t,e),rY(v,y)}catch(e){console.error("Failed to change page:",e)}}},rQ=e=>{let r=n.current??t,a=r&&r[e];return a?(...e)=>a.apply(r,e):(console.warn(`Mutation binding "${e}" is missing on Score instance.`),alert(`This build of webmscore does not expose "${e}".`),null)},rZ=(e,t)=>{let r=window.prompt(e,t??"");return null===r?null:r},rJ=async(e,r,n)=>{if(!t)return void console.warn(`Mutation "${e}" requested but no score is loaded.`);if(!r)return void console.warn(`Mutation "${e}" requested but binding is missing on Score instance.`);let a=w.length>1,o=!n?.skipSelectionFallback;try{console.debug(`Mutation "${e}" start`);let i=await r();console.debug(`Mutation "${e}" result:`,i);let l=!1!==i;if(l||console.warn(`Mutation "${e}" returned false (no-op).`),n?.clearSelection&&(J.current=!0,et.current+=1,S(!0),g(null),k([]),b(null),x(null),T(""),D(null)),!l)return;if(eY(!0),eQ(!0),!n?.skipRelayout&&t.relayout)try{await t.relayout()}catch(e){console.warn("Relayout after mutation failed:",e)}let c=await rF(t,rl.current);if(await rP(t,c),!n?.skipWasmReselect&&!a&&y&&t.selectElementAtPoint)try{await t.selectElementAtPoint(y.page,y.x,y.y)}catch(e){console.warn("Re-select in WASM after mutation failed; continuing with overlay fallback",e)}if(!n?.clearSelection&&o&&(null!==v&&null===v&&x(v),y&&!y&&b(y)),n?.clearSelection)return;let d=o?v:null,f=o?y:null,p=n?.advanceSelection,m=n?.advanceSelectionStep??1;console.log("[performMutation] Scheduling refresh with preservedIndex:",d,"preservedPoint:",f),window.requestAnimationFrame(()=>{console.log("[performMutation] RAF 1"),window.requestAnimationFrame(()=>{console.log("[performMutation] RAF 2, calling refreshSelectionOverlay"),p?((e,t,r=1)=>{if(!u.current)return;let n=Array.from(u.current.querySelectorAll(ee));if(0===n.length)return;let a=e??v,o=t??y??(h?{page:0,x:h.x+h.w/2,y:h.y+h.h/2}:null);if(o){let e=u.current.getBoundingClientRect();a=n.reduce((t,r,a)=>{let i=r.getBoundingClientRect(),l=(i.left-e.left+i.width/2)/s,u=(i.top-e.top+i.height/2)/s,c=n[t]?.getBoundingClientRect(),d=c?(c.left-e.left+c.width/2)/s:l,f=c?(c.top-e.top+c.height/2)/s:u,p=Math.hypot(d-o.x,f-o.y);return Math.hypot(l-o.x,u-o.y)<p?a:t},0)}let i=a??0,l=Math.min(n.length-1,Math.max(0,i+r)),c=n[l];if(!c)return;let d=c.getBoundingClientRect(),f=u.current.getBoundingClientRect(),p=(d.left-f.left)/s,m=(d.top-f.top)/s,w=d.width/s,_=d.height/s;if(!(w>0&&_>0))return;let S=nO(c)??0,E=p+w/2,T=m+_/2;k([{index:l,page:S,x:p,y:m,w,h:_,centerX:E,centerY:T}]),g({x:p,y:m,w,h:_}),b({page:S,x:E,y:T}),x(l)})(v,y,m):rY(d,f)})})}catch(t){console.error(`Mutation "${e}" failed:`,t),alert(`Unable to ${e}. Check the console for details.`)}},r0=(e,t,r)=>{window.requestAnimationFrame(()=>{window.requestAnimationFrame(()=>{rY(e,t,r)})})},r1=async e=>{if(t){J.current=!1;try{S(!1),await rP(t,rl.current);let r=++et.current;r0(e?.index??null,e?.point??null,r)}catch(e){console.warn("Failed to refresh selection highlight from SVG:",e)}}},r2=()=>rJ("delete selection",async()=>{await rq();let e=rQ("deleteSelection");return!!e&&await e()},{clearSelection:!0}),r4=e=>{N(e)},r8=()=>rJ("set selected text",async()=>{await rq();let e=rQ("setSelectedText");return!!e&&e(C)}),r3=()=>rJ("undo",t?.undo?.bind(t)),r5=()=>rJ("redo",t?.redo?.bind(t)),r6=()=>rJ("raise pitch",async()=>{await rq();let e=rQ("pitchUp");if(e)return e()}),r7=()=>rJ("lower pitch",async()=>{await rq();let e=rQ("pitchDown");if(e)return e()}),r9=e=>rJ(`transpose ${e}`,async()=>{let t=rQ("transpose");if(t)return t(e)},{skipWasmReselect:!0}),ne=async()=>{if(!t)return;await rq();let e=rQ("selectNextChord");if(!e||!await e.call(t))return;let r=rl.current,a=n.current??t,o=a.getSelectionBoundingBox;if("function"==typeof o){let e=await o.call(a);e&&"number"==typeof e.page&&(r=e.page)}r!==rl.current?await rK(r):await r1()},nt=async()=>{if(!t)return;await rq();let e=rQ("selectPrevChord");if(!e||!await e.call(t))return;let r=rl.current,a=n.current??t,o=a.getSelectionBoundingBox;if("function"==typeof o){let e=await o.call(a);e&&"number"==typeof e.page&&(r=e.page)}r!==rl.current?await rK(r):await r1()},nr=async()=>{if(!t)return;console.log("[NAV] handleExtendSelectionNextChord called"),await rq();let e=rQ("extendSelectionNextChord"),r=rQ("getSelectionBoundingBoxes");if(!e||!r)return void console.log("[NAV] Missing functions for extend selection");let n=await e.call(t);if(console.log("[NAV] extendSelectionNextChord result:",n),n){let e=await r.call(t);if(console.log("[NAV] getSelectionBoundingBoxes result:",e),await rP(t,rl.current),e&&e.length>0){let t=e.map((e,t)=>({index:t,page:e.page,x:e.x,y:e.y,w:e.width,h:e.height,centerX:e.x+e.width/2,centerY:e.y+e.height/2})),r=e[e.length-1];g({x:r.x,y:r.y,w:r.width,h:r.height}),b({page:r.page,x:r.x+r.width/2,y:r.y+r.height/2}),k(t)}}},nn=async()=>{if(!t)return;console.log("[NAV] handleExtendSelectionPrevChord called"),await rq();let e=rQ("extendSelectionPrevChord"),r=rQ("getSelectionBoundingBoxes");if(!e||!r)return void console.log("[NAV] Missing functions for extend selection");let n=await e.call(t);if(console.log("[NAV] extendSelectionPrevChord result:",n),n){let e=await r.call(t);if(console.log("[NAV] getSelectionBoundingBoxes result:",e),await rP(t,rl.current),e&&e.length>0){let t=e.map((e,t)=>({index:t,page:e.page,x:e.x,y:e.y,w:e.width,h:e.height,centerX:e.x+e.width/2,centerY:e.y+e.height/2})),r=e[0];g({x:r.x,y:r.y,w:r.width,h:r.height}),b({page:r.page,x:r.x+r.width/2,y:r.y+r.height/2}),k(t)}}},na=e=>rJ(`set accidental ${e}`,async()=>{await rq();let t=rQ("setAccidental");if(t)return t(e)}),no=()=>rJ("toggle dot",async()=>{await rq();let e=rQ("toggleDot");if(e)return e()}),ni=e=>rJ("set duration",async()=>{await rq();let t=rQ("setDurationType");if(t)return t(e)}),ns=(e,t)=>{let r=!t;return rJ("add pitch",async()=>{await rq();let r=rQ("addPitchByStep");if(r)return r(e,t,!1)},{skipWasmReselect:!0,skipSelectionFallback:r,advanceSelection:r})},nl=()=>rJ("enter rest",async()=>{await rq();let e=rQ("enterRest");if(e)return e()},{skipWasmReselect:!0,skipSelectionFallback:!0,advanceSelection:!0}),nu=()=>rJ("toggle line break",async()=>{await rq();let e=rQ("toggleLineBreak");if(e)return e()},{skipWasmReselect:!0}),nc=()=>rJ("toggle page break",async()=>{await rq();let e=rQ("togglePageBreak");if(e)return e()},{skipWasmReselect:!0}),nd=()=>rJ("add tie",async()=>{await rq();let e=rQ("addTie");if(e)return e()}),nf={0:"Chord symbol",1:"Roman numeral",2:"Nashville number"},np=async()=>{t&&(await rJ("set title",async()=>{let e=rQ("setTitleText");if(e)return e(em)},{skipWasmReselect:!0}),await rI(t))},nm=async()=>{t&&(await rJ("set subtitle",async()=>{let e=rQ("setSubtitleText");if(e)return e(eg)},{skipWasmReselect:!0}),await rI(t))},nh=async()=>{t&&(await rJ("set composer",async()=>{let e=rQ("setComposerText");if(e)return e(eb)},{skipWasmReselect:!0}),await rI(t))},ng=async()=>{t&&(await rJ("set lyricist",async()=>{let e=rQ("setLyricistText");if(e)return e(ex)},{skipWasmReselect:!0}),await rI(t))},ny=async e=>{t&&e&&(await rJ("add instrument",async()=>{let t=rQ("appendPart");if(t)return t(e)},{skipWasmReselect:!0}),await rI(t))},nb=async e=>{t&&(await rJ("remove instrument",async()=>{let t=rQ("removePart");if(t)return t(e)},{clearSelection:!0,skipWasmReselect:!0}),await rI(t))},nv=async(e,r)=>{t&&(await rJ("toggle part visibility",async()=>{let t=rQ("setPartVisible");if(t)return t(e,r)},{skipWasmReselect:!0}),await rI(t))},nx=async()=>{if(!t)return!1;await rq();let e=rQ("selectionMimeType"),r=rQ("selectionMimeData");if(!e||!r)return!1;let n=await e();if(!n)return!1;let a=await r();return!!a&&0!==a.length&&(rs.current={mimeType:n,data:a instanceof Uint8Array?a:new Uint8Array(a)},!0)},nw=()=>rJ("paste selection",async()=>{let e=rs.current;if(!e)return alert("Nothing copied yet."),!1;await rq();let t=rQ("pasteSelection");if(t)return t(e.mimeType,e.data)},{skipWasmReselect:!0});(0,o.useEffect)(()=>{let e=e=>{if(e.defaultPrevented||!t||(e=>{if(!(e instanceof HTMLElement))return!1;let t=e.tagName.toLowerCase();return e.isContentEditable||"input"===t||"textarea"===t||"select"===t})(e.target))return;let r=e.key,n=r.toLowerCase(),a=e.ctrlKey||e.metaKey;if(a){if("z"===n){e.preventDefault(),e.shiftKey?r5():r3();return}if("y"===n){e.preventDefault(),r5();return}if("c"===n){e.preventDefault(),nx();return}if("v"===n){e.preventDefault(),nw();return}}if(!a){let t={c:0,d:1,e:2,f:3,g:4,a:5,b:6},a={1:8,2:7,3:6,4:5,5:4,6:3,7:2,8:1},o=!!h||w.length>0;if(er&&o){if(r in a){e.preventDefault(),ni(a[r]);return}if("0"===r){e.preventDefault(),nl();return}if("."===r){e.preventDefault(),no();return}if("+"===r){e.preventDefault(),na(3);return}if("-"===r){e.preventDefault(),na(1);return}if("="===r){e.preventDefault(),na(2);return}if("T"===r){e.preventDefault(),nd();return}if(!e.altKey&&n in t){e.preventDefault(),ns(t[n],e.shiftKey);return}}}if("arrowup"===n||"arrowdown"===n){if(!er||!(h||w.length>0))return;e.preventDefault(),a?r9("arrowup"===n?12:-12):"arrowup"===n?r6():r7();return}if("arrowleft"===n||"arrowright"===n){if(!er||!(h||w.length>0))return;e.preventDefault(),e.shiftKey?"arrowright"===n?nr():nn():"arrowright"===n?ne():nt();return}if(("delete"===n||"backspace"===n)&&er&&(h||w.length>0)){if(e.preventDefault(),"line"===j)return void nu();if("page"===j)return void nc();r2()}};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[t,er,h,w.length,ns,nl,na,ni,no,nd,r3,r5,r6,r7,r9,ne,nt,nr,nn,r2,nx,nw]);let nk=async(e,r,n)=>{if(t&&t.setTimeSignature){rr(!0);try{await rq(),"number"==typeof n&&t.setTimeSignatureWithType?await t.setTimeSignatureWithType(e,r,n):("number"!=typeof n||t.setTimeSignatureWithType||console.warn("Time signature type requested but not supported by this WASM build."),await t.setTimeSignature(e,r)),t.relayout&&await t.relayout(),await rP(t),r0(v,y,et.current)}catch(e){console.error("Failed to set time signature",e),alert("Unable to set time signature. See console for details.")}finally{rr(!1)}}},n_=async e=>{if(t&&t.setKeySignature){rr(!0);try{await rq(),await t.setKeySignature(e),t.relayout&&await t.relayout(),await rP(t),r0(v,y,et.current)}catch(e){console.error("Failed to set key signature",e),alert("Unable to set key signature. See console for details.")}finally{rr(!1)}}},nS=async e=>{if(t&&t.setClef){rr(!0);try{await rq(),await t.setClef(e),t.relayout&&await t.relayout(),await rP(t),r0(v,y,et.current)}catch(e){console.error("Failed to set clef",e),alert("Unable to set clef. See console for details.")}finally{rr(!1)}}},nE=(e,t,r)=>{let n=new Blob([e],{type:r}),a=URL.createObjectURL(n),o=document.createElement("a");o.href=a,o.download=t,o.click(),URL.revokeObjectURL(a)},nT=async()=>{if(t)try{let e=await t.saveSvg(0,!0);nE(e,"score.svg","image/svg+xml")}catch(e){console.error("Failed to export SVG",e),alert("Unable to export SVG. See console for details.")}},nC=async()=>{if(t)try{let e=await t.savePdf();nE(e,"score.pdf","application/pdf")}catch(e){console.error("Failed to export PDF",e),alert("Unable to export PDF. See console for details.")}},nN=async()=>{if(!t||!t.savePng)return void alert("PNG export is not available in this build.");try{let e=await t.savePng(0,!0,!0);nE(e,"score.png","image/png")}catch(e){console.error("Failed to export PNG",e),alert("Unable to export PNG. See console for details.")}},nA=async()=>{if(!t||!t.saveMxl)return void alert("MXL export is not available in this build.");try{let e=await t.saveMxl();nE(e,"score.mxl","application/vnd.recordare.musicxml")}catch(e){console.error("Failed to export MXL",e),alert("Unable to export MXL. See console for details.")}},nj=async()=>{if(!t||!t.saveMsc)return void alert("MSCZ export is not available in this build.");try{let e=await t.saveMsc("mscz");nE(e,"score.mscz","application/vnd.musescore.mscz")}catch(e){console.error("Failed to export MSCZ",e),alert("Unable to export MSCZ. See console for details.")}},nD=async()=>{if(!t||!t.saveMidi)return void alert("MIDI export is not available in this build.");try{let e=await t.saveMidi(!0,!0);nE(e,"score.mid","audio/midi")}catch(e){console.error("Failed to export MIDI",e),alert("Unable to export MIDI. See console for details.")}},nM=async()=>{if(!t||!t.saveAudio)return void alert("Audio export is not available in this build.");try{if(rr(!0),!await rR())return void alert("No default soundfont found. Upload a .sf2/.sf3 soundfont file using the toolbar, or configure NEXT_PUBLIC_SOUNDFONT_CDN_URL to load from a CDN.");let e=await t.saveAudio("wav");nE(e,"score.wav","audio/wav")}catch(e){console.error("Failed to export audio",e),alert("Unable to export audio. See console for details.")}finally{rr(!1)}},nF=()=>{t7.current&&(t7.current.pause(),t7.current.currentTime=0),ro.current.forEach(e=>{try{e.stop()}catch(e){}}),ro.current=[];let e=ri.current;e&&(e(!0).catch(()=>{}),ri.current=null),re(!1)},nP=async e=>{t7.current&&(t7.current.pause(),t7.current.src="");let t=new Audio(e);t7.current=t,t.onended=()=>re(!1),await t.play(),re(!0)},nI=async()=>{if(!t||!t.saveAudio)return void alert("Audio playback is not available in this build.");try{if(rr(!0),!await rR())return void alert("No default soundfont found. Upload a .sf2/.sf3 soundfont file using the toolbar, or configure NEXT_PUBLIC_SOUNDFONT_CDN_URL to load from a CDN.");nF();let e="function"==typeof t.synthAudioBatch,r=!1;if(e)try{let e=ra.current||new AudioContext({sampleRate:44100});ra.current=e,"suspended"===e.state&&await e.resume();let n=await t.synthAudioBatch(0,16);ri.current=n;let a=e.currentTime+.05,o=null;for(;;){let t=await n(!1);if(!Array.isArray(t)||0===t.length)break;let r=!1;for(let n of t){if(!n)continue;n.done&&(r=!0);let t=new Float32Array(n.chunk.buffer,n.chunk.byteOffset,n.chunk.byteLength/4),i=Math.floor(t.length/512);(!Number.isInteger(i)||i<1)&&(i=1),i>2&&(i=2);let s=e.createBuffer(i,512,e.sampleRate);for(let e=0;e<i;e++){let r=512*e,n=t.subarray(r,r+512);s.copyToChannel(n,e)}let l=e.createBufferSource();l.buffer=s,l.connect(e.destination);let u=a+n.startTime;if(l.start(u),ro.current.push(l),o=l,r)break}if(r)break}o&&(o.onended=()=>{re(!1),ro.current=[],ri.current=null}),re(!0),r=!0}catch(e){console.warn("Streaming playback failed; falling back to WAV",e),nF()}if(!r)if(rn.current)await nP(rn.current);else{let e=await t.saveAudio("wav"),r=new Blob([e],{type:"audio/wav"}),n=URL.createObjectURL(r);rn.current=n,await nP(n)}}catch(e){console.error("Failed to play audio",e),alert("Unable to play audio. See console for details."),nF()}finally{rr(!1)}},nL=e=>{let t=e?Number.parseFloat(e):NaN;return Number.isFinite(t)?t:0},nR=e=>{if(!d.current||!c.current||s<=0)return null;let t=d.current,r=window.getComputedStyle(t),n=nL(r.paddingLeft),a=nL(r.paddingRight),o=nL(r.paddingBottom),i=0;if("width"===e)i=t.clientWidth-n-a;else{let e=c.current.offsetTop;i=t.clientHeight-e-o}if(i<=0)return null;let l=c.current.getBoundingClientRect(),u="width"===e?l.width:l.height;if(u<=0)return null;let p=u/s;if(p<=0)return null;let m=i/p;return Number.isFinite(m)?f(m):null},nB=()=>{let e=nR("width");null!==e&&l(e)},nO=e=>{let t=e;for(;t&&t!==u.current;){let e=t.dataset?.page;if(e&&!Number.isNaN(Number(e))){let t=Number(e);return t>=0?t:null}let r=t.getAttribute("id");if(r){let e=r.match(/page-?(\d+)/i);if(e){let t=Number(e[1]);return Number.isNaN(t)?null:Math.max(t-1,0)}}t=t.parentElement}return null},nU=(e,t)=>{if(!u.current)return null;let r=u.current.getBoundingClientRect();return{x:(e-r.left)/s,y:(t-r.top)/s}},nz=async(e,r)=>{if(!u.current||!t)return null;let n=u.current.getBoundingClientRect(),a=Array.from(u.current.querySelectorAll(ee)).map((t,r)=>{let a=t.getBoundingClientRect(),o={x:(a.left-n.left)/s,y:(a.top-n.top)/s,w:a.width/s,h:a.height/s};if(!(o.w>0&&o.h>0)||!(e.x+e.w>=o.x)||!(o.x+o.w>=e.x)||!(e.y+e.h>=o.y)||!(o.y+o.h>=e.y))return null;let i=nO(t)??0,l=o.x+o.w/2,u=o.y+o.h/2;return{el:t,index:r,pageIndex:i,box:o,centerX:l,centerY:u}}).filter(e=>!!e).sort((e,t)=>e.pageIndex-t.pageIndex||e.box.y-t.box.y||e.box.x-t.box.x||e.index-t.index);if(0===a.length)return!r&&(g(null),k([]),b(null),x(null),T(""),D(null),t.clearSelection&&await t.clearSelection().catch(e=>{console.warn("clearSelection not available or failed:",e)})),null;let o=a[0],i=a.map(e=>({index:e.index,page:e.pageIndex,x:e.box.x,y:e.box.y,w:e.box.w,h:e.box.h,centerX:e.centerX,centerY:e.centerY,classes:e.el.getAttribute("class")??""}));r?k(e=>{let t=new Set;for(let r of e)null!==r.index&&t.add(r.index);let r=[...e];for(let e of i)null!==e.index&&t.has(e.index)||(null!==e.index&&t.add(e.index),r.push(e));return r}):k(i),g(o.box),b({page:o.pageIndex,x:o.centerX,y:o.centerY}),x(o.index);let l={index:o.index,point:{page:o.pageIndex,x:o.centerX,y:o.centerY}};if(t.selectElementAtPointWithMode){let e=a.some(e=>(e.el.getAttribute("class")??"").includes("Note")),n=+!!r;if(e&&a.length>1){let e=a[0],r=a[0];for(let t of a)t.box.x<e.box.x&&(e=t),t.box.x+t.box.w>r.box.x+r.box.w&&(r=t);await t.selectElementAtPointWithMode(e.pageIndex,e.centerX,e.centerY,n),await t.selectElementAtPointWithMode(r.pageIndex,r.centerX,r.centerY,3)}else{await t.selectElementAtPointWithMode(o.pageIndex,o.centerX,o.centerY,n);for(let e=1;e<a.length;e++){let r=a[e];await t.selectElementAtPointWithMode(r.pageIndex,r.centerX,r.centerY,1)}}return l}return t.selectElementAtPoint?(!r&&t.clearSelection&&await t.clearSelection().catch(e=>{console.warn("clearSelection not available or failed:",e)}),await t.selectElementAtPoint(o.pageIndex,o.centerX,o.centerY)):console.warn("selectElementAtPoint is not available; cannot update selection in WASM"),l},nX=async e=>{if("pointer"!==X.current||$.current!==e.pointerId)return;let t=q.current,r=V.current,n=H.current;X.current=null,Y.current=!1,$.current=null,W.current=null,H.current=null,V.current=!1,q.current=!1;try{e.currentTarget.releasePointerCapture(e.pointerId)}catch{}if(!t||!n)return;z.current=!0;let a=nU(e.clientX,e.clientY);if(!a)return void U(null);let o=Math.min(n.x,a.x),i=Math.min(n.y,a.y),s={x:o,y:i,w:Math.max(n.x,a.x)-o,h:Math.max(n.y,a.y)-i};U(s);let l=await nz(s,r);U(null),await r1(l)},n$=async e=>{if("mouse"!==X.current||-1!==$.current)return;let t=q.current,r=V.current,n=H.current;if(X.current=null,$.current=null,W.current=null,H.current=null,V.current=!1,q.current=!1,!t||!n)return;z.current=!0;let a=nU(e.clientX,e.clientY);if(!a)return void U(null);let o=Math.min(n.x,a.x),i=Math.min(n.y,a.y),s={x:o,y:i,w:Math.max(n.x,a.x)-o,h:Math.max(n.y,a.y)-i};U(s);let l=await nz(s,r);U(null),await r1(l)},nW=e=>{if(z.current){z.current=!1;return}if(!u.current)return;let r=e.metaKey||e.ctrlKey||e.shiftKey,n=e.shiftKey&&!e.metaKey&&!e.ctrlKey,a=e.target,o=!1;for(;a;){if(en(a.getAttribute("class"))){o=!0;break}if(eo(a)){o=!0,a=es(a);break}if(a===u.current||null===a.parentElement)break;a=a.parentElement}if(!o||!a){g(null),k([]),b(null),x(null),T(""),D(null);let e=()=>r1(null);J.current=!0,et.current+=1,S(!0),t?.clearSelection&&t.clearSelection().then(e).catch(t=>{console.warn("clearSelection not available or failed:",t),e()});return}let i=a,l=i.getBoundingClientRect(),c=u.current.getBoundingClientRect(),d=(l.left-c.left)/s,f=(l.top-c.top)/s,p=l.width/s,m=l.height/s;if(p>0&&m>0){let e=nO(i)??0,s=d+p/2,l=f+m/2,c=Array.from(u.current.querySelectorAll(ee)),h=-1;if(o&&a&&(h=c.indexOf(a)),h<0&&(h=c.indexOf(i)),h<0&&i){let e=i;for(;e&&e!==u.current&&!((h=c.indexOf(e))>=0);)e=e.parentElement}let y={index:h>=0?h:null,page:e,x:d,y:f,w:p,h:m,centerX:s,centerY:l,classes:ei(i,i.getAttribute("class")??"")},_={index:y.index,point:{page:e,x:s,y:l}},S=!!t?.selectElementAtPointWithMode,E=r&&null!==y.index&&w.some(e=>e.index===y.index),C=w.length>0,N=S?t.selectElementAtPointWithMode(e,s,l,S?r?E?2:n&&C?3:1:0:null):t?.selectElementAtPoint?.(e,s,l);if(N?.then(()=>{r1(_)}),N?.catch(e=>{console.warn("selectElementAtPoint not available or failed:",e),g(null),k([]),b(null),x(null),T(""),D(null)}),!r){k([y]),g({x:d,y:f,w:p,h:m}),x(y.index),b({page:e,x:s,y:l});return}if(E&&null!==y.index){let e=w.filter(e=>e.index!==y.index);if(k(e),v===y.index){let t=e.at(-1)??null;t?(g({x:t.x,y:t.y,w:t.w,h:t.h}),b({page:t.page,x:t.centerX,y:t.centerY}),x(t.index)):(g(null),b(null),x(null))}return}k([...w,y]),g({x:d,y:f,w:p,h:m}),x(y.index),b({page:e,x:s,y:l})}else g(null),k([]),b(null),x(null),T(""),D(null)},nH=()=>{B(null)},nG=w.filter(e=>(null===v||e.index!==v)&&(!h||e.x!==h.x||e.y!==h.y||e.w!==h.w||e.h!==h.h)),nV=ea(E)||!!R,nq=!er||!t?.setSelectedText,nY=ej||eM,nK=nY||!t||!t?.saveXml,nQ=nY||!t,nZ=e5||!t||!t?.saveXml,nJ=!nZ&&e8,n0=!nZ&&eK,n1=tf.trim()?tg?{valid:!1,message:tg}:tm?{valid:!0,message:`${tm.ops.length} ops ready`}:{valid:!1,message:"AI output is not a valid patch."}:{valid:!0,message:""},n2=nZ||!tb.trim()||!!tg;return(0,a.jsxs)("div",{className:"flex flex-col h-screen",children:[(0,a.jsx)("div",{className:"relative",style:{zIndex:100},children:(0,a.jsx)(K,{onNewScore:()=>{tO(""),tz(""),tV(4),tY(0),tQ(4),tJ(4),rb.length>0&&(tH(rb[0].id),t$([rb[0].id])),tR(!0)},onFileUpload:rM,onSoundFontUpload:rB,scoreTitle:em,scoreSubtitle:eg,scoreComposer:eb,scoreLyricist:ex,onScoreTitleChange:eh,onScoreSubtitleChange:ey,onScoreComposerChange:ev,onScoreLyricistChange:ew,onSetTitleText:np,onSetSubtitleText:nm,onSetComposerText:nh,onSetLyricistText:t?.setLyricistText?ng:void 0,headerTextAvailable:!!(t?.setTitleText&&t?.setComposerText),onZoomIn:()=>{l(e=>f(e+.1))},onZoomOut:()=>{l(e=>f(e-.1))},zoomLevel:s,onFitWidth:nB,onFitHeight:()=>{let e=nR("height");null!==e&&l(e)},onDeleteSelection:r2,onUndo:r3,onRedo:r5,onPitchUp:r6,onPitchDown:r7,onTranspose:r9,onSetAccidental:na,onDurationLonger:()=>rJ("lengthen duration",async()=>{await rq();let e=rQ("doubleDuration");if(e)return e()}),onDurationShorter:()=>rJ("shorten duration",async()=>{await rq();let e=rQ("halfDuration");if(e)return e()}),mutationsEnabled:er,selectionActive:!!h||w.length>0||!!y,onExportSvg:nT,onExportPdf:nC,onExportPng:nN,onExportMxl:nA,onExportMscz:nj,onExportMidi:nD,onExportAudio:nM,onPlayAudio:nI,onStopAudio:nF,isPlaying:t9,audioBusy:rt,exportsEnabled:!!t,pngAvailable:!!t?.savePng,audioAvailable:!!t?.saveAudio,onSetTimeSignature:nk,onSetKeySignature:n_,onSetClef:nS,onToggleDot:no,onToggleDoubleDot:()=>rJ("toggle double dot",async()=>{await rq();let e=rQ("toggleDoubleDot");if(e)return e()}),onSetDurationType:ni,onToggleLineBreak:nu,onTogglePageBreak:nc,onSetVoice:e=>h||w.length>0?rJ(`change voice ${e+1}`,async()=>{await rq();let t=rQ("changeSelectedElementsVoice");if(t)return t(e)}):void alert("Select notes or rests to move them to another voice."),onAddDynamic:e=>rJ("add dynamic",async()=>{await rq();let t=rQ("addDynamic");if(t)return t(e)}),onAddHairpin:e=>rJ("add hairpin",async()=>{await rq();let t=rQ("addHairpin");if(t)return t(e)}),onAddPedal:e=>rJ("add pedal",async()=>{await rq();let t=rQ("addPedal");if(t)return t(e)}),onAddSostenutoPedal:()=>rJ("add sostenuto pedal",async()=>{await rq();let e=rQ("addSostenutoPedal");if(e)return e()}),onAddUnaCorda:()=>rJ("add una corda",async()=>{await rq();let e=rQ("addUnaCorda");if(e)return e()}),onSplitPedal:()=>rJ("split pedal",async()=>{await rq();let e=rQ("splitPedal");if(e)return e()}),onAddTempoText:e=>rJ("add tempo text",async()=>{let t=rQ("addTempoText");if(t)return t(e)},h?void 0:{clearSelection:!0}),onAddStaffText:()=>{let e=rZ("Staff text:");if(null!==e)return rJ("add staff text",async()=>{await rq();let t=rQ("addStaffText");if(t)return t(e)})},onAddSystemText:()=>{let e=rZ("System text:");if(null!==e)return rJ("add system text",async()=>{await rq();let t=rQ("addSystemText");if(t)return t(e)})},onAddExpressionText:()=>{let e=rZ("Expression text:");if(null!==e)return rJ("add expression text",async()=>{await rq();let t=rQ("addExpressionText");if(t)return t(e)})},onAddLyricText:()=>{let e=rZ("Lyrics text:");if(null!==e)return rJ("add lyric text",async()=>{await rq();let t=rQ("addLyricText");if(t)return t(e)})},onAddHarmonyText:e=>{let t=nf[e],r=rZ(`${t} text:`);if(null!==r)return rJ(`${t.toLowerCase()} text`,async()=>{await rq();let t=rQ("addHarmonyText");if(t)return t(e,r)})},onAddFingeringText:()=>{let e=rZ("Fingering text:");if(null!==e)return rJ("add fingering text",async()=>{await rq();let t=rQ("addFingeringText");if(t)return t(e)})},onAddLeftHandGuitarFingeringText:()=>{let e=rZ("Left-hand guitar fingering text:");if(null!==e)return rJ("add left-hand guitar fingering text",async()=>{await rq();let t=rQ("addLeftHandGuitarFingeringText");if(t)return t(e)})},onAddRightHandGuitarFingeringText:()=>{let e=rZ("Right-hand guitar fingering text:");if(null!==e)return rJ("add right-hand guitar fingering text",async()=>{await rq();let t=rQ("addRightHandGuitarFingeringText");if(t)return t(e)})},onAddStringNumberText:()=>{let e=rZ("String number text:");if(null!==e)return rJ("add string number text",async()=>{await rq();let t=rQ("addStringNumberText");if(t)return t(e)})},onAddInstrumentChangeText:()=>{let e=rZ("Instrument change text:");if(null!==e)return rJ("add instrument change text",async()=>{await rq();let t=rQ("addInstrumentChangeText");if(t)return t(e)})},onAddStickingText:()=>{let e=rZ("Sticking text:");if(null!==e)return rJ("add sticking text",async()=>{await rq();let t=rQ("addStickingText");if(t)return t(e)})},onAddFiguredBassText:()=>{let e=rZ("Figured bass text:");if(null!==e)return rJ("add figured bass text",async()=>{await rq();let t=rQ("addFiguredBassText");if(t)return t(e)})},onAddArticulation:e=>rJ(`add articulation ${e}`,async()=>{await rq();let t=rQ("addArticulation");if(t)return t(e)}),onAddSlur:()=>rJ("add slur",async()=>{await rq();let e=rQ("addSlur");if(e)return e()}),onAddTie:nd,onAddGraceNote:e=>rJ(`add grace note ${e}`,async()=>{await rq();let t=rQ("addGraceNote");if(t)return t(e)}),onAddTuplet:e=>rJ(`add tuplet ${e}`,async()=>{await rq();let t=rQ("addTuplet");if(t)return t(e)}),onAddNoteFromRest:()=>rJ("add note",async()=>{await rq();let e=rQ("addNoteFromRest");if(e)return e()}),onToggleRepeatStart:()=>rJ("toggle repeat start",async()=>{await rq();let e=rQ("toggleRepeatStart");if(e)return e()}),onToggleRepeatEnd:()=>rJ("toggle repeat end",async()=>{await rq();let e=rQ("toggleRepeatEnd");if(e)return e()}),onSetRepeatCount:e=>rJ(`set repeat count ${e}`,async()=>{await rq();let t=rQ("setRepeatCount");if(t)return t(e)}),onSetBarLineType:e=>rJ(`set barline type ${e}`,async()=>{await rq();let t=rQ("setBarLineType");if(t)return t(e)}),onAddVolta:e=>rJ(`add volta ${e}`,async()=>{await rq();let t=rQ("addVolta");if(t)return t(e)}),onInsertMeasures:(e,t)=>rJ("insert measures",async()=>{await rq();let r=rQ("insertMeasures");return!!r&&r(Math.max(1,Math.floor(e)),Z[t]??Z["after-selection"])}),onRemoveTrailingEmptyMeasures:()=>rJ("remove trailing empty measures",async()=>{let e=rQ("removeTrailingEmptyMeasures");return!!e&&e()},{clearSelection:!0,skipWasmReselect:!0}),insertMeasuresDisabled:!t?.insertMeasures,parts:ek,instrumentGroups:eS,onAddPart:ny,onRemovePart:nb,onTogglePartVisible:nv,selectedTextActive:nV,selectedTextValue:C,onSelectedTextChange:r4,onApplySelectedText:r8,selectedTextDisabled:nq})}),(0,a.jsxs)("div",{className:"flex flex-1 min-h-0",children:[(0,a.jsxs)("aside",{className:`shrink-0 border-r bg-white text-sm ${eB?"w-12":"w-72"} ${eB?"":"overflow-y-auto"}`,"data-testid":"checkpoint-sidebar",children:[(0,a.jsxs)("div",{className:eB?"flex items-center justify-center p-2":"flex items-center justify-between p-4",children:[!eB&&(0,a.jsx)("span",{className:"text-xs font-semibold uppercase tracking-wide text-gray-500",children:"Checkpoints"}),(0,a.jsxs)("div",{className:eB?"":"flex items-center gap-2",children:[!eB&&(0,a.jsx)("button",{type:"button","data-testid":"btn-checkpoint-refresh",onClick:rA,disabled:nY,className:"text-xs font-medium text-gray-600 hover:text-gray-900 disabled:opacity-50 disabled:cursor-not-allowed",children:"Refresh"}),(0,a.jsx)("button",{type:"button","data-testid":"btn-checkpoint-toggle","aria-expanded":!eB,"aria-controls":"checkpoint-sidebar-content","aria-label":eB?"Show checkpoints":"Hide checkpoints",onClick:()=>eO(e=>!e),className:"text-xs font-medium text-gray-600 hover:text-gray-900",children:eB?">>":"<<"})]})]}),!eB&&(0,a.jsxs)("div",{id:"checkpoint-sidebar-content",className:"px-4 pb-4",children:[(0,a.jsxs)("div",{className:"mt-3 flex gap-2 text-xs font-medium text-gray-600",children:[(0,a.jsx)("button",{type:"button","data-testid":"tab-checkpoints",onClick:()=>ez("checkpoints"),className:`rounded border px-2 py-1 ${"checkpoints"===eU?"border-gray-400 bg-gray-100 text-gray-900":"border-transparent text-gray-500 hover:text-gray-700"}`,children:"Checkpoints"}),(0,a.jsx)("button",{type:"button","data-testid":"tab-scores",onClick:()=>ez("scores"),className:`rounded border px-2 py-1 ${"scores"===eU?"border-gray-400 bg-gray-100 text-gray-900":"border-transparent text-gray-500 hover:text-gray-700"}`,children:"Scores"})]}),"checkpoints"===eU&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"mt-3 flex flex-col gap-2",children:[(0,a.jsx)("input",{"data-testid":"input-checkpoint-label",type:"text",value:eN,onChange:e=>eA(e.target.value),placeholder:"Checkpoint label",className:"w-full rounded border border-gray-300 px-2 py-1 text-sm focus:border-blue-500 focus:outline-none"}),(0,a.jsx)("button",{type:"button","data-testid":"btn-checkpoint-save",onClick:rU,disabled:nK,className:`w-full rounded border px-3 py-1 text-sm font-medium disabled:opacity-50 disabled:cursor-not-allowed ${!nK&&eq?"border-blue-600 bg-blue-600 text-white hover:bg-blue-700":"border-gray-300 bg-white text-gray-700 hover:bg-gray-50"}`,children:"Save Checkpoint"}),!t&&(0,a.jsx)("span",{className:"text-xs text-gray-400",children:"Load a score to enable checkpoints."})]}),eP&&(0,a.jsx)("div",{className:"mt-3 text-xs text-red-600",children:eP}),eM&&(0,a.jsx)("div",{className:"mt-3 text-xs text-gray-400",children:"Loading checkpoints..."}),!eM&&0===eT.length&&(0,a.jsx)("div",{className:"mt-3 text-xs text-gray-400",children:"No checkpoints yet."}),(0,a.jsx)("div",{className:"mt-3 space-y-3",children:eT.map(e=>(0,a.jsxs)("div",{className:"rounded border border-gray-200 p-2",children:[(0,a.jsx)("div",{className:"text-sm font-medium text-gray-800",children:e.title}),(0,a.jsxs)("div",{className:"text-xs text-gray-500",children:[rd(e.createdAt),e.size?` \xb7 ${(e=>{if(!Number.isFinite(e))return"";let t=["B","KB","MB","GB"],r=e,n=0;for(;r>=1024&&n<t.length-1;)r/=1024,n+=1;let a=r>=10||0===n?0:1;return`${r.toFixed(a)} ${t[n]}`})(e.size)}`:""]}),(0,a.jsxs)("div",{className:"mt-2 flex flex-wrap gap-2",children:[(0,a.jsx)("button",{type:"button","data-testid":`btn-checkpoint-restore-${e.id}`,onClick:()=>rz(e),disabled:nY,className:"rounded border border-gray-300 px-2 py-1 text-xs text-gray-700 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"Restore"}),(0,a.jsx)("button",{type:"button","data-testid":`btn-checkpoint-compare-${e.id}`,onClick:()=>rX(e),disabled:nQ,className:"rounded border border-gray-300 px-2 py-1 text-xs text-gray-700 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"Compare"}),(0,a.jsx)("button",{type:"button","data-testid":`btn-checkpoint-delete-${e.id}`,onClick:()=>rH(e),disabled:nY,className:"rounded border border-gray-300 px-2 py-1 text-xs text-red-600 hover:bg-red-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"Delete"})]})]},e.id))})]}),"scores"===eU&&(0,a.jsxs)(a.Fragment,{children:[eG&&(0,a.jsx)("div",{className:"mt-3 text-xs text-red-600",children:eG}),eW&&(0,a.jsx)("div",{className:"mt-3 text-xs text-gray-400",children:"Loading scores..."}),!eW&&0===eX.length&&(0,a.jsx)("div",{className:"mt-3 text-xs text-gray-400",children:"No saved scores yet."}),(0,a.jsx)("div",{className:"mt-3 space-y-3",children:eX.map(e=>{let t=(e=>{if(e.startsWith("url:")){let t=e.slice(4);return{title:t.split("/").pop()||t,detail:t,type:"url"}}return e.startsWith("file:")?{title:e.slice(5).split(":")[0]||"File import",detail:"File import",type:"file"}:e.startsWith("new:")?{title:"New score",detail:e.slice(4),type:"new"}:"legacy"===e?{title:"Legacy checkpoints",detail:"Unscoped checkpoints",type:"legacy"}:{title:e,detail:"",type:"other"}})(e.scoreId),r=e.scoreId===tP;return(0,a.jsxs)("div",{className:`rounded border p-2 ${r?"border-blue-300 bg-blue-50":"border-gray-200"}`,children:[(0,a.jsxs)("div",{className:"flex items-center justify-between gap-2",children:[(0,a.jsx)("div",{className:"text-sm font-medium text-gray-800",children:t.title}),r&&(0,a.jsx)("span",{className:"text-[10px] font-semibold uppercase text-blue-700",children:"Current"})]}),t.detail&&(0,a.jsx)("div",{className:"text-xs text-gray-500 break-all",children:t.detail}),(0,a.jsxs)("div",{className:"mt-1 text-xs text-gray-500",children:[e.count," checkpoint",1===e.count?"":"s",e.lastUpdated?` \xb7 ${rd(e.lastUpdated)}`:""]}),(0,a.jsx)("div",{className:"mt-2 flex flex-wrap gap-2",children:(0,a.jsx)("button",{type:"button",onClick:()=>(e=>{if(!e.scoreId.startsWith("url:")){var t;return void((t=e.scoreId)&&(tI(t),!t.startsWith("url:")&&rm(t),ez("checkpoints")))}let r=e.scoreId.slice(4),n=new URL(window.location.href);n.searchParams.set("score",r),n.searchParams.delete("scoreId"),window.location.assign(n.toString())})(e),className:"rounded border border-gray-300 px-2 py-1 text-xs text-gray-700 hover:bg-gray-50",children:"Open score"})})]},e.scoreId)})})]})]})]}),(0,a.jsxs)("div",{ref:d,className:"relative z-0 flex-1 overflow-auto bg-gray-50 p-8",children:[p&&(0,a.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,a.jsx)("div",{className:"text-xl text-gray-500",children:"Loading score..."})}),!p&&!t&&(0,a.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,a.jsx)("div",{className:"text-xl text-gray-400",children:"No score loaded. Open a file to begin."})}),!p&&t&&(0,a.jsxs)("div",{className:"mb-3 flex items-center justify-end gap-2 text-sm text-gray-600",children:[(0,a.jsxs)("span",{"data-testid":"page-indicator",children:["Page ",tj+1," of ",tM]}),(0,a.jsx)("select",{className:"px-2 py-1 border border-gray-300 rounded bg-white text-sm",onChange:e=>{let t=Number(e.target.value);Number.isNaN(t)||rK(t)},value:tj,"data-testid":"page-select",children:Array.from({length:tM},(e,t)=>(0,a.jsxs)("option",{value:t,children:["Page ",t+1]},t))}),(0,a.jsx)("button",{type:"button",onClick:()=>void(!(tj<=0)&&rK(tj-1)),disabled:tj<=0,className:"px-3 py-1 bg-white border border-gray-300 rounded hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"Prev"}),(0,a.jsx)("button",{type:"button",onClick:()=>void(!(tj>=tM-1)&&rK(tj+1)),disabled:tj>=tM-1,className:"px-3 py-1 bg-white border border-gray-300 rounded hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"Next"})]}),(0,a.jsxs)("div",{ref:c,className:"relative origin-top-left transition-transform duration-200 ease-out bg-white shadow-lg mx-auto","data-testid":"score-wrapper",style:{transform:`scale(${s})`,width:"fit-content"},onClick:nW,onPointerDown:e=>{if(0!==e.button||X.current&&"pointer"!==X.current||null!==$.current||!u.current||!t)return;let r=nU(e.clientX,e.clientY);r&&($.current=e.pointerId,X.current="pointer",Y.current=!1,W.current={x:e.clientX,y:e.clientY},H.current=r,V.current=e.metaKey||e.ctrlKey,q.current=!1)},onPointerMove:e=>{if("pointer"!==X.current||(Y.current=!0,$.current!==e.pointerId))return;let t=W.current,r=H.current;if(!t||!r)return;let n=e.clientX-t.x,a=e.clientY-t.y;if(!q.current){if(4>Math.hypot(n,a))return;q.current=!0;try{e.currentTarget.setPointerCapture(e.pointerId)}catch{}}let o=nU(e.clientX,e.clientY);if(!o)return;let i=Math.min(r.x,o.x),s=Math.min(r.y,o.y);U({x:i,y:s,w:Math.max(r.x,o.x)-i,h:Math.max(r.y,o.y)-s}),e.preventDefault()},onPointerUp:nX,onPointerCancel:e=>{if("pointer"===X.current&&$.current===e.pointerId){X.current=null,Y.current=!1,$.current=null,W.current=null,H.current=null,V.current=!1,q.current=!1,U(null);try{e.currentTarget.releasePointerCapture(e.pointerId)}catch{}}},onMouseDown:e=>{if(0!==e.button||"pointer"===X.current||null!==$.current||!u.current||!t)return;let r=nU(e.clientX,e.clientY);r&&(X.current="mouse",$.current=-1,Y.current=!1,W.current={x:e.clientX,y:e.clientY},H.current=r,V.current=e.metaKey||e.ctrlKey,q.current=!1)},onMouseMove:e=>{if("pointer"===X.current&&!Y.current&&null!==$.current){let t=W.current,r=H.current;if(!t||!r)return;let n=e.clientX-t.x,a=e.clientY-t.y;if(!q.current){if(4>Math.hypot(n,a))return;q.current=!0;try{e.currentTarget.setPointerCapture($.current)}catch{}}let o=nU(e.clientX,e.clientY);if(!o)return;let i=Math.min(r.x,o.x),s=Math.min(r.y,o.y);U({x:i,y:s,w:Math.max(r.x,o.x)-i,h:Math.max(r.y,o.y)-s}),e.preventDefault();return}if("mouse"!==X.current||-1!==$.current)return;let t=W.current,r=H.current;if(!t||!r)return;let n=e.clientX-t.x,a=e.clientY-t.y;if(!q.current){if(4>Math.hypot(n,a))return;q.current=!0}let o=nU(e.clientX,e.clientY);if(!o)return;let i=Math.min(r.x,o.x),s=Math.min(r.y,o.y);U({x:i,y:s,w:Math.max(r.x,o.x)-i,h:Math.max(r.y,o.y)-s}),e.preventDefault()},onMouseUp:n$,onContextMenu:e=>{(e=>{if(!u.current||!t)return;let r=e.target,n=!1;for(;r;){if(eo(r)){n=!0,r=es(r);break}if(r===u.current)break;r=r.parentElement}n&&r?(e.preventDefault(),nW(e),B({x:e.clientX,y:e.clientY})):B(null)})(e)},children:[(0,a.jsx)("div",{ref:u,"data-testid":"svg-container"}),O&&(0,a.jsx)("div",{"data-testid":"drag-selection-rect",className:"absolute border border-blue-600 bg-blue-200 bg-opacity-20 pointer-events-none",style:{left:O.x,top:O.y,width:O.w,height:O.h}}),nG.map(e=>(0,a.jsx)("div",{className:"absolute pointer-events-none",style:{left:e.x,top:e.y,width:e.w,height:e.h}},null!==e.index?`sel-${e.index}`:`sel-${e.page}-${e.x}-${e.y}-${e.w}-${e.h}`)),h&&!_&&(0,a.jsx)("div",{"data-testid":"selection-overlay",className:"absolute pointer-events-none",style:{left:h.x,top:h.y,width:h.w,height:h.h}}),R&&(0,a.jsxs)("div",{className:"fixed z-50 flex flex-col gap-2 rounded border bg-white p-3 shadow-lg",style:{left:R.x,top:R.y},onClick:e=>e.stopPropagation(),onMouseDown:e=>e.stopPropagation(),onPointerDown:e=>e.stopPropagation(),children:[(0,a.jsx)("label",{className:"text-xs uppercase tracking-wide text-gray-500",children:"Text content"}),(0,a.jsx)("input",{"data-testid":"ctxmenu-text-input",type:"text",value:C,onChange:e=>r4(e.target.value),onClick:e=>e.stopPropagation(),className:"min-w-[200px] rounded border border-gray-300 px-2 py-1 text-sm focus:border-blue-500 focus:outline-none"}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)("button",{type:"button",onClick:()=>{r8(),nH()},className:"flex-1 rounded border border-gray-300 px-3 py-1 text-sm font-medium text-gray-700 hover:bg-gray-100",children:"Save"}),(0,a.jsx)("button",{type:"button",onClick:nH,className:"flex-1 rounded border border-gray-300 px-3 py-1 text-sm font-medium text-gray-700 hover:bg-gray-100",children:"Cancel"})]})]})]})]}),(0,a.jsxs)("aside",{className:`shrink-0 border-l bg-white text-sm ${"closed"===eZ?"w-12":"full"===eZ?"w-full":"w-80"} ${"closed"===eZ?"":"overflow-y-auto"}`,"data-testid":"xml-sidebar",children:[(0,a.jsxs)("div",{className:"sticky top-0 z-10 bg-white",children:[(0,a.jsxs)("div",{className:"closed"===eZ?"flex items-center justify-center p-2":"flex items-center justify-between p-4",children:["closed"!==eZ&&(0,a.jsx)("span",{className:"text-xs font-semibold uppercase tracking-wide text-gray-500",children:"MusicXML"}),(0,a.jsx)("button",{type:"button","data-testid":"btn-xml-toggle","aria-expanded":"closed"!==eZ,"aria-controls":"xml-sidebar-content","aria-label":"closed"===eZ?"Open MusicXML sidebar":"open"===eZ?"Expand MusicXML sidebar":"Close MusicXML sidebar",onClick:()=>{eJ(e=>"closed"===e?"open":"open"===e?"full":"closed")},className:"text-xs font-medium text-gray-600 hover:text-gray-900",children:"closed"===eZ?"Open":"open"===eZ?"Full":"Close"})]}),"closed"!==eZ&&(0,a.jsxs)("div",{className:"px-4 pb-3",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between text-xs text-gray-500",children:[(0,a.jsx)("span",{children:0===eT.length?"No checkpoint yet":eq?"Unsaved score changes":""}),e5&&(0,a.jsx)("span",{children:"Loading..."})]}),(0,a.jsxs)("div",{className:"mt-3 flex items-center justify-between text-xs font-medium text-gray-600",children:[(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)("button",{type:"button","data-testid":"tab-xml",onClick:()=>e1("xml"),className:`rounded border px-2 py-1 ${"xml"===e0?"border-gray-400 bg-gray-100 text-gray-900":"border-transparent text-gray-500 hover:text-gray-700"}`,children:"XML"}),(0,a.jsx)("button",{type:"button","data-testid":"tab-ai",onClick:()=>e1("assistant"),className:`rounded border px-2 py-1 ${"assistant"===e0?"border-gray-400 bg-gray-100 text-gray-900":"border-transparent text-gray-500 hover:text-gray-700"}`,children:"Assistant"})]}),(0,a.jsx)("div",{})]})]})]}),"closed"!==eZ&&(0,a.jsxs)("div",{id:"xml-sidebar-content",className:"px-4 pb-4",children:["xml"===e0&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"mt-3 flex flex-wrap gap-2",children:[(0,a.jsx)("button",{type:"button","data-testid":"btn-xml-apply",onClick:rW,disabled:!nJ,title:"Applying edits will auto-checkpoint if the score has unsaved changes.",className:`flex-1 rounded border px-3 py-1 text-xs font-medium disabled:opacity-50 disabled:cursor-not-allowed ${nJ?"border-blue-600 bg-blue-600 text-white hover:bg-blue-700":"border-gray-300 bg-white text-gray-700"}`,children:"Apply edits"}),(0,a.jsx)("button",{type:"button","data-testid":"btn-xml-reload",onClick:r$,disabled:!n0,title:n0?"The score has changed, reload to update XML. Any XML changes will be lost on update.":void 0,className:`flex-1 rounded border px-3 py-1 text-xs font-medium disabled:opacity-50 disabled:cursor-not-allowed ${n0?"border-blue-600 bg-blue-600 text-white hover:bg-blue-700":"border-gray-300 bg-white text-gray-700"}`,children:"Reload"})]}),(0,a.jsx)("div",{className:"mt-2",children:(0,a.jsx)(G,{testId:"xml-editor",value:e2,onChange:e=>{e4(e),e3(!0)},readOnly:nZ,placeholderText:t?"MusicXML will appear here.":"Load a score to view MusicXML."})})]}),"assistant"===e0&&(0,a.jsxs)("div",{className:"mt-3 space-y-3 text-sm text-gray-700",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-xs font-semibold uppercase tracking-wide text-gray-500",children:"OpenAI Model"}),(0,a.jsxs)("select",{value:te,onChange:e=>tt(e.target.value),className:"mt-1 w-full rounded border border-gray-300 px-2 py-1 text-sm",disabled:!tS.length,children:[tT&&(0,a.jsx)("option",{children:"Loading models..."}),!tT&&!tS.length&&(0,a.jsx)("option",{children:"No models loaded"}),tS.map(e=>(0,a.jsx)("option",{value:e,children:e},e))]}),tN&&(0,a.jsx)("div",{className:"mt-1 text-xs text-red-600",children:tN})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-xs font-semibold uppercase tracking-wide text-gray-500",children:"API Key"}),(0,a.jsx)("input",{type:"password",value:tr,onChange:e=>tn(e.target.value),className:"mt-1 w-full rounded border border-gray-300 px-2 py-1 text-sm",placeholder:"Paste your key"}),(0,a.jsx)("div",{className:"mt-1 text-[11px] text-gray-500",children:"Stored locally in this browser."})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between gap-2 text-xs text-gray-600",children:[(0,a.jsxs)("label",{className:"flex items-center gap-2",children:[(0,a.jsx)("input",{type:"checkbox",checked:ti,onChange:e=>ts(e.target.checked)}),"Include full MusicXML"]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("span",{children:"Max output"}),(0,a.jsxs)("select",{value:tl,onChange:e=>tu(e.target.value),className:"rounded border border-gray-300 px-2 py-1 text-xs",children:[(0,a.jsx)("option",{value:"auto",children:"Auto"}),(0,a.jsx)("option",{value:"custom",children:"Custom"})]}),"custom"===tl&&(0,a.jsx)("input",{type:"number",min:256,value:tc,onChange:e=>td(Number(e.target.value)||0),className:"w-20 rounded border border-gray-300 px-2 py-1 text-xs"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-xs font-semibold uppercase tracking-wide text-gray-500",children:"Instruction"}),(0,a.jsx)("textarea",{value:ta,onChange:e=>to(e.target.value),rows:4,className:"mt-1 w-full rounded border border-gray-300 px-2 py-1 text-sm",placeholder:"Describe the change you want in the MusicXML."})]}),(0,a.jsx)("button",{type:"button",onClick:rG,disabled:tx,className:"w-full rounded border border-gray-300 bg-white px-3 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:tx?"Working...":"Generate Patch"}),tk&&(0,a.jsx)("div",{className:"text-xs text-red-600",children:tk}),tf&&(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between text-xs text-gray-500",children:[(0,a.jsx)("span",{children:"AI Patch"}),n1.message&&(0,a.jsx)("span",{className:n1.valid?"text-gray-500":"text-red-600",children:n1.message})]}),(0,a.jsx)(G,{value:tf,onChange:()=>{},readOnly:!0,placeholderText:"AI patch will appear here."}),(0,a.jsx)("button",{type:"button",onClick:rV,disabled:n2,title:"Applying edits will auto-checkpoint if the score has unsaved changes.",className:"w-full rounded border border-gray-300 bg-white px-3 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"Apply Patch"})]})]}),e7&&(0,a.jsx)("div",{className:"mt-2 text-xs text-red-600",children:e7})]})]}),tL&&(0,a.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/40 p-6","data-testid":"new-score-modal",children:(0,a.jsxs)("div",{className:"w-full max-w-xl rounded bg-white p-4 shadow-lg",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("div",{className:"text-sm font-semibold text-gray-800",children:"New Score"}),(0,a.jsx)("button",{type:"button",onClick:()=>tR(!1),className:"rounded border border-gray-300 px-2 py-1 text-xs text-gray-700 hover:bg-gray-50",children:"Close"})]}),(0,a.jsxs)("div",{className:"mt-4 grid gap-3 text-sm text-gray-700",children:[(0,a.jsx)("div",{className:"rounded border border-amber-200 bg-amber-50 px-3 py-2 text-xs text-amber-900",children:"Creating a new score will replace the current score and switch to a new checkpoint set. Export your score if you want a copy; you can return to the previous URL to access older checkpoints."}),t2&&(0,a.jsx)("div",{className:"rounded border border-amber-200 bg-amber-50 px-3 py-2 text-xs text-amber-900",children:t2}),t5&&(0,a.jsx)("div",{className:"rounded border border-amber-200 bg-amber-50 px-3 py-2 text-xs text-amber-900",children:t5}),(0,a.jsxs)("label",{className:"flex flex-col gap-1",children:[(0,a.jsx)("span",{className:"text-xs font-semibold uppercase tracking-wide text-gray-500",children:"Title"}),(0,a.jsx)("input",{type:"text",value:tB,onChange:e=>tO(e.target.value),className:"rounded border border-gray-300 px-2 py-1 text-sm",placeholder:"Untitled score"})]}),(0,a.jsxs)("label",{className:"flex flex-col gap-1",children:[(0,a.jsx)("span",{className:"text-xs font-semibold uppercase tracking-wide text-gray-500",children:"Composer"}),(0,a.jsx)("input",{type:"text",value:tU,onChange:e=>tz(e.target.value),className:"rounded border border-gray-300 px-2 py-1 text-sm",placeholder:"Composer"})]}),(0,a.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,a.jsx)("span",{className:"text-xs font-semibold uppercase tracking-wide text-gray-500",children:"Instruments"}),rb.length>0?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsxs)("select",{value:tW,onChange:e=>tH(e.target.value),className:"flex-1 rounded border border-gray-300 px-2 py-1 text-sm",children:[rx.length>0&&(0,a.jsx)("optgroup",{label:"Common",children:rx.map((e,t)=>(0,a.jsx)("option",{value:e.instrument.id,children:e.label},`common-${e.instrument.id}-${t}`))}),ry.length>0?ry.map(e=>(0,a.jsx)("optgroup",{label:e.name,children:e.instruments.map(e=>(0,a.jsx)("option",{value:e.id,children:e.name},e.id))},e.id)):rb.map(e=>(0,a.jsx)("option",{value:e.id,children:e.label},e.id))]}),(0,a.jsx)("button",{type:"button",onClick:()=>{tW&&t$(e=>[...e,tW])},disabled:!tW,className:"rounded border border-gray-300 bg-white px-3 py-1 text-sm text-gray-700 hover:bg-gray-50 disabled:cursor-not-allowed disabled:opacity-50",children:"Add"})]}),(0,a.jsx)("div",{className:"space-y-1 rounded border border-gray-200 bg-gray-50 p-2 text-xs text-gray-700",children:tX.length>0?tX.map((e,t)=>{let r=rb.find(t=>t.id===e),n=r?.label||r?.name||e;return(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("span",{className:"flex-1 truncate",children:n}),(0,a.jsx)("button",{type:"button",onClick:()=>{t$(e=>e.filter((e,r)=>r!==t))},className:"rounded border border-gray-300 bg-white px-2 py-0.5 text-[11px] text-gray-700 hover:bg-gray-100",children:"Remove"})]},`${e}-${t}`)}):(0,a.jsx)("div",{className:"text-gray-500",children:"No instruments selected."})})]}):(0,a.jsx)("div",{className:"rounded border border-gray-200 bg-gray-50 px-2 py-1 text-xs text-gray-500",children:"Instrument list unavailable."})]}),(0,a.jsxs)("div",{className:"grid gap-3 sm:grid-cols-2",children:[(0,a.jsxs)("label",{className:"flex flex-col gap-1",children:[(0,a.jsx)("span",{className:"text-xs font-semibold uppercase tracking-wide text-gray-500",children:"Measures"}),(0,a.jsx)("input",{type:"number",min:1,value:tG,onChange:e=>tV(Number(e.target.value)||1),className:"rounded border border-gray-300 px-2 py-1 text-sm"})]}),(0,a.jsxs)("label",{className:"flex flex-col gap-1",children:[(0,a.jsx)("span",{className:"text-xs font-semibold uppercase tracking-wide text-gray-500",children:"Key Signature"}),(0,a.jsx)("select",{value:String(tq),onChange:e=>tY(Number(e.target.value)),className:"rounded border border-gray-300 px-2 py-1 text-sm",children:[{label:"C",fifths:0},{label:"G",fifths:1},{label:"D",fifths:2},{label:"A",fifths:3},{label:"E",fifths:4},{label:"B",fifths:5},{label:"F#",fifths:6},{label:"C#",fifths:7},{label:"F",fifths:-1},{label:"Bb",fifths:-2},{label:"Eb",fifths:-3},{label:"Ab",fifths:-4},{label:"Db",fifths:-5},{label:"Gb",fifths:-6},{label:"Cb",fifths:-7}].map(e=>(0,a.jsx)("option",{value:e.fifths,children:e.label},e.fifths))})]})]}),(0,a.jsxs)("label",{className:"flex flex-col gap-1",children:[(0,a.jsx)("span",{className:"text-xs font-semibold uppercase tracking-wide text-gray-500",children:"Time Signature"}),(0,a.jsx)("select",{value:`${tK}/${tZ}`,onChange:e=>{let[t,r]=e.target.value.split("/").map(e=>Number(e));Number.isFinite(t)&&Number.isFinite(r)&&(tQ(t),tJ(r))},className:"rounded border border-gray-300 px-2 py-1 text-sm",children:[{label:"4/4",numerator:4,denominator:4},{label:"3/4",numerator:3,denominator:4},{label:"2/4",numerator:2,denominator:4},{label:"6/8",numerator:6,denominator:8},{label:"2/2",numerator:2,denominator:2},{label:"5/4",numerator:5,denominator:4},{label:"7/8",numerator:7,denominator:8},{label:"3/8",numerator:3,denominator:8},{label:"9/8",numerator:9,denominator:8},{label:"12/8",numerator:12,denominator:8}].map(e=>(0,a.jsx)("option",{value:`${e.numerator}/${e.denominator}`,children:e.label},e.label))})]})]}),(0,a.jsxs)("div",{className:"mt-4 flex gap-2",children:[(0,a.jsx)("button",{type:"button",onClick:rO,className:"flex-1 rounded border border-gray-300 bg-blue-600 px-3 py-2 text-sm font-medium text-white hover:bg-blue-700",children:"Create Score"}),(0,a.jsx)("button",{type:"button",onClick:()=>tR(!1),className:"flex-1 rounded border border-gray-300 bg-white px-3 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50",children:"Cancel"})]})]})}),eL&&(0,a.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/40 p-6","data-testid":"checkpoint-compare-modal",children:(0,a.jsxs)("div",{className:"flex w-full max-w-6xl flex-col gap-4 rounded bg-white p-4 shadow-lg",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("div",{className:"text-sm font-semibold text-gray-800",children:"Compare Checkpoint"}),(0,a.jsx)("button",{type:"button",onClick:()=>eR(null),className:"rounded border border-gray-300 px-2 py-1 text-xs text-gray-700 hover:bg-gray-50",children:"Close"})]}),(0,a.jsxs)("div",{className:"grid gap-4 md:grid-cols-2",children:[(0,a.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,a.jsx)("span",{className:"text-xs font-semibold uppercase tracking-wide text-gray-500",children:"Current"}),(0,a.jsx)("textarea",{readOnly:!0,value:eL.currentXml,className:"h-96 w-full rounded border border-gray-200 bg-gray-50 p-2 font-mono text-xs text-gray-700"})]}),(0,a.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,a.jsx)("span",{className:"text-xs font-semibold uppercase tracking-wide text-gray-500",children:eL.title}),(0,a.jsx)("textarea",{readOnly:!0,value:eL.checkpointXml,className:"h-96 w-full rounded border border-gray-200 bg-gray-50 p-2 font-mono text-xs text-gray-700"})]})]})]})})]})]})}}}]);